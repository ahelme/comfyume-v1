{"version":3,"file":"index-tImAQKwZ.js","sources":["../../src/extensions/core/clipspace.ts","../../src/extensions/core/contextMenuFilter.ts","../../src/extensions/core/customCombo.ts","../../src/extensions/core/dynamicPrompts.ts","../../src/extensions/core/editAttention.ts","../../src/constants/uvMirrors.ts","../../src/utils/electronMirrorCheck.ts","../../src/extensions/core/electronAdapter.ts","../../src/utils/executableGroupNodeChildDTO.ts","../../src/extensions/core/groupNodeManage.ts","../../src/utils/nodeDefUtil.ts","../../src/renderer/utils/nodeTypeGuards.ts","../../src/extensions/core/widgetInputs.ts","../../src/extensions/core/groupNode.ts","../../src/extensions/core/groupOptions.ts","../../src/extensions/core/imageCompare.ts","../../src/extensions/core/load3d/exportMenuHelper.ts","../../src/extensions/core/load3d/Load3DConfiguration.ts","../../src/extensions/core/load3d.ts","../../src/extensions/core/maskeditor.ts","../../src/extensions/core/nodeTemplates.ts","../../src/extensions/core/noteNode.ts","../../src/extensions/core/previewAny.ts","../../src/extensions/core/rerouteNode.ts","../../src/extensions/core/saveImageExtraOutput.ts","../../src/extensions/core/saveMesh.ts","../../src/extensions/core/selectionBorder.ts","../../src/extensions/core/simpleTouchSupport.ts","../../src/extensions/core/slotDefaults.ts","../../src/extensions/core/uploadAudio.ts","../../src/extensions/core/uploadImage.ts","../../src/extensions/core/webcamCapture.ts"],"sourcesContent":["import { app } from '../../scripts/app'\nimport { ComfyApp } from '../../scripts/app'\nimport { $el, ComfyDialog } from '../../scripts/ui'\n\nexport class ClipspaceDialog extends ComfyDialog {\n  static items: Array<\n    HTMLButtonElement & {\n      contextPredicate?: () => boolean\n    }\n  > = []\n  static instance: ClipspaceDialog | null = null\n\n  static registerButton(\n    name: string,\n    contextPredicate: () => boolean,\n    callback: () => void\n  ) {\n    const item = $el('button', {\n      type: 'button',\n      textContent: name,\n      contextPredicate: contextPredicate,\n      onclick: callback\n    })\n\n    ClipspaceDialog.items.push(item)\n  }\n\n  static invalidatePreview() {\n    if (\n      ComfyApp.clipspace &&\n      ComfyApp.clipspace.imgs &&\n      ComfyApp.clipspace.imgs.length > 0\n    ) {\n      const img_preview = document.getElementById(\n        'clipspace_preview'\n      ) as HTMLImageElement\n      if (img_preview) {\n        img_preview.src =\n          ComfyApp.clipspace.imgs[ComfyApp.clipspace['selectedIndex']].src\n        img_preview.style.maxHeight = '100%'\n        img_preview.style.maxWidth = '100%'\n      }\n    }\n  }\n\n  static invalidate() {\n    if (ClipspaceDialog.instance) {\n      const self = ClipspaceDialog.instance\n      // allow reconstruct controls when copying from non-image to image content.\n      const children = $el('div.comfy-modal-content', [\n        self.createImgSettings(),\n        ...self.createButtons()\n      ])\n\n      if (self.element) {\n        // update\n        if (self.element.firstChild) {\n          self.element.removeChild(self.element.firstChild)\n        }\n        self.element.appendChild(children)\n      } else {\n        // new\n        self.element = $el('div.comfy-modal', { parent: document.body }, [\n          children\n        ])\n      }\n\n      if (self.element.children[0].children.length <= 1) {\n        self.element.children[0].appendChild(\n          $el('p', {}, [\n            'Unable to find the features to edit content of a format stored in the current Clipspace.'\n          ])\n        )\n      }\n\n      ClipspaceDialog.invalidatePreview()\n    }\n  }\n\n  constructor() {\n    super()\n  }\n\n  override createButtons() {\n    const buttons = []\n\n    for (let idx in ClipspaceDialog.items) {\n      const item = ClipspaceDialog.items[idx]\n      if (!item.contextPredicate || item.contextPredicate())\n        buttons.push(ClipspaceDialog.items[idx])\n    }\n\n    buttons.push(\n      $el('button', {\n        type: 'button',\n        textContent: 'Close',\n        onclick: () => {\n          this.close()\n        }\n      })\n    )\n\n    return buttons\n  }\n\n  createImgSettings() {\n    if (ComfyApp.clipspace?.imgs) {\n      const combo_items = []\n      const imgs = ComfyApp.clipspace.imgs\n\n      for (let i = 0; i < imgs.length; i++) {\n        combo_items.push($el('option', { value: i }, [`${i}`]))\n      }\n\n      const combo1 = $el(\n        'select',\n        {\n          id: 'clipspace_img_selector',\n          onchange: (event: Event) => {\n            if (event.target && ComfyApp.clipspace) {\n              ComfyApp.clipspace['selectedIndex'] = (\n                event.target as HTMLSelectElement\n              ).selectedIndex\n              ClipspaceDialog.invalidatePreview()\n            }\n          }\n        },\n        combo_items\n      )\n\n      const row1 = $el('tr', {}, [\n        $el('td', {}, [$el('font', { color: 'white' }, ['Select Image'])]),\n        $el('td', {}, [combo1])\n      ])\n\n      const combo2 = $el(\n        'select',\n        {\n          id: 'clipspace_img_paste_mode',\n          onchange: (event: Event) => {\n            if (event.target && ComfyApp.clipspace) {\n              ComfyApp.clipspace['img_paste_mode'] = (\n                event.target as HTMLSelectElement\n              ).value\n            }\n          }\n        },\n        [\n          $el('option', { value: 'selected' }, 'selected'),\n          $el('option', { value: 'all' }, 'all')\n        ]\n      ) as HTMLSelectElement\n      combo2.value = ComfyApp.clipspace['img_paste_mode']\n\n      const row2 = $el('tr', {}, [\n        $el('td', {}, [$el('font', { color: 'white' }, ['Paste Mode'])]),\n        $el('td', {}, [combo2])\n      ])\n\n      const td = $el(\n        'td',\n        { align: 'center', width: '100px', height: '100px', colSpan: '2' },\n        [$el('img', { id: 'clipspace_preview', ondragstart: () => false }, [])]\n      )\n\n      const row3 = $el('tr', {}, [td])\n\n      return $el('table', {}, [row1, row2, row3])\n    } else {\n      return []\n    }\n  }\n\n  createImgPreview() {\n    if (ComfyApp.clipspace?.imgs) {\n      return $el('img', { id: 'clipspace_preview', ondragstart: () => false })\n    } else return []\n  }\n\n  override show() {\n    ClipspaceDialog.invalidate()\n\n    this.element.style.display = 'block'\n  }\n}\n\napp.registerExtension({\n  name: 'Comfy.Clipspace',\n  init(app) {\n    app.openClipspace = function () {\n      if (!ClipspaceDialog.instance) {\n        ClipspaceDialog.instance = new ClipspaceDialog()\n        ComfyApp.clipspace_invalidate_handler = ClipspaceDialog.invalidate\n      }\n\n      if (ComfyApp.clipspace) {\n        ClipspaceDialog.instance.show()\n      } else app.ui.dialog.show('Clipspace is Empty!')\n    }\n  }\n})\n","import {\n  LGraphCanvas,\n  LiteGraph,\n  isComboWidget\n} from '@/lib/litegraph/src/litegraph'\n\nimport { app } from '../../scripts/app'\n\n// Adds filtering to combo context menus\n\nconst ext = {\n  name: 'Comfy.ContextMenuFilter',\n  init() {\n    const ctxMenu = LiteGraph.ContextMenu\n\n    // @ts-expect-error TODO Very hacky way to modify Litegraph behaviour. Fix ctx later.\n    LiteGraph.ContextMenu = function (values, options) {\n      const ctx = new ctxMenu(values, options)\n\n      // If we are a dark menu (only used for combo boxes) then add a filter input\n      if (options?.className === 'dark' && values?.length > 4) {\n        const filter = document.createElement('input')\n        filter.classList.add('comfy-context-menu-filter')\n        filter.placeholder = 'Filter list'\n\n        ctx.root.prepend(filter)\n\n        const items = Array.from(\n          ctx.root.querySelectorAll('.litemenu-entry')\n        ) as HTMLElement[]\n        let displayedItems = [...items]\n        let itemCount = displayedItems.length\n\n        // We must request an animation frame for the current node of the active canvas to update.\n        requestAnimationFrame(() => {\n          const currentNode = LGraphCanvas.active_canvas.current_node\n          const clickedComboValue = currentNode?.widgets\n            ?.filter(\n              (w) =>\n                isComboWidget(w) && w.options.values?.length === values.length\n            )\n            .find((w) =>\n              // @ts-expect-error Poorly typed; filter above \"should\" mitigate exceptions\n              w.options.values?.every((v, i) => v === values[i])\n            )?.value\n\n          let selectedIndex = clickedComboValue\n            ? values.findIndex((v: string) => v === clickedComboValue)\n            : 0\n          if (selectedIndex < 0) {\n            selectedIndex = 0\n          }\n          let selectedItem = displayedItems[selectedIndex]\n          updateSelected()\n\n          // Apply highlighting to the selected item\n          function updateSelected() {\n            selectedItem?.style.setProperty('background-color', '')\n            selectedItem?.style.setProperty('color', '')\n            selectedItem = displayedItems[selectedIndex]\n            selectedItem?.style.setProperty(\n              'background-color',\n              '#ccc',\n              'important'\n            )\n            selectedItem?.style.setProperty('color', '#000', 'important')\n          }\n\n          const positionList = () => {\n            const rect = ctx.root.getBoundingClientRect()\n\n            // If the top is off-screen then shift the element with scaling applied\n            if (rect.top < 0) {\n              const scale =\n                1 -\n                ctx.root.getBoundingClientRect().height / ctx.root.clientHeight\n\n              const shift = (ctx.root.clientHeight * scale) / 2\n\n              ctx.root.style.top = -shift + 'px'\n            }\n          }\n\n          // Arrow up/down to select items\n          filter.addEventListener('keydown', (event) => {\n            switch (event.key) {\n              case 'ArrowUp':\n                event.preventDefault()\n                if (selectedIndex === 0) {\n                  selectedIndex = itemCount - 1\n                } else {\n                  selectedIndex--\n                }\n                updateSelected()\n                break\n              case 'ArrowRight':\n                event.preventDefault()\n                selectedIndex = itemCount - 1\n                updateSelected()\n                break\n              case 'ArrowDown':\n                event.preventDefault()\n                if (selectedIndex === itemCount - 1) {\n                  selectedIndex = 0\n                } else {\n                  selectedIndex++\n                }\n                updateSelected()\n                break\n              case 'ArrowLeft':\n                event.preventDefault()\n                selectedIndex = 0\n                updateSelected()\n                break\n              case 'Enter':\n                selectedItem?.click()\n                break\n              case 'Escape':\n                ctx.close()\n                break\n            }\n          })\n\n          filter.addEventListener('input', () => {\n            // Hide all items that don't match our filter\n            const term = filter.value.toLocaleLowerCase()\n            // When filtering, recompute which items are visible for arrow up/down and maintain selection.\n            displayedItems = items.filter((item) => {\n              const isVisible =\n                !term || item.textContent?.toLocaleLowerCase().includes(term)\n              item.style.display = isVisible ? 'block' : 'none'\n              return isVisible\n            })\n\n            selectedIndex = 0\n            if (displayedItems.includes(selectedItem)) {\n              selectedIndex = displayedItems.findIndex(\n                (d) => d === selectedItem\n              )\n            }\n            itemCount = displayedItems.length\n\n            updateSelected()\n\n            // If we have an event then we can try and position the list under the source\n            if (options.event) {\n              let top = options.event.clientY - 10\n\n              const bodyRect = document.body.getBoundingClientRect()\n\n              const rootRect = ctx.root.getBoundingClientRect()\n              if (\n                bodyRect.height &&\n                top > bodyRect.height - rootRect.height - 10\n              ) {\n                top = Math.max(0, bodyRect.height - rootRect.height - 10)\n              }\n\n              ctx.root.style.top = top + 'px'\n              positionList()\n            }\n          })\n\n          requestAnimationFrame(() => {\n            // Focus the filter box when opening\n            filter.focus()\n\n            positionList()\n          })\n        })\n      }\n\n      return ctx\n    }\n\n    LiteGraph.ContextMenu.prototype = ctxMenu.prototype\n  }\n}\n\napp.registerExtension(ext)\n","import { shallowReactive } from 'vue'\n\nimport { useChainCallback } from '@/composables/functional/useChainCallback'\nimport type { CanvasPointerEvent } from '@/lib/litegraph/src/types/events'\nimport { LGraphNode } from '@/lib/litegraph/src/LGraphNode'\nimport { LLink } from '@/lib/litegraph/src/litegraph'\nimport { app } from '@/scripts/app'\n\nfunction applyToGraph(this: LGraphNode, extraLinks: LLink[] = []) {\n  if (!this.outputs[0].links?.length || !this.graph) return\n\n  const links = [\n    ...this.outputs[0].links.map((l) => this.graph!.links[l]),\n    ...extraLinks\n  ]\n  let v = this.widgets?.[0].value\n  // For each output link copy our value over the original widget value\n  for (const linkInfo of links) {\n    const node = this.graph?.getNodeById(linkInfo.target_id)\n    const input = node?.inputs[linkInfo.target_slot]\n    if (!input) {\n      console.warn('Unable to resolve node or input for link', linkInfo)\n      continue\n    }\n\n    const widgetName = input.widget?.name\n    if (!widgetName) {\n      console.warn('Invalid widget or widget name', input.widget)\n      continue\n    }\n\n    const widget = node.widgets?.find((w) => w.name === widgetName)\n    if (!widget) {\n      console.warn(`Unable to find widget \"${widgetName}\" on node [${node.id}]`)\n      continue\n    }\n\n    widget.value = v\n    widget.callback?.(\n      widget.value,\n      app.canvas,\n      node,\n      app.canvas.graph_mouse,\n      {} as CanvasPointerEvent\n    )\n  }\n}\n\nfunction onNodeCreated(this: LGraphNode) {\n  this.applyToGraph = useChainCallback(this.applyToGraph, applyToGraph)\n\n  const comboWidget = this.widgets![0]\n  const values = shallowReactive<string[]>([])\n  comboWidget.options.values = values\n\n  const updateCombo = () => {\n    values.splice(\n      0,\n      values.length,\n      ...this.widgets!.filter(\n        (w) => w.name.startsWith('option') && w.value\n      ).map((w) => `${w.value}`)\n    )\n    if (app.configuringGraph) return\n    if (values.includes(`${comboWidget.value}`)) return\n    comboWidget.value = values[0] ?? ''\n    comboWidget.callback?.(comboWidget.value)\n  }\n  comboWidget.callback = useChainCallback(comboWidget.callback, () =>\n    this.applyToGraph!()\n  )\n\n  function addOption(node: LGraphNode) {\n    if (!node.widgets) return\n    const newCount = node.widgets.length - 1\n    node.addWidget('string', `option${newCount}`, '', () => {})\n    const widget = node.widgets.at(-1)\n    if (!widget) return\n\n    let value = ''\n    Object.defineProperty(widget, 'value', {\n      get() {\n        return value\n      },\n      set(v) {\n        value = v\n        updateCombo()\n        if (!node.widgets) return\n        const lastWidget = node.widgets.at(-1)\n        if (lastWidget === this) {\n          if (v) addOption(node)\n          return\n        }\n        if (v || node.widgets.at(-2) !== this || lastWidget?.value) return\n        node.widgets.pop()\n        node.computeSize(node.size)\n        this.callback(v)\n      }\n    })\n  }\n  addOption(this)\n}\n\napp.registerExtension({\n  name: 'Comfy.CustomCombo',\n  beforeRegisterNodeDef(nodeType, nodeData) {\n    if (nodeData?.name !== 'CustomCombo') return\n    nodeType.prototype.onNodeCreated = useChainCallback(\n      nodeType.prototype.onNodeCreated,\n      onNodeCreated\n    )\n  }\n})\n","import { useExtensionService } from '@/services/extensionService'\nimport { processDynamicPrompt } from '@/utils/formatUtil'\n\n// Allows for simple dynamic prompt replacement\n// Inputs in the format {a|b} will have a random value of a or b chosen when the prompt is queued.\n\nuseExtensionService().registerExtension({\n  name: 'Comfy.DynamicPrompts',\n  nodeCreated(node) {\n    if (node.widgets) {\n      // Locate dynamic prompt text widgets\n      // Include any widgets with dynamicPrompts set to true, and customtext\n      const widgets = node.widgets.filter((w) => w.dynamicPrompts)\n      for (const widget of widgets) {\n        // Override the serialization of the value to resolve dynamic prompts for all widgets supporting it in this node\n        widget.serializeValue = (workflowNode, widgetIndex) => {\n          if (typeof widget.value !== 'string') return widget.value\n\n          const prompt = processDynamicPrompt(widget.value)\n\n          // Overwrite the value in the serialized workflow pnginfo\n          if (workflowNode?.widgets_values)\n            workflowNode.widgets_values[widgetIndex] = prompt\n\n          return prompt\n        }\n      }\n    }\n  }\n})\n","import { app } from '../../scripts/app'\n\n// Allows you to edit the attention weight by holding ctrl (or cmd) and using the up/down arrow keys\n\napp.registerExtension({\n  name: 'Comfy.EditAttention',\n  init() {\n    const editAttentionDelta = app.ui.settings.addSetting({\n      id: 'Comfy.EditAttention.Delta',\n      category: ['Comfy', 'EditTokenWeight', 'Delta'],\n      name: 'Ctrl+up/down precision',\n      type: 'slider',\n      attrs: {\n        min: 0.01,\n        max: 0.5,\n        step: 0.01\n      },\n      defaultValue: 0.05\n    })\n\n    function incrementWeight(weight: string, delta: number): string {\n      const floatWeight = parseFloat(weight)\n      if (isNaN(floatWeight)) return weight\n      const newWeight = floatWeight + delta\n      return String(Number(newWeight.toFixed(10)))\n    }\n\n    type Enclosure = {\n      start: number\n      end: number\n    }\n\n    function findNearestEnclosure(\n      text: string,\n      cursorPos: number\n    ): Enclosure | null {\n      let start = cursorPos,\n        end = cursorPos\n      let openCount = 0,\n        closeCount = 0\n\n      // Find opening parenthesis before cursor\n      while (start >= 0) {\n        start--\n        if (text[start] === '(' && openCount === closeCount) break\n        if (text[start] === '(') openCount++\n        if (text[start] === ')') closeCount++\n      }\n      if (start < 0) return null\n\n      openCount = 0\n      closeCount = 0\n\n      // Find closing parenthesis after cursor\n      while (end < text.length) {\n        if (text[end] === ')' && openCount === closeCount) break\n        if (text[end] === '(') openCount++\n        if (text[end] === ')') closeCount++\n        end++\n      }\n      if (end === text.length) return null\n\n      return { start: start + 1, end: end }\n    }\n\n    function addWeightToParentheses(text: string): string {\n      const parenRegex = /^\\((.*)\\)$/\n      const parenMatch = text.match(parenRegex)\n\n      const floatRegex = /:([+-]?(\\d*\\.)?\\d+([eE][+-]?\\d+)?)/\n      const floatMatch = text.match(floatRegex)\n\n      if (parenMatch && !floatMatch) {\n        return `(${parenMatch[1]}:1.0)`\n      } else {\n        return text\n      }\n    }\n\n    function editAttention(event: KeyboardEvent) {\n      // @ts-expect-error Runtime narrowing not impl.\n      const inputField: HTMLTextAreaElement = event.composedPath()[0]\n      const delta = parseFloat(editAttentionDelta.value)\n\n      if (inputField.tagName !== 'TEXTAREA') return\n      if (!(event.key === 'ArrowUp' || event.key === 'ArrowDown')) return\n      if (!event.ctrlKey && !event.metaKey) return\n\n      event.preventDefault()\n\n      let start = inputField.selectionStart\n      let end = inputField.selectionEnd\n      let selectedText = inputField.value.substring(start, end)\n\n      // If there is no selection, attempt to find the nearest enclosure, or select the current word\n      if (!selectedText) {\n        const nearestEnclosure = findNearestEnclosure(inputField.value, start)\n        if (nearestEnclosure) {\n          start = nearestEnclosure.start\n          end = nearestEnclosure.end\n          selectedText = inputField.value.substring(start, end)\n        } else {\n          // Select the current word, find the start and end of the word\n          const delimiters = ' .,\\\\/!?%^*;:{}=-_`~()\\r\\n\\t'\n\n          while (\n            !delimiters.includes(inputField.value[start - 1]) &&\n            start > 0\n          ) {\n            start--\n          }\n\n          while (\n            !delimiters.includes(inputField.value[end]) &&\n            end < inputField.value.length\n          ) {\n            end++\n          }\n\n          selectedText = inputField.value.substring(start, end)\n          if (!selectedText) return\n        }\n      }\n\n      // If the selection ends with a space, remove it\n      if (selectedText[selectedText.length - 1] === ' ') {\n        selectedText = selectedText.substring(0, selectedText.length - 1)\n        end -= 1\n      }\n\n      // If there are parentheses left and right of the selection, select them\n      if (\n        inputField.value[start - 1] === '(' &&\n        inputField.value[end] === ')'\n      ) {\n        start -= 1\n        end += 1\n        selectedText = inputField.value.substring(start, end)\n      }\n\n      // If the selection is not enclosed in parentheses, add them\n      if (\n        selectedText[0] !== '(' ||\n        selectedText[selectedText.length - 1] !== ')'\n      ) {\n        selectedText = `(${selectedText})`\n      }\n\n      // If the selection does not have a weight, add a weight of 1.0\n      selectedText = addWeightToParentheses(selectedText)\n\n      // Increment the weight\n      const weightDelta = event.key === 'ArrowUp' ? delta : -delta\n      const updatedText = selectedText.replace(\n        /\\((.*):([+-]?\\d+(?:\\.\\d+)?)\\)/,\n        (_, text, weight) => {\n          weight = incrementWeight(weight, weightDelta)\n          if (weight == 1) {\n            return text\n          } else {\n            return `(${text}:${weight})`\n          }\n        }\n      )\n\n      inputField.setSelectionRange(start, end)\n      // Intentional use of deprecated: https://developer.mozilla.org/docs/Web/API/Document/execCommand#using_inserttext\n      document.execCommand('insertText', false, updatedText)\n      inputField.setSelectionRange(start, start + updatedText.length)\n    }\n    window.addEventListener('keydown', editAttention)\n  }\n})\n","interface UVMirror {\n  /**\n   * The setting id defined for the mirror.\n   */\n  settingId: string\n  /**\n   * The default mirror to use.\n   */\n  mirror: string\n  /**\n   * The fallback mirror to use.\n   */\n  fallbackMirror: string\n  /**\n   * The path suffix to validate the mirror is reachable.\n   */\n  validationPathSuffix?: string\n}\n\nexport const PYTHON_MIRROR: UVMirror = {\n  settingId: 'Comfy-Desktop.UV.PythonInstallMirror',\n  mirror:\n    'https://github.com/astral-sh/python-build-standalone/releases/download',\n  fallbackMirror:\n    'https://python-standalone.org/mirror/astral-sh/python-build-standalone',\n  validationPathSuffix:\n    '/20250115/cpython-3.10.16+20250115-aarch64-apple-darwin-debug-full.tar.zst.sha256'\n}\n","import { electronAPI } from '@/utils/envUtil'\nimport { isValidUrl } from '@/utils/formatUtil'\n\n/**\n * Check if a mirror is reachable from the electron App.\n * @param mirror - The mirror to check.\n * @returns True if the mirror is reachable, false otherwise.\n */\nexport const checkMirrorReachable = async (mirror: string) => {\n  return (\n    isValidUrl(mirror) && (await electronAPI().NetWork.canAccessUrl(mirror))\n  )\n}\n","import log from 'loglevel'\n\nimport { useExternalLink } from '@/composables/useExternalLink'\nimport { PYTHON_MIRROR } from '@/constants/uvMirrors'\nimport { t } from '@/i18n'\nimport { useToastStore } from '@/platform/updates/common/toastStore'\nimport { useWorkflowStore } from '@/platform/workflow/management/stores/workflowStore'\nimport { app } from '@/scripts/app'\nimport { useDialogService } from '@/services/dialogService'\nimport { checkMirrorReachable } from '@/utils/electronMirrorCheck'\nimport { electronAPI as getElectronAPI, isElectron } from '@/utils/envUtil'\n;(async () => {\n  if (!isElectron()) return\n\n  const electronAPI = getElectronAPI()\n  const desktopAppVersion = await electronAPI.getElectronVersion()\n  const workflowStore = useWorkflowStore()\n  const toastStore = useToastStore()\n  const { staticUrls, buildDocsUrl } = useExternalLink()\n\n  const onChangeRestartApp = (newValue: string, oldValue: string) => {\n    // Add a delay to allow changes to take effect before restarting.\n    if (oldValue !== undefined && newValue !== oldValue) {\n      electronAPI.restartApp('Restart ComfyUI to apply changes.', 1500)\n    }\n  }\n\n  app.registerExtension({\n    name: 'Comfy.ElectronAdapter',\n    settings: [\n      {\n        id: 'Comfy-Desktop.AutoUpdate',\n        category: ['Comfy-Desktop', 'General', 'AutoUpdate'],\n        name: 'Automatically check for updates',\n        type: 'boolean',\n        defaultValue: true,\n        onChange: onChangeRestartApp\n      },\n      {\n        id: 'Comfy-Desktop.SendStatistics',\n        category: ['Comfy-Desktop', 'General', 'Send Statistics'],\n        name: 'Send anonymous usage metrics',\n        type: 'boolean',\n        defaultValue: true,\n        onChange: onChangeRestartApp\n      },\n      {\n        id: 'Comfy-Desktop.WindowStyle',\n        category: ['Comfy-Desktop', 'General', 'Window Style'],\n        name: 'Window Style',\n        tooltip: \"Custom: Replace the system title bar with ComfyUI's Top menu\",\n        type: 'combo',\n        experimental: true,\n        defaultValue: 'default',\n        options: ['default', 'custom'],\n        onChange: (\n          newValue: 'default' | 'custom',\n          oldValue?: 'default' | 'custom'\n        ) => {\n          if (!oldValue) return\n\n          electronAPI.Config.setWindowStyle(newValue)\n        }\n      },\n      {\n        id: 'Comfy-Desktop.UV.PythonInstallMirror',\n        name: 'Python Install Mirror',\n        tooltip: `Managed Python installations are downloaded from the Astral python-build-standalone project. This variable can be set to a mirror URL to use a different source for Python installations. The provided URL will replace https://github.com/astral-sh/python-build-standalone/releases/download in, e.g., https://github.com/astral-sh/python-build-standalone/releases/download/20240713/cpython-3.12.4%2B20240713-aarch64-apple-darwin-install_only.tar.gz. Distributions can be read from a local directory by using the file:// URL scheme.`,\n        type: 'url',\n        defaultValue: '',\n        attrs: {\n          validateUrlFn(mirror: string) {\n            return checkMirrorReachable(\n              mirror + PYTHON_MIRROR.validationPathSuffix\n            )\n          }\n        }\n      },\n      {\n        id: 'Comfy-Desktop.UV.PypiInstallMirror',\n        name: 'Pypi Install Mirror',\n        tooltip: `Default pip install mirror`,\n        type: 'url',\n        defaultValue: '',\n        attrs: {\n          validateUrlFn: checkMirrorReachable\n        }\n      },\n      {\n        id: 'Comfy-Desktop.UV.TorchInstallMirror',\n        name: 'Torch Install Mirror',\n        tooltip: `Pip install mirror for pytorch`,\n        type: 'url',\n        defaultValue: '',\n        attrs: {\n          validateUrlFn: checkMirrorReachable\n        }\n      }\n    ],\n\n    commands: [\n      {\n        id: 'Comfy-Desktop.Folders.OpenLogsFolder',\n        label: 'Open Logs Folder',\n        icon: 'pi pi-folder-open',\n        function() {\n          electronAPI.openLogsFolder()\n        }\n      },\n      {\n        id: 'Comfy-Desktop.Folders.OpenModelsFolder',\n        label: 'Open Models Folder',\n        icon: 'pi pi-folder-open',\n        function() {\n          electronAPI.openModelsFolder()\n        }\n      },\n      {\n        id: 'Comfy-Desktop.Folders.OpenOutputsFolder',\n        label: 'Open Outputs Folder',\n        icon: 'pi pi-folder-open',\n        function() {\n          electronAPI.openOutputsFolder()\n        }\n      },\n      {\n        id: 'Comfy-Desktop.Folders.OpenInputsFolder',\n        label: 'Open Inputs Folder',\n        icon: 'pi pi-folder-open',\n        function() {\n          electronAPI.openInputsFolder()\n        }\n      },\n      {\n        id: 'Comfy-Desktop.Folders.OpenCustomNodesFolder',\n        label: 'Open Custom Nodes Folder',\n        icon: 'pi pi-folder-open',\n        function() {\n          electronAPI.openCustomNodesFolder()\n        }\n      },\n      {\n        id: 'Comfy-Desktop.Folders.OpenModelConfig',\n        label: 'Open extra_model_paths.yaml',\n        icon: 'pi pi-file',\n        function() {\n          electronAPI.openModelConfig()\n        }\n      },\n      {\n        id: 'Comfy-Desktop.OpenDevTools',\n        label: 'Open DevTools',\n        icon: 'pi pi-code',\n        function() {\n          electronAPI.openDevTools()\n        }\n      },\n      {\n        id: 'Comfy-Desktop.OpenUserGuide',\n        label: 'Desktop User Guide',\n        icon: 'pi pi-book',\n        function() {\n          window.open(\n            buildDocsUrl('/installation/desktop', {\n              includeLocale: true,\n              platform: true\n            }),\n            '_blank'\n          )\n        }\n      },\n      {\n        id: 'Comfy-Desktop.CheckForUpdates',\n        label: 'Check for Updates',\n        icon: 'pi pi-sync',\n        async function() {\n          try {\n            const updateInfo = await electronAPI.checkForUpdates({\n              disableUpdateReadyAction: true\n            })\n\n            if (!updateInfo.isUpdateAvailable) {\n              toastStore.add({\n                severity: 'info',\n                summary: t('desktopUpdate.noUpdateFound'),\n                life: 5_000\n              })\n              return\n            }\n\n            const proceed = await useDialogService().confirm({\n              title: t('desktopUpdate.updateFoundTitle', {\n                version: updateInfo.version\n              }),\n              message: t('desktopUpdate.updateAvailableMessage'),\n              type: 'default'\n            })\n            if (proceed) {\n              try {\n                electronAPI.restartAndInstall()\n              } catch (error) {\n                log.error('Error installing update:', error)\n                toastStore.add({\n                  severity: 'error',\n                  summary: t('g.error'),\n                  detail: t('desktopUpdate.errorInstallingUpdate'),\n                  life: 10_000\n                })\n              }\n            }\n          } catch (error) {\n            log.error('Error checking for updates:', error)\n            toastStore.add({\n              severity: 'error',\n              summary: t('g.error'),\n              detail: t('desktopUpdate.errorCheckingUpdate'),\n              life: 10_000\n            })\n          }\n        }\n      },\n      {\n        id: 'Comfy-Desktop.Reinstall',\n        label: 'Reinstall',\n        icon: 'pi pi-refresh',\n        async function() {\n          const proceed = await useDialogService().confirm({\n            message: t('desktopMenu.confirmReinstall'),\n            title: t('desktopMenu.reinstall'),\n            type: 'reinstall'\n          })\n\n          if (proceed) electronAPI.reinstall()\n        }\n      },\n      {\n        id: 'Comfy-Desktop.Restart',\n        label: 'Restart',\n        icon: 'pi pi-refresh',\n        function() {\n          electronAPI.restartApp()\n        }\n      },\n      {\n        id: 'Comfy-Desktop.Quit',\n        label: 'Quit',\n        icon: 'pi pi-sign-out',\n        async function() {\n          // Confirm if unsaved workflows are open\n          if (workflowStore.modifiedWorkflows.length > 0) {\n            const confirmed = await useDialogService().confirm({\n              message: t('desktopMenu.confirmQuit'),\n              title: t('desktopMenu.quit'),\n              type: 'default'\n            })\n\n            if (!confirmed) return\n          }\n\n          electronAPI.quit()\n        }\n      }\n    ],\n\n    menuCommands: [\n      {\n        path: ['Help'],\n        commands: ['Comfy-Desktop.OpenUserGuide']\n      },\n      {\n        path: ['Help'],\n        commands: ['Comfy-Desktop.OpenDevTools']\n      },\n      {\n        path: ['Help', 'Open Folder'],\n        commands: [\n          'Comfy-Desktop.Folders.OpenLogsFolder',\n          'Comfy-Desktop.Folders.OpenModelsFolder',\n          'Comfy-Desktop.Folders.OpenOutputsFolder',\n          'Comfy-Desktop.Folders.OpenInputsFolder',\n          'Comfy-Desktop.Folders.OpenCustomNodesFolder',\n          'Comfy-Desktop.Folders.OpenModelConfig'\n        ]\n      },\n      {\n        path: ['Help'],\n        commands: ['Comfy-Desktop.CheckForUpdates', 'Comfy-Desktop.Reinstall']\n      }\n    ],\n\n    keybindings: [\n      {\n        commandId: 'Workspace.CloseWorkflow',\n        combo: {\n          key: 'w',\n          ctrl: true\n        }\n      }\n    ],\n\n    aboutPageBadges: [\n      {\n        label: 'ComfyUI_desktop v' + desktopAppVersion,\n        url: staticUrls.githubElectron,\n        icon: 'pi pi-github'\n      }\n    ]\n  })\n})()\n","import type { GroupNodeHandler } from '@/extensions/core/groupNode'\nimport { ExecutableNodeDTO } from '@/lib/litegraph/src/litegraph'\nimport type {\n  ExecutableLGraphNode,\n  ExecutionId,\n  LGraphNode,\n  NodeId,\n  SubgraphNode\n} from '@/lib/litegraph/src/litegraph'\n\nexport class ExecutableGroupNodeChildDTO extends ExecutableNodeDTO {\n  groupNodeHandler?: GroupNodeHandler\n\n  constructor(\n    /** The actual node that this DTO wraps. */\n    node: LGraphNode | SubgraphNode,\n    /** A list of subgraph instance node IDs from the root graph to the containing instance. @see {@link id} */\n    subgraphNodePath: readonly NodeId[],\n    /** A flattened map of all DTOs in this node network. Subgraph instances have been expanded into their inner nodes. */\n    nodesByExecutionId: Map<ExecutionId, ExecutableLGraphNode>,\n    /** The actual subgraph instance that contains this node, otherwise undefined. */\n    subgraphNode?: SubgraphNode | undefined,\n    groupNodeHandler?: GroupNodeHandler\n  ) {\n    super(node, subgraphNodePath, nodesByExecutionId, subgraphNode)\n    this.groupNodeHandler = groupNodeHandler\n  }\n\n  override resolveInput(slot: number) {\n    // Check if this group node is inside a subgraph (unsupported)\n    if (this.id.split(':').length > 2) {\n      throw new Error(\n        'Group nodes inside subgraphs are not supported. Please convert the group node to a subgraph instead.'\n      )\n    }\n\n    const inputNode = this.node.getInputNode(slot)\n    if (!inputNode) return\n\n    const link = this.node.getInputLink(slot)\n    if (!link) throw new Error('Failed to get input link')\n\n    const inputNodeId = String(inputNode.id)\n\n    // Try to find the node using the full ID first (for nodes outside the group)\n    let inputNodeDto = this.nodesByExecutionId?.get(inputNodeId)\n\n    // If not found, try with just the last part of the ID (for nodes inside the group)\n    if (!inputNodeDto) {\n      const id = inputNodeId.split(':').at(-1)\n      if (id !== undefined) {\n        inputNodeDto = this.nodesByExecutionId?.get(id)\n      }\n    }\n\n    if (!inputNodeDto) {\n      throw new Error(\n        `Failed to get input node ${inputNodeId} for group node child ${this.id} with slot ${slot}`\n      )\n    }\n\n    return {\n      node: inputNodeDto,\n      origin_id: inputNodeId,\n      origin_slot: link.origin_slot\n    }\n  }\n}\n","import { PREFIX, SEPARATOR } from '@/constants/groupNodeConstants'\nimport {\n  type LGraphNode,\n  type LGraphNodeConstructor,\n  LiteGraph\n} from '@/lib/litegraph/src/litegraph'\nimport { useToastStore } from '@/platform/updates/common/toastStore'\n\nimport { type ComfyApp, app } from '../../scripts/app'\nimport { $el } from '../../scripts/ui'\nimport { ComfyDialog } from '../../scripts/ui/dialog'\nimport { DraggableList } from '../../scripts/ui/draggableList'\nimport { GroupNodeConfig, GroupNodeHandler } from './groupNode'\nimport './groupNodeManage.css'\n\nconst ORDER: symbol = Symbol()\n\n// @ts-expect-error fixme ts strict error\nfunction merge(target, source) {\n  if (typeof target === 'object' && typeof source === 'object') {\n    for (const key in source) {\n      const sv = source[key]\n      if (typeof sv === 'object') {\n        let tv = target[key]\n        if (!tv) tv = target[key] = {}\n        merge(tv, source[key])\n      } else {\n        target[key] = sv\n      }\n    }\n  }\n\n  return target\n}\n\nexport class ManageGroupDialog extends ComfyDialog<HTMLDialogElement> {\n  // @ts-expect-error fixme ts strict error\n  tabs: Record<\n    'Inputs' | 'Outputs' | 'Widgets',\n    { tab: HTMLAnchorElement; page: HTMLElement }\n  >\n  selectedNodeIndex: number | null | undefined\n  selectedTab: keyof ManageGroupDialog['tabs'] = 'Inputs'\n  selectedGroup: string | undefined\n  modifications: Record<\n    string,\n    Record<\n      string,\n      Record<\n        string,\n        { name?: string | undefined; visible?: boolean | undefined }\n      >\n    >\n  > = {}\n  // @ts-expect-error fixme ts strict error\n  nodeItems: any[]\n  app: ComfyApp\n  // @ts-expect-error fixme ts strict error\n  groupNodeType: LGraphNodeConstructor<LGraphNode>\n  groupNodeDef: any\n  groupData: any\n\n  // @ts-expect-error fixme ts strict error\n  innerNodesList: HTMLUListElement\n  // @ts-expect-error fixme ts strict error\n  widgetsPage: HTMLElement\n  // @ts-expect-error fixme ts strict error\n  inputsPage: HTMLElement\n  // @ts-expect-error fixme ts strict error\n  outputsPage: HTMLElement\n  draggable: any\n\n  get selectedNodeInnerIndex() {\n    // @ts-expect-error fixme ts strict error\n    return +this.nodeItems[this.selectedNodeIndex].dataset.nodeindex\n  }\n\n  // @ts-expect-error fixme ts strict error\n  constructor(app) {\n    super()\n    this.app = app\n    this.element = $el('dialog.comfy-group-manage', {\n      parent: document.body\n    }) as HTMLDialogElement\n  }\n\n  // @ts-expect-error fixme ts strict error\n  changeTab(tab) {\n    this.tabs[this.selectedTab].tab.classList.remove('active')\n    this.tabs[this.selectedTab].page.classList.remove('active')\n    // @ts-expect-error fixme ts strict error\n    this.tabs[tab].tab.classList.add('active')\n    // @ts-expect-error fixme ts strict error\n    this.tabs[tab].page.classList.add('active')\n    this.selectedTab = tab\n  }\n\n  // @ts-expect-error fixme ts strict error\n  changeNode(index, force?) {\n    if (!force && this.selectedNodeIndex === index) return\n\n    if (this.selectedNodeIndex != null) {\n      this.nodeItems[this.selectedNodeIndex].classList.remove('selected')\n    }\n    this.nodeItems[index].classList.add('selected')\n    this.selectedNodeIndex = index\n\n    if (!this.buildInputsPage() && this.selectedTab === 'Inputs') {\n      this.changeTab('Widgets')\n    }\n    if (!this.buildWidgetsPage() && this.selectedTab === 'Widgets') {\n      this.changeTab('Outputs')\n    }\n    if (!this.buildOutputsPage() && this.selectedTab === 'Outputs') {\n      this.changeTab('Inputs')\n    }\n\n    this.changeTab(this.selectedTab)\n  }\n\n  getGroupData() {\n    this.groupNodeType = LiteGraph.registered_node_types[\n      `${PREFIX}${SEPARATOR}` + this.selectedGroup\n    ] as unknown as LGraphNodeConstructor<LGraphNode>\n    this.groupNodeDef = this.groupNodeType.nodeData\n    this.groupData = GroupNodeHandler.getGroupData(this.groupNodeType)\n  }\n\n  // @ts-expect-error fixme ts strict error\n  changeGroup(group, reset = true) {\n    this.selectedGroup = group\n    this.getGroupData()\n\n    const nodes = this.groupData.nodeData.nodes\n    // @ts-expect-error fixme ts strict error\n    this.nodeItems = nodes.map((n, i) =>\n      $el(\n        'li.draggable-item',\n        {\n          dataset: {\n            nodeindex: n.index + ''\n          },\n          onclick: () => {\n            this.changeNode(i)\n          }\n        },\n        [\n          $el('span.drag-handle'),\n          $el(\n            'div',\n            {\n              textContent: n.title ?? n.type\n            },\n            n.title\n              ? $el('span', {\n                  textContent: n.type\n                })\n              : []\n          )\n        ]\n      )\n    )\n\n    this.innerNodesList.replaceChildren(...this.nodeItems)\n\n    if (reset) {\n      this.selectedNodeIndex = null\n      this.changeNode(0)\n    } else {\n      const items = this.draggable.getAllItems()\n      // @ts-expect-error fixme ts strict error\n      let index = items.findIndex((item) => item.classList.contains('selected'))\n      if (index === -1) index = this.selectedNodeIndex\n      this.changeNode(index, true)\n    }\n\n    const ordered = [...nodes]\n    this.draggable?.dispose()\n    this.draggable = new DraggableList(this.innerNodesList, 'li')\n    this.draggable.addEventListener(\n      'dragend',\n      // @ts-expect-error fixme ts strict error\n      ({ detail: { oldPosition, newPosition } }) => {\n        if (oldPosition === newPosition) return\n        ordered.splice(newPosition, 0, ordered.splice(oldPosition, 1)[0])\n        for (let i = 0; i < ordered.length; i++) {\n          this.storeModification({\n            nodeIndex: ordered[i].index,\n            section: ORDER,\n            prop: 'order',\n            value: i\n          })\n        }\n      }\n    )\n  }\n\n  storeModification(props: {\n    nodeIndex?: number\n    section: symbol\n    prop: string\n    value: any\n  }) {\n    const { nodeIndex, section, prop, value } = props\n    // @ts-expect-error fixme ts strict error\n    const groupMod = (this.modifications[this.selectedGroup] ??= {})\n    const nodesMod = (groupMod.nodes ??= {})\n    const nodeMod = (nodesMod[nodeIndex ?? this.selectedNodeInnerIndex] ??= {})\n    const typeMod = (nodeMod[section] ??= {})\n    if (typeof value === 'object') {\n      const objMod = (typeMod[prop] ??= {})\n      Object.assign(objMod, value)\n    } else {\n      typeMod[prop] = value\n    }\n  }\n\n  // @ts-expect-error fixme ts strict error\n  getEditElement(section, prop, value, placeholder, checked, checkable = true) {\n    if (value === placeholder) value = ''\n\n    const mods =\n      // @ts-expect-error fixme ts strict error\n      this.modifications[this.selectedGroup]?.nodes?.[\n        this.selectedNodeInnerIndex\n      ]?.[section]?.[prop]\n    if (mods) {\n      if (mods.name != null) {\n        value = mods.name\n      }\n      if (mods.visible != null) {\n        checked = mods.visible\n      }\n    }\n\n    return $el('div', [\n      $el('input', {\n        value,\n        placeholder,\n        type: 'text',\n        // @ts-expect-error fixme ts strict error\n        onchange: (e) => {\n          this.storeModification({\n            section,\n            prop,\n            value: { name: e.target.value }\n          })\n        }\n      }),\n      $el('label', { textContent: 'Visible' }, [\n        $el('input', {\n          type: 'checkbox',\n          checked,\n          disabled: !checkable,\n          // @ts-expect-error fixme ts strict error\n          onchange: (e) => {\n            this.storeModification({\n              section,\n              prop,\n              value: { visible: !!e.target.checked }\n            })\n          }\n        })\n      ])\n    ])\n  }\n\n  buildWidgetsPage() {\n    const widgets =\n      this.groupData.oldToNewWidgetMap[this.selectedNodeInnerIndex]\n    const items = Object.keys(widgets ?? {})\n    // @ts-expect-error fixme ts strict error\n    const type = app.rootGraph.extra.groupNodes[this.selectedGroup]\n    const config = type.config?.[this.selectedNodeInnerIndex]?.input\n    this.widgetsPage.replaceChildren(\n      ...items.map((oldName) => {\n        return this.getEditElement(\n          'input',\n          oldName,\n          widgets[oldName],\n          oldName,\n          config?.[oldName]?.visible !== false\n        )\n      })\n    )\n    return !!items.length\n  }\n\n  buildInputsPage() {\n    const inputs = this.groupData.nodeInputs[this.selectedNodeInnerIndex]\n    const items = Object.keys(inputs ?? {})\n    // @ts-expect-error fixme ts strict error\n    const type = app.rootGraph.extra.groupNodes[this.selectedGroup]\n    const config = type.config?.[this.selectedNodeInnerIndex]?.input\n    this.inputsPage.replaceChildren(\n      // @ts-expect-error fixme ts strict error\n      ...items\n        .map((oldName) => {\n          let value = inputs[oldName]\n          if (!value) {\n            return\n          }\n\n          return this.getEditElement(\n            'input',\n            oldName,\n            value,\n            oldName,\n            config?.[oldName]?.visible !== false\n          )\n        })\n        .filter(Boolean)\n    )\n    return !!items.length\n  }\n\n  buildOutputsPage() {\n    const nodes = this.groupData.nodeData.nodes\n    const innerNodeDef = this.groupData.getNodeDef(\n      nodes[this.selectedNodeInnerIndex]\n    )\n    const outputs = innerNodeDef?.output ?? []\n    const groupOutputs =\n      this.groupData.oldToNewOutputMap[this.selectedNodeInnerIndex]\n\n    // @ts-expect-error fixme ts strict error\n    const type = app.rootGraph.extra.groupNodes[this.selectedGroup]\n    const config = type.config?.[this.selectedNodeInnerIndex]?.output\n    const node = this.groupData.nodeData.nodes[this.selectedNodeInnerIndex]\n    const checkable = node.type !== 'PrimitiveNode'\n    this.outputsPage.replaceChildren(\n      ...outputs\n        // @ts-expect-error fixme ts strict error\n        .map((type, slot) => {\n          const groupOutputIndex = groupOutputs?.[slot]\n          const oldName = innerNodeDef.output_name?.[slot] ?? type\n          let value = config?.[slot]?.name\n          const visible = config?.[slot]?.visible || groupOutputIndex != null\n          if (!value || value === oldName) {\n            value = ''\n          }\n          return this.getEditElement(\n            'output',\n            slot,\n            value,\n            oldName,\n            visible,\n            checkable\n          )\n        })\n        .filter(Boolean)\n    )\n    return !!outputs.length\n  }\n\n  // @ts-expect-error fixme ts strict error\n  show(type?) {\n    const groupNodes = Object.keys(app.rootGraph.extra?.groupNodes ?? {}).sort(\n      (a, b) => a.localeCompare(b)\n    )\n\n    this.innerNodesList = $el(\n      'ul.comfy-group-manage-list-items'\n    ) as HTMLUListElement\n    this.widgetsPage = $el('section.comfy-group-manage-node-page')\n    this.inputsPage = $el('section.comfy-group-manage-node-page')\n    this.outputsPage = $el('section.comfy-group-manage-node-page')\n    const pages = $el('div', [\n      this.widgetsPage,\n      this.inputsPage,\n      this.outputsPage\n    ])\n\n    this.tabs = [\n      ['Inputs', this.inputsPage],\n      ['Widgets', this.widgetsPage],\n      ['Outputs', this.outputsPage]\n      // @ts-expect-error fixme ts strict error\n    ].reduce((p, [name, page]: [string, HTMLElement]) => {\n      // @ts-expect-error fixme ts strict error\n      p[name] = {\n        tab: $el('a', {\n          onclick: () => {\n            this.changeTab(name)\n          },\n          textContent: name\n        }),\n        page\n      }\n      return p\n    }, {}) as any\n\n    const outer = $el('div.comfy-group-manage-outer', [\n      $el('header', [\n        $el('h2', 'Group Nodes'),\n        $el(\n          'select',\n          {\n            // @ts-expect-error fixme ts strict error\n            onchange: (e) => {\n              this.changeGroup(e.target.value)\n            }\n          },\n          groupNodes.map((g) =>\n            $el('option', {\n              textContent: g,\n              selected: `${PREFIX}${SEPARATOR}${g}` === type,\n              value: g\n            })\n          )\n        )\n      ]),\n      $el('main', [\n        $el('section.comfy-group-manage-list', this.innerNodesList),\n        $el('section.comfy-group-manage-node', [\n          $el(\n            'header',\n            Object.values(this.tabs).map((t) => t.tab)\n          ),\n          pages\n        ])\n      ]),\n      $el('footer', [\n        $el(\n          'button.comfy-btn',\n          {\n            onclick: () => {\n              const node = app.rootGraph.nodes.find(\n                (n) => n.type === `${PREFIX}${SEPARATOR}` + this.selectedGroup\n              )\n              if (node) {\n                useToastStore().addAlert(\n                  'This group node is in use in the current workflow, please first remove these.'\n                )\n                return\n              }\n              if (\n                confirm(\n                  `Are you sure you want to remove the node: \"${this.selectedGroup}\"`\n                )\n              ) {\n                // @ts-expect-error fixme ts strict error\n                delete app.rootGraph.extra.groupNodes[this.selectedGroup]\n                LiteGraph.unregisterNodeType(\n                  `${PREFIX}${SEPARATOR}` + this.selectedGroup\n                )\n              }\n              this.show()\n            }\n          },\n          'Delete Group Node'\n        ),\n        $el(\n          'button.comfy-btn',\n          {\n            onclick: async () => {\n              let nodesByType\n              let recreateNodes = []\n              const types = {}\n              for (const g in this.modifications) {\n                // @ts-expect-error fixme ts strict error\n                const type = app.rootGraph.extra.groupNodes[g]\n                let config = (type.config ??= {})\n\n                let nodeMods = this.modifications[g]?.nodes\n                if (nodeMods) {\n                  const keys = Object.keys(nodeMods)\n                  // @ts-expect-error fixme ts strict error\n                  if (nodeMods[keys[0]][ORDER]) {\n                    // If any node is reordered, they will all need sequencing\n                    const orderedNodes = []\n                    const orderedMods = {}\n                    const orderedConfig = {}\n\n                    for (const n of keys) {\n                      // @ts-expect-error fixme ts strict error\n                      const order = nodeMods[n][ORDER].order\n                      orderedNodes[order] = type.nodes[+n]\n                      // @ts-expect-error fixme ts strict error\n                      orderedMods[order] = nodeMods[n]\n                      orderedNodes[order].index = order\n                    }\n\n                    // Rewrite links\n                    for (const l of type.links) {\n                      // @ts-expect-error l[0]/l[2] used as node index\n                      if (l[0] != null) l[0] = type.nodes[l[0]].index\n                      // @ts-expect-error l[0]/l[2] used as node index\n                      if (l[2] != null) l[2] = type.nodes[l[2]].index\n                    }\n\n                    // Rewrite externals\n                    if (type.external) {\n                      for (const ext of type.external) {\n                        if (ext[0] != null) {\n                          // @ts-expect-error ext[0] used as node index\n                          ext[0] = type.nodes[ext[0]].index\n                        }\n                      }\n                    }\n\n                    // Rewrite modifications\n                    for (const id of keys) {\n                      // @ts-expect-error id used as node index\n                      if (config[id]) {\n                        // @ts-expect-error fixme ts strict error\n                        orderedConfig[type.nodes[id].index] = config[id]\n                      }\n                      // @ts-expect-error id used as config key\n                      delete config[id]\n                    }\n\n                    type.nodes = orderedNodes\n                    nodeMods = orderedMods\n                    type.config = config = orderedConfig\n                  }\n\n                  merge(config, nodeMods)\n                }\n\n                // @ts-expect-error fixme ts strict error\n                types[g] = type\n\n                if (!nodesByType) {\n                  nodesByType = app.rootGraph.nodes.reduce((p, n) => {\n                    // @ts-expect-error fixme ts strict error\n                    p[n.type] ??= []\n                    // @ts-expect-error fixme ts strict error\n                    p[n.type].push(n)\n                    return p\n                  }, {})\n                }\n\n                // @ts-expect-error fixme ts strict error\n                const nodes = nodesByType[`${PREFIX}${SEPARATOR}` + g]\n                if (nodes) recreateNodes.push(...nodes)\n              }\n\n              await GroupNodeConfig.registerFromWorkflow(types, [])\n\n              for (const node of recreateNodes) {\n                node.recreate()\n              }\n\n              this.modifications = {}\n              this.app.canvas.setDirty(true, true)\n              this.changeGroup(this.selectedGroup, false)\n            }\n          },\n          'Save'\n        ),\n        $el(\n          'button.comfy-btn',\n          { onclick: () => this.element.close() },\n          'Close'\n        )\n      ])\n    ])\n\n    this.element.replaceChildren(outer)\n    this.changeGroup(\n      type\n        ? (groupNodes.find((g) => `${PREFIX}${SEPARATOR}${g}` === type) ??\n            groupNodes[0])\n        : groupNodes[0]\n    )\n    this.element.showModal()\n\n    this.element.addEventListener('close', () => {\n      this.draggable?.dispose()\n      this.element.remove()\n    })\n  }\n}\n","import _ from 'es-toolkit/compat'\n\nimport type {\n  ComboInputSpec,\n  ComboInputSpecV2,\n  FloatInputSpec,\n  InputSpec,\n  IntInputSpec,\n  NumericInputOptions\n} from '@/schemas/nodeDefSchema'\nimport {\n  getComboSpecComboOptions,\n  getInputSpecType,\n  isComboInputSpec,\n  isFloatInputSpec,\n  isIntInputSpec\n} from '@/schemas/nodeDefSchema'\n\nimport { lcm } from './mathUtil'\n\nconst IGNORE_KEYS = new Set<string>([\n  'default',\n  'forceInput',\n  'defaultInput',\n  'control_after_generate',\n  'multiline',\n  'tooltip',\n  'dynamicPrompts'\n])\n\nconst getRange = (options: NumericInputOptions) => {\n  const min = options.min ?? -Infinity\n  const max = options.max ?? Infinity\n  return { min, max }\n}\n\nconst mergeNumericInputSpec = <T extends IntInputSpec | FloatInputSpec>(\n  spec1: T,\n  spec2: T\n): T | null => {\n  const type = spec1[0]\n  const options1 = spec1[1] ?? {}\n  const options2 = spec2[1] ?? {}\n\n  const range1 = getRange(options1)\n  const range2 = getRange(options2)\n\n  // If the ranges do not overlap, return null\n  if (range1.min > range2.max || range1.max < range2.min) {\n    return null\n  }\n\n  const step1 = options1.step ?? 1\n  const step2 = options2.step ?? 1\n\n  const mergedOptions = {\n    // Take intersection of ranges\n    min: Math.max(range1.min, range2.min),\n    max: Math.min(range1.max, range2.max),\n    step: lcm(step1, step2)\n  }\n\n  return mergeCommonInputSpec(\n    [type, { ...options1, ...mergedOptions }] as T,\n    [type, { ...options2, ...mergedOptions }] as T\n  )\n}\n\nconst mergeComboInputSpec = <T extends ComboInputSpec | ComboInputSpecV2>(\n  spec1: T,\n  spec2: T\n): T | null => {\n  const options1 = spec1[1] ?? {}\n  const options2 = spec2[1] ?? {}\n\n  const comboOptions1 = getComboSpecComboOptions(spec1)\n  const comboOptions2 = getComboSpecComboOptions(spec2)\n\n  const intersection = _.intersection(comboOptions1, comboOptions2)\n\n  // If the intersection is empty, return null\n  if (intersection.length === 0) {\n    return null\n  }\n\n  return mergeCommonInputSpec(\n    ['COMBO', { ...options1, options: intersection }] as T,\n    ['COMBO', { ...options2, options: intersection }] as T\n  )\n}\n\nconst mergeCommonInputSpec = <T extends InputSpec>(\n  spec1: T,\n  spec2: T\n): T | null => {\n  const type = getInputSpecType(spec1)\n  const options1 = spec1[1] ?? {}\n  const options2 = spec2[1] ?? {}\n\n  const compareKeys = _.union(_.keys(options1), _.keys(options2)).filter(\n    (key) => !IGNORE_KEYS.has(key)\n  )\n\n  const mergeIsValid = compareKeys.every((key) => {\n    const value1 = options1[key]\n    const value2 = options2[key]\n    return value1 === value2 || (_.isNil(value1) && _.isNil(value2))\n  })\n\n  return mergeIsValid ? ([type, { ...options1, ...options2 }] as T) : null\n}\n\n/**\n * Merges two input specs.\n *\n * @param spec1 - The first input spec.\n * @param spec2 - The second input spec.\n * @returns The merged input spec, or null if the specs are not mergeable.\n */\nexport const mergeInputSpec = (\n  spec1: InputSpec,\n  spec2: InputSpec\n): InputSpec | null => {\n  const type1 = getInputSpecType(spec1)\n  const type2 = getInputSpecType(spec2)\n\n  if (type1 !== type2) {\n    return null\n  }\n\n  if (isIntInputSpec(spec1) || isFloatInputSpec(spec1)) {\n    return mergeNumericInputSpec(spec1, spec2 as typeof spec1)\n  }\n\n  if (isComboInputSpec(spec1)) {\n    return mergeComboInputSpec(spec1, spec2 as typeof spec1)\n  }\n\n  return mergeCommonInputSpec(spec1, spec2)\n}\n","import type { PrimitiveNode } from '@/extensions/core/widgetInputs'\nimport type { LGraphNode } from '@/lib/litegraph/src/litegraph'\n\nexport const isPrimitiveNode = (\n  node: LGraphNode\n): node is PrimitiveNode & LGraphNode => node.type === 'PrimitiveNode'\n","import {\n  type CallbackParams,\n  useChainCallback\n} from '@/composables/functional/useChainCallback'\nimport { LGraphNode, LiteGraph } from '@/lib/litegraph/src/litegraph'\nimport type {\n  INodeInputSlot,\n  INodeOutputSlot,\n  ISlotType,\n  LLink\n} from '@/lib/litegraph/src/litegraph'\nimport { NodeSlot } from '@/lib/litegraph/src/node/NodeSlot'\nimport type { CanvasPointerEvent } from '@/lib/litegraph/src/types/events'\nimport type { IBaseWidget } from '@/lib/litegraph/src/types/widgets'\nimport type { InputSpec } from '@/schemas/nodeDefSchema'\nimport { app } from '@/scripts/app'\nimport {\n  ComfyWidgets,\n  addValueControlWidgets,\n  isValidWidgetType\n} from '@/scripts/widgets'\nimport { CONFIG, GET_CONFIG } from '@/services/litegraphService'\nimport { mergeInputSpec } from '@/utils/nodeDefUtil'\nimport { applyTextReplacements } from '@/utils/searchAndReplace'\nimport { isPrimitiveNode } from '@/renderer/utils/nodeTypeGuards'\n\nconst replacePropertyName = 'Run widget replace on values'\nexport class PrimitiveNode extends LGraphNode {\n  controlValues?: any[]\n  lastType?: string\n  static override category: string\n  constructor(title: string) {\n    super(title)\n    this.addOutput('connect to widget input', '*')\n    this.serialize_widgets = true\n    this.isVirtualNode = true\n\n    if (!this.properties || !(replacePropertyName in this.properties)) {\n      this.addProperty(replacePropertyName, false, 'boolean')\n    }\n  }\n\n  override applyToGraph(extraLinks: LLink[] = []) {\n    if (!this.outputs[0].links?.length || !this.graph) return\n\n    const links = [\n      ...this.outputs[0].links.map((l) => this.graph!.links[l]),\n      ...extraLinks\n    ]\n    let v = this.widgets?.[0].value\n    if (v && this.properties[replacePropertyName]) {\n      v = applyTextReplacements(this.graph, v as string)\n    }\n\n    // For each output link copy our value over the original widget value\n    for (const linkInfo of links) {\n      const node = this.graph?.getNodeById(linkInfo.target_id)\n      const input = node?.inputs[linkInfo.target_slot]\n      if (!input) {\n        console.warn('Unable to resolve node or input for link', linkInfo)\n        continue\n      }\n\n      const widgetName = input.widget?.name\n      if (!widgetName) {\n        console.warn('Invalid widget or widget name', input.widget)\n        continue\n      }\n\n      const widget = node.widgets?.find((w) => w.name === widgetName)\n      if (!widget) {\n        console.warn(\n          `Unable to find widget \"${widgetName}\" on node [${node.id}]`\n        )\n        continue\n      }\n\n      widget.value = v\n      widget.callback?.(\n        widget.value,\n        app.canvas,\n        node,\n        app.canvas.graph_mouse,\n        {} as CanvasPointerEvent\n      )\n    }\n  }\n\n  override refreshComboInNode() {\n    const widget = this.widgets?.[0]\n    if (widget?.type === 'combo') {\n      // @ts-expect-error fixme ts strict error\n      widget.options.values = this.outputs[0].widget[GET_CONFIG]()[0]\n\n      // @ts-expect-error fixme ts strict error\n      if (!widget.options.values.includes(widget.value as string)) {\n        // @ts-expect-error fixme ts strict error\n        widget.value = widget.options.values[0]\n        ;(widget.callback as Function)(widget.value)\n      }\n    }\n  }\n\n  override onAfterGraphConfigured() {\n    if (this.outputs[0].links?.length && !this.widgets?.length) {\n      this.#onFirstConnection()\n\n      // Populate widget values from config data\n      if (this.widgets && this.widgets_values) {\n        for (let i = 0; i < this.widgets_values.length; i++) {\n          const w = this.widgets[i]\n          if (w) {\n            w.value = this.widgets_values[i] as any\n          }\n        }\n      }\n\n      // Merge values if required\n      this.#mergeWidgetConfig()\n    }\n  }\n\n  override onConnectionsChange(\n    _type: ISlotType,\n    _index: number,\n    connected: boolean\n  ) {\n    if (app.configuringGraph) {\n      // Dont run while the graph is still setting up\n      return\n    }\n\n    const links = this.outputs[0].links\n    if (connected) {\n      if (links?.length && !this.widgets?.length) {\n        this.#onFirstConnection()\n      }\n    } else {\n      // We may have removed a link that caused the constraints to change\n      this.#mergeWidgetConfig()\n\n      if (!links?.length) {\n        this.onLastDisconnect()\n      }\n    }\n  }\n\n  override onConnectOutput(\n    slot: number,\n    _type: string,\n    input: INodeInputSlot,\n    target_node: LGraphNode,\n    target_slot: number\n  ) {\n    // Fires before the link is made allowing us to reject it if it isn't valid\n    // No widget, we can't connect\n    if (!input.widget && !(input.type in ComfyWidgets)) {\n      return false\n    }\n\n    if (this.outputs[slot].links?.length) {\n      const valid = this.#isValidConnection(input)\n      if (valid) {\n        // On connect of additional outputs, copy our value to their widget\n        this.applyToGraph([{ target_id: target_node.id, target_slot } as LLink])\n      }\n      return valid\n    }\n\n    return true\n  }\n\n  #onFirstConnection(recreating?: boolean) {\n    // First connection can fire before the graph is ready on initial load so random things can be missing\n    if (!this.outputs[0].links || !this.graph) {\n      this.onLastDisconnect()\n      return\n    }\n    const linkId = this.outputs[0].links[0]\n    const link = this.graph.links[linkId]\n    if (!link) return\n\n    const theirNode = this.graph.getNodeById(link.target_id)\n    if (!theirNode || !theirNode.inputs) return\n\n    const input = theirNode.inputs[link.target_slot]\n    if (!input) return\n\n    let widget\n    if (!input.widget) {\n      if (!(input.type in ComfyWidgets)) return\n      widget = { name: input.name, [GET_CONFIG]: () => [input.type, {}] } //fake widget\n    } else {\n      widget = input.widget\n    }\n\n    // @ts-expect-error fixme ts strict error\n    const config = widget[GET_CONFIG]?.()\n    if (!config) return\n\n    const { type } = getWidgetType(config)\n    // Update our output to restrict to the widget type\n    this.outputs[0].type = type\n    this.outputs[0].name = type\n    this.outputs[0].widget = widget\n\n    this.#createWidget(\n      widget[CONFIG] ?? config,\n      theirNode,\n      widget.name,\n      // @ts-expect-error fixme ts strict error\n      recreating\n    )\n  }\n\n  #createWidget(\n    inputData: InputSpec,\n    node: LGraphNode,\n    widgetName: string,\n    recreating: boolean\n  ) {\n    let type = inputData[0]\n\n    if (type instanceof Array) {\n      type = 'COMBO'\n    }\n\n    // Store current size as addWidget resizes the node\n    const [oldWidth, oldHeight] = this.size\n    let widget: IBaseWidget\n    if (isValidWidgetType(type)) {\n      widget = (ComfyWidgets[type](this, 'value', inputData, app) || {}).widget\n    } else {\n      // @ts-expect-error InputSpec is not typed correctly\n      widget = this.addWidget(type, 'value', null, () => {}, {})\n    }\n\n    if (node?.widgets && widget) {\n      const theirWidget = node.widgets.find((w) => w.name === widgetName)\n      if (theirWidget) {\n        widget.value = theirWidget.value\n      }\n    }\n\n    if (\n      !inputData?.[1]?.control_after_generate &&\n      (widget.type === 'number' || widget.type === 'combo')\n    ) {\n      let control_value = this.widgets_values?.[1]\n      if (!control_value) {\n        control_value = 'fixed'\n      }\n      addValueControlWidgets(\n        this,\n        widget,\n        control_value as string,\n        undefined,\n        inputData\n      )\n      if (this.widgets?.[1]) widget.linkedWidgets = [this.widgets[1]]\n\n      let filter = this.widgets_values?.[2]\n      if (filter && this.widgets && this.widgets.length === 3) {\n        this.widgets[2].value = filter\n      }\n    }\n\n    // Restore any saved control values\n    const controlValues = this.controlValues\n    if (\n      this.widgets &&\n      this.lastType === this.widgets[0]?.type &&\n      controlValues?.length === this.widgets.length - 1\n    ) {\n      for (let i = 0; i < controlValues.length; i++) {\n        this.widgets[i + 1].value = controlValues[i]\n      }\n    }\n\n    // When our value changes, update other widgets to reflect our changes\n    // e.g. so LoadImage shows correct image\n    widget.callback = useChainCallback(widget.callback, () => {\n      this.applyToGraph()\n    })\n\n    // Use the biggest dimensions in case the widgets caused the node to grow\n    this.setSize([\n      Math.max(this.size[0], oldWidth),\n      Math.max(this.size[1], oldHeight)\n    ])\n\n    if (!recreating) {\n      // Grow our node more if required\n      const sz = this.computeSize()\n      if (this.size[0] < sz[0]) {\n        this.size[0] = sz[0]\n      }\n      if (this.size[1] < sz[1]) {\n        this.size[1] = sz[1]\n      }\n\n      requestAnimationFrame(() => {\n        this.onResize?.(this.size)\n      })\n    }\n  }\n\n  recreateWidget() {\n    const values = this.widgets?.map((w) => w.value)\n    this.#removeWidgets()\n    this.#onFirstConnection(true)\n    if (values?.length && this.widgets) {\n      for (let i = 0; i < this.widgets.length; i++)\n        this.widgets[i].value = values[i]\n    }\n    return this.widgets?.[0]\n  }\n\n  #mergeWidgetConfig() {\n    // Merge widget configs if the node has multiple outputs\n    const output = this.outputs[0]\n    const links = output.links ?? []\n\n    const hasConfig = !!output.widget?.[CONFIG]\n    if (hasConfig) {\n      delete output.widget?.[CONFIG]\n    }\n\n    if (links?.length < 2 && hasConfig) {\n      // Copy the widget options from the source\n      if (links.length) {\n        this.recreateWidget()\n      }\n\n      return\n    }\n    const config1 = (output.widget?.[GET_CONFIG] as () => InputSpec)?.()\n    if (!config1) return\n    const isNumber = config1[0] === 'INT' || config1[0] === 'FLOAT'\n    if (!isNumber || !this.graph) return\n\n    for (const linkId of links) {\n      const link = this.graph.links[linkId]\n      if (!link) continue // Can be null when removing a node\n\n      const theirNode = this.graph.getNodeById(link.target_id)\n      if (!theirNode) continue\n      const theirInput = theirNode.inputs[link.target_slot]\n\n      // Call is valid connection so it can merge the configs when validating\n      this.#isValidConnection(theirInput, hasConfig)\n    }\n  }\n\n  #isValidConnection(input: INodeInputSlot, forceUpdate?: boolean) {\n    // Only allow connections where the configs match\n    const output = this.outputs?.[0]\n    const config2 = (input.widget?.[GET_CONFIG] as () => InputSpec)?.()\n    if (!config2) return false\n\n    return !!mergeIfValid.call(\n      this,\n      output,\n      config2,\n      forceUpdate,\n      this.recreateWidget\n    )\n  }\n\n  #removeWidgets() {\n    if (this.widgets) {\n      // Allow widgets to cleanup\n      for (const w of this.widgets) {\n        if (w.onRemove) {\n          w.onRemove()\n        }\n      }\n\n      // Temporarily store the current values in case the node is being recreated\n      // e.g. by group node conversion\n      this.controlValues = []\n      this.lastType = this.widgets[0]?.type\n      for (let i = 1; i < this.widgets.length; i++) {\n        this.controlValues.push(this.widgets[i].value)\n      }\n      setTimeout(() => {\n        delete this.lastType\n        delete this.controlValues\n      }, 15)\n      this.widgets.length = 0\n    }\n  }\n\n  onLastDisconnect() {\n    // We can't remove + re-add the output here as if you drag a link over the same link\n    // it removes, then re-adds, causing it to break\n    this.outputs[0].type = '*'\n    this.outputs[0].name = 'connect to widget input'\n    delete this.outputs[0].widget\n\n    this.#removeWidgets()\n  }\n}\n\nexport function getWidgetConfig(\n  slot: INodeInputSlot | INodeOutputSlot\n): InputSpec {\n  return (slot.widget?.[CONFIG] ??\n    (slot.widget?.[GET_CONFIG] as () => InputSpec)?.() ?? [\n      '*',\n      {}\n    ]) as InputSpec\n}\n\nfunction getConfig(this: LGraphNode, widgetName: string) {\n  const { nodeData } = this.constructor\n  return (\n    nodeData?.input?.required?.[widgetName] ??\n    nodeData?.input?.optional?.[widgetName]\n  )\n}\n\n/**\n * Convert a widget to an input slot.\n * @deprecated Widget to socket conversion is no longer necessary, as they co-exist now.\n * @param node The node to convert the widget to an input slot for.\n * @param widget The widget to convert to an input slot.\n * @returns The input slot that was converted from the widget or undefined if the widget is not found.\n * @knipIgnoreUnusedButUsedByCustomNodes\n */\nexport function convertToInput(\n  node: LGraphNode,\n  widget: IBaseWidget\n): INodeInputSlot | undefined {\n  console.warn(\n    'Please remove call to convertToInput. Widget to socket conversion is no longer necessary, as they co-exist now.'\n  )\n  return node.inputs.find((slot) => slot.widget?.name === widget.name)\n}\n\nfunction getWidgetType(config: InputSpec) {\n  // Special handling for COMBO so we restrict links based on the entries\n  let type = config[0]\n  if (type instanceof Array) {\n    type = 'COMBO'\n  }\n  return { type }\n}\n\nexport function setWidgetConfig(slot: INodeInputSlot, config?: InputSpec) {\n  if (!slot.widget) return\n  if (config) {\n    slot.widget[GET_CONFIG] = () => config\n  } else {\n    delete slot.widget\n  }\n\n  if (!(slot instanceof NodeSlot)) return\n  const graph = slot.node.graph\n  if (!graph) return\n  const link = graph.links[slot.link ?? -1]\n  if (!link) return\n  const originNode = graph.getNodeById(link.origin_id)\n  if (!originNode || !isPrimitiveNode(originNode)) return\n  if (config) {\n    originNode.recreateWidget()\n  } else if (!app.configuringGraph) {\n    originNode.disconnectOutput(0)\n    originNode.onLastDisconnect()\n  }\n}\n\nexport function mergeIfValid(\n  output: INodeOutputSlot | INodeInputSlot,\n  config2: InputSpec,\n  forceUpdate?: boolean,\n  recreateWidget?: () => void,\n  config1?: InputSpec\n): { customConfig: InputSpec[1] } {\n  if (!config1) {\n    config1 = getWidgetConfig(output)\n  }\n\n  const customSpec = mergeInputSpec(config1, config2)\n\n  if (customSpec || forceUpdate) {\n    if (customSpec) {\n      // @ts-expect-error fixme ts strict error\n      output.widget[CONFIG] = customSpec\n    }\n\n    // @ts-expect-error fixme ts strict error\n    const widget = recreateWidget?.call(this)\n    // When deleting a node this can be null\n    if (widget) {\n      // @ts-expect-error fixme ts strict error\n      const min = widget.options.min\n      // @ts-expect-error fixme ts strict error\n      const max = widget.options.max\n      // @ts-expect-error fixme ts strict error\n      if (min != null && widget.value < min) widget.value = min\n      // @ts-expect-error fixme ts strict error\n      if (max != null && widget.value > max) widget.value = max\n      // @ts-expect-error fixme ts strict error\n      widget.callback(widget.value)\n    }\n  }\n\n  return { customConfig: customSpec?.[1] ?? {} }\n}\n\napp.registerExtension({\n  name: 'Comfy.WidgetInputs',\n  async beforeRegisterNodeDef(nodeType, _nodeData, app) {\n    // @ts-expect-error adding extra property\n    nodeType.prototype.convertWidgetToInput = function (this: LGraphNode) {\n      console.warn(\n        'Please remove call to convertWidgetToInput. Widget to socket conversion is no longer necessary, as they co-exist now.'\n      )\n      return false\n    }\n\n    nodeType.prototype.onGraphConfigured = useChainCallback(\n      nodeType.prototype.onGraphConfigured,\n      function (this: LGraphNode) {\n        if (!this.inputs) return\n        this.widgets ??= []\n\n        for (const input of this.inputs) {\n          if (input.widget) {\n            const name = input.widget.name\n            if (!input.widget[GET_CONFIG]) {\n              input.widget[GET_CONFIG] = () => getConfig.call(this, name)\n            }\n\n            const w = this.widgets?.find((w) => w.name === name)\n            if (!w) {\n              this.removeInput(this.inputs.findIndex((i) => i === input))\n            }\n          }\n        }\n      }\n    )\n\n    nodeType.prototype.onConfigure = useChainCallback(\n      nodeType.prototype.onConfigure,\n      function (this: LGraphNode) {\n        if (!app.configuringGraph && this.inputs) {\n          // On copy + paste of nodes, ensure that widget configs are set up\n          for (const input of this.inputs) {\n            if (input.widget && !input.widget[GET_CONFIG]) {\n              const name = input.widget.name\n              input.widget[GET_CONFIG] = () => getConfig.call(this, name)\n            }\n          }\n        }\n      }\n    )\n\n    // Double click a widget input to automatically attach a primitive\n    const origOnInputDblClick = nodeType.prototype.onInputDblClick\n    nodeType.prototype.onInputDblClick = function (\n      this: LGraphNode,\n      ...[slot, ...args]: CallbackParams<typeof origOnInputDblClick>\n    ) {\n      const r = origOnInputDblClick?.apply(this, [slot, ...args])\n\n      const input = this.inputs[slot]\n      if (!input.widget) {\n        // Not a widget input or already handled input\n        if (\n          !(input.type in ComfyWidgets) &&\n          !(\n            (\n              input.widget?.[GET_CONFIG] as (() => InputSpec) | undefined\n            )?.()?.[0] instanceof Array\n          )\n        ) {\n          return r //also Not a ComfyWidgets input or combo (do nothing)\n        }\n      }\n\n      // Create a primitive node\n      const node = LiteGraph.createNode('PrimitiveNode')\n      const graph = app.canvas.graph\n      if (!node || !graph) return r\n\n      graph?.add(node)\n\n      // Calculate a position that won't directly overlap another node\n      const pos: [number, number] = [\n        this.pos[0] - node.size[0] - 30,\n        this.pos[1]\n      ]\n      while (graph.getNodeOnPos(pos[0], pos[1], graph.nodes))\n        pos[1] += LiteGraph.NODE_TITLE_HEIGHT\n\n      node.pos = pos\n      node.connect(0, this, slot)\n      node.title = input.name\n\n      return r\n    }\n  },\n  registerCustomNodes() {\n    LiteGraph.registerNodeType(\n      'PrimitiveNode',\n      Object.assign(PrimitiveNode, {\n        title: 'Primitive'\n      })\n    )\n    PrimitiveNode.category = 'utils'\n  }\n})\n","import { PREFIX, SEPARATOR } from '@/constants/groupNodeConstants'\nimport { t } from '@/i18n'\nimport type { GroupNodeWorkflowData } from '@/lib/litegraph/src/LGraph'\nimport type { SerialisedLLinkArray } from '@/lib/litegraph/src/LLink'\nimport type { NodeId } from '@/lib/litegraph/src/LGraphNode'\nimport type { IContextMenuValue } from '@/lib/litegraph/src/interfaces'\nimport {\n  type ExecutableLGraphNode,\n  type ExecutionId,\n  LGraphNode,\n  type LGraphNodeConstructor,\n  LiteGraph,\n  SubgraphNode\n} from '@/lib/litegraph/src/litegraph'\nimport { useToastStore } from '@/platform/updates/common/toastStore'\nimport {\n  type ComfyNode,\n  type ComfyWorkflowJSON\n} from '@/platform/workflow/validation/schemas/workflowSchema'\nimport type { ComfyNodeDef, InputSpec } from '@/schemas/nodeDefSchema'\nimport { useDialogService } from '@/services/dialogService'\nimport { useExecutionStore } from '@/stores/executionStore'\nimport { useNodeDefStore } from '@/stores/nodeDefStore'\nimport { useWidgetStore } from '@/stores/widgetStore'\nimport { type ComfyExtension } from '@/types/comfy'\nimport { ExecutableGroupNodeChildDTO } from '@/utils/executableGroupNodeChildDTO'\nimport { GROUP } from '@/utils/executableGroupNodeDto'\nimport { deserialiseAndCreate, serialise } from '@/utils/vintageClipboard'\n\nimport { api } from '../../scripts/api'\nimport { app } from '../../scripts/app'\nimport { ManageGroupDialog } from './groupNodeManage'\nimport { mergeIfValid } from './widgetInputs'\n\ntype GroupNodeLink = SerialisedLLinkArray\ntype LinksFromMap = Record<number, Record<number, GroupNodeLink[]>>\ntype LinksToMap = Record<number, Record<number, GroupNodeLink>>\ntype ExternalFromMap = Record<number, Record<number, string | number>>\n\ninterface GroupNodeInput {\n  name?: string\n  type?: string\n  label?: string\n  widget?: { name: string }\n}\n\ninterface GroupNodeOutput {\n  name?: string\n  type?: string\n  label?: string\n  widget?: { name: string }\n  links?: number[]\n}\n\ninterface GroupNodeData extends Omit<\n  GroupNodeWorkflowData['nodes'][number],\n  'inputs' | 'outputs'\n> {\n  title?: string\n  widgets_values?: unknown[]\n  inputs?: GroupNodeInput[]\n  outputs?: GroupNodeOutput[]\n}\n\ninterface GroupNodeDef {\n  input: {\n    required: Record<string, unknown>\n    optional?: Record<string, unknown>\n  }\n  output: unknown[]\n  output_name: string[]\n  output_is_list: boolean[]\n}\n\ninterface NodeConfigEntry {\n  input?: Record<string, { name?: string; visible?: boolean }>\n  output?: Record<number, { name?: string; visible?: boolean }>\n}\n\ninterface SerializedGroupConfig {\n  nodes: unknown[]\n  links: GroupNodeLink[]\n  external?: (number | string)[][]\n}\n\nconst Workflow = {\n  InUse: {\n    Free: 0,\n    Registered: 1,\n    InWorkflow: 2\n  },\n  isInUseGroupNode(name: string) {\n    const id = `${PREFIX}${SEPARATOR}${name}`\n    // Check if lready registered/in use in this workflow\n    if (app.rootGraph.extra?.groupNodes?.[name]) {\n      if (app.rootGraph.nodes.find((n) => n.type === id)) {\n        return Workflow.InUse.InWorkflow\n      } else {\n        return Workflow.InUse.Registered\n      }\n    }\n    return Workflow.InUse.Free\n  },\n  storeGroupNode(name: string, data: GroupNodeWorkflowData) {\n    let extra = app.rootGraph.extra\n    if (!extra) app.rootGraph.extra = extra = {}\n    let groupNodes = extra.groupNodes\n    if (!groupNodes) extra.groupNodes = groupNodes = {}\n    groupNodes[name] = data\n  }\n}\n\nclass GroupNodeBuilder {\n  nodes: LGraphNode[]\n  nodeData!: GroupNodeWorkflowData\n\n  constructor(nodes: LGraphNode[]) {\n    this.nodes = nodes\n  }\n\n  async build() {\n    const name = await this.getName()\n    if (!name) return\n\n    // Sort the nodes so they are in execution order\n    // this allows for widgets to be in the correct order when reconstructing\n    this.sortNodes()\n\n    this.nodeData = this.getNodeData()\n    Workflow.storeGroupNode(name, this.nodeData)\n\n    return { name, nodeData: this.nodeData }\n  }\n\n  async getName() {\n    const name = await useDialogService().prompt({\n      title: t('groupNode.create'),\n      message: t('groupNode.enterName'),\n      defaultValue: ''\n    })\n    if (!name) return\n    const used = Workflow.isInUseGroupNode(name)\n    switch (used) {\n      case Workflow.InUse.InWorkflow:\n        useToastStore().addAlert(\n          'An in use group node with this name already exists embedded in this workflow, please remove any instances or use a new name.'\n        )\n        return\n      case Workflow.InUse.Registered:\n        if (\n          !confirm(\n            'A group node with this name already exists embedded in this workflow, are you sure you want to overwrite it?'\n          )\n        ) {\n          return\n        }\n        break\n    }\n    return name\n  }\n\n  sortNodes() {\n    // Gets the builders nodes in graph execution order\n    const nodesInOrder = app.rootGraph.computeExecutionOrder(false)\n    this.nodes = this.nodes\n      .map((node) => ({ index: nodesInOrder.indexOf(node), node }))\n      .sort(\n        (a, b) =>\n          a.index - b.index ||\n          String(a.node.id).localeCompare(String(b.node.id))\n      )\n      .map(({ node }) => node)\n  }\n\n  getNodeData(): GroupNodeWorkflowData {\n    const storeLinkTypes = (config: SerializedGroupConfig) => {\n      // Store link types for dynamically typed nodes e.g. reroutes\n      for (const link of config.links) {\n        const origin = app.rootGraph.getNodeById(link[4] as NodeId)\n        const type = origin?.outputs?.[Number(link[1])]?.type\n        if (type !== undefined) link.push(type)\n      }\n    }\n\n    const storeExternalLinks = (config: SerializedGroupConfig) => {\n      // Store any external links to the group in the config so when rebuilding we add extra slots\n      config.external = []\n      for (let i = 0; i < this.nodes.length; i++) {\n        const node = this.nodes[i]\n        if (!node.outputs?.length) continue\n        for (let slot = 0; slot < node.outputs.length; slot++) {\n          let hasExternal = false\n          const output = node.outputs[slot]\n          let type = output.type\n          if (!output.links?.length) continue\n          for (const l of output.links) {\n            const link = app.rootGraph.links[l]\n            if (!link) continue\n            if (type === '*') type = link.type\n\n            if (!app.canvas.selected_nodes[link.target_id]) {\n              hasExternal = true\n              break\n            }\n          }\n          if (hasExternal) {\n            config.external.push([i, slot, String(type)])\n          }\n        }\n      }\n    }\n\n    // Use the built in copyToClipboard function to generate the node data we need\n    const graph = app.canvas?.graph\n    if (!graph) return { nodes: [], links: [], external: [] }\n    const serialised = serialise(this.nodes, graph)\n    const config = JSON.parse(serialised) as SerializedGroupConfig\n    config.external = []\n\n    storeLinkTypes(config)\n    storeExternalLinks(config)\n\n    return config as GroupNodeWorkflowData\n  }\n}\n\nexport class GroupNodeConfig {\n  name: string\n  nodeData: GroupNodeWorkflowData\n  inputCount: number\n  oldToNewOutputMap: Record<number, Record<number, number>>\n  newToOldOutputMap: Record<number, { node: GroupNodeData; slot: number }>\n  oldToNewInputMap: Record<number, Record<string, number>>\n  oldToNewWidgetMap: Record<number, Record<string, string | null>>\n  newToOldWidgetMap: Record<string, { node: GroupNodeData; inputName: string }>\n  primitiveDefs: Record<number, GroupNodeDef>\n  widgetToPrimitive: Record<number, Record<string, number | number[]>>\n  primitiveToWidget: Record<\n    number,\n    { nodeId: number | string | null; inputName: string }[]\n  >\n  nodeInputs: Record<number, Record<string, string>>\n  outputVisibility: boolean[]\n  nodeDef: (ComfyNodeDef & { [GROUP]: GroupNodeConfig }) | undefined\n  inputs!: unknown[]\n  linksFrom!: LinksFromMap\n  linksTo!: LinksToMap\n  externalFrom!: ExternalFromMap\n\n  constructor(name: string, nodeData: GroupNodeWorkflowData) {\n    this.name = name\n    this.nodeData = nodeData\n    this.getLinks()\n\n    this.inputCount = 0\n    this.oldToNewOutputMap = {}\n    this.newToOldOutputMap = {}\n    this.oldToNewInputMap = {}\n    this.oldToNewWidgetMap = {}\n    this.newToOldWidgetMap = {}\n    this.primitiveDefs = {}\n    this.widgetToPrimitive = {}\n    this.primitiveToWidget = {}\n    this.nodeInputs = {}\n    this.outputVisibility = []\n  }\n\n  async registerType(source = PREFIX) {\n    this.nodeDef = {\n      output: [],\n      output_name: [],\n      output_is_list: [],\n      output_node: false, // This is a lie (to satisfy the interface)\n      name: source + SEPARATOR + this.name,\n      display_name: this.name,\n      category: 'group nodes' + (SEPARATOR + source),\n      input: { required: {} },\n      description: `Group node combining ${this.nodeData.nodes\n        .map((n) => n.type)\n        .join(', ')}`,\n      python_module: 'custom_nodes.' + this.name,\n\n      [GROUP]: this\n    }\n\n    this.inputs = []\n    const seenInputs = {}\n    const seenOutputs = {}\n    for (let i = 0; i < this.nodeData.nodes.length; i++) {\n      const node = this.nodeData.nodes[i] as GroupNodeData\n      node.index = i\n      this.processNode(node, seenInputs, seenOutputs)\n    }\n\n    for (const p of this.#convertedToProcess) {\n      p()\n    }\n    this.#convertedToProcess = []\n    if (!this.nodeDef) return\n    await app.registerNodeDef(`${PREFIX}${SEPARATOR}` + this.name, this.nodeDef)\n    useNodeDefStore().addNodeDef(this.nodeDef)\n  }\n\n  getLinks() {\n    this.linksFrom = {}\n    this.linksTo = {}\n    this.externalFrom = {}\n\n    // Extract links for easy lookup\n    for (const link of this.nodeData.links) {\n      const [sourceNodeId, sourceNodeSlot, targetNodeId, targetNodeSlot] = link\n\n      // Skip links outside the copy config\n      if (\n        sourceNodeId == null ||\n        sourceNodeSlot == null ||\n        targetNodeId == null ||\n        targetNodeSlot == null\n      )\n        continue\n\n      const srcId = Number(sourceNodeId)\n      const srcSlot = Number(sourceNodeSlot)\n      const tgtId = Number(targetNodeId)\n      const tgtSlot = Number(targetNodeSlot)\n\n      if (!this.linksFrom[srcId]) {\n        this.linksFrom[srcId] = {}\n      }\n      if (!this.linksFrom[srcId][srcSlot]) {\n        this.linksFrom[srcId][srcSlot] = []\n      }\n      this.linksFrom[srcId][srcSlot].push(link)\n\n      if (!this.linksTo[tgtId]) {\n        this.linksTo[tgtId] = {}\n      }\n      this.linksTo[tgtId][tgtSlot] = link\n    }\n\n    if (this.nodeData.external) {\n      for (const ext of this.nodeData.external) {\n        const nodeIdx = Number(ext[0])\n        const slotIdx = Number(ext[1])\n        const typeVal = ext[2]\n        if (typeVal == null) continue\n        if (!this.externalFrom[nodeIdx]) {\n          this.externalFrom[nodeIdx] = { [slotIdx]: typeVal }\n        } else {\n          this.externalFrom[nodeIdx][slotIdx] = typeVal\n        }\n      }\n    }\n  }\n\n  processNode(\n    node: GroupNodeData,\n    seenInputs: Record<string, number>,\n    seenOutputs: Record<string, number>\n  ) {\n    const def = this.getNodeDef(node)\n    if (!def) return\n\n    const inputs = { ...def.input?.required, ...def.input?.optional }\n\n    this.inputs.push(this.processNodeInputs(node, seenInputs, inputs))\n    if (def.output?.length) this.processNodeOutputs(node, seenOutputs, def)\n  }\n\n  getNodeDef(\n    node: GroupNodeData\n  ): GroupNodeDef | ComfyNodeDef | null | undefined {\n    if (node.type) {\n      const def = globalDefs[node.type]\n      if (def) return def\n    }\n\n    const nodeIndex = node.index\n    if (nodeIndex == null) return undefined\n\n    const linksFrom = this.linksFrom[nodeIndex]\n    if (node.type === 'PrimitiveNode') {\n      // Skip as its not linked\n      if (!linksFrom) return\n\n      let type: string | number | null = linksFrom[0]?.[0]?.[5] ?? null\n      if (type === 'COMBO') {\n        // Use the array items\n        const source = node.outputs?.[0]?.widget?.name\n        const nodeIdx = linksFrom[0]?.[0]?.[2]\n        if (source && nodeIdx != null) {\n          const fromTypeName = this.nodeData.nodes[Number(nodeIdx)]?.type\n          if (fromTypeName) {\n            const fromType = globalDefs[fromTypeName]\n            const input =\n              fromType?.input?.required?.[source] ??\n              fromType?.input?.optional?.[source]\n            const inputType = input?.[0]\n            type =\n              typeof inputType === 'string' || typeof inputType === 'number'\n                ? inputType\n                : null\n          }\n        }\n      }\n\n      const def = (this.primitiveDefs[nodeIndex] = {\n        input: {\n          required: {\n            value: [type, {}]\n          }\n        },\n        output: [type],\n        output_name: [],\n        output_is_list: []\n      })\n      return def\n    } else if (node.type === 'Reroute') {\n      const linksTo = this.linksTo[nodeIndex]\n      if (linksTo && linksFrom && !this.externalFrom[nodeIndex]?.[0]) {\n        // Being used internally\n        return null\n      }\n\n      let config: Record<string, unknown> = {}\n      let rerouteType = '*'\n      if (linksFrom) {\n        const links = linksFrom[0] ?? []\n        for (const link of links) {\n          const id = link[2]\n          const slot = link[3]\n          if (id == null || slot == null) continue\n          const targetNode = this.nodeData.nodes[Number(id)]\n          const input = targetNode?.inputs?.[Number(slot)] as\n            | GroupNodeInput\n            | undefined\n          if (input?.type && rerouteType === '*') {\n            rerouteType = input.type\n          }\n          if (input?.widget && targetNode?.type) {\n            const targetDef = globalDefs[targetNode.type]\n            const targetWidget =\n              targetDef?.input?.required?.[input.widget.name] ??\n              targetDef?.input?.optional?.[input.widget.name]\n\n            if (targetWidget) {\n              const widgetSpec = [targetWidget[0], config] as Parameters<\n                typeof mergeIfValid\n              >[4]\n              const res = mergeIfValid(\n                { widget: widgetSpec } as unknown as Parameters<\n                  typeof mergeIfValid\n                >[0],\n                targetWidget,\n                false,\n                undefined,\n                widgetSpec\n              )\n              config = (res?.customConfig as Record<string, unknown>) ?? config\n            }\n          }\n        }\n      } else if (linksTo) {\n        const link = linksTo[0]\n        if (link) {\n          const id = link[0]\n          const slot = link[1]\n          if (id != null && slot != null) {\n            const outputType =\n              this.nodeData.nodes[Number(id)]?.outputs?.[Number(slot)]\n            if (\n              outputType &&\n              typeof outputType === 'object' &&\n              'type' in outputType\n            ) {\n              rerouteType = String((outputType as GroupNodeOutput).type ?? '*')\n            }\n          }\n        }\n      } else {\n        // Reroute used as a pipe\n        for (const l of this.nodeData.links) {\n          if (l[2] === node.index) {\n            const linkType = l[5]\n            if (linkType != null) rerouteType = String(linkType)\n            break\n          }\n        }\n        if (rerouteType === '*') {\n          // Check for an external link\n          const t = this.externalFrom[nodeIndex]?.[0]\n          if (t) {\n            rerouteType = String(t)\n          }\n        }\n      }\n\n      config.forceInput = true\n      return {\n        input: {\n          required: {\n            [rerouteType]: [rerouteType, config]\n          }\n        },\n        output: [rerouteType],\n        output_name: [],\n        output_is_list: []\n      }\n    }\n\n    console.warn(\n      'Skipping virtual node ' +\n        node.type +\n        ' when building group node ' +\n        this.name\n    )\n  }\n\n  getInputConfig(\n    node: GroupNodeData,\n    inputName: string,\n    seenInputs: Record<string, number>,\n    config: unknown[],\n    extra?: Record<string, unknown>\n  ) {\n    const nodeConfig = this.nodeData.config?.[node.index ?? -1] as\n      | NodeConfigEntry\n      | undefined\n    const customConfig = nodeConfig?.input?.[inputName]\n    let name =\n      customConfig?.name ??\n      node.inputs?.find((inp) => inp.name === inputName)?.label ??\n      inputName\n    let key = name\n    let prefix = ''\n    // Special handling for primitive to include the title if it is set rather than just \"value\"\n    if ((node.type === 'PrimitiveNode' && node.title) || name in seenInputs) {\n      prefix = `${node.title ?? node.type} `\n      key = name = `${prefix}${inputName}`\n      if (name in seenInputs) {\n        name = `${prefix}${seenInputs[name]} ${inputName}`\n      }\n    }\n    seenInputs[key] = (seenInputs[key] ?? 1) + 1\n\n    if (inputName === 'seed' || inputName === 'noise_seed') {\n      if (!extra) extra = {}\n      extra.control_after_generate = `${prefix}control_after_generate`\n    }\n    if (config[0] === 'IMAGEUPLOAD') {\n      if (!extra) extra = {}\n      const nodeIndex = node.index ?? -1\n      const configOptions =\n        typeof config[1] === 'object' && config[1] !== null ? config[1] : {}\n      const widgetKey =\n        'widget' in configOptions && typeof configOptions.widget === 'string'\n          ? configOptions.widget\n          : 'image'\n      extra.widget = this.oldToNewWidgetMap[nodeIndex]?.[widgetKey] ?? 'image'\n    }\n\n    if (extra) {\n      const configObj =\n        typeof config[1] === 'object' && config[1] ? config[1] : {}\n      config = [config[0], { ...configObj, ...extra }]\n    }\n\n    return { name, config, customConfig }\n  }\n\n  processWidgetInputs(\n    inputs: Record<string, unknown>,\n    node: GroupNodeData,\n    inputNames: string[],\n    seenInputs: Record<string, number>\n  ) {\n    const slots: string[] = []\n    const converted = new Map<number, string>()\n    const nodeIndex = node.index ?? -1\n    const widgetMap: Record<string, string | null> = (this.oldToNewWidgetMap[\n      nodeIndex\n    ] = {})\n    for (const inputName of inputNames) {\n      const inputSpec = inputs[inputName]\n      const isValidSpec =\n        Array.isArray(inputSpec) &&\n        inputSpec.length >= 1 &&\n        typeof inputSpec[0] === 'string'\n      if (\n        isValidSpec &&\n        useWidgetStore().inputIsWidget(inputSpec as InputSpec)\n      ) {\n        const convertedIndex =\n          node.inputs?.findIndex(\n            (inp) => inp.name === inputName && inp.widget?.name === inputName\n          ) ?? -1\n        if (convertedIndex > -1) {\n          // This widget has been converted to a widget\n          // We need to store this in the correct position so link ids line up\n          converted.set(convertedIndex, inputName)\n          widgetMap[inputName] = null\n        } else {\n          // Normal widget\n          const { name, config } = this.getInputConfig(\n            node,\n            inputName,\n            seenInputs,\n            inputs[inputName] as unknown[]\n          )\n          if (this.nodeDef?.input?.required) {\n            // @ts-expect-error legacy dynamic input assignment\n            this.nodeDef.input.required[name] = config\n          }\n          widgetMap[inputName] = name\n          this.newToOldWidgetMap[name] = { node, inputName }\n        }\n      } else {\n        // Normal input\n        slots.push(inputName)\n      }\n    }\n    return { converted, slots }\n  }\n\n  checkPrimitiveConnection(\n    link: GroupNodeLink,\n    inputName: string,\n    inputs: Record<string, unknown[]>\n  ) {\n    const linkSourceIdx = link[0]\n    if (linkSourceIdx == null) return\n    const sourceNode = this.nodeData.nodes[Number(linkSourceIdx)]\n    if (sourceNode?.type === 'PrimitiveNode') {\n      // Merge link configurations\n      const sourceNodeId = Number(link[0])\n      const targetNodeId = Number(link[2])\n      const primitiveDef = this.primitiveDefs[sourceNodeId]\n      if (!primitiveDef) return\n      const targetWidget = inputs[inputName]\n      const primitiveConfig = primitiveDef.input.required.value as [\n        unknown,\n        Record<string, unknown>\n      ]\n      const output = { widget: primitiveConfig }\n      const config = mergeIfValid(\n        // @ts-expect-error slot type mismatch - legacy API\n        output,\n        targetWidget,\n        false,\n        undefined,\n        primitiveConfig\n      )\n      const inputConfig = inputs[inputName]?.[1]\n      primitiveConfig[1] =\n        (config?.customConfig ?? inputConfig)\n          ? { ...(typeof inputConfig === 'object' ? inputConfig : {}) }\n          : {}\n\n      const widgetName = this.oldToNewWidgetMap[sourceNodeId]?.['value']\n      if (widgetName) {\n        const name = widgetName.substring(0, widgetName.length - 6)\n        primitiveConfig[1].control_after_generate = true\n        primitiveConfig[1].control_prefix = name\n      }\n\n      let toPrimitive = this.widgetToPrimitive[targetNodeId]\n      if (!toPrimitive) {\n        toPrimitive = this.widgetToPrimitive[targetNodeId] = {}\n      }\n      const existing = toPrimitive[inputName]\n      if (Array.isArray(existing)) {\n        existing.push(sourceNodeId)\n      } else if (typeof existing === 'number') {\n        toPrimitive[inputName] = [existing, sourceNodeId]\n      } else {\n        toPrimitive[inputName] = sourceNodeId\n      }\n\n      let toWidget = this.primitiveToWidget[sourceNodeId]\n      if (!toWidget) {\n        toWidget = this.primitiveToWidget[sourceNodeId] = []\n      }\n      toWidget.push({ nodeId: targetNodeId, inputName })\n    }\n  }\n\n  processInputSlots(\n    inputs: Record<string, unknown[]>,\n    node: GroupNodeData,\n    slots: string[],\n    linksTo: Record<number, GroupNodeLink>,\n    inputMap: Record<number, number>,\n    seenInputs: Record<string, number>\n  ) {\n    const nodeIdx = node.index ?? -1\n    this.nodeInputs[nodeIdx] = {}\n    for (let i = 0; i < slots.length; i++) {\n      const inputName = slots[i]\n      if (linksTo[i]) {\n        this.checkPrimitiveConnection(linksTo[i], inputName, inputs)\n        // This input is linked so we can skip it\n        continue\n      }\n\n      const { name, config, customConfig } = this.getInputConfig(\n        node,\n        inputName,\n        seenInputs,\n        inputs[inputName]\n      )\n\n      this.nodeInputs[nodeIdx][inputName] = name\n      if (customConfig?.visible === false) continue\n\n      if (this.nodeDef?.input?.required) {\n        // @ts-expect-error legacy dynamic input assignment\n        this.nodeDef.input.required[name] = config\n      }\n      inputMap[i] = this.inputCount++\n    }\n  }\n\n  processConvertedWidgets(\n    inputs: Record<string, unknown>,\n    node: GroupNodeData,\n    slots: string[],\n    converted: Map<number, string>,\n    linksTo: Record<number, GroupNodeLink>,\n    inputMap: Record<number, number>,\n    seenInputs: Record<string, number>\n  ) {\n    // Add converted widgets sorted into their index order (ordered as they were converted) so link ids match up\n    const convertedSlots = [...converted.keys()]\n      .sort()\n      .map((k) => converted.get(k))\n    for (let i = 0; i < convertedSlots.length; i++) {\n      const inputName = convertedSlots[i]\n      if (!inputName) continue\n      if (linksTo[slots.length + i]) {\n        this.checkPrimitiveConnection(\n          linksTo[slots.length + i],\n          inputName,\n          inputs as Record<string, unknown[]>\n        )\n        // This input is linked so we can skip it\n        continue\n      }\n\n      const { name, config } = this.getInputConfig(\n        node,\n        inputName,\n        seenInputs,\n        inputs[inputName] as unknown[],\n        {\n          defaultInput: true\n        }\n      )\n\n      if (this.nodeDef?.input?.required) {\n        // @ts-expect-error legacy dynamic input assignment\n        this.nodeDef.input.required[name] = config\n      }\n      this.newToOldWidgetMap[name] = { node, inputName }\n\n      const nodeIndex = node.index ?? -1\n      if (!this.oldToNewWidgetMap[nodeIndex]) {\n        this.oldToNewWidgetMap[nodeIndex] = {}\n      }\n      this.oldToNewWidgetMap[nodeIndex][inputName] = name\n\n      inputMap[slots.length + i] = this.inputCount++\n    }\n  }\n\n  #convertedToProcess: (() => void)[] = []\n  processNodeInputs(\n    node: GroupNodeData,\n    seenInputs: Record<string, number>,\n    inputs: Record<string, unknown>\n  ) {\n    const inputMapping: unknown[] = []\n\n    const inputNames = Object.keys(inputs)\n    if (!inputNames.length) return\n\n    const { converted, slots } = this.processWidgetInputs(\n      inputs,\n      node,\n      inputNames,\n      seenInputs\n    )\n    const nodeIndex = node.index ?? -1\n    const linksTo = this.linksTo[nodeIndex] ?? {}\n    const inputMap: Record<number, number> = (this.oldToNewInputMap[nodeIndex] =\n      {})\n    this.processInputSlots(\n      inputs as unknown as Record<string, unknown[]>,\n      node,\n      slots,\n      linksTo,\n      inputMap,\n      seenInputs\n    )\n\n    // Converted inputs have to be processed after all other nodes as they'll be at the end of the list\n    this.#convertedToProcess.push(() =>\n      this.processConvertedWidgets(\n        inputs,\n        node,\n        slots,\n        converted,\n        linksTo,\n        inputMap,\n        seenInputs\n      )\n    )\n\n    return inputMapping\n  }\n\n  processNodeOutputs(\n    node: GroupNodeData,\n    seenOutputs: Record<string, number>,\n    def: GroupNodeDef | ComfyNodeDef\n  ) {\n    const nodeIndex = node.index ?? -1\n    const oldToNew: Record<number, number> = (this.oldToNewOutputMap[\n      nodeIndex\n    ] = {})\n\n    const defOutput = def.output ?? []\n    // Add outputs\n    for (let outputId = 0; outputId < defOutput.length; outputId++) {\n      const linksFrom = this.linksFrom[nodeIndex]\n      // If this output is linked internally we flag it to hide\n      const hasLink =\n        linksFrom?.[outputId] && !this.externalFrom[nodeIndex]?.[outputId]\n      const outputConfig = this.nodeData.config?.[node.index ?? -1] as\n        | NodeConfigEntry\n        | undefined\n      const customConfig = outputConfig?.output?.[outputId]\n      const visible = customConfig?.visible ?? !hasLink\n      this.outputVisibility.push(visible)\n      if (!visible) {\n        continue\n      }\n\n      if (this.nodeDef?.output) {\n        oldToNew[outputId] = this.nodeDef.output.length\n        this.newToOldOutputMap[this.nodeDef.output.length] = {\n          node,\n          slot: outputId\n        }\n        // @ts-expect-error legacy dynamic output type assignment\n        this.nodeDef.output.push(defOutput[outputId])\n        this.nodeDef.output_is_list?.push(\n          def.output_is_list?.[outputId] ?? false\n        )\n      }\n\n      let label: string | undefined = customConfig?.name\n      if (!label) {\n        const outputVal = defOutput[outputId]\n        label =\n          def.output_name?.[outputId] ??\n          (typeof outputVal === 'string' ? outputVal : undefined)\n        const output = node.outputs?.find((o) => o.name === label)\n        if (output?.label) {\n          label = output.label\n        }\n      }\n\n      let name: string = String(label ?? `output_${outputId}`)\n      if (name in seenOutputs) {\n        const prefix = `${node.title ?? node.type} `\n        name = `${prefix}${label ?? outputId}`\n        if (name in seenOutputs) {\n          name = `${prefix}${node.index} ${label ?? outputId}`\n        }\n      }\n      seenOutputs[name] = 1\n\n      this.nodeDef?.output_name?.push(name)\n    }\n  }\n\n  static async registerFromWorkflow(\n    groupNodes: Record<string, GroupNodeWorkflowData>,\n    missingNodeTypes: (\n      | string\n      | { type: string; hint?: string; action?: unknown }\n    )[]\n  ) {\n    for (const g in groupNodes) {\n      const groupData = groupNodes[g]\n\n      let hasMissing = false\n      for (const n of groupData.nodes) {\n        // Find missing node types\n        if (!n.type || !(n.type in LiteGraph.registered_node_types)) {\n          missingNodeTypes.push({\n            type: n.type ?? 'unknown',\n            hint: ` (In group node '${PREFIX}${SEPARATOR}${g}')`\n          })\n\n          missingNodeTypes.push({\n            type: `${PREFIX}${SEPARATOR}` + g,\n            action: {\n              text: 'Remove from workflow',\n              callback: (e: MouseEvent) => {\n                delete groupNodes[g]\n                const target = e.target as HTMLElement\n                target.textContent = 'Removed'\n                target.style.pointerEvents = 'none'\n                target.style.opacity = '0.7'\n              }\n            }\n          })\n\n          hasMissing = true\n        }\n      }\n\n      if (hasMissing) continue\n\n      const config = new GroupNodeConfig(g, groupData)\n      await config.registerType()\n    }\n  }\n}\n\nexport class GroupNodeHandler {\n  node: LGraphNode\n  groupData: GroupNodeConfig\n  innerNodes: LGraphNode[] | null = null\n\n  constructor(node: LGraphNode) {\n    this.node = node\n    this.groupData = node.constructor?.nodeData?.[GROUP] as GroupNodeConfig\n\n    this.node.setInnerNodes = (innerNodes) => {\n      this.innerNodes = innerNodes\n\n      for (\n        let innerNodeIndex = 0;\n        innerNodeIndex < this.innerNodes.length;\n        innerNodeIndex++\n      ) {\n        const innerNode = this.innerNodes[innerNodeIndex]\n        innerNode.graph ??= this.node.graph\n\n        for (const w of innerNode.widgets ?? []) {\n          if (w.type === 'converted-widget') {\n            // @ts-expect-error legacy widget property for converted widgets\n            w.serializeValue = w.origSerializeValue\n          }\n        }\n\n        innerNode.index = innerNodeIndex\n        innerNode.getInputNode = (slot: number) => {\n          // Check if this input is internal or external\n          const nodeIdx = innerNode.index ?? 0\n          const externalSlot = this.groupData.oldToNewInputMap[nodeIdx]?.[slot]\n          if (externalSlot != null) {\n            return this.node.getInputNode(externalSlot)\n          }\n\n          // Internal link\n          const innerLink = this.groupData.linksTo[nodeIdx]?.[slot]\n          if (!innerLink) return null\n\n          const linkSrcIdx = innerLink[0]\n          if (linkSrcIdx == null) return null\n          const inputNode = innerNodes[Number(linkSrcIdx)]\n          // Primitives will already apply their values\n          if (inputNode.type === 'PrimitiveNode') return null\n\n          return inputNode\n        }\n\n        // @ts-expect-error returns partial link object, not full LLink\n        innerNode.getInputLink = (slot: number) => {\n          const nodeIdx = innerNode.index ?? 0\n          const externalSlot = this.groupData.oldToNewInputMap[nodeIdx]?.[slot]\n          if (externalSlot != null) {\n            // The inner node is connected via the group node inputs\n            const linkId = this.node.inputs[externalSlot].link\n            if (linkId == null) return null\n            const existingLink = app.rootGraph.links[linkId]\n            if (!existingLink) return null\n\n            // Use the outer link, but update the target to the inner node\n            return {\n              ...existingLink,\n              target_id: innerNode.id,\n              target_slot: +slot\n            }\n          }\n\n          const innerLink = this.groupData.linksTo[nodeIdx]?.[slot]\n          if (!innerLink) return null\n          const linkSrcIdx = innerLink[0]\n          if (linkSrcIdx == null) return null\n          // Use the inner link, but update the origin node to be inner node id\n          return {\n            origin_id: innerNodes[Number(linkSrcIdx)].id,\n            origin_slot: innerLink[1],\n            target_id: innerNode.id,\n            target_slot: +slot\n          }\n        }\n      }\n    }\n\n    this.node.updateLink = (link) => {\n      // Replace the group node reference with the internal node\n      // @ts-expect-error Can this be removed?  Or replaced with: LLink.create(link.asSerialisable())\n      link = { ...link }\n      const output = this.groupData.newToOldOutputMap[link.origin_slot]\n      if (!output || !this.innerNodes) return null\n      const nodeIdx = output.node.index ?? 0\n      let innerNode: LGraphNode | null = this.innerNodes[nodeIdx]\n      let l\n      while (innerNode?.type === 'Reroute') {\n        l = innerNode.getInputLink(0)\n        innerNode = innerNode.getInputNode(0)\n      }\n\n      if (!innerNode) {\n        return null\n      }\n\n      if (\n        l &&\n        GroupNodeHandler.isGroupNode(innerNode) &&\n        innerNode.updateLink\n      ) {\n        return innerNode.updateLink(l)\n      }\n\n      link.origin_id = innerNode.id\n      link.origin_slot = l?.origin_slot ?? output.slot\n      return link\n    }\n\n    /** @internal Used to flatten the subgraph before execution. Recursive; call with no args. */\n    this.node.getInnerNodes = (\n      computedNodeDtos: Map<ExecutionId, ExecutableLGraphNode>,\n      /** The path of subgraph node IDs. */\n      subgraphNodePath: readonly NodeId[] = [],\n      /** The list of nodes to add to. */\n      nodes: ExecutableLGraphNode[] = [],\n      /** The set of visited nodes. */\n      visited = new Set<LGraphNode>()\n    ): ExecutableLGraphNode[] => {\n      if (visited.has(this.node))\n        throw new Error('RecursionError: while flattening subgraph')\n      visited.add(this.node)\n\n      if (!this.innerNodes) {\n        const createdNodes = this.groupData.nodeData.nodes\n          .map((n, i) => {\n            if (!n.type) return null\n            const innerNode = LiteGraph.createNode(n.type)\n            if (!innerNode) return null\n            // @ts-expect-error legacy node data format used for configure\n            innerNode.configure(n)\n            innerNode.id = `${this.node.id}:${i}`\n            innerNode.graph = this.node.graph\n            return innerNode\n          })\n          .filter((n): n is LGraphNode => n !== null)\n        this.node.setInnerNodes?.(createdNodes)\n      }\n\n      this.updateInnerWidgets()\n\n      const subgraphInstanceIdPath = [...subgraphNodePath, this.node.id]\n\n      // Assertion: Deprecated, does not matter.\n      const subgraphNode = (this.node.graph?.getNodeById(\n        subgraphNodePath.at(-1)\n      ) ?? undefined) as SubgraphNode | undefined\n\n      for (const node of this.innerNodes ?? []) {\n        node.graph ??= this.node.graph\n\n        // Create minimal DTOs rather than cloning the node\n        const currentId = String(node.id)\n        // @ts-expect-error temporary id reassignment for DTO creation\n        node.id = currentId.split(':').at(-1)\n        const aVeryRealNode = new ExecutableGroupNodeChildDTO(\n          node,\n          subgraphInstanceIdPath,\n          computedNodeDtos,\n          subgraphNode\n        )\n        node.id = currentId\n        aVeryRealNode.groupNodeHandler = this\n\n        nodes.push(aVeryRealNode)\n      }\n      return nodes\n    }\n\n    // @ts-expect-error recreate returns null if creation fails\n    this.node.recreate = async () => {\n      const id = this.node.id\n      const sz = this.node.size\n      const nodes = (\n        this.node as LGraphNode & { convertToNodes?: () => LGraphNode[] }\n      ).convertToNodes?.()\n      if (!nodes) return null\n\n      const groupNode = LiteGraph.createNode(this.node.type)\n      if (!groupNode) return null\n      groupNode.id = id\n\n      // Reuse the existing nodes for this instance\n      groupNode.setInnerNodes?.(nodes)\n      const handler = GroupNodeHandler.getHandler(groupNode)\n      handler?.populateWidgets()\n      app.rootGraph.add(groupNode)\n      groupNode.setSize?.([\n        Math.max(groupNode.size[0], sz[0]),\n        Math.max(groupNode.size[1], sz[1])\n      ])\n\n      // Remove all converted nodes and relink them\n      const builder = new GroupNodeBuilder(nodes)\n      const nodeData = builder.getNodeData()\n      if (handler) {\n        handler.groupData.nodeData.links = nodeData.links\n        handler.replaceNodes(nodes)\n      }\n      return groupNode\n    }\n    ;(\n      this.node as LGraphNode & { convertToNodes: () => LGraphNode[] }\n    ).convertToNodes = () => {\n      const addInnerNodes = () => {\n        // Clone the node data so we dont mutate it for other nodes\n        const c = { ...this.groupData.nodeData }\n        c.nodes = [...c.nodes]\n        // @ts-expect-error getInnerNodes called without args in legacy conversion code\n        const innerNodes = this.node.getInnerNodes?.()\n        const ids: (string | number)[] = []\n        for (let i = 0; i < c.nodes.length; i++) {\n          let id: string | number | undefined = innerNodes?.[i]?.id\n          // Use existing IDs if they are set on the inner nodes\n          if (id == null || (typeof id === 'number' && isNaN(id))) {\n            id = undefined\n          } else {\n            ids.push(id)\n          }\n          // @ts-expect-error adding id to node copy for serialization\n          c.nodes[i] = { ...c.nodes[i], id }\n        }\n        deserialiseAndCreate(JSON.stringify(c), app.canvas)\n\n        const [x, y] = this.node.pos\n        let top: number | undefined\n        let left: number | undefined\n        // Configure nodes with current widget data\n        const selectedIds = ids.length\n          ? ids\n          : Object.keys(app.canvas.selected_nodes)\n        const newNodes: LGraphNode[] = []\n        for (let i = 0; i < selectedIds.length; i++) {\n          const id = selectedIds[i]\n          const newNode = app.rootGraph.getNodeById(id)\n          const innerNode = innerNodes?.[i]\n          if (!newNode) continue\n          newNodes.push(newNode)\n\n          if (left == null || newNode.pos[0] < left) {\n            left = newNode.pos[0]\n          }\n          if (top == null || newNode.pos[1] < top) {\n            top = newNode.pos[1]\n          }\n\n          if (!newNode.widgets || !innerNode) continue\n\n          // @ts-expect-error index property access on ExecutableLGraphNode\n          const map = this.groupData.oldToNewWidgetMap[innerNode.index ?? 0]\n          if (map) {\n            const widgets = Object.keys(map)\n\n            for (const oldName of widgets) {\n              const newName = map[oldName]\n              if (!newName) continue\n\n              const widgetIndex =\n                this.node.widgets?.findIndex((w) => w.name === newName) ?? -1\n              if (widgetIndex === -1) continue\n\n              // Populate the main and any linked widgets\n              if (innerNode.type === 'PrimitiveNode') {\n                for (let i = 0; i < newNode.widgets.length; i++) {\n                  const srcWidget = this.node.widgets?.[widgetIndex + i]\n                  if (srcWidget) {\n                    newNode.widgets[i].value = srcWidget.value\n                  }\n                }\n              } else {\n                const outerWidget = this.node.widgets?.[widgetIndex]\n                const newWidget = newNode.widgets.find(\n                  (w) => w.name === oldName\n                )\n                if (!newWidget || !outerWidget) continue\n\n                newWidget.value = outerWidget.value\n                const linkedWidgets = outerWidget.linkedWidgets ?? []\n                for (let w = 0; w < linkedWidgets.length; w++) {\n                  const newLinked = newWidget.linkedWidgets?.[w]\n                  if (newLinked && linkedWidgets[w]) {\n                    newLinked.value = linkedWidgets[w].value\n                  }\n                }\n              }\n            }\n          }\n        }\n\n        // Shift each node\n        for (const newNode of newNodes) {\n          newNode.pos[0] -= (left ?? 0) - x\n          newNode.pos[1] -= (top ?? 0) - y\n        }\n\n        return { newNodes, selectedIds }\n      }\n\n      const reconnectInputs = (selectedIds: (string | number)[]) => {\n        for (const innerNodeIndex in this.groupData.oldToNewInputMap) {\n          const id = selectedIds[Number(innerNodeIndex)]\n          const newNode = app.rootGraph.getNodeById(id)\n          if (!newNode) continue\n          const map = this.groupData.oldToNewInputMap[Number(innerNodeIndex)]\n          for (const innerInputId in map) {\n            const groupSlotId = map[Number(innerInputId)]\n            if (groupSlotId == null) continue\n            const slot = node.inputs[groupSlotId]\n            if (slot.link == null) continue\n            const link = app.rootGraph.links[slot.link]\n            if (!link) continue\n            //  connect this node output to the input of another node\n            const originNode = app.rootGraph.getNodeById(link.origin_id)\n            originNode?.connect(link.origin_slot, newNode, +innerInputId)\n          }\n        }\n      }\n\n      const reconnectOutputs = (selectedIds: (string | number)[]) => {\n        for (\n          let groupOutputId = 0;\n          groupOutputId < node.outputs?.length;\n          groupOutputId++\n        ) {\n          const output = node.outputs[groupOutputId]\n          if (!output.links) continue\n          const links = [...output.links]\n          for (const l of links) {\n            const slot = this.groupData.newToOldOutputMap[groupOutputId]\n            if (!slot) continue\n            const link = app.rootGraph.links[l]\n            if (!link) continue\n            const targetNode = app.rootGraph.getNodeById(link.target_id)\n            const newNode = app.rootGraph.getNodeById(\n              selectedIds[slot.node.index ?? 0]\n            )\n            if (targetNode) {\n              newNode?.connect(slot.slot, targetNode, link.target_slot)\n            }\n          }\n        }\n      }\n\n      app.canvas.emitBeforeChange()\n\n      try {\n        const { newNodes, selectedIds } = addInnerNodes()\n        reconnectInputs(selectedIds)\n        reconnectOutputs(selectedIds)\n        app.rootGraph.remove(this.node)\n\n        return newNodes\n      } finally {\n        app.canvas.emitAfterChange()\n      }\n    }\n\n    const getExtraMenuOptions = this.node.getExtraMenuOptions\n    const handlerNode = this.node\n    this.node.getExtraMenuOptions = function (_canvas, options) {\n      getExtraMenuOptions?.call(this, _canvas, options)\n\n      let optionIndex = options.findIndex((o) => o?.content === 'Outputs')\n      if (optionIndex === -1) optionIndex = options.length\n      else optionIndex++\n      options.splice(\n        optionIndex,\n        0,\n        null,\n        {\n          content: 'Convert to nodes',\n          // @ts-expect-error async callback not expected by legacy menu API\n          callback: async () => {\n            const convertFn = (\n              handlerNode as LGraphNode & {\n                convertToNodes?: () => LGraphNode[]\n              }\n            ).convertToNodes\n            return convertFn?.()\n          }\n        },\n        {\n          content: 'Manage Group Node',\n          callback: () => manageGroupNodes(this.type)\n        }\n      )\n      // Return empty array to satisfy type signature without triggering\n      // LGraphCanvas concatenation (which only happens when length > 0)\n      return []\n    }\n\n    // Draw custom collapse icon to identity this as a group\n    const onDrawTitleBox = this.node.onDrawTitleBox\n    this.node.onDrawTitleBox = function (ctx, height, size, scale) {\n      onDrawTitleBox?.call(this, ctx, height, size, scale)\n\n      const fill = ctx.fillStyle\n      ctx.beginPath()\n      ctx.rect(11, -height + 11, 2, 2)\n      ctx.rect(14, -height + 11, 2, 2)\n      ctx.rect(17, -height + 11, 2, 2)\n      ctx.rect(11, -height + 14, 2, 2)\n      ctx.rect(14, -height + 14, 2, 2)\n      ctx.rect(17, -height + 14, 2, 2)\n      ctx.rect(11, -height + 17, 2, 2)\n      ctx.rect(14, -height + 17, 2, 2)\n      ctx.rect(17, -height + 17, 2, 2)\n\n      ctx.fillStyle = this.boxcolor || LiteGraph.NODE_DEFAULT_BOXCOLOR\n      ctx.fill()\n      ctx.fillStyle = fill\n    }\n\n    // Draw progress label\n    const onDrawForeground = node.onDrawForeground\n    const groupData = this.groupData.nodeData\n    node.onDrawForeground = function (ctx, canvas, canvasElement) {\n      onDrawForeground?.call(this, ctx, canvas, canvasElement)\n      const progressState = useExecutionStore().nodeProgressStates[this.id]\n      if (\n        progressState &&\n        progressState.state === 'running' &&\n        this.runningInternalNodeId !== null\n      ) {\n        const nodeIdx =\n          typeof this.runningInternalNodeId === 'number'\n            ? this.runningInternalNodeId\n            : parseInt(String(this.runningInternalNodeId), 10)\n        const n = groupData.nodes[nodeIdx] as { title?: string; type?: string }\n        if (!n) return\n        const message = `Running ${n.title || n.type} (${this.runningInternalNodeId}/${groupData.nodes.length})`\n        ctx.save()\n        ctx.font = '12px sans-serif'\n        const sz = ctx.measureText(message)\n        ctx.fillStyle = node.boxcolor || LiteGraph.NODE_DEFAULT_BOXCOLOR\n        ctx.beginPath()\n        ctx.roundRect(\n          0,\n          -LiteGraph.NODE_TITLE_HEIGHT - 20,\n          sz.width + 12,\n          20,\n          5\n        )\n        ctx.fill()\n\n        ctx.fillStyle = '#fff'\n        ctx.fillText(message, 6, -LiteGraph.NODE_TITLE_HEIGHT - 6)\n        ctx.restore()\n      }\n    }\n\n    // Flag this node as needing to be reset\n    const onExecutionStart = this.node.onExecutionStart\n    this.node.onExecutionStart = function () {\n      ;(this as LGraphNode & { resetExecution?: boolean }).resetExecution = true\n      return onExecutionStart?.call(this)\n    }\n\n    const onNodeCreated = this.node.onNodeCreated\n    const handlerGroupData = this.groupData\n    this.node.onNodeCreated = function () {\n      if (!this.widgets) {\n        return\n      }\n      const config = handlerGroupData.nodeData.config as\n        | Record<number, NodeConfigEntry>\n        | undefined\n      if (config) {\n        for (const n in config) {\n          const inputs = config[n]?.input\n          if (!inputs) continue\n          for (const w in inputs) {\n            if (inputs[w]?.visible !== false) continue\n            const widgetName =\n              handlerGroupData.oldToNewWidgetMap[Number(n)]?.[w]\n            const widget = this.widgets.find((wg) => wg.name === widgetName)\n            if (widget) {\n              widget.type = 'hidden'\n              widget.computeSize = () => [0, -4]\n            }\n          }\n        }\n      }\n\n      return onNodeCreated?.call(this)\n    }\n\n    type EventDetail = { display_node?: string; node?: string } | string\n    const handleEvent = (\n      type: string,\n      getId: (detail: EventDetail) => string | undefined,\n      getEvent: (\n        detail: EventDetail,\n        id: string,\n        node: LGraphNode\n      ) => EventDetail\n    ) => {\n      const handler = ({ detail }: CustomEvent<EventDetail>) => {\n        const id = getId(detail)\n        if (!id) return\n        const existingNode = app.rootGraph.getNodeById(id)\n        if (existingNode) return\n\n        const innerNodeIndex =\n          this.innerNodes?.findIndex((n) => n.id == id) ?? -1\n        if (innerNodeIndex > -1) {\n          ;(\n            this.node as LGraphNode & { runningInternalNodeId?: number }\n          ).runningInternalNodeId = innerNodeIndex\n          api.dispatchCustomEvent(\n            type as 'executing',\n            getEvent(detail, `${this.node.id}`, this.node) as string\n          )\n        }\n      }\n      api.addEventListener(\n        type as 'executing' | 'executed',\n        handler as EventListener\n      )\n      return handler\n    }\n\n    const executing = handleEvent(\n      'executing',\n      (d) => (typeof d === 'string' ? d : undefined),\n      (_d, id) => id\n    )\n\n    const executed = handleEvent(\n      'executed',\n      (d) => (typeof d === 'object' ? d?.display_node || d?.node : undefined),\n      (d, id, node) => ({\n        ...(typeof d === 'object' ? d : {}),\n        node: id,\n        display_node: id,\n        merge: !(node as LGraphNode & { resetExecution?: boolean })\n          .resetExecution\n      })\n    )\n\n    const onRemoved = node.onRemoved\n    this.node.onRemoved = function () {\n      onRemoved?.call(this)\n      api.removeEventListener('executing', executing as EventListener)\n      api.removeEventListener('executed', executed as EventListener)\n    }\n\n    this.node.refreshComboInNode = (defs) => {\n      // Update combo widget options\n      for (const widgetName in this.groupData.newToOldWidgetMap) {\n        const widget = this.node.widgets?.find((w) => w.name === widgetName)\n        if (widget?.type === 'combo') {\n          const old = this.groupData.newToOldWidgetMap[widgetName]\n          if (!old.node.type) continue\n          const def = defs[old.node.type]\n          const input =\n            def?.input?.required?.[old.inputName] ??\n            def?.input?.optional?.[old.inputName]\n          if (!input) continue\n\n          widget.options.values = input[0] as unknown[]\n\n          const values = widget.options.values as unknown[]\n          if (old.inputName !== 'image' && !values.includes(widget.value)) {\n            widget.value = values[0] as typeof widget.value\n            widget.callback?.(widget.value)\n          }\n        }\n      }\n    }\n  }\n\n  updateInnerWidgets() {\n    if (!this.innerNodes) return\n    for (const newWidgetName in this.groupData.newToOldWidgetMap) {\n      const newWidget = this.node.widgets?.find((w) => w.name === newWidgetName)\n      if (!newWidget) continue\n\n      const newValue = newWidget.value\n      const old = this.groupData.newToOldWidgetMap[newWidgetName]\n      const nodeIdx = old.node.index ?? 0\n      const innerNode = this.innerNodes[nodeIdx]\n      if (!innerNode) continue\n\n      if (innerNode.type === 'PrimitiveNode') {\n        // @ts-expect-error primitiveValue is a custom property on PrimitiveNode\n        innerNode.primitiveValue = newValue\n        const primitiveLinked = this.groupData.primitiveToWidget[nodeIdx]\n        for (const linked of primitiveLinked ?? []) {\n          const linkedNodeId =\n            typeof linked.nodeId === 'number'\n              ? linked.nodeId\n              : Number(linked.nodeId)\n          const linkedNode = this.innerNodes[linkedNodeId]\n          const widget = linkedNode?.widgets?.find(\n            (w) => w.name === linked.inputName\n          )\n\n          if (widget) {\n            widget.value = newValue\n          }\n        }\n        continue\n      } else if (innerNode.type === 'Reroute') {\n        const rerouteLinks = this.groupData.linksFrom[nodeIdx]\n        if (rerouteLinks) {\n          for (const [, , targetNodeId, targetSlot] of rerouteLinks[0] ?? []) {\n            if (targetNodeId == null || targetSlot == null) continue\n            const targetNode = this.innerNodes[Number(targetNodeId)]\n            if (!targetNode) continue\n            const input = targetNode.inputs?.[Number(targetSlot)]\n            if (input?.widget) {\n              const widgetName = input.widget.name\n              const widget = targetNode.widgets?.find(\n                (w) => w.name === widgetName\n              )\n              if (widget) {\n                widget.value = newValue\n              }\n            }\n          }\n        }\n      }\n\n      const widget = innerNode.widgets?.find((w) => w.name === old.inputName)\n      if (widget) {\n        widget.value = newValue\n      }\n    }\n  }\n\n  populatePrimitive(\n    _node: GroupNodeData,\n    nodeId: number,\n    oldName: string\n  ): boolean {\n    // Converted widget, populate primitive if linked\n    const primitiveId = this.groupData.widgetToPrimitive[nodeId]?.[oldName]\n    if (primitiveId == null) return false\n    const targetWidgetName =\n      this.groupData.oldToNewWidgetMap[\n        Array.isArray(primitiveId) ? primitiveId[0] : primitiveId\n      ]?.['value']\n    if (!targetWidgetName) return false\n    const targetWidgetIndex =\n      this.node.widgets?.findIndex((w) => w.name === targetWidgetName) ?? -1\n    if (targetWidgetIndex > -1 && this.innerNodes) {\n      const primIdx = Array.isArray(primitiveId) ? primitiveId[0] : primitiveId\n      const primitiveNode = this.innerNodes[primIdx]\n      if (!primitiveNode?.widgets) return true\n      let len = primitiveNode.widgets.length\n      if (\n        len - 1 !==\n        (this.node.widgets?.[targetWidgetIndex]?.linkedWidgets?.length ?? 0)\n      ) {\n        // Fallback handling for if some reason the primitive has a different number of widgets\n        // we dont want to overwrite random widgets, better to leave blank\n        len = 1\n      }\n      for (let i = 0; i < len; i++) {\n        const targetWidget = this.node.widgets?.[targetWidgetIndex + i]\n        const srcWidget = primitiveNode.widgets[i]\n        if (targetWidget && srcWidget) {\n          targetWidget.value = srcWidget.value\n        }\n      }\n    }\n    return true\n  }\n\n  populateReroute(\n    node: GroupNodeData,\n    nodeId: number,\n    map: Record<string, string | null>\n  ) {\n    if (node.type !== 'Reroute') return\n\n    const link = this.groupData.linksFrom[nodeId]?.[0]?.[0]\n    if (!link) return\n    const targetNodeId = link[2]\n    const targetNodeSlot = link[3]\n    if (targetNodeId == null || targetNodeSlot == null) return\n    const targetNode = this.groupData.nodeData.nodes[Number(targetNodeId)] as\n      | GroupNodeData\n      | undefined\n    const inputs = targetNode?.inputs\n    const targetWidget = (inputs as GroupNodeInput[] | undefined)?.[\n      Number(targetNodeSlot)\n    ]?.widget\n    if (!targetWidget) return\n\n    const offset =\n      (inputs?.length ?? 0) - (targetNode?.widgets_values?.length ?? 0)\n    const v = targetNode?.widgets_values?.[Number(targetNodeSlot) - offset]\n    if (v == null) return\n\n    const widgetName = Object.values(map)[0]\n    const widget = this.node.widgets?.find((w) => w.name === widgetName)\n    if (widget) {\n      widget.value = v\n    }\n  }\n\n  populateWidgets() {\n    if (!this.node.widgets) return\n\n    for (\n      let nodeId = 0;\n      nodeId < this.groupData.nodeData.nodes.length;\n      nodeId++\n    ) {\n      const node = this.groupData.nodeData.nodes[nodeId] as GroupNodeData\n      const map = this.groupData.oldToNewWidgetMap[nodeId] ?? {}\n      const widgets = Object.keys(map)\n\n      if (!node.widgets_values?.length) {\n        // special handling for populating values into reroutes\n        // this allows primitives connect to them to pick up the correct value\n        this.populateReroute(node, nodeId, map)\n        continue\n      }\n\n      let linkedShift = 0\n      for (let i = 0; i < widgets.length; i++) {\n        const oldName = widgets[i]\n        const newName = map[oldName]\n        const widgetIndex = this.node.widgets.findIndex(\n          (w) => w.name === newName\n        )\n        const mainWidget = this.node.widgets[widgetIndex]\n        if (\n          this.populatePrimitive(node, nodeId, oldName) ||\n          widgetIndex === -1\n        ) {\n          // Find the inner widget and shift by the number of linked widgets as they will have been removed too\n          const innerWidget = this.innerNodes?.[nodeId]?.widgets?.find(\n            (w) => w.name === oldName\n          )\n          linkedShift += innerWidget?.linkedWidgets?.length ?? 0\n        }\n        if (widgetIndex === -1) {\n          continue\n        }\n\n        // Populate the main and any linked widget\n        mainWidget.value = node.widgets_values?.[\n          i + linkedShift\n        ] as typeof mainWidget.value\n        const linkedWidgets = mainWidget.linkedWidgets ?? []\n        for (let w = 0; w < linkedWidgets.length; w++) {\n          this.node.widgets[widgetIndex + w + 1].value = node.widgets_values?.[\n            i + ++linkedShift\n          ] as typeof mainWidget.value\n        }\n      }\n    }\n  }\n\n  replaceNodes(nodes: LGraphNode[]) {\n    let top: number | undefined\n    let left: number | undefined\n\n    for (let i = 0; i < nodes.length; i++) {\n      const node = nodes[i]\n      if (left == null || node.pos[0] < left) {\n        left = node.pos[0]\n      }\n      if (top == null || node.pos[1] < top) {\n        top = node.pos[1]\n      }\n\n      this.linkOutputs(node, i)\n      app.rootGraph.remove(node)\n\n      // Set internal ID to what is expected after workflow is reloaded\n      node.id = `${this.node.id}:${i}`\n    }\n\n    this.linkInputs()\n    this.node.pos = [left ?? 0, top ?? 0]\n  }\n\n  linkOutputs(originalNode: LGraphNode, nodeId: number) {\n    if (!originalNode.outputs) return\n\n    for (const output of originalNode.outputs) {\n      if (!output.links) continue\n      // Clone the links as they'll be changed if we reconnect\n      const links = [...output.links]\n      for (const l of links) {\n        const link = app.rootGraph.links[l]\n        if (!link) continue\n\n        const targetNode = app.rootGraph.getNodeById(link.target_id)\n        const newSlot =\n          this.groupData.oldToNewOutputMap[nodeId]?.[link.origin_slot]\n        if (newSlot != null && targetNode) {\n          this.node.connect(newSlot, targetNode, link.target_slot)\n        }\n      }\n    }\n  }\n\n  linkInputs() {\n    for (const link of this.groupData.nodeData.links ?? []) {\n      const [, originSlot, targetId, targetSlot, actualOriginId] = link\n      if (actualOriginId == null || typeof actualOriginId === 'object') continue\n      const originNode = app.rootGraph.getNodeById(actualOriginId)\n      if (!originNode) continue // this node is in the group\n      if (targetId == null || targetSlot == null) continue\n      const mappedSlot =\n        this.groupData.oldToNewInputMap[Number(targetId)]?.[Number(targetSlot)]\n      if (mappedSlot == null) continue\n      if (typeof originSlot === 'number' || typeof originSlot === 'string') {\n        originNode.connect(\n          originSlot,\n          // @ts-expect-error Valid - uses deprecated interface (node ID instead of node reference)\n          this.node.id,\n          mappedSlot\n        )\n      }\n    }\n  }\n\n  static getGroupData(\n    node: LGraphNodeConstructor<LGraphNode>\n  ): GroupNodeConfig | undefined\n  static getGroupData(node: LGraphNode): GroupNodeConfig | undefined\n  static getGroupData(\n    node: LGraphNode | LGraphNodeConstructor<LGraphNode>\n  ): GroupNodeConfig | undefined {\n    // Check if this is a constructor (function) or an instance\n    if (typeof node === 'function') {\n      // Constructor case - access nodeData directly\n      const nodeData = (node as LGraphNodeConstructor & { nodeData?: unknown })\n        .nodeData as Record<symbol, GroupNodeConfig> | undefined\n      return nodeData?.[GROUP]\n    }\n    // Instance case - check instance property first, then constructor\n    const instanceData = (node as LGraphNode & { nodeData?: unknown })\n      .nodeData as Record<symbol, GroupNodeConfig> | undefined\n    if (instanceData?.[GROUP]) return instanceData[GROUP]\n    const ctorData = (\n      node.constructor as LGraphNodeConstructor & { nodeData?: unknown }\n    )?.nodeData as Record<symbol, GroupNodeConfig> | undefined\n    return ctorData?.[GROUP]\n  }\n\n  static getHandler(node: LGraphNode): GroupNodeHandler | undefined {\n    // @ts-expect-error GROUP symbol indexing on LGraphNode\n    let handler = node[GROUP] as GroupNodeHandler | undefined\n    // Handler may not be set yet if nodeCreated async hook hasn't run\n    // Create it synchronously if needed\n    if (!handler && GroupNodeHandler.isGroupNode(node)) {\n      handler = new GroupNodeHandler(node)\n      ;(node as LGraphNode & { [GROUP]: GroupNodeHandler })[GROUP] = handler\n    }\n    return handler\n  }\n\n  static isGroupNode(node: LGraphNode) {\n    return !!node.constructor?.nodeData?.[GROUP]\n  }\n\n  static async fromNodes(nodes: LGraphNode[]) {\n    // Process the nodes into the stored workflow group node data\n    const builder = new GroupNodeBuilder(nodes)\n    const res = await builder.build()\n    if (!res) return\n\n    const { name, nodeData } = res\n\n    // Convert this data into a LG node definition and register it\n    const config = new GroupNodeConfig(name, nodeData)\n    await config.registerType()\n\n    const groupNode = LiteGraph.createNode(`${PREFIX}${SEPARATOR}${name}`)\n    if (!groupNode) return\n    // Reuse the existing nodes for this instance\n    groupNode.setInnerNodes?.(builder.nodes)\n    const handler = GroupNodeHandler.getHandler(groupNode)\n    handler?.populateWidgets()\n    app.rootGraph.add(groupNode)\n\n    // Remove all converted nodes and relink them\n    handler?.replaceNodes(builder.nodes)\n    return groupNode\n  }\n}\n\nconst replaceLegacySeparators = (nodes: ComfyNode[]): void => {\n  for (const node of nodes) {\n    if (typeof node.type === 'string' && node.type.startsWith('workflow/')) {\n      node.type = node.type.replace(/^workflow\\//, `${PREFIX}${SEPARATOR}`)\n    }\n  }\n}\n\n/**\n * Convert selected nodes to a group node\n * @throws {Error} if no nodes are selected\n * @throws {Error} if a group node is already selected\n * @throws {Error} if a group node is selected\n *\n * The context menu item should not be available if any of the above conditions are met.\n * The error is automatically handled by the commandStore when the command is executed.\n */\nasync function convertSelectedNodesToGroupNode() {\n  const nodes = Object.values(app.canvas.selected_nodes ?? {})\n  if (nodes.length === 0) {\n    throw new Error('No nodes selected')\n  }\n  if (nodes.length === 1) {\n    throw new Error('Please select multiple nodes to convert to group node')\n  }\n\n  for (const node of nodes) {\n    if (node instanceof SubgraphNode) {\n      throw new Error('Selected nodes contain a subgraph node')\n    }\n    if (GroupNodeHandler.isGroupNode(node)) {\n      throw new Error('Selected nodes contain a group node')\n    }\n  }\n  return await GroupNodeHandler.fromNodes(nodes)\n}\n\nconst convertDisabled = (selected: LGraphNode[]) =>\n  selected.length < 2 || !!selected.find((n) => GroupNodeHandler.isGroupNode(n))\n\nfunction ungroupSelectedGroupNodes() {\n  const nodes = Object.values(app.canvas.selected_nodes ?? {})\n  for (const node of nodes) {\n    if (GroupNodeHandler.isGroupNode(node)) {\n      node.convertToNodes?.()\n    }\n  }\n}\n\nfunction manageGroupNodes(type?: string) {\n  new ManageGroupDialog(app).show(type)\n}\n\nconst id = 'Comfy.GroupNode'\n\n/**\n * Global node definitions cache, populated and mutated by extension callbacks.\n *\n * **Initialization**: Set by `addCustomNodeDefs` during extension initialization.\n * This callback runs early in the app lifecycle, before any code that reads\n * `globalDefs` is executed.\n *\n * **Mutation**: `refreshComboInNodes` merges updated definitions into this object\n * when combo options are refreshed (e.g., after model files change).\n *\n * **Usage Notes**:\n * - Functions reading `globalDefs` (e.g., `getNodeDef`, `checkPrimitiveConnection`)\n *   must only be called after `addCustomNodeDefs` has run.\n * - Not thread-safe; assumes single-threaded JS execution model.\n * - The object reference is stable after initialization; only contents are mutated.\n */\nlet globalDefs: Record<string, ComfyNodeDef>\nconst ext: ComfyExtension = {\n  name: id,\n  commands: [\n    {\n      id: 'Comfy.GroupNode.ConvertSelectedNodesToGroupNode',\n      label: 'Convert selected nodes to group node',\n      icon: 'pi pi-sitemap',\n      versionAdded: '1.3.17',\n      function: () => convertSelectedNodesToGroupNode()\n    },\n    {\n      id: 'Comfy.GroupNode.UngroupSelectedGroupNodes',\n      label: 'Ungroup selected group nodes',\n      icon: 'pi pi-sitemap',\n      versionAdded: '1.3.17',\n      function: () => ungroupSelectedGroupNodes()\n    },\n    {\n      id: 'Comfy.GroupNode.ManageGroupNodes',\n      label: 'Manage group nodes',\n      icon: 'pi pi-cog',\n      versionAdded: '1.3.17',\n      function: (...args: unknown[]) =>\n        manageGroupNodes(args[0] as string | undefined)\n    }\n  ],\n  keybindings: [\n    {\n      commandId: 'Comfy.GroupNode.ConvertSelectedNodesToGroupNode',\n      combo: {\n        alt: true,\n        key: 'g'\n      }\n    },\n    {\n      commandId: 'Comfy.GroupNode.UngroupSelectedGroupNodes',\n      combo: {\n        alt: true,\n        shift: true,\n        key: 'G'\n      }\n    }\n  ],\n\n  getCanvasMenuItems(canvas): IContextMenuValue[] {\n    const items: IContextMenuValue[] = []\n    const selected = Object.values(canvas.selected_nodes ?? {})\n    const convertEnabled = !convertDisabled(selected)\n\n    items.push({\n      content: `Convert to Group Node (Deprecated)`,\n      disabled: !convertEnabled,\n      // @ts-expect-error async callback - legacy menu API doesn't expect Promise\n      callback: async () => convertSelectedNodesToGroupNode()\n    })\n\n    const groups = canvas.graph?.extra?.groupNodes\n    const manageDisabled = !groups || !Object.keys(groups).length\n    items.push({\n      content: `Manage Group Nodes`,\n      disabled: manageDisabled,\n      callback: () => manageGroupNodes()\n    })\n\n    return items\n  },\n\n  getNodeMenuItems(node): IContextMenuValue[] {\n    if (GroupNodeHandler.isGroupNode(node)) {\n      return []\n    }\n\n    const selected = Object.values(app.canvas.selected_nodes ?? {})\n    const convertEnabled = !convertDisabled(selected)\n\n    return [\n      {\n        content: `Convert to Group Node (Deprecated)`,\n        disabled: !convertEnabled,\n        // @ts-expect-error async callback - legacy menu API doesn't expect Promise\n        callback: async () => convertSelectedNodesToGroupNode()\n      }\n    ]\n  },\n  async beforeConfigureGraph(\n    graphData: ComfyWorkflowJSON,\n    missingNodeTypes: string[]\n  ) {\n    const nodes = graphData?.extra?.groupNodes as\n      | Record<string, GroupNodeWorkflowData>\n      | undefined\n    if (nodes) {\n      replaceLegacySeparators(graphData.nodes)\n      await GroupNodeConfig.registerFromWorkflow(nodes, missingNodeTypes)\n    }\n  },\n  addCustomNodeDefs(defs) {\n    // Store this so we can mutate it later with group nodes\n    globalDefs = defs\n  },\n  nodeCreated(node) {\n    if (GroupNodeHandler.isGroupNode(node)) {\n      ;(node as LGraphNode & { [GROUP]: GroupNodeHandler })[GROUP] =\n        new GroupNodeHandler(node)\n\n      // Ensure group nodes pasted from other workflows are stored\n      const handler = GroupNodeHandler.getHandler(node)\n      if (node.title && handler?.groupData?.nodeData) {\n        Workflow.storeGroupNode(node.title, handler.groupData.nodeData)\n      }\n    }\n  },\n  async refreshComboInNodes(defs: Record<string, ComfyNodeDef>) {\n    // Re-register group nodes so new ones are created with the correct options\n    Object.assign(globalDefs, defs)\n    const nodes = app.rootGraph.extra?.groupNodes as\n      | Record<string, GroupNodeWorkflowData>\n      | undefined\n    if (nodes) {\n      await GroupNodeConfig.registerFromWorkflow(nodes, [])\n    }\n  }\n}\n\napp.registerExtension(ext)\n","import type {\n  IContextMenuValue,\n  Positionable\n} from '@/lib/litegraph/src/interfaces'\nimport {\n  LGraphCanvas,\n  LGraphGroup,\n  type LGraphNode\n} from '@/lib/litegraph/src/litegraph'\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport type { ComfyExtension } from '@/types/comfy'\n\nimport { app } from '../../scripts/app'\n\nfunction setNodeMode(node: LGraphNode, mode: number) {\n  node.mode = mode\n  node.graph?.change()\n}\n\nfunction addNodesToGroup(group: LGraphGroup, items: Iterable<Positionable>) {\n  const padding = useSettingStore().get('Comfy.GroupSelectedNodes.Padding')\n  group.resizeTo([...group.children, ...items], padding)\n}\n\nconst ext: ComfyExtension = {\n  name: 'Comfy.GroupOptions',\n\n  getCanvasMenuItems(canvas: LGraphCanvas): IContextMenuValue[] {\n    const items: IContextMenuValue[] = []\n\n    // @ts-expect-error fixme ts strict error\n    const group = canvas.graph.getGroupOnPos(\n      canvas.graph_mouse[0],\n      canvas.graph_mouse[1]\n    )\n\n    if (!group) {\n      if (canvas.selectedItems.size > 0) {\n        items.push({\n          content: 'Add Group For Selected Nodes',\n          callback: () => {\n            const group = new LGraphGroup()\n            addNodesToGroup(group, canvas.selectedItems)\n            // @ts-expect-error fixme ts strict error\n            canvas.graph.add(group)\n            // @ts-expect-error fixme ts strict error\n            canvas.graph.change()\n\n            group.recomputeInsideNodes()\n          }\n        })\n      }\n\n      return items\n    }\n\n    // Group nodes aren't recomputed until the group is moved, this ensures the nodes are up-to-date\n    group.recomputeInsideNodes()\n    const nodesInGroup = group.nodes\n\n    items.push({\n      content: 'Add Selected Nodes To Group',\n      disabled: !canvas.selectedItems?.size,\n      callback: () => {\n        addNodesToGroup(group, canvas.selectedItems)\n        // @ts-expect-error fixme ts strict error\n        canvas.graph.change()\n      }\n    })\n\n    // No nodes in group, return default options\n    if (nodesInGroup.length === 0) {\n      return items\n    } else {\n      // Add a separator between the default options and the group options\n      // @ts-expect-error fixme ts strict error\n      items.push(null)\n    }\n\n    // Check if all nodes are the same mode\n    let allNodesAreSameMode = true\n    for (let i = 1; i < nodesInGroup.length; i++) {\n      if (nodesInGroup[i].mode !== nodesInGroup[0].mode) {\n        allNodesAreSameMode = false\n        break\n      }\n    }\n\n    items.push({\n      content: 'Fit Group To Nodes',\n      callback: () => {\n        group.recomputeInsideNodes()\n        const padding = useSettingStore().get(\n          'Comfy.GroupSelectedNodes.Padding'\n        )\n        group.resizeTo(group.children, padding)\n        // @ts-expect-error fixme ts strict error\n        canvas.graph.change()\n      }\n    })\n\n    items.push({\n      content: 'Select Nodes',\n      callback: () => {\n        canvas.selectNodes(nodesInGroup)\n        // @ts-expect-error fixme ts strict error\n        canvas.graph.change()\n        canvas.canvas.focus()\n      }\n    })\n\n    // Modes\n    // 0: Always\n    // 1: On Event\n    // 2: Never\n    // 3: On Trigger\n    // 4: Bypass\n    // If all nodes are the same mode, add a menu option to change the mode\n    if (allNodesAreSameMode) {\n      const mode = nodesInGroup[0].mode\n      switch (mode) {\n        case 0:\n          // All nodes are always, option to disable, and bypass\n          items.push({\n            content: 'Set Group Nodes to Never',\n            callback: () => {\n              for (const node of nodesInGroup) {\n                setNodeMode(node, 2)\n              }\n            }\n          })\n          items.push({\n            content: 'Bypass Group Nodes',\n            callback: () => {\n              for (const node of nodesInGroup) {\n                setNodeMode(node, 4)\n              }\n            }\n          })\n          break\n        case 2:\n          // All nodes are never, option to enable, and bypass\n          items.push({\n            content: 'Set Group Nodes to Always',\n            callback: () => {\n              for (const node of nodesInGroup) {\n                setNodeMode(node, 0)\n              }\n            }\n          })\n          items.push({\n            content: 'Bypass Group Nodes',\n            callback: () => {\n              for (const node of nodesInGroup) {\n                setNodeMode(node, 4)\n              }\n            }\n          })\n          break\n        case 4:\n          // All nodes are bypass, option to enable, and disable\n          items.push({\n            content: 'Set Group Nodes to Always',\n            callback: () => {\n              for (const node of nodesInGroup) {\n                setNodeMode(node, 0)\n              }\n            }\n          })\n          items.push({\n            content: 'Set Group Nodes to Never',\n            callback: () => {\n              for (const node of nodesInGroup) {\n                setNodeMode(node, 2)\n              }\n            }\n          })\n          break\n        default:\n          // All nodes are On Trigger or On Event(Or other?), option to disable, set to always, or bypass\n          items.push({\n            content: 'Set Group Nodes to Always',\n            callback: () => {\n              for (const node of nodesInGroup) {\n                setNodeMode(node, 0)\n              }\n            }\n          })\n          items.push({\n            content: 'Set Group Nodes to Never',\n            callback: () => {\n              for (const node of nodesInGroup) {\n                setNodeMode(node, 2)\n              }\n            }\n          })\n          items.push({\n            content: 'Bypass Group Nodes',\n            callback: () => {\n              for (const node of nodesInGroup) {\n                setNodeMode(node, 4)\n              }\n            }\n          })\n          break\n      }\n    } else {\n      // Nodes are not all the same mode, add a menu option to change the mode to always, never, or bypass\n      items.push({\n        content: 'Set Group Nodes to Always',\n        callback: () => {\n          for (const node of nodesInGroup) {\n            setNodeMode(node, 0)\n          }\n        }\n      })\n      items.push({\n        content: 'Set Group Nodes to Never',\n        callback: () => {\n          for (const node of nodesInGroup) {\n            setNodeMode(node, 2)\n          }\n        }\n      })\n      items.push({\n        content: 'Bypass Group Nodes',\n        callback: () => {\n          for (const node of nodesInGroup) {\n            setNodeMode(node, 4)\n          }\n        }\n      })\n    }\n\n    return items\n  }\n}\n\napp.registerExtension(ext)\n","import type { NodeExecutionOutput } from '@/schemas/apiSchema'\nimport { api } from '@/scripts/api'\nimport { app } from '@/scripts/app'\nimport { useExtensionService } from '@/services/extensionService'\n\nuseExtensionService().registerExtension({\n  name: 'Comfy.ImageCompare',\n\n  async nodeCreated(node) {\n    if (node.constructor.comfyClass !== 'ImageCompare') return\n\n    const [oldWidth, oldHeight] = node.size\n    node.setSize([Math.max(oldWidth, 400), Math.max(oldHeight, 350)])\n\n    const onExecuted = node.onExecuted\n\n    node.onExecuted = function (output: NodeExecutionOutput) {\n      onExecuted?.call(this, output)\n\n      const aImages = (output as Record<string, unknown>).a_images as\n        | Record<string, string>[]\n        | undefined\n      const bImages = (output as Record<string, unknown>).b_images as\n        | Record<string, string>[]\n        | undefined\n      const rand = app.getRandParam()\n\n      const beforeUrl =\n        aImages && aImages.length > 0\n          ? api.apiURL(`/view?${new URLSearchParams(aImages[0])}${rand}`)\n          : ''\n      const afterUrl =\n        bImages && bImages.length > 0\n          ? api.apiURL(`/view?${new URLSearchParams(bImages[0])}${rand}`)\n          : ''\n\n      const widget = node.widgets?.find((w) => w.type === 'imagecompare')\n\n      if (widget) {\n        widget.value = {\n          before: beforeUrl,\n          after: afterUrl\n        }\n        widget.callback?.(widget.value)\n      }\n    }\n  }\n})\n","import { t } from '@/i18n'\nimport type { IContextMenuValue } from '@/lib/litegraph/src/interfaces'\nimport { useToastStore } from '@/platform/updates/common/toastStore'\nimport Load3d from '@/extensions/core/load3d/Load3d'\nimport { LiteGraph } from '@/lib/litegraph/src/litegraph'\n\nconst EXPORT_FORMATS = [\n  { label: 'GLB', value: 'glb' },\n  { label: 'OBJ', value: 'obj' },\n  { label: 'STL', value: 'stl' }\n] as const\n\n/**\n * Creates export menu items for a 3D node using the new extension API.\n * Returns an array of context menu items including a separator and export submenu.\n */\nexport function createExportMenuItems(\n  load3d: Load3d\n): (IContextMenuValue | null)[] {\n  return [\n    null, // Separator\n    {\n      content: 'Save',\n      has_submenu: true,\n      callback: (_value, _options, event, prev_menu) => {\n        const submenuOptions: IContextMenuValue[] = EXPORT_FORMATS.map(\n          (format) => ({\n            content: format.label,\n            callback: () => {\n              void (async () => {\n                try {\n                  await load3d.exportModel(format.value)\n                  useToastStore().add({\n                    severity: 'success',\n                    summary: t('toastMessages.exportSuccess', {\n                      format: format.label\n                    })\n                  })\n                } catch (error) {\n                  console.error('Export failed:', error)\n                  useToastStore().addAlert(\n                    t('toastMessages.failedToExportModel', {\n                      format: format.label\n                    })\n                  )\n                }\n              })()\n            }\n          })\n        )\n\n        new LiteGraph.ContextMenu(submenuOptions, {\n          event,\n          parentMenu: prev_menu\n        })\n      }\n    }\n  ]\n}\n","import Load3d from '@/extensions/core/load3d/Load3d'\nimport Load3dUtils from '@/extensions/core/load3d/Load3dUtils'\nimport type {\n  CameraConfig,\n  CameraState,\n  LightConfig,\n  ModelConfig,\n  SceneConfig\n} from '@/extensions/core/load3d/interfaces'\nimport type { Dictionary } from '@/lib/litegraph/src/interfaces'\nimport type { NodeProperty } from '@/lib/litegraph/src/LGraphNode'\nimport type { IBaseWidget } from '@/lib/litegraph/src/types/widgets'\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { api } from '@/scripts/api'\n\ntype Load3DConfigurationSettings = {\n  loadFolder: string\n  modelWidget: IBaseWidget\n  cameraState?: CameraState\n  width?: IBaseWidget\n  height?: IBaseWidget\n  bgImagePath?: string\n}\n\nclass Load3DConfiguration {\n  constructor(\n    private load3d: Load3d,\n    private properties?: Dictionary<NodeProperty | undefined>\n  ) {}\n\n  configureForSaveMesh(loadFolder: 'input' | 'output', filePath: string) {\n    this.setupModelHandlingForSaveMesh(filePath, loadFolder)\n    this.setupDefaultProperties()\n  }\n\n  configure(setting: Load3DConfigurationSettings) {\n    this.setupModelHandling(\n      setting.modelWidget,\n      setting.loadFolder,\n      setting.cameraState\n    )\n    this.setupTargetSize(setting.width, setting.height)\n    this.setupDefaultProperties(setting.bgImagePath)\n  }\n\n  private setupTargetSize(width?: IBaseWidget, height?: IBaseWidget) {\n    if (width && height) {\n      this.load3d.setTargetSize(width.value as number, height.value as number)\n\n      width.callback = (value: number) => {\n        this.load3d.setTargetSize(value, height.value as number)\n      }\n\n      height.callback = (value: number) => {\n        this.load3d.setTargetSize(width.value as number, value)\n      }\n    }\n  }\n\n  private setupModelHandlingForSaveMesh(filePath: string, loadFolder: string) {\n    const onModelWidgetUpdate = this.createModelUpdateHandler(loadFolder)\n\n    if (filePath) {\n      onModelWidgetUpdate(filePath)\n    }\n  }\n\n  private setupModelHandling(\n    modelWidget: IBaseWidget,\n    loadFolder: string,\n    cameraState?: CameraState\n  ) {\n    const onModelWidgetUpdate = this.createModelUpdateHandler(\n      loadFolder,\n      cameraState\n    )\n    if (modelWidget.value) {\n      onModelWidgetUpdate(modelWidget.value)\n    }\n\n    const originalCallback = modelWidget.callback\n\n    let currentValue = modelWidget.value\n    Object.defineProperty(modelWidget, 'value', {\n      get() {\n        return currentValue\n      },\n      set(newValue) {\n        currentValue = newValue\n        if (modelWidget.callback && newValue !== undefined && newValue !== '') {\n          modelWidget.callback(newValue)\n        }\n      },\n      enumerable: true,\n      configurable: true\n    })\n\n    modelWidget.callback = (value: string | number | boolean | object) => {\n      onModelWidgetUpdate(value)\n\n      if (originalCallback) {\n        originalCallback(value)\n      }\n    }\n  }\n\n  private setupDefaultProperties(bgImagePath?: string) {\n    const sceneConfig = this.loadSceneConfig()\n    this.applySceneConfig(sceneConfig, bgImagePath)\n\n    const cameraConfig = this.loadCameraConfig()\n    this.applyCameraConfig(cameraConfig)\n\n    const lightConfig = this.loadLightConfig()\n    this.applyLightConfig(lightConfig)\n  }\n\n  private loadSceneConfig(): SceneConfig {\n    if (this.properties && 'Scene Config' in this.properties) {\n      return this.properties['Scene Config'] as SceneConfig\n    }\n\n    return {\n      showGrid: useSettingStore().get('Comfy.Load3D.ShowGrid'),\n      backgroundColor:\n        '#' + useSettingStore().get('Comfy.Load3D.BackgroundColor'),\n      backgroundImage: ''\n    } as SceneConfig\n  }\n\n  private loadCameraConfig(): CameraConfig {\n    if (this.properties && 'Camera Config' in this.properties) {\n      return this.properties['Camera Config'] as CameraConfig\n    }\n\n    return {\n      cameraType: useSettingStore().get('Comfy.Load3D.CameraType'),\n      fov: 35\n    } as CameraConfig\n  }\n\n  private loadLightConfig(): LightConfig {\n    if (this.properties && 'Light Config' in this.properties) {\n      return this.properties['Light Config'] as LightConfig\n    }\n\n    return {\n      intensity: useSettingStore().get('Comfy.Load3D.LightIntensity')\n    } as LightConfig\n  }\n\n  private loadModelConfig(): ModelConfig {\n    if (this.properties && 'Model Config' in this.properties) {\n      return this.properties['Model Config'] as ModelConfig\n    }\n\n    return {\n      upDirection: 'original',\n      materialMode: 'original',\n      showSkeleton: false\n    }\n  }\n\n  private applySceneConfig(config: SceneConfig, bgImagePath?: string) {\n    this.load3d.toggleGrid(config.showGrid)\n    this.load3d.setBackgroundColor(config.backgroundColor)\n    if (config.backgroundImage) {\n      if (bgImagePath && bgImagePath != config.backgroundImage) {\n        return\n      }\n\n      void this.load3d.setBackgroundImage(config.backgroundImage)\n\n      if (config.backgroundRenderMode) {\n        this.load3d.setBackgroundRenderMode(config.backgroundRenderMode)\n      }\n    }\n  }\n\n  private applyCameraConfig(config: CameraConfig) {\n    this.load3d.toggleCamera(config.cameraType)\n    this.load3d.setFOV(config.fov)\n\n    if (config.state) {\n      this.load3d.setCameraState(config.state)\n    }\n  }\n\n  private applyLightConfig(config: LightConfig) {\n    this.load3d.setLightIntensity(config.intensity)\n  }\n\n  private applyModelConfig(config: ModelConfig) {\n    this.load3d.setUpDirection(config.upDirection)\n    this.load3d.setMaterialMode(config.materialMode)\n  }\n\n  private createModelUpdateHandler(\n    loadFolder: string,\n    cameraState?: CameraState\n  ) {\n    let isFirstLoad = true\n    return async (value: string | number | boolean | object) => {\n      if (!value) return\n\n      const filename = value as string\n\n      this.setResourceFolder(filename)\n\n      const modelUrl = api.apiURL(\n        Load3dUtils.getResourceURL(\n          ...Load3dUtils.splitFilePath(filename),\n          loadFolder\n        )\n      )\n\n      await this.load3d.loadModel(modelUrl, filename)\n\n      const modelConfig = this.loadModelConfig()\n      this.applyModelConfig(modelConfig)\n\n      if (isFirstLoad && cameraState) {\n        try {\n          this.load3d.setCameraState(cameraState)\n        } catch (error) {\n          console.warn('Failed to restore camera state:', error)\n        }\n        isFirstLoad = false\n      }\n    }\n  }\n\n  private setResourceFolder(filename: string): void {\n    const pathParts = filename.split('/').filter((part) => part.trim())\n\n    if (pathParts.length <= 2) {\n      return\n    }\n\n    const subfolderParts = pathParts.slice(1, -1)\n    const subfolder = subfolderParts.join('/')\n\n    if (subfolder && this.properties) {\n      this.properties['Resource Folder'] = subfolder\n    }\n  }\n}\n\nexport default Load3DConfiguration\n","import { nextTick } from 'vue'\n\nimport Load3D from '@/components/load3d/Load3D.vue'\nimport Load3DViewerContent from '@/components/load3d/Load3dViewerContent.vue'\nimport { nodeToLoad3dMap, useLoad3d } from '@/composables/useLoad3d'\nimport { createExportMenuItems } from '@/extensions/core/load3d/exportMenuHelper'\nimport Load3DConfiguration from '@/extensions/core/load3d/Load3DConfiguration'\nimport Load3dUtils from '@/extensions/core/load3d/Load3dUtils'\nimport { t } from '@/i18n'\nimport type { LGraphNode } from '@/lib/litegraph/src/LGraphNode'\nimport type { IContextMenuValue } from '@/lib/litegraph/src/interfaces'\nimport type { IStringWidget } from '@/lib/litegraph/src/types/widgets'\nimport { useToastStore } from '@/platform/updates/common/toastStore'\nimport { type CustomInputSpec } from '@/schemas/nodeDef/nodeDefSchemaV2'\nimport { api } from '@/scripts/api'\nimport { ComfyApp, app } from '@/scripts/app'\nimport { ComponentWidgetImpl, addWidget } from '@/scripts/domWidget'\nimport { useExtensionService } from '@/services/extensionService'\nimport { useLoad3dService } from '@/services/load3dService'\nimport { useDialogStore } from '@/stores/dialogStore'\nimport { isLoad3dNode } from '@/utils/litegraphUtil'\n\nconst inputSpecLoad3D: CustomInputSpec = {\n  name: 'image',\n  type: 'Load3D',\n  isPreview: false\n}\n\nconst inputSpecPreview3D: CustomInputSpec = {\n  name: 'image',\n  type: 'Preview3D',\n  isPreview: true\n}\n\nasync function handleModelUpload(files: FileList, node: any) {\n  if (!files?.length) return\n\n  const modelWidget = node.widgets?.find(\n    (w: any) => w.name === 'model_file'\n  ) as IStringWidget\n\n  try {\n    const resourceFolder = (node.properties['Resource Folder'] as string) || ''\n\n    const subfolder = resourceFolder.trim()\n      ? `3d/${resourceFolder.trim()}`\n      : '3d'\n\n    const uploadPath = await Load3dUtils.uploadFile(files[0], subfolder)\n\n    if (!uploadPath) {\n      useToastStore().addAlert(t('toastMessages.fileUploadFailed'))\n      return\n    }\n\n    const modelUrl = api.apiURL(\n      Load3dUtils.getResourceURL(\n        ...Load3dUtils.splitFilePath(uploadPath),\n        'input'\n      )\n    )\n\n    useLoad3d(node).waitForLoad3d((load3d) => {\n      try {\n        load3d.loadModel(modelUrl)\n      } catch (error) {\n        useToastStore().addAlert(t('toastMessages.failedToLoadModel'))\n      }\n    })\n\n    if (uploadPath && modelWidget) {\n      if (!modelWidget.options?.values?.includes(uploadPath)) {\n        modelWidget.options?.values?.push(uploadPath)\n      }\n\n      modelWidget.value = uploadPath\n    }\n  } catch (error) {\n    console.error('Model upload failed:', error)\n    useToastStore().addAlert(t('toastMessages.fileUploadFailed'))\n  }\n}\n\nasync function handleResourcesUpload(files: FileList, node: any) {\n  if (!files?.length) return\n\n  try {\n    const resourceFolder = (node.properties['Resource Folder'] as string) || ''\n\n    const subfolder = resourceFolder.trim()\n      ? `3d/${resourceFolder.trim()}`\n      : '3d'\n\n    await Load3dUtils.uploadMultipleFiles(files, subfolder)\n  } catch (error) {\n    console.error('Extra resources upload failed:', error)\n    useToastStore().addAlert(t('toastMessages.extraResourcesUploadFailed'))\n  }\n}\n\nfunction createFileInput(\n  accept: string,\n  multiple: boolean = false\n): HTMLInputElement {\n  const input = document.createElement('input')\n  input.type = 'file'\n  input.accept = accept\n  input.multiple = multiple\n  input.style.display = 'none'\n  return input\n}\n\nuseExtensionService().registerExtension({\n  name: 'Comfy.Load3D',\n  settings: [\n    {\n      id: 'Comfy.Load3D.ShowGrid',\n      category: ['3D', 'Scene', 'Initial Grid Visibility'],\n      name: 'Initial Grid Visibility',\n      tooltip:\n        'Controls whether the grid is visible by default when a new 3D widget is created. This default can still be toggled individually for each widget after creation.',\n      type: 'boolean',\n      defaultValue: true,\n      experimental: true\n    },\n    {\n      id: 'Comfy.Load3D.BackgroundColor',\n      category: ['3D', 'Scene', 'Initial Background Color'],\n      name: 'Initial Background Color',\n      tooltip:\n        'Controls the default background color of the 3D scene. This setting determines the background appearance when a new 3D widget is created, but can be adjusted individually for each widget after creation.',\n      type: 'color',\n      defaultValue: '282828',\n      experimental: true\n    },\n    {\n      id: 'Comfy.Load3D.CameraType',\n      category: ['3D', 'Camera', 'Initial Camera Type'],\n      name: 'Initial Camera Type',\n      tooltip:\n        'Controls whether the camera is perspective or orthographic by default when a new 3D widget is created. This default can still be toggled individually for each widget after creation.',\n      type: 'combo',\n      options: ['perspective', 'orthographic'],\n      defaultValue: 'perspective',\n      experimental: true\n    },\n    {\n      id: 'Comfy.Load3D.LightIntensity',\n      category: ['3D', 'Light', 'Initial Light Intensity'],\n      name: 'Initial Light Intensity',\n      tooltip:\n        'Sets the default brightness level of lighting in the 3D scene. This value determines how intensely lights illuminate objects when a new 3D widget is created, but can be adjusted individually for each widget after creation.',\n      type: 'number',\n      defaultValue: 3,\n      experimental: true\n    },\n    {\n      id: 'Comfy.Load3D.LightIntensityMaximum',\n      category: ['3D', 'Light', 'Light Intensity Maximum'],\n      name: 'Light Intensity Maximum',\n      tooltip:\n        'Sets the maximum allowable light intensity value for 3D scenes. This defines the upper brightness limit that can be set when adjusting lighting in any 3D widget.',\n      type: 'number',\n      defaultValue: 10,\n      experimental: true\n    },\n    {\n      id: 'Comfy.Load3D.LightIntensityMinimum',\n      category: ['3D', 'Light', 'Light Intensity Minimum'],\n      name: 'Light Intensity Minimum',\n      tooltip:\n        'Sets the minimum allowable light intensity value for 3D scenes. This defines the lower brightness limit that can be set when adjusting lighting in any 3D widget.',\n      type: 'number',\n      defaultValue: 1,\n      experimental: true\n    },\n    {\n      id: 'Comfy.Load3D.LightAdjustmentIncrement',\n      category: ['3D', 'Light', 'Light Adjustment Increment'],\n      name: 'Light Adjustment Increment',\n      tooltip:\n        'Controls the increment size when adjusting light intensity in 3D scenes. A smaller step value allows for finer control over lighting adjustments, while a larger value results in more noticeable changes per adjustment.',\n      type: 'slider',\n      attrs: {\n        min: 0.1,\n        max: 1,\n        step: 0.1\n      },\n      defaultValue: 0.5,\n      experimental: true\n    },\n    {\n      id: 'Comfy.Load3D.3DViewerEnable',\n      category: ['3D', '3DViewer', 'Enable'],\n      name: 'Enable 3D Viewer (Beta)',\n      tooltip:\n        'Enables the 3D Viewer (Beta) for selected nodes. This feature allows you to visualize and interact with 3D models directly within the full size 3d viewer.',\n      type: 'boolean',\n      defaultValue: false,\n      experimental: true\n    },\n    {\n      id: 'Comfy.Load3D.PLYEngine',\n      category: ['3D', 'PLY', 'PLY Engine'],\n      name: 'PLY Engine',\n      tooltip:\n        'Select the engine for loading PLY files. \"threejs\" uses the native Three.js PLYLoader (best for mesh PLY files). \"fastply\" uses an optimized loader for ASCII point cloud PLY files. \"sparkjs\" uses Spark.js for 3D Gaussian Splatting PLY files.',\n      type: 'combo',\n      options: ['threejs', 'fastply', 'sparkjs'],\n      defaultValue: 'threejs',\n      experimental: true\n    }\n  ],\n  commands: [\n    {\n      id: 'Comfy.3DViewer.Open3DViewer',\n      icon: 'pi pi-pencil',\n      label: 'Open 3D Viewer (Beta) for Selected Node',\n      function: () => {\n        const selectedNodes = app.canvas.selected_nodes\n        if (!selectedNodes || Object.keys(selectedNodes).length !== 1) return\n\n        const selectedNode = selectedNodes[Object.keys(selectedNodes)[0]]\n\n        if (!isLoad3dNode(selectedNode)) return\n\n        ComfyApp.copyToClipspace(selectedNode)\n        // @ts-expect-error clipspace_return_node is an extension property added at runtime\n        ComfyApp.clipspace_return_node = selectedNode\n\n        const props = { node: selectedNode }\n\n        useDialogStore().showDialog({\n          key: 'global-load3d-viewer',\n          title: t('load3d.viewer.title'),\n          component: Load3DViewerContent,\n          props: props,\n          dialogComponentProps: {\n            style: 'width: 80vw; height: 80vh;',\n            maximizable: true,\n            onClose: async () => {\n              await useLoad3dService().handleViewerClose(props.node)\n            }\n          }\n        })\n      }\n    }\n  ],\n  getCustomWidgets() {\n    return {\n      LOAD_3D(node) {\n        const fileInput = createFileInput(\n          '.gltf,.glb,.obj,.fbx,.stl,.ply,.spz,.splat,.ksplat',\n          false\n        )\n\n        node.properties['Resource Folder'] = ''\n\n        fileInput.onchange = async () => {\n          await handleModelUpload(fileInput.files!, node)\n        }\n\n        node.addWidget('button', 'upload 3d model', 'upload3dmodel', () => {\n          fileInput.click()\n        })\n\n        const resourcesInput = createFileInput('*', true)\n\n        resourcesInput.onchange = async () => {\n          await handleResourcesUpload(resourcesInput.files!, node)\n          resourcesInput.value = ''\n        }\n\n        node.addWidget(\n          'button',\n          'upload extra resources',\n          'uploadExtraResources',\n          () => {\n            resourcesInput.click()\n          }\n        )\n\n        node.addWidget('button', 'clear', 'clear', () => {\n          useLoad3d(node).waitForLoad3d((load3d) => {\n            load3d.clearModel()\n          })\n\n          const modelWidget = node.widgets?.find((w) => w.name === 'model_file')\n          if (modelWidget) {\n            modelWidget.value = ''\n          }\n        })\n\n        const widget = new ComponentWidgetImpl({\n          node: node,\n          name: 'image',\n          component: Load3D,\n          inputSpec: inputSpecLoad3D,\n          options: {}\n        })\n\n        widget.type = 'load3D'\n\n        addWidget(node, widget)\n\n        return { widget }\n      }\n    }\n  },\n\n  getNodeMenuItems(node: LGraphNode): (IContextMenuValue | null)[] {\n    // Only show menu items for Load3D nodes\n    if (node.constructor.comfyClass !== 'Load3D') return []\n\n    const load3d = useLoad3dService().getLoad3d(node)\n    if (!load3d) return []\n\n    if (load3d.isSplatModel()) return []\n\n    return createExportMenuItems(load3d)\n  },\n\n  async nodeCreated(node) {\n    if (node.constructor.comfyClass !== 'Load3D') return\n\n    const [oldWidth, oldHeight] = node.size\n\n    node.setSize([Math.max(oldWidth, 300), Math.max(oldHeight, 600)])\n\n    await nextTick()\n\n    useLoad3d(node).waitForLoad3d((load3d) => {\n      const cameraConfig = node.properties['Camera Config'] as any\n      const cameraState = cameraConfig?.state\n\n      const config = new Load3DConfiguration(load3d, node.properties)\n\n      const modelWidget = node.widgets?.find((w) => w.name === 'model_file')\n      const width = node.widgets?.find((w) => w.name === 'width')\n      const height = node.widgets?.find((w) => w.name === 'height')\n      const sceneWidget = node.widgets?.find((w) => w.name === 'image')\n\n      if (modelWidget && width && height && sceneWidget) {\n        const settings = {\n          loadFolder: 'input',\n          modelWidget: modelWidget,\n          cameraState: cameraState,\n          width: width,\n          height: height\n        }\n        config.configure(settings)\n\n        sceneWidget.serializeValue = async () => {\n          const currentLoad3d = nodeToLoad3dMap.get(node)\n          if (!currentLoad3d) {\n            console.error('No load3d instance found for node')\n            return null\n          }\n\n          const cameraConfig = (node.properties['Camera Config'] as any) || {\n            cameraType: currentLoad3d.getCurrentCameraType(),\n            fov: currentLoad3d.cameraManager.perspectiveCamera.fov\n          }\n          cameraConfig.state = currentLoad3d.getCameraState()\n          node.properties['Camera Config'] = cameraConfig\n\n          currentLoad3d.stopRecording()\n\n          const {\n            scene: imageData,\n            mask: maskData,\n            normal: normalData\n          } = await currentLoad3d.captureScene(\n            width.value as number,\n            height.value as number\n          )\n\n          const [data, dataMask, dataNormal] = await Promise.all([\n            Load3dUtils.uploadTempImage(imageData, 'scene'),\n            Load3dUtils.uploadTempImage(maskData, 'scene_mask'),\n            Load3dUtils.uploadTempImage(normalData, 'scene_normal')\n          ])\n\n          currentLoad3d.handleResize()\n\n          const returnVal = {\n            image: `threed/${data.name} [temp]`,\n            mask: `threed/${dataMask.name} [temp]`,\n            normal: `threed/${dataNormal.name} [temp]`,\n            camera_info:\n              (node.properties['Camera Config'] as any)?.state || null,\n            recording: ''\n          }\n\n          const recordingData = currentLoad3d.getRecordingData()\n\n          if (recordingData) {\n            const [recording] = await Promise.all([\n              Load3dUtils.uploadTempImage(recordingData, 'recording', 'mp4')\n            ])\n            returnVal['recording'] = `threed/${recording.name} [temp]`\n          }\n\n          return returnVal\n        }\n      }\n    })\n  }\n})\n\nuseExtensionService().registerExtension({\n  name: 'Comfy.Preview3D',\n\n  async beforeRegisterNodeDef(_nodeType, nodeData) {\n    if ('Preview3D' === nodeData.name) {\n      // @ts-expect-error InputSpec is not typed correctly\n      nodeData.input.required.image = ['PREVIEW_3D']\n    }\n  },\n\n  getNodeMenuItems(node: LGraphNode): (IContextMenuValue | null)[] {\n    // Only show menu items for Preview3D nodes\n    if (node.constructor.comfyClass !== 'Preview3D') return []\n\n    const load3d = useLoad3dService().getLoad3d(node)\n    if (!load3d) return []\n\n    if (load3d.isSplatModel()) return []\n\n    return createExportMenuItems(load3d)\n  },\n\n  getCustomWidgets() {\n    return {\n      PREVIEW_3D(node) {\n        const widget = new ComponentWidgetImpl({\n          node,\n          name: inputSpecPreview3D.name,\n          component: Load3D,\n          inputSpec: inputSpecPreview3D,\n          options: {}\n        })\n\n        widget.type = 'load3D'\n\n        addWidget(node, widget)\n\n        return { widget }\n      }\n    }\n  },\n\n  async nodeCreated(node) {\n    if (node.constructor.comfyClass !== 'Preview3D') return\n\n    const [oldWidth, oldHeight] = node.size\n\n    node.setSize([Math.max(oldWidth, 400), Math.max(oldHeight, 550)])\n\n    await nextTick()\n\n    const onExecuted = node.onExecuted\n\n    useLoad3d(node).waitForLoad3d((load3d) => {\n      const config = new Load3DConfiguration(load3d, node.properties)\n\n      const modelWidget = node.widgets?.find((w) => w.name === 'model_file')\n\n      if (modelWidget) {\n        const lastTimeModelFile = node.properties['Last Time Model File']\n\n        if (lastTimeModelFile) {\n          modelWidget.value = lastTimeModelFile\n\n          const cameraConfig = node.properties['Camera Config'] as any\n          const cameraState = cameraConfig?.state\n\n          const settings = {\n            loadFolder: 'output',\n            modelWidget: modelWidget,\n            cameraState: cameraState\n          }\n\n          config.configure(settings)\n        }\n\n        node.onExecuted = function (message: any) {\n          onExecuted?.apply(this, arguments as any)\n\n          let filePath = message.result[0]\n\n          if (!filePath) {\n            const msg = t('toastMessages.unableToGetModelFilePath')\n            console.error(msg)\n            useToastStore().addAlert(msg)\n          }\n\n          let cameraState = message.result[1]\n          let bgImagePath = message.result[2]\n\n          modelWidget.value = filePath.replaceAll('\\\\', '/')\n\n          node.properties['Last Time Model File'] = modelWidget.value\n\n          const settings = {\n            loadFolder: 'output',\n            modelWidget: modelWidget,\n            cameraState: cameraState,\n            bgImagePath: bgImagePath\n          }\n\n          config.configure(settings)\n\n          if (bgImagePath) {\n            load3d.setBackgroundImage(bgImagePath)\n          }\n        }\n      }\n    })\n  }\n})\n","import _ from 'es-toolkit/compat'\nimport type { LGraphNode } from '@/lib/litegraph/src/litegraph'\n\nimport { app, ComfyApp } from '@/scripts/app'\nimport { useMaskEditorStore } from '@/stores/maskEditorStore'\nimport { useDialogStore } from '@/stores/dialogStore'\nimport { useMaskEditor } from '@/composables/maskeditor/useMaskEditor'\nimport { useCanvasTransform } from '@/composables/maskeditor/useCanvasTransform'\n\nfunction openMaskEditor(node: LGraphNode): void {\n  if (!node) {\n    console.error('[MaskEditor] No node provided')\n    return\n  }\n\n  if (!node.imgs?.length && node.previewMediaType !== 'image') {\n    console.error('[MaskEditor] Node has no images')\n    return\n  }\n\n  useMaskEditor().openMaskEditor(node)\n}\n\n// Open mask editor from clipspace (for plugin compatibility)\n// This is called when ComfyApp.open_maskeditor() is invoked without arguments\nfunction openMaskEditorFromClipspace(): void {\n  const node = ComfyApp.clipspace_return_node as LGraphNode | null\n  if (!node) {\n    console.error('[MaskEditor] No clipspace_return_node found')\n    return\n  }\n\n  openMaskEditor(node)\n}\n\n// Check if the dialog is already opened\nfunction isOpened(): boolean {\n  return useDialogStore().isDialogOpen('global-mask-editor')\n}\n\nconst changeBrushSize = async (sizeChanger: (oldSize: number) => number) => {\n  if (!isOpened()) return\n\n  const store = useMaskEditorStore()\n  const oldBrushSize = store.brushSettings.size\n  const newBrushSize = sizeChanger(oldBrushSize)\n  store.setBrushSize(newBrushSize)\n}\n\napp.registerExtension({\n  name: 'Comfy.MaskEditor',\n  settings: [\n    {\n      id: 'Comfy.MaskEditor.BrushAdjustmentSpeed',\n      category: ['Mask Editor', 'BrushAdjustment', 'Sensitivity'],\n      name: 'Brush adjustment speed multiplier',\n      tooltip:\n        'Controls how quickly the brush size and hardness change when adjusting. Higher values mean faster changes.',\n      type: 'slider',\n      attrs: {\n        min: 0.1,\n        max: 2.0,\n        step: 0.1\n      },\n      defaultValue: 1.0,\n      versionAdded: '1.0.0'\n    },\n    {\n      id: 'Comfy.MaskEditor.UseDominantAxis',\n      category: ['Mask Editor', 'BrushAdjustment', 'UseDominantAxis'],\n      name: 'Lock brush adjustment to dominant axis',\n      tooltip:\n        'When enabled, brush adjustments will only affect size OR hardness based on which direction you move more',\n      type: 'boolean',\n      defaultValue: true\n    }\n  ],\n  commands: [\n    {\n      id: 'Comfy.MaskEditor.OpenMaskEditor',\n      icon: 'pi pi-pencil',\n      label: 'Open Mask Editor for Selected Node',\n      function: () => {\n        const selectedNodes = app.canvas.selected_nodes\n        if (!selectedNodes || Object.keys(selectedNodes).length !== 1) return\n\n        const selectedNode = selectedNodes[Object.keys(selectedNodes)[0]]\n        openMaskEditor(selectedNode)\n      }\n    },\n    {\n      id: 'Comfy.MaskEditor.BrushSize.Increase',\n      icon: 'pi pi-plus-circle',\n      label: 'Increase Brush Size in MaskEditor',\n      function: () => changeBrushSize((old) => _.clamp(old + 2, 1, 250))\n    },\n    {\n      id: 'Comfy.MaskEditor.BrushSize.Decrease',\n      icon: 'pi pi-minus-circle',\n      label: 'Decrease Brush Size in MaskEditor',\n      function: () => changeBrushSize((old) => _.clamp(old - 2, 1, 250))\n    },\n    {\n      id: 'Comfy.MaskEditor.ColorPicker',\n      icon: 'pi pi-palette',\n      label: 'Open Color Picker in MaskEditor',\n      function: () => {\n        if (!isOpened()) return\n\n        const store = useMaskEditorStore()\n        store.colorInput?.click()\n      }\n    },\n    {\n      id: 'Comfy.MaskEditor.Rotate.Right',\n      icon: 'pi pi-refresh',\n      label: 'Rotate Right in MaskEditor',\n      function: async () => {\n        if (!isOpened()) return\n        await useCanvasTransform().rotateClockwise()\n      }\n    },\n    {\n      id: 'Comfy.MaskEditor.Rotate.Left',\n      icon: 'pi pi-undo',\n      label: 'Rotate Left in MaskEditor',\n      function: async () => {\n        if (!isOpened()) return\n        await useCanvasTransform().rotateCounterclockwise()\n      }\n    },\n    {\n      id: 'Comfy.MaskEditor.Mirror.Horizontal',\n      icon: 'pi pi-arrows-h',\n      label: 'Mirror Horizontal in MaskEditor',\n      function: async () => {\n        if (!isOpened()) return\n        await useCanvasTransform().mirrorHorizontal()\n      }\n    },\n    {\n      id: 'Comfy.MaskEditor.Mirror.Vertical',\n      icon: 'pi pi-arrows-v',\n      label: 'Mirror Vertical in MaskEditor',\n      function: async () => {\n        if (!isOpened()) return\n        await useCanvasTransform().mirrorVertical()\n      }\n    }\n  ],\n  init() {\n    // Set up ComfyApp static methods for plugin compatibility (deprecated)\n    ComfyApp.open_maskeditor = openMaskEditorFromClipspace\n\n    console.warn(\n      '[MaskEditor] ComfyApp.open_maskeditor is deprecated. ' +\n        'Plugins should migrate to using the command system or direct node context menu integration.'\n    )\n  }\n})\n","import { downloadBlob } from '@/base/common/downloadUtil'\nimport { t } from '@/i18n'\nimport type { IContextMenuValue } from '@/lib/litegraph/src/interfaces'\nimport type { LGraphCanvas } from '@/lib/litegraph/src/litegraph'\nimport { useToastStore } from '@/platform/updates/common/toastStore'\nimport { useDialogService } from '@/services/dialogService'\nimport type { ComfyExtension } from '@/types/comfy'\nimport { deserialiseAndCreate } from '@/utils/vintageClipboard'\n\nimport { api } from '../../scripts/api'\nimport { app } from '../../scripts/app'\nimport { $el, ComfyDialog } from '../../scripts/ui'\nimport { GroupNodeConfig, GroupNodeHandler } from './groupNode'\n\n// Adds the ability to save and add multiple nodes as a template\n// To save:\n// Select multiple nodes (ctrl + drag to select a region or ctrl+click individual nodes)\n// Right click the canvas\n// Save Node Template -> give it a name\n//\n// To add:\n// Right click the canvas\n// Node templates -> click the one to add\n//\n// To delete/rename:\n// Right click the canvas\n// Node templates -> Manage\n//\n// To rearrange:\n// Open the manage dialog and Drag and drop elements using the \"Name:\" label as handle\n\nconst id = 'Comfy.NodeTemplates'\nconst file = 'comfy.templates.json'\n\nclass ManageTemplates extends ComfyDialog {\n  // @ts-expect-error fixme ts strict error\n  templates: any[]\n  draggedEl: HTMLElement | null\n  saveVisualCue: number | null\n  emptyImg: HTMLImageElement\n  importInput: HTMLInputElement\n\n  constructor() {\n    super()\n    this.load().then((v) => {\n      this.templates = v\n    })\n\n    this.element.classList.add('comfy-manage-templates')\n    this.draggedEl = null\n    this.saveVisualCue = null\n    this.emptyImg = new Image()\n    this.emptyImg.src =\n      'data:image/gif;base64,R0lGODlhAQABAIAAAAUEBAAAACwAAAAAAQABAAACAkQBADs='\n\n    this.importInput = $el('input', {\n      type: 'file',\n      accept: '.json',\n      multiple: true,\n      style: { display: 'none' },\n      parent: document.body,\n      onchange: () => this.importAll()\n    }) as HTMLInputElement\n  }\n\n  override createButtons() {\n    const btns = super.createButtons()\n    btns[0].textContent = 'Close'\n    btns[0].onclick = () => {\n      // @ts-expect-error fixme ts strict error\n      clearTimeout(this.saveVisualCue)\n      this.close()\n    }\n    btns.unshift(\n      $el('button', {\n        type: 'button',\n        textContent: 'Export',\n        onclick: () => this.exportAll()\n      })\n    )\n    btns.unshift(\n      $el('button', {\n        type: 'button',\n        textContent: 'Import',\n        onclick: () => {\n          this.importInput.click()\n        }\n      })\n    )\n    return btns\n  }\n\n  async load() {\n    let templates = []\n    const res = await api.getUserData(file)\n    if (res.status === 200) {\n      try {\n        templates = await res.json()\n      } catch (error) {}\n    } else if (res.status !== 404) {\n      console.error(res.status + ' ' + res.statusText)\n    }\n    return templates ?? []\n  }\n\n  async store() {\n    const templates = JSON.stringify(this.templates, undefined, 4)\n    try {\n      await api.storeUserData(file, templates, { stringify: false })\n    } catch (error) {\n      console.error(error)\n      // @ts-expect-error fixme ts strict error\n      useToastStore().addAlert(error.message)\n    }\n  }\n\n  async importAll() {\n    // @ts-expect-error fixme ts strict error\n    for (const file of this.importInput.files) {\n      if (file.type === 'application/json' || file.name.endsWith('.json')) {\n        const reader = new FileReader()\n        reader.onload = async () => {\n          const importFile = JSON.parse(reader.result as string)\n          if (importFile?.templates) {\n            for (const template of importFile.templates) {\n              if (template?.name && template?.data) {\n                this.templates.push(template)\n              }\n            }\n            await this.store()\n          }\n        }\n        await reader.readAsText(file)\n      }\n    }\n\n    // @ts-expect-error fixme ts strict error\n    this.importInput.value = null\n\n    this.close()\n  }\n\n  exportAll() {\n    if (this.templates.length == 0) {\n      useToastStore().addAlert(t('toastMessages.noTemplatesToExport'))\n      return\n    }\n\n    const json = JSON.stringify({ templates: this.templates }, null, 2) // convert the data to a JSON string\n    const blob = new Blob([json], { type: 'application/json' })\n    downloadBlob('node_templates.json', blob)\n  }\n\n  override show() {\n    // Show list of template names + delete button\n    super.show(\n      $el(\n        'div',\n        {},\n        this.templates.flatMap((t, i) => {\n          // @ts-expect-error fixme ts strict error\n          let nameInput\n          return [\n            $el(\n              'div',\n              {\n                dataset: { id: i.toString() },\n                className: 'templateManagerRow',\n                style: {\n                  display: 'grid',\n                  gridTemplateColumns: '1fr auto',\n                  border: '1px dashed transparent',\n                  gap: '5px',\n                  backgroundColor: 'var(--comfy-menu-bg)'\n                },\n                // @ts-expect-error fixme ts strict error\n                ondragstart: (e) => {\n                  this.draggedEl = e.currentTarget\n                  e.currentTarget.style.opacity = '0.6'\n                  e.currentTarget.style.border = '1px dashed yellow'\n                  e.dataTransfer.effectAllowed = 'move'\n                  e.dataTransfer.setDragImage(this.emptyImg, 0, 0)\n                },\n                // @ts-expect-error fixme ts strict error\n                ondragend: (e) => {\n                  e.target.style.opacity = '1'\n                  e.currentTarget.style.border = '1px dashed transparent'\n                  e.currentTarget.removeAttribute('draggable')\n\n                  // rearrange the elements\n                  this.element\n                    .querySelectorAll('.templateManagerRow')\n                    // @ts-expect-error fixme ts strict error\n                    .forEach((el: HTMLElement, i) => {\n                      // @ts-expect-error fixme ts strict error\n                      var prev_i = Number.parseInt(el.dataset.id)\n\n                      if (el == this.draggedEl && prev_i != i) {\n                        this.templates.splice(\n                          i,\n                          0,\n                          this.templates.splice(prev_i, 1)[0]\n                        )\n                      }\n                      el.dataset.id = i.toString()\n                    })\n                  this.store()\n                },\n                // @ts-expect-error fixme ts strict error\n                ondragover: (e) => {\n                  e.preventDefault()\n                  if (e.currentTarget == this.draggedEl) return\n\n                  let rect = e.currentTarget.getBoundingClientRect()\n                  if (e.clientY > rect.top + rect.height / 2) {\n                    e.currentTarget.parentNode.insertBefore(\n                      this.draggedEl,\n                      e.currentTarget.nextSibling\n                    )\n                  } else {\n                    e.currentTarget.parentNode.insertBefore(\n                      this.draggedEl,\n                      e.currentTarget\n                    )\n                  }\n                }\n              },\n              [\n                $el(\n                  'label',\n                  {\n                    textContent: 'Name: ',\n                    style: {\n                      cursor: 'grab'\n                    },\n                    // @ts-expect-error fixme ts strict error\n                    onmousedown: (e) => {\n                      // enable dragging only from the label\n                      if (e.target.localName == 'label')\n                        e.currentTarget.parentNode.draggable = 'true'\n                    }\n                  },\n                  [\n                    $el('input', {\n                      value: t.name,\n                      dataset: { name: t.name },\n                      style: {\n                        transitionProperty: 'background-color',\n                        transitionDuration: '0s'\n                      },\n                      // @ts-expect-error fixme ts strict error\n                      onchange: (e) => {\n                        // @ts-expect-error fixme ts strict error\n                        clearTimeout(this.saveVisualCue)\n                        var el = e.target\n                        var row = el.parentNode.parentNode\n                        this.templates[row.dataset.id].name =\n                          el.value.trim() || 'untitled'\n                        this.store()\n                        el.style.backgroundColor = 'rgb(40, 95, 40)'\n                        el.style.transitionDuration = '0s'\n                        // @ts-expect-error\n                        // In browser env the return value is number.\n                        this.saveVisualCue = setTimeout(function () {\n                          el.style.transitionDuration = '.7s'\n                          el.style.backgroundColor = 'var(--comfy-input-bg)'\n                        }, 15)\n                      },\n                      // @ts-expect-error fixme ts strict error\n                      onkeypress: (e) => {\n                        var el = e.target\n                        // @ts-expect-error fixme ts strict error\n                        clearTimeout(this.saveVisualCue)\n                        el.style.transitionDuration = '0s'\n                        el.style.backgroundColor = 'var(--comfy-input-bg)'\n                      },\n                      $: (el) => (nameInput = el)\n                    })\n                  ]\n                ),\n                $el('div', {}, [\n                  $el('button', {\n                    textContent: 'Export',\n                    style: {\n                      fontSize: '12px',\n                      fontWeight: 'normal'\n                    },\n                    onclick: () => {\n                      const json = JSON.stringify({ templates: [t] }, null, 2) // convert the data to a JSON string\n                      const blob = new Blob([json], {\n                        type: 'application/json'\n                      })\n                      // @ts-expect-error fixme ts strict error\n                      const name = (nameInput.value || t.name) + '.json'\n                      downloadBlob(name, blob)\n                    }\n                  }),\n                  $el('button', {\n                    textContent: 'Delete',\n                    style: {\n                      fontSize: '12px',\n                      color: 'red',\n                      fontWeight: 'normal'\n                    },\n                    // @ts-expect-error fixme ts strict error\n                    onclick: (e) => {\n                      const item = e.target.parentNode.parentNode\n                      item.parentNode.removeChild(item)\n                      this.templates.splice(item.dataset.id * 1, 1)\n                      this.store()\n                      // update the rows index, setTimeout ensures that the list is updated\n                      var that = this\n                      setTimeout(function () {\n                        that.element\n                          .querySelectorAll('.templateManagerRow')\n                          // @ts-expect-error fixme ts strict error\n                          .forEach((el: HTMLElement, i) => {\n                            el.dataset.id = i.toString()\n                          })\n                      }, 0)\n                    }\n                  })\n                ])\n              ]\n            )\n          ]\n        })\n      )\n    )\n  }\n}\n\nconst manage = new ManageTemplates()\n\n// @ts-expect-error fixme ts strict error\nconst clipboardAction = async (cb) => {\n  // We use the clipboard functions but dont want to overwrite the current user clipboard\n  // Restore it after we've run our callback\n  const old = localStorage.getItem('litegrapheditor_clipboard')\n  await cb()\n  // @ts-expect-error fixme ts strict error\n  localStorage.setItem('litegrapheditor_clipboard', old)\n}\n\nconst ext: ComfyExtension = {\n  name: id,\n\n  getCanvasMenuItems(_canvas: LGraphCanvas): IContextMenuValue[] {\n    const items: IContextMenuValue[] = []\n\n    // @ts-expect-error fixme ts strict error\n    items.push(null)\n    items.push({\n      content: `Save Selected as Template`,\n      disabled: !Object.keys(app.canvas.selected_nodes || {}).length,\n      callback: async () => {\n        const name = await useDialogService().prompt({\n          title: t('nodeTemplates.saveAsTemplate'),\n          message: t('nodeTemplates.enterName'),\n          defaultValue: ''\n        })\n        if (!name?.trim()) return\n\n        clipboardAction(() => {\n          app.canvas.copyToClipboard()\n          let data = localStorage.getItem('litegrapheditor_clipboard')\n          data = JSON.parse(data || '{}')\n          const nodeIds = Object.keys(app.canvas.selected_nodes)\n          for (let i = 0; i < nodeIds.length; i++) {\n            const node = app.canvas.graph?.getNodeById(nodeIds[i])\n            const nodeData = node?.constructor.nodeData\n\n            if (!node) continue\n            const groupConfig = GroupNodeHandler.getGroupData(node)\n            if (groupConfig) {\n              const groupData = groupConfig.nodeData\n              // @ts-expect-error\n              if (!data.groupNodes) {\n                // @ts-expect-error\n                data.groupNodes = {}\n              }\n              if (nodeData == null) throw new TypeError('nodeData is not set')\n              // @ts-expect-error\n              data.groupNodes[nodeData.name] = groupData\n              // @ts-expect-error\n              data.nodes[i].type = nodeData.name\n            }\n          }\n\n          manage.templates.push({\n            name,\n            data: JSON.stringify(data)\n          })\n          manage.store()\n        })\n      }\n    })\n\n    // Map each template to a menu item\n    const subItems = manage.templates.map((t) => {\n      return {\n        content: t.name,\n        callback: () => {\n          clipboardAction(async () => {\n            const data = JSON.parse(t.data)\n            await GroupNodeConfig.registerFromWorkflow(\n              data.groupNodes ?? {},\n              []\n            )\n\n            // Check for old clipboard format\n            if (!data.reroutes) {\n              deserialiseAndCreate(t.data, app.canvas)\n            } else {\n              localStorage.setItem('litegrapheditor_clipboard', t.data)\n              app.canvas.pasteFromClipboard()\n            }\n          })\n        }\n      }\n    })\n\n    // @ts-expect-error fixme ts strict error\n    subItems.push(null, {\n      content: 'Manage',\n      callback: () => manage.show()\n    })\n\n    items.push({\n      content: 'Node Templates',\n      submenu: {\n        options: subItems\n      }\n    })\n\n    return items\n  }\n}\n\napp.registerExtension(ext)\n","import { LGraphCanvas, LiteGraph } from '@/lib/litegraph/src/litegraph'\nimport { LGraphNode } from '@/lib/litegraph/src/litegraph'\n\nimport { app } from '../../scripts/app'\nimport { ComfyWidgets } from '../../scripts/widgets'\n\n// Node that add notes to your project\n\napp.registerExtension({\n  name: 'Comfy.NoteNode',\n  registerCustomNodes() {\n    class NoteNode extends LGraphNode {\n      static override category: string\n      static collapsable: boolean\n      static title_mode: number\n\n      groupcolor = LGraphCanvas.node_colors.yellow.groupcolor\n      override isVirtualNode: boolean\n\n      constructor(title: string) {\n        super(title)\n\n        this.color = LGraphCanvas.node_colors.yellow.color\n        this.bgcolor = LGraphCanvas.node_colors.yellow.bgcolor\n\n        if (!this.properties) {\n          this.properties = { text: '' }\n        }\n        ComfyWidgets.STRING(\n          this,\n          'text',\n          ['STRING', { default: this.properties.text, multiline: true }],\n          app\n        )\n\n        this.serialize_widgets = true\n        this.isVirtualNode = true\n      }\n    }\n\n    // Load default visibility\n\n    LiteGraph.registerNodeType(\n      'Note',\n      Object.assign(NoteNode, {\n        title_mode: LiteGraph.NORMAL_TITLE,\n        title: 'Note',\n        collapsable: true\n      })\n    )\n\n    NoteNode.category = 'utils'\n\n    /** Markdown variant of NoteNode */\n    class MarkdownNoteNode extends LGraphNode {\n      static override title = 'Markdown Note'\n\n      groupcolor = LGraphCanvas.node_colors.yellow.groupcolor\n\n      constructor(title: string) {\n        super(title)\n\n        this.color = LGraphCanvas.node_colors.yellow.color\n        this.bgcolor = LGraphCanvas.node_colors.yellow.bgcolor\n\n        if (!this.properties) {\n          this.properties = { text: '' }\n        }\n        ComfyWidgets.MARKDOWN(\n          this,\n          'text',\n          ['STRING', { default: this.properties.text }],\n          app\n        )\n\n        this.serialize_widgets = true\n        this.isVirtualNode = true\n      }\n    }\n\n    LiteGraph.registerNodeType('MarkdownNote', MarkdownNoteNode)\n    MarkdownNoteNode.category = 'utils'\n  }\n})\n","/*\nPreview Any - original implement from\nhttps://github.com/rgthree/rgthree-comfy/blob/main/py/display_any.py\nupstream requested in https://github.com/Kosinkadink/rfcs/blob/main/rfcs/0000-corenodes.md#preview-nodes\n */\nimport { app } from '@/scripts/app'\nimport { type DOMWidget } from '@/scripts/domWidget'\nimport { ComfyWidgets } from '@/scripts/widgets'\nimport { useExtensionService } from '@/services/extensionService'\n\nuseExtensionService().registerExtension({\n  name: 'Comfy.PreviewAny',\n  async beforeRegisterNodeDef(nodeType, nodeData) {\n    if (nodeData.name === 'PreviewAny') {\n      const onNodeCreated = nodeType.prototype.onNodeCreated\n\n      nodeType.prototype.onNodeCreated = function () {\n        onNodeCreated ? onNodeCreated.apply(this, []) : undefined\n\n        const showValueWidget = ComfyWidgets['MARKDOWN'](\n          this,\n          'preview',\n          ['MARKDOWN', {}],\n          app\n        ).widget as DOMWidget<HTMLTextAreaElement, string>\n\n        const showValueWidgetPlain = ComfyWidgets['STRING'](\n          this,\n          'preview',\n          ['STRING', { multiline: true }],\n          app\n        ).widget as DOMWidget<HTMLTextAreaElement, string>\n\n        const showAsPlaintextWidget = ComfyWidgets['BOOLEAN'](\n          this,\n          'previewMode',\n          [\n            'BOOLEAN',\n            { label_on: 'Markdown', label_off: 'Plaintext', default: false }\n          ],\n          app\n        )\n\n        showAsPlaintextWidget.widget.callback = (value: boolean) => {\n          showValueWidget.hidden = !value\n          showValueWidget.options.hidden = !value\n          showValueWidgetPlain.hidden = value\n          showValueWidgetPlain.options.hidden = value\n        }\n\n        showValueWidget.hidden = true\n        showValueWidget.options.hidden = true\n        showValueWidget.options.read_only = true\n        showValueWidget.element.readOnly = true\n        showValueWidget.element.disabled = true\n        showValueWidget.serialize = false\n\n        showValueWidgetPlain.hidden = false\n        showValueWidgetPlain.options.hidden = false\n        showValueWidgetPlain.options.read_only = true\n        showValueWidgetPlain.element.readOnly = true\n        showValueWidgetPlain.element.disabled = true\n        showValueWidgetPlain.serialize = false\n      }\n\n      const onExecuted = nodeType.prototype.onExecuted\n\n      nodeType.prototype.onExecuted = function (message) {\n        onExecuted === null || onExecuted === void 0\n          ? void 0\n          : onExecuted.apply(this, [message])\n\n        const previewWidgets =\n          this.widgets?.filter((w) => w.name === 'preview') ?? []\n\n        for (const previewWidget of previewWidgets) {\n          const text = message.text ?? ''\n          previewWidget.value = Array.isArray(text) ? (text[0] ?? '') : text\n        }\n      }\n    }\n  }\n})\n","import type { IContextMenuValue } from '@/lib/litegraph/src/litegraph'\nimport {\n  LGraphCanvas,\n  LGraphNode,\n  LiteGraph\n} from '@/lib/litegraph/src/litegraph'\nimport type { ISlotType } from '@/lib/litegraph/src/interfaces'\n\nimport { app } from '../../scripts/app'\nimport { getWidgetConfig, mergeIfValid, setWidgetConfig } from './widgetInputs'\n\n// Node that allows you to redirect connections for cleaner graphs\n\napp.registerExtension({\n  name: 'Comfy.RerouteNode',\n  registerCustomNodes(app) {\n    interface RerouteNode extends LGraphNode {\n      __outputType?: string | number\n    }\n\n    class RerouteNode extends LGraphNode {\n      static override category: string | undefined\n      static defaultVisibility = false\n\n      constructor(title?: string) {\n        super(title ?? '')\n        if (!this.properties) {\n          this.properties = {}\n        }\n        this.properties.showOutputText = RerouteNode.defaultVisibility\n        this.properties.horizontal = false\n\n        this.addInput('', '*')\n        this.addOutput(this.properties.showOutputText ? '*' : '', '*')\n\n        // This node is purely frontend and does not impact the resulting prompt so should not be serialized\n        this.isVirtualNode = true\n      }\n      override onAfterGraphConfigured() {\n        requestAnimationFrame(() => {\n          this.onConnectionsChange(LiteGraph.INPUT, undefined, true)\n        })\n      }\n      override clone(): LGraphNode | null {\n        const cloned = super.clone()\n        if (!cloned) return cloned\n        cloned.removeOutput(0)\n        cloned.addOutput(this.properties.showOutputText ? '*' : '', '*')\n        cloned.setSize(cloned.computeSize())\n        return cloned\n      }\n      override onConnectionsChange(\n        type: ISlotType,\n        _index: number | undefined,\n        connected: boolean\n      ) {\n        const { graph } = this\n        if (!graph) return\n        if (app.configuringGraph) return\n\n        // Prevent multiple connections to different types when we have no input\n        if (connected && type === LiteGraph.OUTPUT) {\n          // Ignore wildcard nodes as these will be updated to real types\n          const types = new Set(\n            this.outputs[0].links\n              ?.map((l) => graph.links[l]?.type)\n              ?.filter((t) => t && t !== '*') ?? []\n          )\n          if (types.size > 1) {\n            const linksToDisconnect = []\n            for (const linkId of this.outputs[0].links ?? []) {\n              const link = graph.links[linkId]\n              linksToDisconnect.push(link)\n            }\n            linksToDisconnect.pop()\n            for (const link of linksToDisconnect) {\n              const node = graph.getNodeById(link.target_id)\n              node?.disconnectInput(link.target_slot)\n            }\n          }\n        }\n\n        // Find root input\n        let currentNode: RerouteNode | null = this\n        let updateNodes: RerouteNode[] = []\n        let inputType = null\n        let inputNode = null\n        while (currentNode) {\n          updateNodes.unshift(currentNode)\n          const linkId = currentNode.inputs[0].link\n          if (linkId !== null) {\n            const link = graph.links[linkId]\n            if (!link) return\n            const node = graph.getNodeById(link.origin_id)\n            if (!node) return\n            if (node instanceof RerouteNode) {\n              if (node === this) {\n                // We've found a circle\n                currentNode.disconnectInput(link.target_slot)\n                currentNode = null\n              } else {\n                // Move the previous node\n                currentNode = node\n              }\n            } else {\n              // We've found the end\n              inputNode = currentNode\n              inputType = node.outputs[link.origin_slot]?.type ?? null\n              break\n            }\n          } else {\n            // This path has no input node\n            currentNode = null\n            break\n          }\n        }\n\n        // Find all outputs\n        const nodes: RerouteNode[] = [this]\n        let outputType = null\n        while (nodes.length) {\n          currentNode = nodes.pop()!\n          const outputs = currentNode.outputs?.[0]?.links ?? []\n          for (const linkId of outputs) {\n            const link = graph.links[linkId]\n\n            // When disconnecting sometimes the link is still registered\n            if (!link) continue\n\n            const node = graph.getNodeById(link.target_id)\n            if (!node) continue\n            if (node instanceof RerouteNode) {\n              // Follow reroute nodes\n              nodes.push(node)\n              updateNodes.push(node)\n            } else {\n              // We've found an output\n              const nodeInput = node.inputs[link.target_slot]\n              const nodeOutType = nodeInput.type\n              const keep =\n                !inputType ||\n                !nodeOutType ||\n                LiteGraph.isValidConnection(inputType, nodeOutType)\n              if (!keep) {\n                // The output doesnt match our input so disconnect it\n                node.disconnectInput(link.target_slot)\n                continue\n              }\n              node.onConnectionsChange?.(\n                LiteGraph.INPUT,\n                link.target_slot,\n                keep,\n                link,\n                nodeInput\n              )\n              outputType = node.inputs[link.target_slot].type\n            }\n          }\n        }\n\n        const displayType = inputType || outputType || '*'\n        const color = LGraphCanvas.link_type_colors[displayType]\n\n        let widgetConfig\n        let widgetType\n        // Update the types of each node\n        for (const node of updateNodes) {\n          // If we dont have an input type we are always wildcard but we'll show the output type\n          // This lets you change the output link to a different type and all nodes will update\n          node.outputs[0].type = inputType || '*'\n          node.__outputType = displayType\n          node.outputs[0].name = node.properties.showOutputText\n            ? `${displayType}`\n            : ''\n          node.setSize(node.computeSize())\n\n          for (const l of node.outputs[0].links || []) {\n            const link = graph.links[l]\n            if (!link) continue\n            link.color = color\n\n            if (app.configuringGraph) continue\n            const targetNode = graph.getNodeById(link.target_id)\n            if (!targetNode) continue\n            const targetInput = targetNode.inputs?.[link.target_slot]\n            if (targetInput?.widget) {\n              const config = getWidgetConfig(targetInput)\n              if (!widgetConfig) {\n                widgetConfig = config[1] ?? {}\n                widgetType = config[0]\n              }\n\n              const merged = mergeIfValid(targetInput, [\n                config[0],\n                widgetConfig\n              ])\n              if (merged.customConfig) {\n                widgetConfig = merged.customConfig\n              }\n            }\n          }\n        }\n\n        for (const node of updateNodes) {\n          if (widgetConfig && outputType) {\n            node.inputs[0].widget = { name: 'value' }\n            setWidgetConfig(node.inputs[0], [\n              widgetType ?? `${displayType}`,\n              widgetConfig\n            ])\n          } else {\n            setWidgetConfig(node.inputs[0], undefined)\n          }\n        }\n\n        if (inputNode?.inputs?.[0]?.link) {\n          const link = graph.links[inputNode.inputs[0].link]\n          if (link) {\n            link.color = color\n          }\n        }\n      }\n\n      override getExtraMenuOptions(\n        _: unknown,\n        options: (IContextMenuValue | null)[]\n      ): IContextMenuValue[] {\n        options.unshift(\n          {\n            content:\n              (this.properties.showOutputText ? 'Hide' : 'Show') + ' Type',\n            callback: () => {\n              this.properties.showOutputText = !this.properties.showOutputText\n              if (this.properties.showOutputText) {\n                this.outputs[0].name = `${this.__outputType || this.outputs[0].type}`\n              } else {\n                this.outputs[0].name = ''\n              }\n              this.setSize(this.computeSize())\n              app.canvas.setDirty(true, true)\n            }\n          },\n          {\n            content:\n              (RerouteNode.defaultVisibility ? 'Hide' : 'Show') +\n              ' Type By Default',\n            callback: () => {\n              RerouteNode.setDefaultTextVisibility(\n                !RerouteNode.defaultVisibility\n              )\n            }\n          }\n        )\n        return []\n      }\n      override computeSize(): [number, number] {\n        return [\n          this.properties.showOutputText && this.outputs && this.outputs.length\n            ? Math.max(\n                75,\n                LiteGraph.NODE_TEXT_SIZE * this.outputs[0].name.length * 0.6 +\n                  40\n              )\n            : 75,\n          26\n        ]\n      }\n\n      static setDefaultTextVisibility(visible: boolean) {\n        RerouteNode.defaultVisibility = visible\n        if (visible) {\n          localStorage['Comfy.RerouteNode.DefaultVisibility'] = 'true'\n        } else {\n          delete localStorage['Comfy.RerouteNode.DefaultVisibility']\n        }\n      }\n    }\n\n    // Load default visibility\n    RerouteNode.setDefaultTextVisibility(\n      !!localStorage['Comfy.RerouteNode.DefaultVisibility']\n    )\n\n    LiteGraph.registerNodeType(\n      'Reroute',\n      Object.assign(RerouteNode, {\n        title_mode: LiteGraph.NO_TITLE,\n        title: 'Reroute',\n        collapsable: false\n      })\n    )\n\n    RerouteNode.category = 'utils'\n  }\n})\n","import { applyTextReplacements } from '@/utils/searchAndReplace'\n\nimport { app } from '../../scripts/app'\n\nconst saveNodeTypes = new Set([\n  'SaveImage',\n  'SaveVideo',\n  'SaveAnimatedWEBP',\n  'SaveWEBM',\n  'SaveAudio',\n  'SaveGLB',\n  'SaveAnimatedPNG',\n  'CLIPSave',\n  'VAESave',\n  'ModelSave',\n  'LoraSave',\n  'SaveLatent'\n])\n\n// Use widget values and dates in output filenames\n\napp.registerExtension({\n  name: 'Comfy.SaveImageExtraOutput',\n  async beforeRegisterNodeDef(nodeType, nodeData, app) {\n    if (saveNodeTypes.has(nodeData.name)) {\n      const onNodeCreated = nodeType.prototype.onNodeCreated\n      // When the SaveImage node is created we want to override the serialization of the output name widget to run our S&R\n      nodeType.prototype.onNodeCreated = function () {\n        const r = onNodeCreated\n          ? // @ts-expect-error fixme ts strict error\n            onNodeCreated.apply(this, arguments)\n          : undefined\n\n        // @ts-expect-error fixme ts strict error\n        const widget = this.widgets.find((w) => w.name === 'filename_prefix')\n        // @ts-expect-error fixme ts strict error\n        widget.serializeValue = () => {\n          // @ts-expect-error fixme ts strict error\n          return applyTextReplacements(app.graph, widget.value)\n        }\n\n        return r\n      }\n    } else {\n      // When any other node is created add a property to alias the node\n      const onNodeCreated = nodeType.prototype.onNodeCreated\n      nodeType.prototype.onNodeCreated = function () {\n        const r = onNodeCreated\n          ? // @ts-expect-error fixme ts strict error\n            onNodeCreated.apply(this, arguments)\n          : undefined\n\n        if (!this.properties || !('Node name for S&R' in this.properties)) {\n          this.addProperty('Node name for S&R', this.constructor.type, 'string')\n        }\n\n        return r\n      }\n    }\n  }\n})\n","import { nextTick } from 'vue'\n\nimport Load3D from '@/components/load3d/Load3D.vue'\nimport { useLoad3d } from '@/composables/useLoad3d'\nimport { createExportMenuItems } from '@/extensions/core/load3d/exportMenuHelper'\nimport Load3DConfiguration from '@/extensions/core/load3d/Load3DConfiguration'\nimport type { LGraphNode } from '@/lib/litegraph/src/LGraphNode'\nimport type { IContextMenuValue } from '@/lib/litegraph/src/interfaces'\nimport { type CustomInputSpec } from '@/schemas/nodeDef/nodeDefSchemaV2'\nimport { ComponentWidgetImpl, addWidget } from '@/scripts/domWidget'\nimport { useExtensionService } from '@/services/extensionService'\nimport { useLoad3dService } from '@/services/load3dService'\n\nconst inputSpec: CustomInputSpec = {\n  name: 'image',\n  type: 'Preview3D',\n  isPreview: true\n}\n\nuseExtensionService().registerExtension({\n  name: 'Comfy.SaveGLB',\n\n  async beforeRegisterNodeDef(_nodeType, nodeData) {\n    if ('SaveGLB' === nodeData.name) {\n      // @ts-expect-error InputSpec is not typed correctly\n      nodeData.input.required.image = ['PREVIEW_3D']\n    }\n  },\n\n  getCustomWidgets() {\n    return {\n      PREVIEW_3D(node) {\n        const widget = new ComponentWidgetImpl({\n          node,\n          name: inputSpec.name,\n          component: Load3D,\n          inputSpec,\n          options: {}\n        })\n\n        widget.type = 'load3D'\n\n        addWidget(node, widget)\n\n        return { widget }\n      }\n    }\n  },\n\n  getNodeMenuItems(node: LGraphNode): (IContextMenuValue | null)[] {\n    // Only show menu items for SaveGLB nodes\n    if (node.constructor.comfyClass !== 'SaveGLB') return []\n\n    const load3d = useLoad3dService().getLoad3d(node)\n    if (!load3d) return []\n\n    if (load3d.isSplatModel()) return []\n\n    return createExportMenuItems(load3d)\n  },\n\n  async nodeCreated(node) {\n    if (node.constructor.comfyClass !== 'SaveGLB') return\n\n    const [oldWidth, oldHeight] = node.size\n\n    node.setSize([Math.max(oldWidth, 400), Math.max(oldHeight, 550)])\n\n    await nextTick()\n\n    const onExecuted = node.onExecuted\n\n    node.onExecuted = function (message: any) {\n      onExecuted?.apply(this, arguments as any)\n\n      const fileInfo = message['3d'][0]\n\n      useLoad3d(node).waitForLoad3d((load3d) => {\n        const modelWidget = node.widgets?.find((w) => w.name === 'image')\n\n        if (load3d && modelWidget) {\n          const filePath = fileInfo['subfolder'] + '/' + fileInfo['filename']\n\n          modelWidget.value = filePath\n\n          const config = new Load3DConfiguration(load3d, node.properties)\n\n          config.configureForSaveMesh(fileInfo['type'], filePath)\n        }\n      })\n    }\n  }\n})\n","import type { LGraphCanvas, Rectangle } from '@/lib/litegraph/src/litegraph'\nimport { createBounds } from '@/lib/litegraph/src/litegraph'\nimport { app } from '@/scripts/app'\n\n/**\n * Draws a dashed border around selected items that maintains constant pixel size\n * regardless of zoom level, similar to the DOM selection overlay.\n */\nfunction drawSelectionBorder(\n  ctx: CanvasRenderingContext2D,\n  canvas: LGraphCanvas\n) {\n  const selectedItems = canvas.selectedItems\n\n  // Only draw if multiple items selected\n  if (selectedItems.size <= 1) return\n\n  // Use the same bounds calculation as the toolbox\n  const bounds = createBounds(selectedItems, 10)\n  if (!bounds) return\n\n  const [x, y, width, height] = bounds\n\n  // Save context state\n  ctx.save()\n\n  // Set up dashed line style that doesn't scale with zoom\n  const borderWidth = 2 / canvas.ds.scale // Constant 2px regardless of zoom\n  ctx.lineWidth = borderWidth\n  ctx.strokeStyle =\n    getComputedStyle(document.documentElement)\n      .getPropertyValue('--border-color')\n      .trim() || '#ffffff66'\n\n  // Create dash pattern that maintains visual size\n  const dashSize = 5 / canvas.ds.scale\n  ctx.setLineDash([dashSize, dashSize])\n\n  // Draw the border using the bounds directly\n  ctx.beginPath()\n  ctx.roundRect(x, y, width, height, 8 / canvas.ds.scale)\n  ctx.stroke()\n\n  // Restore context\n  ctx.restore()\n}\n\n/**\n * Extension that adds a dashed selection border for multiple selected nodes\n */\nconst ext = {\n  name: 'Comfy.SelectionBorder',\n\n  async init() {\n    // Hook into the canvas drawing\n    const originalDrawForeground = app.canvas.onDrawForeground\n\n    app.canvas.onDrawForeground = function (\n      ctx: CanvasRenderingContext2D,\n      visibleArea: Rectangle\n    ) {\n      // Call original if it exists\n      originalDrawForeground?.call(this, ctx, visibleArea)\n\n      // Draw our selection border\n      drawSelectionBorder(ctx, app.canvas)\n    }\n  }\n}\n\napp.registerExtension(ext)\n","import { LGraphCanvas, LiteGraph } from '@/lib/litegraph/src/litegraph'\n\nimport { app } from '@/scripts/app'\n\nlet touchZooming = false\nlet touchCount = 0\n\napp.registerExtension({\n  name: 'Comfy.SimpleTouchSupport',\n  setup() {\n    let touchDist: number | null = null\n    let touchTime: Date | null = null\n    let lastTouch: { clientX: number; clientY: number } | null = null\n    let lastScale: number | null = null\n    function getMultiTouchPos(e: TouchEvent) {\n      return Math.hypot(\n        e.touches[0].clientX - e.touches[1].clientX,\n        e.touches[0].clientY - e.touches[1].clientY\n      )\n    }\n\n    function getMultiTouchCenter(e: TouchEvent) {\n      return {\n        clientX: (e.touches[0].clientX + e.touches[1].clientX) / 2,\n        clientY: (e.touches[0].clientY + e.touches[1].clientY) / 2\n      }\n    }\n\n    app.canvasEl.parentElement?.addEventListener(\n      'touchstart',\n      (e: TouchEvent) => {\n        touchCount += e.changedTouches.length\n\n        lastTouch = null\n        lastScale = null\n        if (e.touches?.length === 1) {\n          // Store start time for press+hold for context menu\n          touchTime = new Date()\n          lastTouch = e.touches[0]\n        } else {\n          touchTime = null\n          if (e.touches?.length === 2) {\n            // Store center pos for zoom\n            lastScale = app.canvas.ds.scale\n            lastTouch = getMultiTouchCenter(e)\n\n            touchDist = getMultiTouchPos(e)\n            app.canvas.pointer.isDown = false\n          }\n        }\n      },\n      true\n    )\n\n    app.canvasEl.parentElement?.addEventListener(\n      'touchend',\n      (e: TouchEvent) => {\n        touchCount -= e.changedTouches.length\n\n        if (e.touches?.length !== 1) touchZooming = false\n        if (touchTime && !e.touches?.length) {\n          if (new Date().getTime() - touchTime.getTime() > 600) {\n            if (e.target === app.canvasEl) {\n              const touch = {\n                button: 2, // Right click\n                clientX: e.changedTouches[0].clientX,\n                clientY: e.changedTouches[0].clientY,\n                pointerId: 1, // changedTouches' id is 0, set it to any number\n                isPrimary: true // changedTouches' isPrimary is false, so set it to true\n              }\n              // context menu info set in 'pointerdown' event\n              app.canvasEl.dispatchEvent(new PointerEvent('pointerdown', touch))\n              // then, context menu open after 'pointerup' event\n              setTimeout(() => {\n                app.canvasEl.dispatchEvent(new PointerEvent('pointerup', touch))\n              })\n              e.preventDefault()\n            }\n          }\n          touchTime = null\n        }\n      }\n    )\n\n    const resetTouchState = () => {\n      touchCount = 0\n      touchZooming = false\n      touchTime = null\n      lastTouch = null\n      lastScale = null\n      touchDist = null\n    }\n\n    // Reset touch state when page loses visibility (e.g., switching apps on iPad)\n    // This prevents touchCount from getting stuck when touchend events are missed\n    document.addEventListener('visibilitychange', () => {\n      if (document.hidden) {\n        resetTouchState()\n      }\n    })\n\n    // Also handle touchcancel which fires when touch is interrupted\n    app.canvasEl.parentElement?.addEventListener('touchcancel', resetTouchState)\n\n    app.canvasEl.parentElement?.addEventListener(\n      'touchmove',\n      (e) => {\n        // make a threshold for touchmove to prevent clear touchTime for long press\n        if (touchTime && lastTouch && e.touches?.length === 1) {\n          const onlyTouch = e.touches[0]\n          const deltaX = onlyTouch.clientX - lastTouch.clientX\n          const deltaY = onlyTouch.clientY - lastTouch.clientY\n          if (deltaX * deltaX + deltaY * deltaY > 30) {\n            touchTime = null\n          }\n        }\n        if (e.touches?.length === 2 && lastTouch && !e.ctrlKey && !e.shiftKey) {\n          e.preventDefault() // Prevent browser from zooming when two textareas are touched\n          app.canvas.pointer.isDown = false\n          touchZooming = true\n\n          LiteGraph.closeAllContextMenus(window)\n          // @ts-expect-error\n          app.canvas.search_box?.close()\n          const newTouchDist = getMultiTouchPos(e)\n\n          const center = getMultiTouchCenter(e)\n\n          if (lastScale === null || touchDist === null) return\n          let scale = (lastScale * newTouchDist) / touchDist\n\n          const newX = (center.clientX - lastTouch.clientX) / scale\n          const newY = (center.clientY - lastTouch.clientY) / scale\n\n          // Code from LiteGraph\n          if (scale < app.canvas.ds.min_scale) {\n            scale = app.canvas.ds.min_scale\n          } else if (scale > app.canvas.ds.max_scale) {\n            scale = app.canvas.ds.max_scale\n          }\n\n          const oldScale = app.canvas.ds.scale\n\n          app.canvas.ds.scale = scale\n\n          // Code from LiteGraph\n          if (Math.abs(app.canvas.ds.scale - 1) < 0.01) {\n            app.canvas.ds.scale = 1\n          }\n\n          const newScale = app.canvas.ds.scale\n\n          const convertScaleToOffset = (scale: number) => [\n            center.clientX / scale - app.canvas.ds.offset[0],\n            center.clientY / scale - app.canvas.ds.offset[1]\n          ]\n          var oldCenter = convertScaleToOffset(oldScale)\n          var newCenter = convertScaleToOffset(newScale)\n\n          app.canvas.ds.offset[0] += newX + newCenter[0] - oldCenter[0]\n          app.canvas.ds.offset[1] += newY + newCenter[1] - oldCenter[1]\n\n          lastTouch.clientX = center.clientX\n          lastTouch.clientY = center.clientY\n\n          app.canvas.setDirty(true, true)\n        }\n      },\n      true\n    )\n  }\n})\n\nconst processMouseDown = LGraphCanvas.prototype.processMouseDown\nLGraphCanvas.prototype.processMouseDown = function (e: PointerEvent) {\n  if (touchZooming || touchCount) {\n    return\n  }\n  app.canvas.pointer.isDown = false // Prevent context menu from opening on second tap\n  return processMouseDown.apply(this, [e])\n}\n\nconst processMouseMove = LGraphCanvas.prototype.processMouseMove\nLGraphCanvas.prototype.processMouseMove = function (e: PointerEvent) {\n  if (touchZooming || touchCount > 1) {\n    return\n  }\n  return processMouseMove.apply(this, [e])\n}\n","import { LiteGraph } from '@/lib/litegraph/src/litegraph'\n\nimport { app } from '../../scripts/app'\nimport { ComfyWidgets } from '../../scripts/widgets'\n\n// Adds defaults for quickly adding nodes with middle click on the input/output\n\napp.registerExtension({\n  name: 'Comfy.SlotDefaults',\n  suggestionsNumber: null,\n  init() {\n    LiteGraph.search_filter_enabled = true\n    LiteGraph.middle_click_slot_add_default_node = true\n    this.suggestionsNumber = app.ui.settings.addSetting({\n      id: 'Comfy.NodeSuggestions.number',\n      category: ['Comfy', 'Node Search Box', 'NodeSuggestions'],\n      name: 'Number of nodes suggestions',\n      tooltip: 'Only for litegraph searchbox/context menu',\n      type: 'slider',\n      attrs: {\n        min: 1,\n        max: 100,\n        step: 1\n      },\n      defaultValue: 5,\n      onChange: (newVal) => {\n        this.setDefaults(newVal)\n      }\n    })\n  },\n  slot_types_default_out: {},\n  slot_types_default_in: {},\n  async beforeRegisterNodeDef(nodeType, nodeData) {\n    var nodeId = nodeData.name\n    const inputs = nodeData['input']?.['required'] //only show required inputs to reduce the mess also not logical to create node with optional inputs\n    for (const inputKey in inputs) {\n      var input = inputs[inputKey]\n      if (typeof input[0] !== 'string') continue\n\n      var type = input[0]\n      if (type in ComfyWidgets) {\n        var customProperties = input[1]\n        if (!customProperties?.forceInput) continue //ignore widgets that don't force input\n      }\n\n      if (!(type in this.slot_types_default_out)) {\n        this.slot_types_default_out[type] = ['Reroute']\n      }\n      if (this.slot_types_default_out[type].includes(nodeId)) continue\n      this.slot_types_default_out[type].push(nodeId)\n\n      // Input types have to be stored as lower case\n      // Store each node that can handle this input type\n      const lowerType = type.toLocaleLowerCase()\n      if (!(lowerType in LiteGraph.registered_slot_in_types)) {\n        LiteGraph.registered_slot_in_types[lowerType] = { nodes: [] }\n      }\n      LiteGraph.registered_slot_in_types[lowerType].nodes.push(\n        // @ts-expect-error ComfyNode\n        nodeType.comfyClass\n      )\n    }\n\n    var outputs = nodeData['output'] ?? []\n    for (const el of outputs) {\n      const type = el as string\n      if (!(type in this.slot_types_default_in)) {\n        this.slot_types_default_in[type] = ['Reroute']\n      }\n\n      if (this.slot_types_default_in[type].includes(nodeId)) continue\n      this.slot_types_default_in[type].push(nodeId)\n\n      // Store each node that can handle this output type\n      if (!(type in LiteGraph.registered_slot_out_types)) {\n        LiteGraph.registered_slot_out_types[type] = { nodes: [] }\n      }\n      // @ts-expect-error ComfyNode\n      LiteGraph.registered_slot_out_types[type].nodes.push(nodeType.comfyClass)\n\n      if (!LiteGraph.slot_types_out.includes(type)) {\n        LiteGraph.slot_types_out.push(type)\n      }\n    }\n\n    var maxNum = this.suggestionsNumber.value\n    this.setDefaults(maxNum)\n  },\n  setDefaults(maxNum?: number | null) {\n    LiteGraph.slot_types_default_out = {}\n    LiteGraph.slot_types_default_in = {}\n\n    for (const type in this.slot_types_default_out) {\n      LiteGraph.slot_types_default_out[type] = this.slot_types_default_out[\n        type\n      ].slice(0, maxNum)\n    }\n    for (const type in this.slot_types_default_in) {\n      LiteGraph.slot_types_default_in[type] = this.slot_types_default_in[\n        type\n      ].slice(0, maxNum)\n    }\n  }\n})\n","import { MediaRecorder as ExtendableMediaRecorder } from 'extendable-media-recorder'\n\nimport { useChainCallback } from '@/composables/functional/useChainCallback'\nimport { useNodeDragAndDrop } from '@/composables/node/useNodeDragAndDrop'\nimport { useNodeFileInput } from '@/composables/node/useNodeFileInput'\nimport { useNodePaste } from '@/composables/node/useNodePaste'\nimport { t } from '@/i18n'\nimport type { LGraphNode } from '@/lib/litegraph/src/litegraph'\nimport type {\n  IBaseWidget,\n  IStringWidget\n} from '@/lib/litegraph/src/types/widgets'\nimport { useToastStore } from '@/platform/updates/common/toastStore'\nimport {\n  getResourceURL,\n  splitFilePath\n} from '@/renderer/extensions/vueNodes/widgets/utils/audioUtils'\nimport type { ComfyNodeDef } from '@/schemas/nodeDefSchema'\nimport type { DOMWidget } from '@/scripts/domWidget'\nimport { useAudioService } from '@/services/audioService'\nimport { type NodeLocatorId } from '@/types'\nimport { getNodeByLocatorId } from '@/utils/graphTraversalUtil'\n\nimport { api } from '../../scripts/api'\nimport { app } from '../../scripts/app'\n\nasync function uploadFile(\n  audioWidget: IStringWidget,\n  audioUIWidget: DOMWidget<HTMLAudioElement, string>,\n  file: File,\n  updateNode: boolean,\n  pasted: boolean = false\n) {\n  try {\n    // Wrap file in formdata so it includes filename\n    const body = new FormData()\n    body.append('image', file)\n    if (pasted) body.append('subfolder', 'pasted')\n    const resp = await api.fetchApi('/upload/image', {\n      method: 'POST',\n      body\n    })\n\n    if (resp.status === 200) {\n      const data = await resp.json()\n      // Add the file to the dropdown list and update the widget value\n      let path = data.name\n      if (data.subfolder) path = data.subfolder + '/' + path\n\n      // @ts-expect-error fixme ts strict error\n      if (!audioWidget.options.values.includes(path)) {\n        // @ts-expect-error fixme ts strict error\n        audioWidget.options.values.push(path)\n      }\n\n      if (updateNode) {\n        audioUIWidget.element.src = api.apiURL(\n          getResourceURL(...splitFilePath(path))\n        )\n        audioWidget.value = path\n\n        // Manually trigger the callback to update VueNodes\n        audioWidget.callback?.(path)\n      }\n    } else {\n      useToastStore().addAlert(resp.status + ' - ' + resp.statusText)\n    }\n  } catch (error) {\n    // @ts-expect-error fixme ts strict error\n    useToastStore().addAlert(error)\n  }\n}\n\n// AudioWidget MUST be registered first, as AUDIOUPLOAD depends on AUDIO_UI to be\n// present.\napp.registerExtension({\n  name: 'Comfy.AudioWidget',\n  async beforeRegisterNodeDef(nodeType, nodeData) {\n    if (\n      [\n        'LoadAudio',\n        'SaveAudio',\n        'PreviewAudio',\n        'SaveAudioMP3',\n        'SaveAudioOpus'\n      ].includes(\n        // @ts-expect-error fixme ts strict error\n        nodeType.prototype.comfyClass\n      )\n    ) {\n      // @ts-expect-error fixme ts strict error\n      nodeData.input.required.audioUI = ['AUDIO_UI', {}]\n    }\n  },\n  getCustomWidgets() {\n    return {\n      AUDIO_UI(node: LGraphNode, inputName: string) {\n        const audio = document.createElement('audio')\n        audio.controls = true\n        audio.classList.add('comfy-audio')\n        audio.setAttribute('name', 'media')\n\n        const audioUIWidget: DOMWidget<HTMLAudioElement, string> =\n          node.addDOMWidget(inputName, /* name=*/ 'audioUI', audio)\n        audioUIWidget.serialize = false\n        const { nodeData } = node.constructor\n        if (nodeData == null) throw new TypeError('nodeData is null')\n\n        const isOutputNode = nodeData.output_node\n        if (isOutputNode) {\n          // Hide the audio widget when there is no audio initially.\n          audioUIWidget.element.classList.add('empty-audio-widget')\n          // Populate the audio widget UI on node execution.\n          const onExecuted = node.onExecuted\n          node.onExecuted = function (message: any) {\n            // @ts-expect-error fixme ts strict error\n            onExecuted?.apply(this, arguments)\n            const audios = message.audio\n            if (!audios) return\n            const audio = audios[0]\n            audioUIWidget.element.src = api.apiURL(\n              getResourceURL(audio.subfolder, audio.filename, audio.type)\n            )\n            audioUIWidget.element.classList.remove('empty-audio-widget')\n          }\n        }\n\n        audioUIWidget.onRemove = useChainCallback(\n          audioUIWidget.onRemove,\n          () => {\n            if (!audioUIWidget.element) return\n            audioUIWidget.element.pause()\n            audioUIWidget.element.src = ''\n            audioUIWidget.element.remove()\n          }\n        )\n\n        return { widget: audioUIWidget }\n      }\n    }\n  },\n  onNodeOutputsUpdated(nodeOutputs: Record<NodeLocatorId, any>) {\n    for (const [nodeLocatorId, output] of Object.entries(nodeOutputs)) {\n      if ('audio' in output) {\n        const node = getNodeByLocatorId(app.rootGraph, nodeLocatorId)\n        if (!node) continue\n\n        // @ts-expect-error fixme ts strict error\n        const audioUIWidget = node.widgets.find(\n          (w) => w.name === 'audioUI'\n        ) as unknown as DOMWidget<HTMLAudioElement, string>\n        const audio = output.audio[0]\n        audioUIWidget.element.src = api.apiURL(\n          getResourceURL(audio.subfolder, audio.filename, audio.type)\n        )\n        audioUIWidget.element.classList.remove('empty-audio-widget')\n      }\n    }\n  }\n})\n\napp.registerExtension({\n  name: 'Comfy.UploadAudio',\n  async beforeRegisterNodeDef(_nodeType, nodeData: ComfyNodeDef) {\n    if (nodeData?.input?.required?.audio?.[1]?.audio_upload === true) {\n      nodeData.input.required.upload = ['AUDIOUPLOAD', {}]\n    }\n  },\n  getCustomWidgets() {\n    return {\n      AUDIOUPLOAD(node, inputName: string) {\n        // The widget that allows user to select file.\n        // @ts-expect-error fixme ts strict error\n        const audioWidget = node.widgets.find(\n          (w) => w.name === 'audio'\n        ) as IStringWidget\n        // @ts-expect-error fixme ts strict error\n        const audioUIWidget = node.widgets.find(\n          (w) => w.name === 'audioUI'\n        ) as unknown as DOMWidget<HTMLAudioElement, string>\n        audioUIWidget.options.canvasOnly = true\n\n        const onAudioWidgetUpdate = () => {\n          if (typeof audioWidget.value !== 'string') return\n          audioUIWidget.element.src = api.apiURL(\n            getResourceURL(...splitFilePath(audioWidget.value))\n          )\n        }\n        // Initially load default audio file to audioUIWidget.\n        if (audioWidget.value) {\n          onAudioWidgetUpdate()\n        }\n        audioWidget.callback = onAudioWidgetUpdate\n\n        // Load saved audio file widget values if restoring from workflow\n        const onGraphConfigured = node.onGraphConfigured\n        node.onGraphConfigured = function () {\n          // @ts-expect-error fixme ts strict error\n          onGraphConfigured?.apply(this, arguments)\n          if (audioWidget.value) {\n            onAudioWidgetUpdate()\n          }\n        }\n\n        const handleUpload = async (files: File[]) => {\n          if (files?.length) {\n            uploadFile(audioWidget, audioUIWidget, files[0], true)\n          }\n          return files\n        }\n\n        const isAudioFile = (file: File) => file.type.startsWith('audio/')\n\n        const { openFileSelection } = useNodeFileInput(node, {\n          accept: 'audio/*',\n          onSelect: handleUpload\n        })\n\n        // The widget to pop up the upload dialog.\n        const uploadWidget = node.addWidget(\n          'button',\n          inputName,\n          '',\n          openFileSelection,\n          { serialize: false, canvasOnly: true }\n        )\n        uploadWidget.label = t('g.choose_file_to_upload')\n\n        useNodeDragAndDrop(node, {\n          fileFilter: isAudioFile,\n          onDrop: handleUpload\n        })\n\n        useNodePaste(node, {\n          fileFilter: isAudioFile,\n          onPaste: handleUpload\n        })\n\n        node.previewMediaType = 'audio'\n\n        return { widget: uploadWidget }\n      }\n    }\n  }\n})\n\napp.registerExtension({\n  name: 'Comfy.RecordAudio',\n\n  getCustomWidgets() {\n    return {\n      AUDIO_RECORD(node, inputName: string) {\n        const audio = document.createElement('audio')\n        audio.controls = true\n        audio.classList.add('comfy-audio')\n        audio.setAttribute('name', 'media')\n        const audioUIWidget: DOMWidget<HTMLAudioElement, string> =\n          node.addDOMWidget(inputName, /* name=*/ 'audioUI', audio)\n        audioUIWidget.options.canvasOnly = false\n\n        let mediaRecorder: MediaRecorder | null = null\n        let isRecording = false\n        let audioChunks: Blob[] = []\n        let currentStream: MediaStream | null = null\n        let recordWidget: IBaseWidget | null = null\n\n        let stopPromise: Promise<void> | null = null\n        let stopResolve: (() => void) | null = null\n\n        audioUIWidget.serializeValue = async () => {\n          if (isRecording && mediaRecorder) {\n            stopPromise = new Promise((resolve) => {\n              stopResolve = resolve\n            })\n\n            mediaRecorder.stop()\n\n            await stopPromise\n          }\n\n          const audioSrc = audioUIWidget.element.src\n\n          if (!audioSrc) {\n            useToastStore().addAlert(t('g.noAudioRecorded'))\n            return ''\n          }\n\n          const blob = await fetch(audioSrc).then((r) => r.blob())\n\n          return await useAudioService().convertBlobToFileAndSubmit(blob)\n        }\n\n        recordWidget = node.addWidget(\n          'button',\n          inputName,\n          '',\n          async () => {\n            if (!isRecording) {\n              try {\n                currentStream = await navigator.mediaDevices.getUserMedia({\n                  audio: true\n                })\n\n                mediaRecorder = new ExtendableMediaRecorder(currentStream, {\n                  mimeType: 'audio/wav'\n                }) as unknown as MediaRecorder\n\n                audioChunks = []\n\n                mediaRecorder.ondataavailable = (event) => {\n                  audioChunks.push(event.data)\n                }\n\n                mediaRecorder.onstop = async () => {\n                  const audioBlob = new Blob(audioChunks, { type: 'audio/wav' })\n\n                  useAudioService().stopAllTracks(currentStream)\n\n                  if (\n                    audioUIWidget.element.src &&\n                    audioUIWidget.element.src.startsWith('blob:')\n                  ) {\n                    URL.revokeObjectURL(audioUIWidget.element.src)\n                  }\n\n                  audioUIWidget.element.src = URL.createObjectURL(audioBlob)\n\n                  isRecording = false\n\n                  if (recordWidget) {\n                    recordWidget.label = t('g.startRecording')\n                  }\n\n                  if (stopResolve) {\n                    stopResolve()\n                    stopResolve = null\n                    stopPromise = null\n                  }\n                }\n\n                mediaRecorder.onerror = (event) => {\n                  console.error('MediaRecorder error:', event)\n                  useAudioService().stopAllTracks(currentStream)\n                  isRecording = false\n\n                  if (recordWidget) {\n                    recordWidget.label = t('g.startRecording')\n                  }\n\n                  if (stopResolve) {\n                    stopResolve()\n                    stopResolve = null\n                    stopPromise = null\n                  }\n                }\n\n                mediaRecorder.start()\n                isRecording = true\n                if (recordWidget) {\n                  recordWidget.label = t('g.stopRecording')\n                }\n              } catch (err) {\n                console.error('Error accessing microphone:', err)\n                useToastStore().addAlert(t('g.micPermissionDenied'))\n\n                if (mediaRecorder) {\n                  try {\n                    mediaRecorder.stop()\n                  } catch {}\n                }\n                useAudioService().stopAllTracks(currentStream)\n                currentStream = null\n                isRecording = false\n                if (recordWidget) {\n                  recordWidget.label = t('g.startRecording')\n                }\n              }\n            } else if (mediaRecorder && isRecording) {\n              mediaRecorder.stop()\n            }\n          },\n          { serialize: false, canvasOnly: false }\n        )\n\n        recordWidget.label = t('g.startRecording')\n        // Override the type for Vue rendering while keeping 'button' for LiteGraph\n        recordWidget.type = 'audiorecord'\n\n        const originalOnRemoved = node.onRemoved\n        node.onRemoved = function () {\n          if (isRecording && mediaRecorder) {\n            mediaRecorder.stop()\n          }\n          useAudioService().stopAllTracks(currentStream)\n          if (audioUIWidget.element.src?.startsWith('blob:')) {\n            URL.revokeObjectURL(audioUIWidget.element.src)\n          }\n          originalOnRemoved?.call(this)\n        }\n\n        return { widget: recordWidget }\n      }\n    }\n  },\n\n  async nodeCreated(node) {\n    if (node.constructor.comfyClass !== 'RecordAudio') return\n\n    await useAudioService().registerWavEncoder()\n  }\n})\n","import {\n  type ComfyNodeDef,\n  type InputSpec,\n  isComboInputSpecV1\n} from '@/schemas/nodeDefSchema'\n\nimport { app } from '../../scripts/app'\n\n// Adds an upload button to the nodes\n\nconst isMediaUploadComboInput = (inputSpec: InputSpec) => {\n  const [inputName, inputOptions] = inputSpec\n  if (!inputOptions) return false\n\n  const isUploadInput =\n    inputOptions['image_upload'] === true ||\n    inputOptions['video_upload'] === true ||\n    inputOptions['animated_image_upload'] === true\n\n  return (\n    isUploadInput && (isComboInputSpecV1(inputSpec) || inputName === 'COMBO')\n  )\n}\n\nconst createUploadInput = (\n  imageInputName: string,\n  imageInputOptions: InputSpec\n): InputSpec => [\n  'IMAGEUPLOAD',\n  {\n    ...imageInputOptions[1],\n    imageInputName\n  }\n]\n\napp.registerExtension({\n  name: 'Comfy.UploadImage',\n  beforeRegisterNodeDef(_nodeType, nodeData: ComfyNodeDef) {\n    const { input } = nodeData ?? {}\n    const { required } = input ?? {}\n    if (!required) return\n\n    const found = Object.entries(required).find(([_, input]) =>\n      isMediaUploadComboInput(input)\n    )\n\n    // If media combo input found, attach upload input\n    if (found) {\n      const [inputName, inputSpec] = found\n      required.upload = createUploadInput(inputName, inputSpec)\n    }\n  }\n})\n","import { t } from '@/i18n'\nimport { useToastStore } from '@/platform/updates/common/toastStore'\n\nimport { api } from '../../scripts/api'\nimport { app } from '../../scripts/app'\n\nconst WEBCAM_READY = Symbol()\n\napp.registerExtension({\n  name: 'Comfy.WebcamCapture',\n  getCustomWidgets() {\n    return {\n      WEBCAM(node, inputName) {\n        // @ts-expect-error fixme ts strict error\n        let res\n        // @ts-expect-error fixme ts strict error\n        node[WEBCAM_READY] = new Promise((resolve) => (res = resolve))\n\n        const container = document.createElement('div')\n        container.style.background = 'rgba(0,0,0,0.25)'\n        container.style.textAlign = 'center'\n\n        const video = document.createElement('video')\n        video.style.height = video.style.width = '100%'\n\n        const loadVideo = async () => {\n          try {\n            const stream = await navigator.mediaDevices.getUserMedia({\n              video: true,\n              audio: false\n            })\n            container.replaceChildren(video)\n\n            // @ts-expect-error fixme ts strict error\n            setTimeout(() => res(video), 500) // Fallback as loadedmetadata doesnt fire sometimes?\n            // @ts-expect-error fixme ts strict error\n            video.addEventListener('loadedmetadata', () => res(video), false)\n            video.srcObject = stream\n            video.play()\n          } catch (error) {\n            const label = document.createElement('div')\n            label.style.color = 'red'\n            label.style.overflow = 'auto'\n            label.style.maxHeight = '100%'\n            label.style.whiteSpace = 'pre-wrap'\n\n            if (window.isSecureContext) {\n              label.textContent =\n                'Unable to load webcam, please ensure access is granted:\\n' +\n                // @ts-expect-error fixme ts strict error\n                error.message\n            } else {\n              label.textContent =\n                'Unable to load webcam. A secure context is required, if you are not accessing ComfyUI on localhost (127.0.0.1) you will have to enable TLS (https)\\n\\n' +\n                // @ts-expect-error fixme ts strict error\n                error.message\n            }\n\n            container.replaceChildren(label)\n          }\n        }\n\n        loadVideo()\n\n        return { widget: node.addDOMWidget(inputName, 'WEBCAM', container) }\n      }\n    }\n  },\n  nodeCreated(node) {\n    if ((node.type, node.constructor.comfyClass !== 'WebcamCapture')) return\n\n    // @ts-expect-error fixme ts strict error\n    let video\n    // @ts-expect-error fixme ts strict error\n    const camera = node.widgets.find((w) => w.name === 'image')\n    // @ts-expect-error fixme ts strict error\n    const w = node.widgets.find((w) => w.name === 'width')\n    // @ts-expect-error fixme ts strict error\n    const h = node.widgets.find((w) => w.name === 'height')\n    // @ts-expect-error fixme ts strict error\n    const captureOnQueue = node.widgets.find(\n      (w) => w.name === 'capture_on_queue'\n    )\n\n    const canvas = document.createElement('canvas')\n\n    const capture = () => {\n      // @ts-expect-error widget value type narrow down\n      canvas.width = w.value\n      // @ts-expect-error widget value type narrow down\n      canvas.height = h.value\n      const ctx = canvas.getContext('2d')\n      // @ts-expect-error widget value type narrow down\n      ctx.drawImage(video, 0, 0, w.value, h.value)\n      const data = canvas.toDataURL('image/png')\n\n      const img = new Image()\n      img.onload = () => {\n        node.imgs = [img]\n        app.canvas.setDirty(true)\n      }\n      img.src = data\n    }\n\n    const btn = node.addWidget(\n      'button',\n      'waiting for camera...',\n      'capture',\n      capture,\n      { canvasOnly: true }\n    )\n    btn.disabled = true\n    btn.serializeValue = () => undefined\n\n    // @ts-expect-error fixme ts strict error\n    camera.serializeValue = async () => {\n      // @ts-expect-error fixme ts strict error\n      if (captureOnQueue.value) {\n        capture()\n      } else if (!node.imgs?.length) {\n        const err = `No webcam image captured`\n        useToastStore().addAlert(err)\n        throw new Error(err)\n      }\n\n      // Upload image to temp storage\n      // @ts-expect-error fixme ts strict error\n      const blob = await new Promise<Blob>((r) => canvas.toBlob(r))\n      const name = `${+new Date()}.png`\n      const file = new File([blob], name)\n      const body = new FormData()\n      body.append('image', file)\n      body.append('subfolder', 'webcam')\n      body.append('type', 'temp')\n      const resp = await api.fetchApi('/upload/image', {\n        method: 'POST',\n        body\n      })\n      if (resp.status !== 200) {\n        const err = `Error uploading camera image: ${resp.status} - ${resp.statusText}`\n        useToastStore().addAlert(err)\n        throw new Error(err)\n      }\n      return `webcam/${name} [temp]`\n    }\n\n    // @ts-expect-error fixme ts strict error\n    node[WEBCAM_READY].then((v) => {\n      video = v\n      // If width isn't specified then use video output resolution\n      // @ts-expect-error fixme ts strict error\n      if (!w.value) {\n        // @ts-expect-error fixme ts strict error\n        w.value = video.videoWidth || 640\n        // @ts-expect-error fixme ts strict error\n        h.value = video.videoHeight || 480\n      }\n      btn.disabled = false\n      btn.label = t('g.capture')\n    })\n  }\n})\n"],"names":["ClipspaceDialog","ComfyDialog","__name","name","contextPredicate","callback","item","$el","ComfyApp","img_preview","self","children","buttons","idx","combo_items","imgs","i","combo1","event","row1","combo2","row2","td","row3","app","ext","ctxMenu","LiteGraph","values","options","ctx","filter","items","displayedItems","itemCount","clickedComboValue","LGraphCanvas","w","isComboWidget","v","selectedIndex","selectedItem","updateSelected","positionList","scale","shift","term","isVisible","d","top","bodyRect","rootRect","applyToGraph","extraLinks","links","l","linkInfo","node","input","widgetName","widget","onNodeCreated","useChainCallback","comboWidget","shallowReactive","updateCombo","addOption","newCount","value","lastWidget","nodeType","nodeData","useExtensionService","widgets","workflowNode","widgetIndex","prompt","processDynamicPrompt","editAttentionDelta","incrementWeight","weight","delta","floatWeight","newWeight","findNearestEnclosure","text","cursorPos","start","end","openCount","closeCount","addWeightToParentheses","parenRegex","parenMatch","floatRegex","floatMatch","editAttention","inputField","selectedText","nearestEnclosure","delimiters","weightDelta","updatedText","_","PYTHON_MIRROR","checkMirrorReachable","mirror","isValidUrl","electronAPI","isElectron","getElectronAPI","desktopAppVersion","workflowStore","useWorkflowStore","toastStore","useToastStore","staticUrls","buildDocsUrl","useExternalLink","onChangeRestartApp","newValue","oldValue","updateInfo","t","useDialogService","error","log","ExecutableGroupNodeChildDTO","ExecutableNodeDTO","subgraphNodePath","nodesByExecutionId","subgraphNode","groupNodeHandler","slot","inputNode","link","inputNodeId","inputNodeDto","id","ORDER","merge","target","source","key","sv","tv","ManageGroupDialog","tab","index","force","PREFIX","SEPARATOR","GroupNodeHandler","group","reset","nodes","n","ordered","DraggableList","oldPosition","newPosition","props","nodeIndex","section","prop","groupMod","nodesMod","nodeMod","typeMod","objMod","placeholder","checked","checkable","mods","e","config","oldName","inputs","innerNodeDef","outputs","groupOutputs","type","groupOutputIndex","visible","groupNodes","a","b","pages","p","page","outer","g","nodesByType","recreateNodes","types","nodeMods","keys","orderedNodes","orderedMods","orderedConfig","order","GroupNodeConfig","IGNORE_KEYS","getRange","min","max","mergeNumericInputSpec","spec1","spec2","options1","options2","range1","range2","step1","step2","mergedOptions","lcm","mergeCommonInputSpec","mergeComboInputSpec","comboOptions1","getComboSpecComboOptions","comboOptions2","intersection","getInputSpecType","value1","value2","mergeInputSpec","type1","type2","isIntInputSpec","isFloatInputSpec","isComboInputSpec","isPrimitiveNode","replacePropertyName","PrimitiveNode","LGraphNode","title","applyTextReplacements","GET_CONFIG","#onFirstConnection","#mergeWidgetConfig","_type","_index","connected","target_node","target_slot","ComfyWidgets","valid","#isValidConnection","recreating","linkId","theirNode","getWidgetType","#createWidget","CONFIG","inputData","oldWidth","oldHeight","isValidWidgetType","theirWidget","control_value","addValueControlWidgets","controlValues","sz","#removeWidgets","output","hasConfig","config1","theirInput","forceUpdate","config2","mergeIfValid","getWidgetConfig","getConfig","convertToInput","setWidgetConfig","NodeSlot","graph","originNode","recreateWidget","customSpec","_nodeData","origOnInputDblClick","args","pos","Workflow","data","extra","GroupNodeBuilder","nodesInOrder","storeLinkTypes","storeExternalLinks","hasExternal","serialised","serialise","GROUP","seenInputs","seenOutputs","#convertedToProcess","useNodeDefStore","sourceNodeId","sourceNodeSlot","targetNodeId","targetNodeSlot","srcId","srcSlot","tgtId","tgtSlot","nodeIdx","slotIdx","typeVal","def","globalDefs","linksFrom","fromTypeName","fromType","inputType","linksTo","rerouteType","targetNode","targetDef","targetWidget","widgetSpec","outputType","linkType","inputName","customConfig","inp","prefix","configOptions","widgetKey","configObj","inputNames","slots","converted","widgetMap","inputSpec","useWidgetStore","convertedIndex","linkSourceIdx","primitiveDef","primitiveConfig","inputConfig","toPrimitive","existing","toWidget","inputMap","convertedSlots","k","inputMapping","oldToNew","defOutput","outputId","hasLink","label","outputVal","o","missingNodeTypes","groupData","hasMissing","innerNodes","innerNodeIndex","innerNode","externalSlot","innerLink","linkSrcIdx","existingLink","computedNodeDtos","visited","createdNodes","subgraphInstanceIdPath","currentId","aVeryRealNode","groupNode","handler","addInnerNodes","c","ids","deserialiseAndCreate","x","y","left","selectedIds","newNodes","newNode","map","newName","srcWidget","outerWidget","newWidget","linkedWidgets","newLinked","reconnectInputs","innerInputId","groupSlotId","reconnectOutputs","groupOutputId","getExtraMenuOptions","handlerNode","_canvas","optionIndex","convertFn","manageGroupNodes","onDrawTitleBox","height","size","fill","onDrawForeground","canvas","canvasElement","progressState","useExecutionStore","message","onExecutionStart","handlerGroupData","wg","handleEvent","getId","getEvent","detail","api","executing","_d","executed","onRemoved","defs","old","newWidgetName","primitiveLinked","linked","linkedNodeId","rerouteLinks","targetSlot","_node","nodeId","primitiveId","targetWidgetName","targetWidgetIndex","primIdx","primitiveNode","len","offset","linkedShift","mainWidget","innerWidget","originalNode","newSlot","originSlot","targetId","actualOriginId","mappedSlot","instanceData","builder","res","replaceLegacySeparators","convertSelectedNodesToGroupNode","SubgraphNode","convertDisabled","selected","ungroupSelectedGroupNodes","convertEnabled","groups","manageDisabled","graphData","setNodeMode","mode","addNodesToGroup","padding","useSettingStore","LGraphGroup","nodesInGroup","allNodesAreSameMode","onExecuted","aImages","bImages","rand","beforeUrl","afterUrl","EXPORT_FORMATS","createExportMenuItems","load3d","_value","_options","prev_menu","submenuOptions","format","Load3DConfiguration","properties","loadFolder","filePath","setting","width","onModelWidgetUpdate","modelWidget","cameraState","originalCallback","currentValue","bgImagePath","sceneConfig","cameraConfig","lightConfig","isFirstLoad","filename","modelUrl","Load3dUtils","modelConfig","pathParts","part","subfolder","inputSpecLoad3D","inputSpecPreview3D","handleModelUpload","files","resourceFolder","uploadPath","useLoad3d","handleResourcesUpload","createFileInput","accept","multiple","selectedNodes","selectedNode","isLoad3dNode","useDialogStore","Load3DViewerContent","useLoad3dService","fileInput","resourcesInput","ComponentWidgetImpl","Load3D","addWidget","nextTick","sceneWidget","settings","currentLoad3d","nodeToLoad3dMap","imageData","maskData","normalData","dataMask","dataNormal","returnVal","recordingData","recording","_nodeType","lastTimeModelFile","msg","openMaskEditor","useMaskEditor","openMaskEditorFromClipspace","isOpened","changeBrushSize","sizeChanger","store","useMaskEditorStore","oldBrushSize","newBrushSize","useCanvasTransform","file","ManageTemplates","btns","templates","reader","importFile","template","json","blob","downloadBlob","nameInput","el","prev_i","rect","row","that","manage","clipboardAction","cb","nodeIds","groupConfig","subItems","NoteNode","MarkdownNoteNode","showValueWidget","showValueWidgetPlain","showAsPlaintextWidget","previewWidgets","previewWidget","RerouteNode","cloned","linksToDisconnect","currentNode","updateNodes","nodeInput","nodeOutType","keep","displayType","color","widgetConfig","widgetType","targetInput","merged","saveNodeTypes","r","fileInfo","drawSelectionBorder","selectedItems","bounds","createBounds","borderWidth","dashSize","originalDrawForeground","visibleArea","touchZooming","touchCount","touchDist","touchTime","lastTouch","lastScale","getMultiTouchPos","getMultiTouchCenter","touch","resetTouchState","onlyTouch","deltaX","deltaY","newTouchDist","center","newX","newY","oldScale","newScale","convertScaleToOffset","oldCenter","newCenter","processMouseDown","processMouseMove","newVal","inputKey","customProperties","lowerType","maxNum","uploadFile","audioWidget","audioUIWidget","updateNode","pasted","body","resp","path","getResourceURL","splitFilePath","audio","audios","nodeOutputs","nodeLocatorId","getNodeByLocatorId","onAudioWidgetUpdate","onGraphConfigured","handleUpload","isAudioFile","openFileSelection","useNodeFileInput","uploadWidget","useNodeDragAndDrop","useNodePaste","mediaRecorder","isRecording","audioChunks","currentStream","recordWidget","stopPromise","stopResolve","resolve","audioSrc","useAudioService","ExtendableMediaRecorder","audioBlob","err","originalOnRemoved","isMediaUploadComboInput","inputOptions","isComboInputSpecV1","createUploadInput","imageInputName","imageInputOptions","required","found","WEBCAM_READY","container","video","stream","camera","h","captureOnQueue","capture","img","btn"],"mappings":"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"}