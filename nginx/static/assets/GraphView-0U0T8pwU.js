const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./SubscriptionRequiredDialogContent-CIYbxFB5.js","./index-BFHZsBkN.js","./vendor-primevue-DeKsC2uk.js","./vendor-other-B8t_Wf2K.js","./vendor-other-DYX1NpEr.css","./vendor-vue-DaLZjKA7.js","./vendor-xterm-CWYFmgbN.js","./vendor-xterm-xj0gfbX3.css","./vendor-three-DH0o8VQ7.js","./vendor-tiptap-VxK0yxkd.js","./index-DJa4hQi7.css","./UserAvatar.vue_vue_type_script_setup_true_lang-COE-v4cY.js","./index-B7ehZHKU.js","./LazyImage.vue_vue_type_script_setup_true_lang-BSzd4gKh.js","./keybindingService-B_cUhEnt.js","./serverConfigStore-D8kGBwZ6.js","./WidgetInputNumber.vue_vue_type_script_setup_true_lang-Cb9Vjdsr.js","./widgetPropFilter-CygYoMQt.js","./WidgetLayoutField.vue_vue_type_script_setup_true_lang-B2h9BxrZ.js","./WidgetWithControl.vue_vue_type_script_setup_true_lang-39lKeCWN.js","./WidgetInputNumber-DwTgzZ6Z.css","./SubscriptionRequiredDialogContent-C1UryadQ.css","./ComfyQueueButton-C6ttLtL6.js","./ComfyQueueButton-Chw03MdC.css"])))=>i.map(i=>d[i]);
var Pl=Object.defineProperty;var n=(e,o)=>Pl(e,"name",{value:o,configurable:!0});import{bw as Ze,r as L,E as b,bx as q,ep as ba,i as Dl,eb as Jo,w as se,c as $,d,l as de,z as R,e as c,v as Xe,k as A,s as K,by as m,q as E,p as ye,T as Xo,j as O,u as V,F as oe,y as be,A as $e,cM as Zo,cN as ko,eq as Al,er as wa,m as _t,D as Bn,I as Ce,G as ve,L as je,es as Ts,dH as _n,e9 as Tn,et as Ll,h as Ie,J as oo,ec as en,bB as tn,bg as it,dc as ut,du as ka,n as Fe,dI as ke,o as ze,cO as $s,eu as El,d8 as Zt,d2 as Re,e7 as Vl,cB as Yt,db as on,ev as Rl,dy as Ca,a as $n,ew as xa,f as Sa,cd as yt,x as Mt,cp as _a,cx as Vt,dg as Ta,t as no,cy as Fn,d5 as St,e8 as Ol,ex as lo,dK as Ct,dw as $a,bl as Wl,dn as zl,cF as Na,b as Ia,bz as Ns,ey as Bl,ez as ho,eA as Fl,bi as Is,eB as Ul,d6 as Gl,cw as Hl,bj as jl,B as ql,da as Ma,d3 as nn,eC as Kl,d4 as Ql,dF as Pa,dz as Yl,bn as Jl,g as Ms,bk as Da,dG as Xl,d0 as Zl,dE as Aa,eD as ei,em as ti,e2 as oi}from"./vendor-other-B8t_Wf2K.js";import{d as At,u as pe,s as qe,j as La,k as Ea}from"./vendor-vue-DaLZjKA7.js";import{b as ni,p as et,_ as Un,u as zt,Z as Va,$ as Nn,a0 as It,a1 as Gn,w as eo,a2 as Hn,e as si,a3 as Ps,a4 as ai,a as jn,q as Ds,M as li,O as ii,P as ri,J as ui,a5 as ci,v as Ra,o as Oa,L as Wa,R as No,c as di,y as za,g as pi,a6 as fi,a7 as mi,m as gi,k as go,a8 as vi}from"./vendor-primevue-DeKsC2uk.js";import{s as Ae,n as He,a as Te,i as Ba,b as xt,c as ne,_ as Z,d as Le,S as sn,t as ce,u as ct,e as re,f as Dt,g as hi,E as qn,h as As,V as yi,j as bi,k as Kn,l as Qn,m as Yn,o as wi,p as bt,q as rt,r as J,v as ki,w as Oe,x as io,y as jo,z as ro,A as Se,B as dt,C as tt,D as Ci,F as Jn,G as xi,H as Tt,I as Fa,J as Si,K as Xn,L as he,M as _i,N as Ls,O as Es,P as Bt,Q as Ti,R as Ua,T as Vs,U as Rs,W as $i,X as Ni,Y as Ft,Z as Ii,$ as Mi,a0 as Pi,a1 as Di,a2 as Zn,a3 as uo,a4 as Ut,a5 as Ga,a6 as Ha,a7 as Ai,a8 as Li,a9 as ja,aa as es,ab as Ke,ac as Ei,ad as vt,ae as In,af as ts,ag as to,ah as Vi,ai as yo,aj as Ri,ak as Oi,al as so,am as Pe,an as qa,ao as Wi,ap as pt,aq as zi,ar as Bi,as as co,at as ge,au as Fi,av as Ui,aw as Rt,ax as Ye,ay as Oo,az as Gi,aA as Gt,aB as ao,aC as Hi,aD as os,aE as ns,aF as qo,aG as ss,aH as ht,aI as Ot,aJ as ji,aK as Pt,aL as We,aM as as,aN as Ka,aO as an,aP as qi,aQ as Ki,aR as Qa,aS as Qi,aT as Yi,aU as Ji,aV as Xi,aW as ln,aX as Co,aY as Zi,aZ as er,a_ as tr,a$ as or,b0 as nr,b1 as cn,b2 as To,b3 as sr,b4 as ar,b5 as lr,b6 as ir,b7 as rr,b8 as ur,b9 as cr,ba as dr,bb as pr,bc as ls,bd as fr,be as Os,bf as mr,bg as gr,bh as vr,bi as hr,bj as yr,bk as kt,bl as Ya,bm as is,bn as Ja,bo,bp as Xa,bq as Za,br as el,bs as br,bt as wr,bu as tl,bv as kr,bw as Cr,bx as xr,by as ol,bz as Ws,bA as Sr,bB as _r,bC as rs,bD as Tr,bE as gt,bF as nl,bG as $r,bH as Nr,bI as Jt,bJ as Ir,bK as Mr,bL as Pr,bM as Dr,bN as Ar,bO as Lr,bP as dn,bQ as Io,bR as Er,bS as sl,bT as pn,bU as Vr,bV as Rr,bW as fn,bX as al,bY as zs,bZ as Or,b_ as Wr,b$ as $o,c0 as mn,c1 as zr,c2 as Br,c3 as Fr,c4 as Ur,c5 as Bs,c6 as Fs,c7 as Us,c8 as Gr,c9 as ll,ca as Hr,cb as jr,cc as qr,cd as Kr,ce as Qr,cf as Gs,cg as Yr,ch as Hs,ci as Jr,cj as Xr,ck as js,cl as qs,cm as Zr,cn as eu,co as tu,cp as wo,cq as ou,cr as nu,cs as su,ct as au,cu as lu,cv as iu,cw as il,cx as ru,cy as uu,cz as cu,cA as du,cB as pu,cC as fu}from"./index-BFHZsBkN.js";import{_ as rl}from"./UserAvatar.vue_vue_type_script_setup_true_lang-COE-v4cY.js";import{W as mu}from"./index-B7ehZHKU.js";import{_ as Ko,u as gu,a as vu,b as hu,c as xo,d as yu}from"./LazyImage.vue_vue_type_script_setup_true_lang-BSzd4gKh.js";import{u as gn}from"./keybindingService-B_cUhEnt.js";import{u as bu}from"./serverConfigStore-D8kGBwZ6.js";import{_ as wu}from"./WidgetInputNumber.vue_vue_type_script_setup_true_lang-Cb9Vjdsr.js";var ul=(e=>(e.Cloud="cloud",e.Local="local",e.Desktop="desktop",e.Mac="mac",e.Windows="windows",e))(ul||{});const Mo=n(e=>({all:"icon-[lucide--list]","getting-started":"icon-[lucide--graduation-cap]","generation-image":"icon-[lucide--image]",image:"icon-[lucide--image]","generation-video":"icon-[lucide--film]",video:"icon-[lucide--film]","generation-3d":"icon-[lucide--box]","3d":"icon-[lucide--box]","generation-audio":"icon-[lucide--volume-2]",audio:"icon-[lucide--volume-2]","generation-llm":"icon-[lucide--message-square-text]","api-nodes":"icon-[lucide--hand-coins]","closed-models":"icon-[lucide--hand-coins]",llm:"icon-[lucide--message-square-text]",llms:"icon-[lucide--message-square-text]","llm-api":"icon-[lucide--message-square-text]","small-models":"icon-[lucide--zap]",performance:"icon-[lucide--zap]","mac-compatible":"icon-[lucide--command]","runs-on-mac":"icon-[lucide--command]","lora-training":"icon-[lucide--dumbbell]",training:"icon-[lucide--dumbbell]",extensions:"icon-[lucide--puzzle]",tools:"icon-[lucide--wrench]",upscaling:"icon-[lucide--maximize-2]",controlnet:"icon-[lucide--sliders-horizontal]","area-composition":"icon-[lucide--layout-grid]"})[e.toLowerCase()]||"icon-[lucide--folder]","getCategoryIcon");function Ks(e,o){return`${e.toLowerCase().replace(/\s+/g,"-")}-${o.toLowerCase().replace(/\s+/g,"-")}`}n(Ks,"generateCategoryId");const cl=At("workflowTemplates",()=>{const e=Ze({}),o=Ze([]),t=Ze([]),s=L(!1),l=L(new Set),a=n(y=>f.value.find(N=>N.name===y),"getTemplateByName"),i=L(new Map),r=n((y,N)=>({...y,localizedTitle:Ae(`templateWorkflows.template.${He(N)}.${He(y.name)}`,y.title??y.name),localizedDescription:Ae(`templateWorkflows.templateDescription.${He(N)}.${He(y.name)}`,y.description)}),"addLocalizedFieldsToTemplate"),u=n((y,N)=>y.map(x=>r(x,N)),"localizeTemplateList"),p=n(y=>({...y,localizedTitle:Ae(`templateWorkflows.category.${He(y.title)}`,y.title??y.moduleName),templates:u(y.templates,y.title)}),"localizeTemplateCategory"),g=n(()=>{const y=o.value.flatMap(x=>x.templates.map(I=>({...r(I,x.title),sourceModule:x.moduleName}))),N=Object.entries(e.value).flatMap(([x,I])=>I.map(_=>({name:_,mediaType:"image",mediaSubtype:"jpg",description:_,sourceModule:x})));return{moduleName:"all",title:"All",localizedTitle:Ae("templateWorkflows.category.All","All Templates"),templates:[...y,...N]}},"createAllCategory"),v=b(()=>{const y=[...o.value.map(p),...Object.entries(e.value).map(([x,I])=>({moduleName:x,title:x,localizedTitle:Ae(`templateWorkflows.category.${He(x)}`,x),templates:I.map(_=>({name:_,mediaType:"image",mediaSubtype:"jpg",description:_}))}))];return[{label:Ae("templateWorkflows.category.ComfyUI Examples","ComfyUI Examples"),modules:[g(),...y.filter(x=>x.moduleName==="default")]},...Object.keys(e.value).length>0?[{label:Ae("templateWorkflows.category.Custom Nodes","Custom Nodes"),modules:y.filter(x=>x.moduleName!=="default")}]:[]]}),f=b(()=>{const y=[];return o.value.forEach(x=>{x.templates.forEach(I=>{const _={...I,sourceModule:x.moduleName,category:x.title,categoryType:x.type,categoryGroup:x.category,isEssential:x.isEssential,isPartnerNode:I.openSource===!1,searchableText:[I.title||I.name,I.description||"",x.title,...I.tags||[],...I.models||[]].join(" ")};y.push(_)})}),Object.entries(e.value).forEach(([x,I])=>{I.forEach(_=>{const S={name:_,title:_,description:_,mediaType:"image",mediaSubtype:"jpg",sourceModule:x,category:"Extensions",categoryType:"extension",searchableText:`${_} ${x} extension`};y.push(S)})}),y.filter(x=>!x.requiresCustomNodes?.length)}),k=n(y=>{if(y==="all")return f.value;if(y.startsWith("basics-"))return f.value.filter(x=>x.isEssential&&x.category?.toLowerCase().replace(/\s+/g,"-")===y.replace("basics-",""));if(y==="popular")return f.value;if(y==="partner-nodes")return f.value.filter(x=>x.isPartnerNode);if(y.startsWith("extension-")){const x=y.replace("extension-","");return f.value.filter(I=>I.sourceModule===x)}const N=i.value.get(y);return N?f.value.filter(x=>!(N.category&&x.category!==N.category||N.categoryGroup&&x.categoryGroup!==N.categoryGroup)):f.value},"filterTemplatesByCategory"),w=b(()=>{if(!s.value)return[];const y=[];i.value.clear(),y.push({id:"all",label:Ae("templateWorkflows.category.All","All Templates"),icon:Mo("all")}),y.push({id:"popular",label:Ae("templateWorkflows.category.Popular","Popular"),icon:"icon-[lucide--flame]"});const N=o.value.filter(S=>S.isEssential&&S.templates.length>0);N.length>0&&N.forEach(S=>{const T=S.icon,M=S.title??"Getting Started",P=Ks("basics",S.title);y.push({id:P,label:Ae(`templateWorkflows.category.${He(M)}`,M),icon:T||Mo(S.type||"getting-started")})});const x=new Map;if(o.value.forEach(S=>{if(S.isEssential)return;const T=S.category,M=S.icon;if(T){x.has(T)||x.set(T,{title:T,items:[]});const P=x.get(T),B=Ks(T,S.title);i.value.set(B,{category:S.title,categoryGroup:T}),P.items.push({id:B,label:Ae(`templateWorkflows.category.${He(S.title)}`,S.title),icon:M||Mo(S.type||"default")})}}),x.forEach((S,T)=>{S.items.length>0&&y.push({title:Ae(`templateWorkflows.category.${He(T)}`,T.split(" ").map(M=>M.charAt(0).toUpperCase()+M.slice(1).toLowerCase()).join(" ")),items:S.items})}),f.value.filter(S=>S.isPartnerNode).length>0&&y.push({id:"partner-nodes",label:Ae("templateWorkflows.category.Partner Nodes","Partner Nodes"),icon:"icon-[lucide--handshake]"}),f.value.filter(S=>S.sourceModule!=="default").length>0){const T=Array.from(new Set(f.value.filter(M=>M.sourceModule!=="default").map(M=>M.sourceModule))).sort().map(M=>({id:`extension-${M}`,label:Ae(`templateWorkflows.category.${He(M)}`,M),icon:Mo("extensions")}));y.push({title:Ae("templateWorkflows.category.Extensions","Extensions"),items:T,collapsible:!0})}return y});async function h(){try{if(!s.value){e.value=await Te.getWorkflowTemplates();const y=Ba.global.locale.value,[N,x]=await Promise.all([Te.getCoreWorkflowTemplates(y),xt&&y!=="en"?Te.getCoreWorkflowTemplates("en"):Promise.resolve([])]);o.value=N,t.value=x;const I=o.value.flatMap(S=>S.templates.map(T=>T.name)),_=Object.values(e.value).flat();l.value=new Set([...I,..._]),s.value=!0}}catch(y){console.error("Error fetching workflow templates:",y)}}n(h,"loadWorkflowTemplates");function C(y){if(t.value.length===0)return null;for(const N of t.value){const x=N.templates.find(I=>I.name===y);if(x)return{tags:x.tags,category:N.title,useCase:x.useCase,models:x.models,license:x.license}}return null}return n(C,"getEnglishMetadata"),{groupedTemplates:v,navGroupedTemplates:w,enhancedTemplates:f,filterTemplatesByCategory:k,isLoaded:s,loadWorkflowTemplates:h,knownTemplateNames:l,getTemplateByName:a,getEnglishMetadata:C}}),rn=Symbol(),ku={class:"base-widget-layout rounded-2xl overflow-hidden relative"},Cu={class:"flex h-full w-full"},xu={class:"flex-1 flex bg-base-background"},Su={class:"flex h-full w-full flex-col"},_u={key:0,class:"w-full h-18 px-6 flex items-center justify-between gap-2"},Tu={class:"flex flex-1 shrink-0 gap-2"},$u={class:"flex min-h-0 flex-1 flex-col"},Nu={key:0,class:"text-xxl m-0 px-6 pt-2 pb-6 capitalize"},Iu={class:"min-h-0 flex-1 px-6 pt-0 pb-10 overflow-y-auto scrollbar-custom"},Mu={key:0,class:"w-1/4 min-w-40 max-w-80"},Pu=q({__name:"BaseModalLayout",props:{contentTitle:{}},setup(e){const o={md:880},t={width:"w-1/3",minWidth:"min-w-40",maxWidth:"max-w-56"},s=ba(),l=Dl(rn,()=>{}),i=Jo(o).greater("md"),r=L(!0),u=L(!1),p=L(!1),g=b(()=>!!s.rightPanel);se(i,w=>{w||(p.value=!1)});const v=b(()=>i.value?r.value:p.value),f=n(()=>{i.value?r.value=!r.value:p.value=!p.value},"toggleLeftPanel"),k=n(()=>{u.value=!u.value},"toggleRightPanel");return(w,h)=>(d(),$("div",ku,[de(R(Z,{size:"icon",class:K(m(ne)("absolute top-4 right-18 z-10","transition-opacity duration-200",{"opacity-0 pointer-events-none":u.value||!g.value})),onClick:k},{default:A(()=>h[0]||(h[0]=[c("i",{class:"icon-[lucide--panel-right] text-sm"},null,-1)])),_:1},8,["class"]),[[Xe,!u.value&&g.value]]),R(Z,{size:"lg",class:"absolute top-4 right-6 z-10 transition-opacity duration-200 w-10",onClick:m(l)},{default:A(()=>h[1]||(h[1]=[c("i",{class:"pi pi-times"},null,-1)])),_:1},8,["onClick"]),c("div",Cu,[R(Xo,{name:"slide-panel"},{default:A(()=>[w.$slots.leftPanel&&v.value?(d(),$("nav",{key:0,class:K([t.width,t.minWidth,t.maxWidth])},[ye(w.$slots,"leftPanel",{},void 0,!0)],2)):E("",!0)]),_:3}),c("div",xu,[c("div",Su,[w.$slots.header?(d(),$("header",_u,[c("div",Tu,[m(i)?E("",!0):(d(),O(Z,{key:0,size:"icon",onClick:f},{default:A(()=>[c("i",{class:K(m(ne)(v.value?"icon-[lucide--panel-left]":"icon-[lucide--panel-left-close]"))},null,2)]),_:1})),ye(w.$slots,"header",{},void 0,!0)]),ye(w.$slots,"header-right-area",{},void 0,!0),c("div",{class:K(m(ne)("flex justify-end gap-2 w-0",g.value&&!u.value?"min-w-22":"min-w-10"))},[u.value&&g.value?(d(),O(Z,{key:0,size:"icon",onClick:k},{default:A(()=>h[2]||(h[2]=[c("i",{class:"icon-[lucide--panel-right-close]"},null,-1)])),_:1})):E("",!0)],2)])):E("",!0),c("main",$u,[ye(w.$slots,"contentFilter",{},void 0,!0),w.$slots.leftPanel?E("",!0):(d(),$("h2",Nu,V(w.contentTitle),1)),c("div",Iu,[ye(w.$slots,"content",{},void 0,!0)])])]),g.value&&u.value?(d(),$("aside",Mu,[ye(w.$slots,"rightPanel",{},void 0,!0)])):E("",!0)])])]))}}),us=Le(Pu,[["__scopeId","data-v-643fc509"]]),Du=q({__name:"NavIcon",props:{icon:{}},setup(e){return(o,t)=>(d(),$("i",{class:K([o.icon,"text-neutral text-sm shrink-0"])},null,2))}}),Au={key:0,class:"pt-0.5"},Lu={key:1,class:"text-neutral icon-[lucide--folder] text-xs shrink-0"},Eu={class:"flex items-center break-all"},Qs=q({__name:"NavItem",props:{icon:{},active:{type:Boolean},onClick:{type:Function}},setup(e){return(o,t)=>(d(),$("div",{class:K(["flex cursor-pointer items-start gap-2 rounded-md px-4 py-3 text-sm transition-colors text-base-foreground",o.active?"bg-interface-menu-component-surface-selected":"hover:bg-interface-menu-component-surface-hovered"]),role:"button",onClick:t[0]||(t[0]=(...s)=>o.onClick&&o.onClick(...s))},[o.icon?(d(),$("div",Au,[R(Du,{icon:o.icon},null,8,["icon"])])):(d(),$("i",Lu)),c("span",Eu,[ye(o.$slots,"default")])],2))}}),Vu={class:"text-xs font-bold text-text-secondary uppercase"},Ru=q({__name:"NavTitle",props:{title:{},modelValue:{type:Boolean,default:!1},collapsible:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{emit:o}){const t=o,s=b({get:n(()=>e.modelValue,"get"),set:n(a=>t("update:modelValue",a),"set")}),l=n(()=>{s.value=!s.value},"toggleCollapse");return(a,i)=>(d(),$("div",{class:K(m(ne)("flex items-center justify-between m-0 px-3 py-0 pt-5",a.collapsible&&"cursor-pointer select-none")),onClick:i[0]||(i[0]=r=>a.collapsible&&l())},[c("h3",Vu,V(a.title),1),a.collapsible?(d(),$("i",{key:0,class:K(m(ne)("pi transition-transform duration-200 text-xs text-text-secondary ",s.value?"pi-chevron-right":"pi-chevron-down"))},null,2)):E("",!0)],2))}}),Ou={},Wu={class:"flex h-16 items-center justify-between px-6"},zu={class:"flex items-center gap-2 pl-1"},Bu={class:"text-neutral text-base font-bold"};function Fu(e,o){return d(),$("header",Wu,[c("div",zu,[ye(e.$slots,"icon",{},()=>[o[0]||(o[0]=c("i",{class:"text-neutral icon-[lucide--puzzle] text-base"},null,-1))]),c("h2",Bu,[ye(e.$slots,"default")])])])}n(Fu,"_sfc_render$2");const Uu=Le(Ou,[["render",Fu]]),Gu={class:"flex h-full w-full flex-col bg-modal-panel-background"},Hu={class:"flex scrollbar-hide flex-1 flex-col gap-1 overflow-y-auto px-3 py-4"},ju={key:0,class:"flex flex-col gap-2"},qu={key:1,class:"flex flex-col gap-2"},cs=q({__name:"LeftSidePanel",props:{navItems:{default:n(()=>[],"default")},modelValue:{}},emits:["update:modelValue"],setup(e,{emit:o}){const t=o,s=L({}),l=n(()=>{if(!e.navItems||e.navItems.length===0)return null;const i=e.navItems[0];return"items"in i&&i.items.length>0?i.items[0].id:"id"in i?i.id:null},"getFirstItemId"),a=b({get:n(()=>e.modelValue??l(),"get"),set:n(i=>t("update:modelValue",i),"set")});return(i,r)=>(d(),$("div",Gu,[R(Uu,null,{icon:A(()=>[ye(i.$slots,"header-icon")]),default:A(()=>[ye(i.$slots,"header-title")]),_:3}),c("nav",Hu,[(d(!0),$(oe,null,be(i.navItems,(u,p)=>(d(),$(oe,{key:p},["items"in u?(d(),$("div",ju,[R(Ru,{modelValue:s.value[u.title],"onUpdate:modelValue":n(g=>s.value[u.title]=g,"onUpdate:modelValue"),title:u.title,collapsible:u.collapsible},null,8,["modelValue","onUpdate:modelValue","title","collapsible"]),!u.collapsible||!s.value[u.title]?(d(!0),$(oe,{key:0},be(u.items,g=>(d(),O(Qs,{key:g.id,icon:g.icon,active:a.value===g.id,onClick:n(v=>a.value=g.id,"onClick")},{default:A(()=>[$e(V(g.label),1)]),_:2},1032,["icon","active","onClick"]))),128)):E("",!0)])):(d(),$("div",qu,[R(Qs,{icon:u.icon,active:a.value===u.id,onClick:n(g=>a.value=u.id,"onClick")},{default:A(()=>[$e(V(u.label),1)]),_:2},1032,["icon","active","onClick"])]))],64))),128))])]))}});function Ku(e){return b(()=>{const{minWidth:o,maxWidth:t}=e,s={};return o&&(s.minWidth=o),t&&(s.maxWidth=t),s})}n(Ku,"usePopoverSizing");const Qu={class:"flex flex-col px-2 pt-2 pb-0"},Yu={key:1,class:"mt-2 flex items-center justify-between"},Ju={key:0,class:"px-1 text-sm text-base-foreground"},Xu={class:"text-sm"},Zu={key:0,class:"pointer-events-none absolute -top-2 -right-2 z-10 flex h-5 w-5 items-center justify-center rounded-full bg-primary-background text-xs font-semibold text-base-foreground"},ec={key:0,class:"text-bold icon-[lucide--check] text-xs text-base-foreground"},Wt=q({inheritAttrs:!1,__name:"MultiSelect",props:Zo({label:{},showSearchBox:{type:Boolean,default:!1},showSelectedCount:{type:Boolean,default:!1},showClearButton:{type:Boolean,default:!1},searchPlaceholder:{default:"Search..."},listMaxHeight:{default:"28rem"},popoverMinWidth:{},popoverMaxWidth:{}},{modelValue:{required:!0},modelModifiers:{},searchQuery:{default:""},searchQueryModifiers:{}}),emits:["update:modelValue","update:searchQuery"],setup(e){const o=ko(e,"modelValue"),t=ko(e,"searchQuery"),{t:s}=pe(),l=b(()=>o.value.length),a=Ku({minWidth:e.popoverMinWidth,maxWidth:e.popoverMaxWidth}),i=Al(),r=b(()=>i.options||[]),u={fuseOptions:{keys:["name","value"],threshold:.3,includeScore:!1},matchAllWhenSearchEmpty:!0},{results:p}=wa(t,r,u),g=b(()=>{if(!t.value||t.value.trim()==="")return r.value;const v=p.value.map(k=>k.item);return[...o.value.filter(k=>!v.some(w=>w.value===k.value)),...v]});return(v,f)=>(d(),O(m(ni),_t({modelValue:o.value,"onUpdate:modelValue":f[2]||(f[2]=k=>o.value=k)},{...v.$attrs,options:g.value},{"option-label":"name",unstyled:"","max-selected-labels":0,pt:{root:n(({props:k})=>({class:m(ne)("h-10 relative inline-flex cursor-pointer select-none","rounded-lg bg-secondary-background text-base-foreground","transition-all duration-200 ease-in-out","border-[2.5px] border-solid",l.value>0?"border-node-component-border":"border-transparent","focus-within:border-node-component-border",{"opacity-60 cursor-default":k.disabled})}),"root"),labelContainer:{class:"flex-1 flex items-center overflow-hidden whitespace-nowrap pl-4 py-2 "},label:{class:"p-0"},dropdown:{class:"flex shrink-0 cursor-pointer items-center justify-center px-3"},header:n(()=>({class:v.showSearchBox||v.showSelectedCount||v.showClearButton?"block":"hidden"}),"header"),overlay:{class:m(ne)("mt-2 rounded-lg py-2 px-2","bg-base-background","text-base-foreground","border border-solid border-border-default")},listContainer:n(()=>({style:{maxHeight:`min(${v.listMaxHeight}, 50vh)`},class:"scrollbar-custom"}),"listContainer"),list:{class:"flex flex-col gap-0 p-0 m-0 list-none border-none text-sm"},option:n(({context:k})=>({class:m(ne)("flex gap-2 items-center h-10 px-2 rounded-lg cursor-pointer","hover:bg-secondary-background-hover",k?.focused&&"bg-secondary-background-selected hover:bg-secondary-background-selected")}),"option"),pcHeaderCheckbox:{root:{class:"hidden"},style:{display:"none"}},pcOptionCheckbox:{root:{class:"hidden"},style:{display:"none"}}},"aria-label":v.label||m(s)("g.multiSelectDropdown"),role:"combobox","aria-expanded":!1,"aria-haspopup":"listbox",tabindex:0}),Bn({value:A(()=>[c("span",Xu,V(v.label),1),l.value>0?(d(),$("span",Zu,V(l.value),1)):E("",!0)]),dropdownicon:A(()=>[f[4]||(f[4]=c("i",{class:"icon-[lucide--chevron-down] text-muted-foreground"},null,-1))]),option:A(k=>[c("div",{role:"button",class:"flex items-center gap-2 cursor-pointer",style:ve(m(a))},[c("div",{class:K(["flex size-4 shrink-0 items-center justify-center rounded p-0.5 transition-all duration-200",k.selected?"bg-primary-background":"bg-secondary-background"])},[k.selected?(d(),$("i",ec)):E("",!0)],2),c("span",null,V(k.option.name),1)],4)]),_:2},[v.showSearchBox||v.showSelectedCount||v.showClearButton?{name:"header",fn:A(()=>[c("div",Qu,[v.showSearchBox?(d(),O(sn,{key:0,modelValue:t.value,"onUpdate:modelValue":f[0]||(f[0]=k=>t.value=k),class:K(v.showSelectedCount||v.showClearButton?"mb-2":""),"show-order":!0,"show-border":!0,"place-holder":v.searchPlaceholder},null,8,["modelValue","class","place-holder"])):E("",!0),v.showSelectedCount||v.showClearButton?(d(),$("div",Yu,[v.showSelectedCount?(d(),$("span",Ju,V(l.value>0?v.$t("g.itemsSelected",{selectedCount:l.value}):v.$t("g.itemSelected",{selectedCount:l.value})),1)):E("",!0),v.showClearButton?(d(),O(Z,{key:1,variant:"textonly",size:"md",onClick:f[1]||(f[1]=Ce(k=>o.value=[],["stop"]))},{default:A(()=>[$e(V(v.$t("g.clearAll")),1)]),_:1})):E("",!0)])):E("",!0),f[3]||(f[3]=c("div",{class:"my-4 h-px bg-border-default"},null,-1))])]),key:"0"}:void 0]),1040,["modelValue","pt","aria-label"]))}});function tc(e){const o=b(()=>{const l=je(e).map(i=>{const r=i.name.split(".").pop();return r&&r!==i.name?r:null}).filter(i=>i!==null);return Ts(l,(i,r)=>i===r).sort().map(i=>({name:`.${i}`,value:i}))}),t=b(()=>{const l=je(e).map(i=>i.user_metadata?.base_model).filter(i=>i!==void 0&&typeof i=="string");return Ts(l,(i,r)=>i===r).sort().map(i=>({name:i,value:i}))});return{availableFileFormats:o,availableBaseModels:t}}n(tc,"useAssetFilterOptions");const oc={class:"flex gap-4 items-center justify-between px-6 pt-2 pb-6","data-component-id":"asset-filter-bar"},nc={class:"flex gap-4 items-center","data-component-id":"asset-filter-bar-left"},sc={class:"flex items-center","data-component-id":"asset-filter-bar-right"},ac=q({__name:"AssetFilterBar",props:{assets:{default:n(()=>[],"default")},allAssets:{default:n(()=>[],"default")}},emits:["filterChange"],setup(e,{emit:o}){const s=[...[{name:ce("assetBrowser.sortRecent"),value:"recent"},{name:ce("assetBrowser.sortAZ"),value:"name-asc"},{name:ce("assetBrowser.sortZA"),value:"name-desc"}]],l=[{name:ce("assetBrowser.ownershipAll"),value:"all"},{name:ce("assetBrowser.ownershipMyModels"),value:"my-models"},{name:ce("assetBrowser.ownershipPublicModels"),value:"public-models"}],a=L([]),i=L([]),r=L("recent"),u=L("all"),{availableFileFormats:p,availableBaseModels:g}=tc(e.assets),v=b(()=>(e.allAssets.length?e.allAssets:e.assets).some(h=>h.is_immutable===!1)),f=o;function k(){f("filterChange",{fileFormats:a.value.map(w=>w.value),baseModels:i.value.map(w=>w.value),sortBy:r.value,ownership:u.value})}return n(k,"handleFilterChange"),(w,h)=>(d(),$("div",oc,[c("div",nc,[m(p).length>0?(d(),O(Wt,{key:0,modelValue:a.value,"onUpdate:modelValue":[h[0]||(h[0]=C=>a.value=C),k],label:w.$t("assetBrowser.fileFormats"),options:m(p),class:"min-w-32","data-component-id":"asset-filter-file-formats"},null,8,["modelValue","label","options"])):E("",!0),m(g).length>0?(d(),O(Wt,{key:1,modelValue:i.value,"onUpdate:modelValue":[h[1]||(h[1]=C=>i.value=C),k],label:w.$t("assetBrowser.baseModels"),options:m(g),class:"min-w-32","data-component-id":"asset-filter-base-models"},null,8,["modelValue","label","options"])):E("",!0),v.value?(d(),O(Ko,{key:2,modelValue:u.value,"onUpdate:modelValue":[h[2]||(h[2]=C=>u.value=C),k],label:w.$t("assetBrowser.ownership"),options:l,class:"min-w-42","data-component-id":"asset-filter-ownership"},null,8,["modelValue","label"])):E("",!0)]),c("div",sc,[R(Ko,{modelValue:r.value,"onUpdate:modelValue":[h[3]||(h[3]=C=>r.value=C),k],label:w.$t("assetBrowser.sortBy"),options:s,class:"min-w-32","data-component-id":"asset-filter-sort"},{icon:A(()=>h[4]||(h[4]=[c("i",{class:"icon-[lucide--arrow-up-down]"},null,-1)])),_:1},8,["modelValue","label"])])]))}}),lc={class:"relative inline-flex items-center"},ic={class:"flex min-w-40 flex-col gap-2 p-2"},dl=q({__name:"MoreButton",props:{isVertical:{type:Boolean,default:!1}},emits:["menuOpened","menuClosed"],setup(e,{expose:o}){const t=L(!1),s=L();function l(){s.value?.hide()}return n(l,"hide"),o({hide:l,isOpen:t}),(a,i)=>(d(),$("div",lc,[R(Z,{size:"icon",variant:"secondary",onClick:s.value?.toggle},{default:A(()=>[c("i",{class:K(m(ne)(a.isVertical?"icon-[lucide--more-vertical]":"icon-[lucide--ellipsis]","text-sm"))},null,2)]),_:1},8,["onClick"]),R(m(et),{ref_key:"popover",ref:s,"append-to":"body","auto-z-index":"",dismissable:"","close-on-escape":"",unstyled:"","base-z-index":1e3,pt:{root:{class:m(ne)("absolute z-50")},content:{class:m(ne)("mt-1 rounded-lg","bg-secondary-background text-base-foreground","shadow-lg")}},onShow:i[0]||(i[0]=()=>{t.value=!0,a.$emit("menuOpened")}),onHide:i[1]||(i[1]=()=>{t.value=!1,a.$emit("menuClosed")})},{default:A(()=>[c("div",ic,[ye(a.$slots,"default",{close:l})])]),_:3},8,["pt"])]))}}),rc={class:"flex flex-col px-4 py-2 text-sm text-muted-foreground border-t border-border-default"},uc={key:0},cc=q({__name:"ConfirmBody",props:{promptText:{}},setup(e){const o=b(()=>je(e.promptText));return(t,s)=>(d(),$("div",rc,[o.value?(d(),$("p",uc,V(o.value),1)):E("",!0)]))}}),dc={class:"w-full flex gap-2 justify-end px-2 pb-2"},pc=q({__name:"ConfirmFooter",props:{cancelText:{},confirmText:{},confirmClass:{},optionsDisabled:{}},emits:["cancel","confirm"],setup(e){const{t:o}=pe(),t=b(()=>e.confirmText||o("g.confirm")),s=b(()=>e.cancelText||o("g.cancel")),l=b(()=>je(e.optionsDisabled));return(a,i)=>(d(),$("section",dc,[R(Z,{disabled:l.value,variant:"textonly",autofocus:"",onClick:i[0]||(i[0]=r=>a.$emit("cancel"))},{default:A(()=>[$e(V(s.value),1)]),_:1},8,["disabled"]),R(Z,{disabled:l.value,variant:"textonly",class:K(a.confirmClass),onClick:i[1]||(i[1]=r=>a.$emit("confirm"))},{default:A(()=>[$e(V(t.value),1)]),_:1},8,["disabled","class"])]))}}),fc={class:"flex items-center gap-2 p-4 font-bold text-sm text-base-foreground font-inter"},mc={key:0,class:"flex-auto"},gc=q({__name:"ConfirmHeader",props:{title:{}},setup(e){return(o,t)=>(d(),$("div",fc,[o.title?(d(),$("span",mc,V(o.title),1)):E("",!0)]))}});function vc(e={}){const o=ct(),{headerProps:t,props:s,footerProps:l}=e;return o.showDialog({headerComponent:gc,component:cc,footerComponent:pc,headerProps:t,props:s,footerProps:l,dialogComponentProps:{pt:{header:"py-0! px-0!",content:"p-0!",footer:"p-0!"}}})}n(vc,"showConfirmDialog");const hc={class:"absolute left-2 bottom-2 flex flex-wrap justify-start gap-1"},yc=q({__name:"AssetBadgeGroup",props:{badges:{}},setup(e){return(o,t)=>(d(),$("div",hc,[(d(!0),$(oe,null,be(o.badges,s=>(d(),$("span",{key:s.label,class:K(m(ne)("px-2 py-1 rounded text-xs font-bold uppercase tracking-wider text-modal-card-tag-foreground bg-modal-card-tag-background break-all"))},V(s.label),3))),128))]))}}),bc=["data-asset-id","aria-labelledby","aria-describedby","tabindex"],wc={class:"relative aspect-square w-full overflow-hidden rounded-xl"},kc=["src","alt"],Cc={class:"max-h-32 flex flex-col gap-2 justify-between flex-auto"},xc=["id"],Sc=["id"],_c={class:"flex gap-4 text-xs text-muted-foreground mt-auto"},Tc={key:0,class:"flex items-center gap-1"},$c={key:1,class:"flex items-center gap-1"},Nc={key:2,class:"flex items-center gap-1"},Ic=q({__name:"AssetCard",props:{asset:{},interactive:{type:Boolean}},emits:["select","deleted"],setup(e,{emit:o}){const t=o,{t:s}=pe(),l=re(),{closeDialog:a}=ct(),{flags:i}=gu(),r=Dt(),u=_n("dropdown-menu-button"),p=Tn(),g=Tn(),v=L(!1),f=L(),k=b(()=>f.value??e.asset.name),w=b(()=>(i.assetDeletionEnabled||i.assetRenameEnabled)&&!(e.asset.is_immutable??!0)),h=b(()=>l.get("LiteGraph.Node.TooltipDelay")),{isLoading:C,error:y}=Ll({src:e.asset.preview_url??"",alt:e.asset.name});function N(){u.value?.hide();const _=je(k),S=L(s("assetBrowser.deletion.body")),T=L(!1),M=vc({headerProps:{title:s("assetBrowser.deletion.header")},props:{promptText:S},footerProps:{confirmText:s("g.delete"),confirmClass:ne("bg-danger-200 text-base-foreground hover:bg-danger-200/80 focus:bg-danger-200/80 focus:ring ring-base-foreground"),optionsDisabled:T,onCancel:n(()=>{a(M)},"onCancel"),onConfirm:n(async()=>{T.value=!0;try{S.value=s("assetBrowser.deletion.inProgress",{assetName:_}),await As.deleteAsset(e.asset.id),S.value=s("assetBrowser.deletion.complete",{assetName:_}),await new Promise(P=>setTimeout(P,1e3)),t("deleted",e.asset)}catch(P){console.error(P),S.value=s("assetBrowser.deletion.failed",{assetName:_}),await new Promise(B=>setTimeout(B,3e3))}finally{a(M)}},"onConfirm")}})}n(N,"confirmDeletion");function x(){u.value?.hide(),v.value=!0}n(x,"startAssetRename");async function I(_){if(v.value=!1,_){f.value=_;try{const S=await As.updateAsset(e.asset.id,{name:_});f.value=S.name}catch(S){console.error(S),r.add({severity:"error",summary:s("assetBrowser.rename.failed"),life:1e4}),f.value=void 0}}}return n(I,"assetRename"),(_,S)=>{const T=Ie("tooltip");return d(),$("div",{"data-component-id":"AssetCard","data-asset-id":_.asset.id,"aria-labelledby":m(p),"aria-describedby":m(g),tabindex:_.interactive?0:-1,class:K(m(ne)("rounded-2xl overflow-hidden transition-all duration-200 bg-modal-card-background p-2 gap-2 flex flex-col h-full",_.interactive&&"group appearance-none bg-transparent m-0 outline-none text-left hover:bg-secondary-background focus:bg-secondary-background border-none focus:outline-solid outline-base-foreground outline-4")),onKeydown:S[3]||(S[3]=oo(Ce(M=>_.interactive&&_.$emit("select",_.asset),["self"]),["enter"]))},[c("div",wc,[m(C)||m(y)?(d(),$("div",{key:0,class:"flex size-full cursor-pointer items-center justify-center bg-gradient-to-br from-smoke-400 via-smoke-800 to-charcoal-400",role:"button",onClick:S[0]||(S[0]=Ce(M=>_.interactive&&_.$emit("select",_.asset),["self"]))})):(d(),$("img",{key:1,src:_.asset.preview_url,alt:k.value,class:"size-full object-cover cursor-pointer",role:"button",onClick:S[1]||(S[1]=Ce(M=>_.interactive&&_.$emit("select",_.asset),["self"]))},null,8,kc)),R(yc,{badges:_.asset.badges},null,8,["badges"]),w.value?(d(),O(hi,{key:2,class:K(m(ne)("absolute top-2 right-2 invisible group-hover:visible",m(u)?.isOpen&&"visible"))},{default:A(()=>[R(dl,{ref:"dropdown-menu-button",size:"sm"},{default:A(()=>[m(i).assetRenameEnabled?(d(),O(Z,{key:0,variant:"secondary",size:"md",class:"justify-start",onClick:x},{default:A(()=>[S[4]||(S[4]=c("i",{class:"icon-[lucide--pencil]"},null,-1)),c("span",null,V(_.$t("g.rename")),1)]),_:1})):E("",!0),m(i).assetDeletionEnabled?(d(),O(Z,{key:1,variant:"secondary",size:"md",class:"justify-start",onClick:N},{default:A(()=>[S[5]||(S[5]=c("i",{class:"icon-[lucide--trash-2]"},null,-1)),c("span",null,V(_.$t("g.delete")),1)]),_:1})):E("",!0)]),_:1},512)]),_:1},8,["class"])):E("",!0)]),c("div",Cc,[de((d(),$("h3",{id:m(p),class:K(m(ne)("mb-2 m-0 text-base font-semibold line-clamp-2 wrap-anywhere","text-base-foreground"))},[R(qn,{"model-value":k.value,"is-editing":v.value,"input-attrs":{"data-testid":"asset-name-input"},onEdit:I,onCancel:S[2]||(S[2]=M=>I())},null,8,["model-value","is-editing"])],10,xc)),[[T,{value:k.value,showDelay:h.value},void 0,{top:!0}]]),de((d(),$("p",{id:m(g),class:K(m(ne)("m-0 text-sm leading-6 overflow-hidden [-webkit-box-orient:vertical] [-webkit-line-clamp:2] [display:-webkit-box] text-muted-foreground"))},[$e(V(_.asset.description),1)],10,Sc)),[[T,{value:_.asset.description,showDelay:h.value},void 0,{top:!0}]]),c("div",_c,[_.asset.stats.stars?(d(),$("span",Tc,[S[6]||(S[6]=c("i",{class:"icon-[lucide--star] size-3"},null,-1)),$e(" "+V(_.asset.stats.stars),1)])):E("",!0),_.asset.stats.downloadCount?(d(),$("span",$c,[S[7]||(S[7]=c("i",{class:"icon-[lucide--download] size-3"},null,-1)),$e(" "+V(_.asset.stats.downloadCount),1)])):E("",!0),_.asset.stats.formattedDate?(d(),$("span",Nc,[S[8]||(S[8]=c("i",{class:"icon-[lucide--clock] size-3"},null,-1)),$e(" "+V(_.asset.stats.formattedDate),1)])):E("",!0)])])],42,bc)}}}),Mc=["aria-label","aria-setsize"],Pc={key:0,class:"flex h-full items-center justify-center py-20"},Dc={key:1,class:"flex h-full flex-col items-center justify-center py-16 text-muted-foreground"},Ac={class:"mb-2 text-lg font-medium"},Lc={class:"text-sm"},Ec=q({__name:"AssetGrid",props:{assets:{},loading:{type:Boolean}},emits:["assetSelect","assetDeleted"],setup(e){const o=b(()=>e.assets.map(s=>({...s,key:s.id}))),t={display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(15rem, 1fr))",gap:"1rem",padding:"0.5rem"};return(s,l)=>(d(),$("div",{"data-component-id":"AssetGrid",class:"h-full",role:"grid","aria-label":s.$t("assetBrowser.assetCollection"),"aria-rowcount":-1,"aria-colcount":-1,"aria-setsize":s.assets.length},[s.loading?(d(),$("div",Pc,l[2]||(l[2]=[c("i",{class:"icon-[lucide--loader] size-12 animate-spin text-muted-foreground"},null,-1)]))):s.assets.length===0?(d(),$("div",Dc,[l[3]||(l[3]=c("i",{class:"mb-4 icon-[lucide--search] size-10"},null,-1)),c("h3",Ac,V(s.$t("assetBrowser.noAssetsFound")),1),c("p",Lc,V(s.$t("assetBrowser.tryAdjustingFilters")),1)])):(d(),O(yi,{key:2,items:o.value,"grid-style":t,"default-item-height":320,"default-item-width":240},{item:A(({item:a})=>[R(Ic,{asset:a,interactive:!0,onSelect:l[0]||(l[0]=i=>s.$emit("assetSelect",i)),onDeleted:l[1]||(l[1]=i=>s.$emit("assetDeleted",i))},null,8,["asset"])]),_:1},8,["items"]))],8,Mc))}});function Vc(e){return typeof e.user_metadata?.description=="string"?e.user_metadata.description:null}n(Vc,"getAssetDescription");function pl(e){return typeof e.user_metadata?.base_model=="string"?e.user_metadata.base_model:null}n(pl,"getAssetBaseModel");function Rc(e){return o=>e==="all"||o.tags.includes(e)?!0:o.tags.some(t=>typeof t=="string"&&t.includes("/")?t.split("/")[0]===e:!1)}n(Rc,"filterByCategory");function Oc(e){return o=>{if(e.length===0)return!0;const t=new Set(e),s=o.name.split(".").pop()?.toLowerCase();return s?t.has(s):!1}}n(Oc,"filterByFileFormats");function Wc(e){return o=>{if(e.length===0)return!0;const t=new Set(e),s=pl(o);return s?t.has(s):!1}}n(Wc,"filterByBaseModels");function zc(e){return o=>e==="all"?!0:e==="my-models"?o.is_immutable===!1:e==="public-models"?o.is_immutable===!0:!0}n(zc,"filterByOwnership");function Bc(e=L([])){const o=b(()=>e.value??[]),t=L(""),s=L("all"),l=L({sortBy:"recent",fileFormats:[],baseModels:[],ownership:"all"});function a(w){const h=w.tags.find(I=>I!=="models"),C=Vc(w)||`${h||ce("assetBrowser.unknown")} model`,y=[];if(h){const I=h.includes("/")?h.substring(h.indexOf("/")+1):h;y.push({label:I,type:"type"})}const N=pl(w);N&&y.push({label:N,type:"base"});const x={formattedDate:bi(new Date(w.created_at),{dateStyle:"short"}),downloadCount:void 0,stars:void 0};return{...w,description:C,badges:y,stats:x}}n(a,"transformAssetForDisplay");const i=b(()=>{const w=o.value.filter(C=>C.tags[0]==="models").map(C=>C.tags[1]).filter(C=>typeof C=="string"&&C.length>0).map(C=>C.split("/")[0]),h=Array.from(new Set(w)).sort().map(C=>({id:C,label:C.charAt(0).toUpperCase()+C.slice(1),icon:"icon-[lucide--package]"}));return[{id:"all",label:ce("assetBrowser.allModels"),icon:"icon-[lucide--folder]"},...h]}),r=b(()=>s.value==="all"?ce("assetBrowser.allModels"):i.value.find(h=>h.id===s.value)?.label||ce("assetBrowser.assets")),u=b(()=>o.value.filter(Rc(s.value))),p={fuseOptions:{keys:[{name:"name",weight:.4},{name:"tags",weight:.3}],threshold:.4,ignoreLocation:!0,includeScore:!0},matchAllWhenSearchEmpty:!0},{results:g}=wa(t,u,p),v=b(()=>g.value.map(w=>w.item)),f=b(()=>{const h=[...v.value.filter(Oc(l.value.fileFormats)).filter(Wc(l.value.baseModels)).filter(zc(l.value.ownership))];return h.sort((C,y)=>{switch(l.value.sortBy){case"name-desc":return y.name.localeCompare(C.name);case"recent":return new Date(y.created_at).getTime()-new Date(C.created_at).getTime();case"popular":return C.name.localeCompare(y.name);case"name-asc":default:return C.name.localeCompare(y.name)}}),h.map(a)});function k(w){l.value={...w}}return n(k,"updateFilters"),{searchQuery:t,selectedCategory:s,availableCategories:i,contentTitle:r,categoryFilteredAssets:u,filteredAssets:f,updateFilters:k}}n(Bc,"useAssetBrowser");const Fc=new Set(["VAE","CLIP","GLIGEN"]);function Uc(e){return e?e==="diffusion_models"?"Diffusion":e.split("_").map(o=>{const t=o.toUpperCase();if(Fc.has(t))return t;const s=o.toLowerCase();return s.charAt(0).toUpperCase()+s.slice(1)}).join(" "):"Models"}n(Uc,"formatCategoryLabel");const Gc={class:"capitalize"},Hc={class:"flex w-full items-center justify-between gap-2"},jc={class:"hidden md:inline"},Ys=q({__name:"AssetBrowserModal",props:{nodeType:{},assetType:{},onSelect:{type:Function},onClose:{type:Function},showLeftPanel:{type:Boolean},title:{}},emits:["asset-select","close"],setup(e,{emit:o}){const{t}=pe(),s=Kn(),l=Qn(),a=Jo(en),i=e,r=o;tn(rn,i.onClose??(()=>{}));const u=b(()=>i.nodeType?i.nodeType:i.assetType?`tag:${i.assetType}`:""),p=b(()=>s.modelAssetsByNodeType.get(u.value)??[]),g=b(()=>s.modelLoadingByNodeType.get(u.value)??!1),v=b(()=>g.value&&p.value.length===0);async function f(){return i.nodeType?await s.updateModelsForNodeType(i.nodeType):i.assetType?await s.updateModelsForTag(i.assetType):[]}n(f,"refreshAssets"),f();const{isUploadButtonEnabled:k,showUploadDialog:w}=vu(f),{searchQuery:h,selectedCategory:C,availableCategories:y,categoryFilteredAssets:N,filteredAssets:x,updateFilters:I}=Bc(p),_=b(()=>{const z=(p.value??[]).map(G=>G.tags?.find(U=>U!=="models")).find(G=>typeof G=="string"&&G.length>0);if(z)return z;if(i.nodeType){const G=l.getCategoryForNodeType(i.nodeType);if(G)return G}return i.assetType?i.assetType:"models"}),S=b(()=>C.value!=="all"?C.value:_.value),T=b(()=>{if(i.title)return i.title;const H=Uc(S.value);return t("assetBrowser.allCategory",{category:H})}),M=b(()=>i.showLeftPanel??!0);function P(){i.onClose?.(),r("close")}n(P,"handleClose");function B(H){r("asset-select",H),i.onSelect?.(H)}return n(B,"handleAssetSelectAndEmit"),(H,z)=>(d(),O(us,{"data-component-id":"AssetBrowserModal",class:"size-full max-h-full max-w-full min-w-0","content-title":T.value,onClose:P},Bn({header:A(()=>[c("div",Hc,[R(sn,{modelValue:m(h),"onUpdate:modelValue":z[1]||(z[1]=G=>it(h)?h.value=G:null),autofocus:!0,size:"lg",placeholder:H.$t("g.searchPlaceholder"),class:"max-w-96"},null,8,["modelValue","placeholder"]),m(k)?(d(),O(Z,{key:0,variant:"primary",size:m(a).md?"lg":"icon","data-attr":"upload-model-button",onClick:m(w)},{default:A(()=>[z[3]||(z[3]=c("i",{class:"icon-[lucide--folder-input]"},null,-1)),c("span",jc,V(H.$t("assetBrowser.uploadModel")),1)]),_:1},8,["size","onClick"])):E("",!0)])]),contentFilter:A(()=>[R(ac,{assets:m(N),"all-assets":p.value,onFilterChange:m(I)},null,8,["assets","all-assets","onFilterChange"])]),content:A(()=>[R(Ec,{assets:m(x),loading:v.value,onAssetSelect:B,onAssetDeleted:f},null,8,["assets","loading"])]),_:2},[M.value?{name:"leftPanel",fn:A(()=>[R(cs,{modelValue:m(C),"onUpdate:modelValue":z[0]||(z[0]=G=>it(C)?C.value=G:null),"data-component-id":"AssetBrowserModal-LeftSidePanel","nav-items":m(y)},{"header-icon":A(()=>z[2]||(z[2]=[c("div",{class:"icon-[lucide--folder] size-4"},null,-1)])),"header-title":A(()=>[c("span",Gc,V(T.value),1)]),_:1},8,["modelValue","nav-items"])]),key:"0"}:void 0]),1032,["content-title"]))}}),Js={headless:!0,modal:!0,closable:!0,pt:{root:{class:"rounded-2xl overflow-hidden asset-browser-dialog"},header:{class:"!p-0 hidden"},content:{class:"!p-0 !m-0 h-full w-full"}}},qc=n(()=>{const e=ct(),o="global-asset-browser";async function t(l){const a=n(i=>{l.onAssetSelected?.(i),e.closeDialog({key:o})},"handleAssetSelected");e.showDialog({key:o,component:Ys,props:{nodeType:l.nodeType,inputName:l.inputName,currentValue:l.currentValue,onSelect:a,onClose:n(()=>e.closeDialog({key:o}),"onClose")},dialogComponentProps:Js})}n(t,"show");async function s(l){const a=n(i=>{l.onAssetSelected?.(i),e.closeDialog({key:o})},"handleAssetSelected");e.showDialog({key:o,component:Ys,props:{showLeftPanel:!0,assetType:l.assetType,title:l.title,onSelect:a,onClose:n(()=>e.closeDialog({key:o}),"onClose")},dialogComponentProps:Js})}return n(s,"browse"),{show:t,browse:s}},"useAssetBrowserDialog"),Kc={class:"flex max-w-xs min-w-40 flex-col gap-2 p-3"},Qc={class:"text-sm font-inter"},Yc={key:1,class:"text-xs"},Jc={class:"flex max-w-xs min-w-40 flex-col gap-2 p-3"},Xc={class:"text-sm font-inter"},Zc={key:1,class:"text-xs"},Xs="cursor-pointer transition-opacity hover:opacity-80",ed=q({__name:"TopbarBadge",props:{badge:{},displayMode:{default:"full"},reverseOrder:{type:Boolean,default:!1},noPadding:{type:Boolean,default:!1},backgroundColor:{default:"var(--comfy-menu-bg)"}},setup(e){const o=e,t=L(),s=n(f=>{t.value?.toggle(f)},"togglePopover"),l=b(()=>o.badge.variant??"info"),a=b(()=>({backgroundColor:o.backgroundColor})),i=b(()=>{switch(l.value){case"error":return"bg-danger-100 text-white";case"warning":return"bg-gold-600 text-black";case"info":default:return"bg-white text-black"}}),r=b(()=>{switch(l.value){case"error":return"text-danger-100";case"warning":return"text-warning-background";case"info":default:return"text-text-primary"}}),u=b(()=>r.value),p=b(()=>{if(o.badge.icon)return o.badge.icon;switch(l.value){case"error":return"pi pi-exclamation-circle";case"warning":return"icon-[lucide--triangle-alert]";case"info":default:return}}),g=b(()=>{switch(l.value){case"error":return"bg-danger-100";case"warning":return"bg-gold-600";case"info":default:return"bg-slate-100"}}),v=b(()=>({root:{class:ne("absolute z-50")},content:{class:ne("mt-1 rounded-lg","bg-base-background","text-base-foreground","shadow-lg","border border-border-default")}}));return(f,k)=>{const w=Ie("tooltip");return f.displayMode==="icon-only"?(d(),$("div",{key:0,class:K(["relative inline-flex h-full shrink-0 items-center justify-center px-2",Xs]),style:ve(a.value),onClick:s},[p.value?(d(),$("i",{key:0,class:K(["shrink-0 text-base",p.value,u.value])},null,2)):f.badge.label?(d(),$("div",{key:1,class:K(["shrink-0 rounded-full px-1.5 py-0.5 text-xxxs font-semibold",i.value])},V(f.badge.label),3)):(d(),$("div",{key:2,class:K(["size-2 shrink-0 rounded-full",g.value])},null,2)),R(m(et),{ref_key:"popover",ref:t,"append-to":"body","auto-z-index":!0,"base-z-index":1e3,dismissable:!0,"close-on-escape":!0,unstyled:"",pt:v.value},{default:A(()=>[c("div",Kc,[f.badge.label?(d(),$("div",{key:0,class:K(["w-fit rounded-full px-1.5 py-0.5 text-xxxs font-semibold",i.value])},V(f.badge.label),3)):E("",!0),c("div",Qc,V(f.badge.text),1),f.badge.tooltip?(d(),$("div",Yc,V(f.badge.tooltip),1)):E("",!0)])]),_:1},8,["pt"])],4)):f.displayMode==="compact"?(d(),$("div",{key:1,class:"relative inline-flex h-full",style:ve(a.value)},[c("div",{class:K(["flex h-full shrink-0 items-center gap-2 whitespace-nowrap",[{"flex-row-reverse":f.reverseOrder},f.noPadding?"":"px-3",Xs]]),onClick:s},[p.value?(d(),$("i",{key:0,class:K(["shrink-0 text-base",p.value,u.value])},null,2)):E("",!0),f.badge.label?(d(),$("div",{key:1,class:K(["shrink-0 rounded-full px-1.5 py-0.5 text-xxxs font-semibold",i.value])},V(f.badge.label),3)):E("",!0)],2),R(m(et),{ref_key:"popover",ref:t,"append-to":"body","auto-z-index":!0,"base-z-index":1e3,dismissable:!0,"close-on-escape":!0,unstyled:"",pt:v.value},{default:A(()=>[c("div",Jc,[f.badge.label?(d(),$("div",{key:0,class:K(["w-fit rounded-full px-1.5 py-0.5 text-xxxs font-semibold",i.value])},V(f.badge.label),3)):E("",!0),c("div",Xc,V(f.badge.text),1),f.badge.tooltip?(d(),$("div",Zc,V(f.badge.tooltip),1)):E("",!0)])]),_:1},8,["pt"])],4)):de((d(),$("div",{key:2,class:K(["flex h-full shrink-0 items-center gap-2 whitespace-nowrap",[{"flex-row-reverse":f.reverseOrder},f.noPadding?"":"px-3"]]),style:ve(a.value)},[p.value?(d(),$("i",{key:0,class:K(["shrink-0 text-base",p.value,u.value])},null,2)):E("",!0),f.badge.label?(d(),$("div",{key:1,class:K(["shrink-0 rounded-full px-1.5 py-0.5 text-xxxs font-semibold",i.value])},V(f.badge.label),3)):E("",!0),c("div",{class:K(["font-inter text-sm",r.value])},V(f.badge.text),3)],6)),[[w,f.badge.tooltip]])}}}),td=3e3,od=300*1e3,nd=q({__name:"SubscribeButton",props:{label:{},size:{default:"lg"},variant:{default:"default"},fluid:{type:Boolean,default:!0}},emits:["subscribed"],setup(e,{emit:o}){const t=o,{subscribe:s,isActiveSubscription:l,fetchStatus:a,showSubscriptionDialog:i}=Yn(),r=wi(),u=L(!1),p=L(!1);let g=null;const v=L(!1),f=n(()=>{p.value=!0,u.value=!0;const h=Date.now(),C=n(async()=>{try{if(Date.now()-h>od){k();return}await a(),l.value&&(k(),r?.trackMonthlySubscriptionSucceeded(),t("subscribed"))}catch(y){console.error("[SubscribeButton] Error polling subscription status:",y)}},"poll");C(),g=window.setInterval(C,td)},"startPollingSubscriptionStatus"),k=n(()=>{g&&(clearInterval(g),g=null),p.value=!1,u.value=!1},"stopPolling");se([v,l],([h,C])=>{});const w=n(async()=>{u.value=!0;try{await s(),f()}catch(h){console.error("[SubscribeButton] Error initiating subscription:",h),u.value=!1}},"handleSubscribe");return ut(()=>{k(),v.value=!1}),(h,C)=>(d(),O(Z,{size:h.size,loading:u.value,disabled:p.value,variant:"primary",style:ve(h.variant==="gradient"?{background:"var(--color-subscription-button-gradient)",color:"var(--color-white)"}:void 0),class:K(m(ne)("font-bold",h.fluid&&"w-full")),onClick:w},{default:A(()=>[$e(V(h.label||h.$t("subscription.required.subscribe")),1)]),_:1},8,["size","loading","disabled","style","class"]))}}),Zs="subscription-required",sd=n(()=>{const e=bt(),o=ct();function t(){o.closeDialog({key:Zs})}n(t,"hide");function s(){e.showLayoutDialog({key:Zs,component:ka(()=>Un(()=>import("./SubscriptionRequiredDialogContent-CIYbxFB5.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21]),import.meta.url)),props:{onClose:t},dialogComponentProps:{style:"width: min(1328px, 95vw); max-height: 90vh;",pt:{root:{class:"rounded-2xl bg-transparent"},content:{class:"!p-0 rounded-2xl border border-border-default bg-base-background/60 backdrop-blur-md shadow-[0_25px_80px_rgba(5,6,12,0.45)]"}}}})}return n(s,"show"),{show:s,hide:t}},"useSubscriptionDialog"),ad=q({__name:"GlobalToast",setup(e){const o=zt(),t=Dt(),s=re();se(()=>t.messagesToAdd,i=>{i.length!==0&&(i.forEach(r=>{o.add(r)}),t.messagesToAdd=[])},{deep:!0}),se(()=>t.messagesToRemove,i=>{i.length!==0&&(i.forEach(r=>{o.remove(r)}),t.messagesToRemove=[])},{deep:!0}),se(()=>t.removeAllRequested,i=>{i&&(o.removeAllGroups(),t.removeAllRequested=!1)});function l(){const i=document.getElementById("dynamic-toast-style")||a(),r=document.querySelector(".graph-canvas-container")?.getBoundingClientRect();r&&(i.textContent=`
    .p-toast.p-component.p-toast-top-right {
      top: ${r.top+100}px !important;
      right: ${window.innerWidth-(r.left+r.width)+20}px !important;
       z-index: 10000 !important;
    }
  `)}n(l,"updateToastPosition");function a(){const i=document.createElement("style");return i.id="dynamic-toast-style",document.head.appendChild(i),i}return n(a,"createStyleElement"),se(()=>s.get("Comfy.UseNewMenu"),()=>Fe(l),{immediate:!0}),se(()=>s.get("Comfy.Sidebar.Location"),()=>Fe(l),{immediate:!0}),(i,r)=>(d(),O(m(Va)))}});let vn,fl;(function(){const e=globalThis;typeof e.requestIdleCallback!="function"||typeof e.cancelIdleCallback!="function"?vn=n((o,t,s)=>{setTimeout(()=>{if(l)return;const a=Date.now()+15;t(Object.freeze({didTimeout:!0,timeRemaining(){return Math.max(0,a-Date.now())}}))});let l=!1;return{dispose(){l||(l=!0)}}},"_runWhenIdle"):vn=n((o,t,s)=>{const l=o.requestIdleCallback(t,typeof s=="number"?{timeout:s}:void 0);let a=!1;return{dispose(){a||(a=!0,o.cancelIdleCallback(l))}}},"_runWhenIdle"),fl=n((o,t)=>vn(globalThis,o,t),"runWhenGlobalIdle")})();const ld={class:"fixed z-9999 flex flex-row no-drag top-0 right-0"},id=q({__name:"MenuHamburger",setup(e){const o=rt(),t=re(),s=n(()=>{o.focusMode=!1},"exitFocusMode");return ke(()=>{t.get("Comfy.UseNewMenu")==="Disabled"&&(o.focusMode?J.ui.menuContainer.style.display="none":J.ui.menuContainer.style.display="block")}),(l,a)=>{const i=Ie("tooltip");return de((d(),$("div",ld,[de((d(),O(Z,{variant:"muted-textonly",size:"lg","aria-label":l.$t("menu.showMenu"),"aria-live":"assertive",onClick:s,onContextmenu:m(ki)},{default:A(()=>a[0]||(a[0]=[c("i",{class:"pi pi-bars"},null,-1)])),_:1},8,["aria-label","onContextmenu"])),[[i,{value:l.$t("menu.showMenu"),showDelay:300}]]),a[1]||(a[1]=c("div",{class:"window-actions-spacer"},null,-1))],512)),[[Xe,m(o).focusMode]])}}}),rd=q({__name:"UnloadWindowConfirmDialog",setup(e){const o=re(),t=Oe(),s=n(l=>{if(o.get("Comfy.Window.UnloadConfirmation")&&t.modifiedWorkflows.length>0)return l.preventDefault(),!0},"handleBeforeUnload");return ze(()=>{window.addEventListener("beforeunload",s)}),ut(()=>{window.removeEventListener("beforeunload",s)}),(l,a)=>(d(),$("div"))}}),ud={class:"w-full h-full absolute top-0 left-0 z-999 pointer-events-none flex flex-col"},cd={class:"side-toolbar-container"},dd=q({__name:"LiteGraphCanvasSplitterOverlay",setup(e){const o=rt(),t=re(),s=io(),l=jo(),{t:a}=pe(),i=b(()=>t.get("Comfy.Sidebar.Location")),r=b(()=>t.get("Comfy.Sidebar.UnifiedWidth")),{focusMode:u}=qe(o),{activeSidebarTabId:p,activeSidebarTab:g}=qe(l),{bottomPanelVisible:v}=qe(ro()),{isOpen:f}=qe(s),k=b(()=>g.value!==null),w=b(()=>r.value?"unified-sidebar":p.value??"default-sidebar");function h({originalEvent:x}){x.preventDefault()}n(h,"onResizestart");const C=b(()=>`main-splitter${f.value?"-with-right-panel":""}-${i.value}`),y=b(()=>{if(i.value==="left")return{display:k.value?"flex":"none"}}),N=b(()=>{if(i.value==="right")return{display:k.value?"flex":"none"}});return(x,I)=>(d(),$("div",ud,[ye(x.$slots,"workflow-tabs",{},void 0,!0),c("div",{class:K(["pointer-events-none flex flex-1 overflow-hidden",{"flex-row":i.value==="left","flex-row-reverse":i.value==="right"}])},[c("div",cd,[ye(x.$slots,"side-toolbar",{},void 0,!0)]),(d(),O(m(Nn),{key:C.value,class:"bg-transparent pointer-events-none border-none flex-1 overflow-hidden","state-key":w.value,"state-storage":"local",onResizestart:h},{default:A(()=>[!m(u)&&(i.value==="left"||m(f))?(d(),O(m(It),{key:0,class:K(i.value==="left"?m(ne)("side-bar-panel bg-comfy-menu-bg pointer-events-auto",k.value&&"min-w-78"):"bg-comfy-menu-bg pointer-events-auto"),"min-size":i.value==="left"?10:15,size:20,style:ve(y.value),role:i.value==="left"?"complementary":void 0,"aria-label":i.value==="left"?m(a)("sideToolbar.sidebar"):void 0},{default:A(()=>[i.value==="left"&&k.value?ye(x.$slots,"side-bar-panel",{key:0},void 0,!0):i.value==="right"?ye(x.$slots,"right-side-panel",{key:1},void 0,!0):E("",!0)]),_:3},8,["class","min-size","style","role","aria-label"])):E("",!0),R(m(It),{size:80,class:"flex flex-col"},{default:A(()=>[ye(x.$slots,"topmenu",{sidebarPanelVisible:k.value},void 0,!0),R(m(Nn),{class:"bg-transparent pointer-events-none border-none splitter-overlay-bottom mr-1 mb-1 ml-1 flex-1",layout:"vertical","pt:gutter":m(ne)("rounded-tl-lg rounded-tr-lg ",!(m(v)&&!m(u))&&"hidden"),"state-key":"bottom-panel-splitter","state-storage":"local",onResizestart:h},{default:A(()=>[R(m(It),{class:"graph-canvas-panel relative"},{default:A(()=>[ye(x.$slots,"graph-canvas-panel",{},void 0,!0)]),_:3}),de(R(m(It),{class:"bottom-panel border border-(--p-panel-border-color) max-w-full overflow-x-auto bg-comfy-menu-bg pointer-events-auto rounded-lg"},{default:A(()=>[ye(x.$slots,"bottom-panel",{},void 0,!0)]),_:3},512),[[Xe,m(v)&&!m(u)]])]),_:3},8,["pt:gutter"])]),_:3}),!m(u)&&(i.value==="right"||m(f))?(d(),O(m(It),{key:1,class:K(i.value==="right"?m(ne)("side-bar-panel bg-comfy-menu-bg pointer-events-auto",k.value&&"min-w-78"):"bg-comfy-menu-bg pointer-events-auto"),"min-size":i.value==="right"?10:15,size:20,style:ve(N.value),role:i.value==="right"?"complementary":void 0,"aria-label":i.value==="right"?m(a)("sideToolbar.sidebar"):void 0},{default:A(()=>[i.value==="left"?ye(x.$slots,"right-side-panel",{key:0},void 0,!0):i.value==="right"&&k.value?ye(x.$slots,"side-bar-panel",{key:1},void 0,!0):E("",!0)]),_:3},8,["class","min-size","style","role","aria-label"])):E("",!0)]),_:3},8,["state-key"]))],2)]))}}),pd=Le(dd,[["__scopeId","data-v-78b7f6de"]]),nt=n(e=>({value:e,showDelay:300,hideDelay:0,pt:{text:{class:"border-node-component-tooltip-border bg-node-component-tooltip-surface text-node-component-tooltip border rounded-md px-2 py-1 text-xs leading-none shadow-none"},arrow:{class:"border-t-node-component-tooltip-border"}}}),"buildTooltipConfig"),fd=ka(()=>Un(()=>import("./ComfyQueueButton-C6ttLtL6.js"),__vite__mapDeps([22,5,3,4,2,1,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,23]),import.meta.url)),md={class:"flex h-full items-center"},gd=q({__name:"ComfyActionbar",setup(e){const o=re(),t=Se(),{t:s}=pe(),{isIdle:l}=qe(dt()),a=b(()=>o.get("Comfy.UseNewMenu")),i=b(()=>a.value!=="Disabled"),r=document.querySelector(".workflow-tabs-container"),u=L(null),p=L(null),g=$s("Comfy.MenuPosition.Docked",!0),v=$s("Comfy.MenuPosition.Floating",{x:0,y:0}),{x:f,y:k,style:w,isDragging:h}=El(u,{initialValue:{x:0,y:0},handle:p,containerElement:document.body,onMove:n(z=>{const G=r?.getBoundingClientRect().bottom??40;z.y<G&&(z.y=G)},"onMove")});Zt([f,k],([z,G])=>{v.value={x:z,y:G}},{debounce:300});const C=n(()=>{if(u.value){const z=window.innerWidth,G=window.innerHeight,U=u.value.offsetWidth,W=u.value.offsetHeight;if(U===0||W===0)return;if(v.value.x!==0||v.value.y!==0){f.value=Yt(v.value.x,0,z-U),k.value=Yt(v.value.y,0,G-W),x();return}f.value===0&&k.value===0&&(f.value=Yt((z-U)/2,0,z-U),k.value=Yt(G-W-10,0,G-W),x())}},"setInitialPosition");async function y(){await Fe(),C()}n(y,"comfyRunButtonResolved"),se(i,async z=>{z&&await Fe(C)}),Re(p,"mousedown",()=>{});const N=L({x:f.value,y:k.value,windowWidth:window.innerWidth,windowHeight:window.innerHeight}),x=n(()=>{N.value={x:f.value,y:k.value,windowWidth:window.innerWidth,windowHeight:window.innerHeight}},"captureLastDragState");se(h,z=>{z||x()},{immediate:!0}),Re(window,"resize",n(()=>{if(u.value){const z=window.innerWidth,G=window.innerHeight,U=u.value.offsetWidth,W=u.value.offsetHeight,F=N.value.x,Q=N.value.windowWidth-(N.value.x+U),j=N.value.y,Y=N.value.windowHeight-(N.value.y+W),X=[{edge:"left",distance:F},{edge:"right",distance:Q},{edge:"top",distance:j},{edge:"bottom",distance:Y}].reduce((Ne,Ue)=>Ue.distance<Ne.distance?Ue:Ne),ae=N.value.y/N.value.windowHeight,le=N.value.x/N.value.windowWidth;X.edge==="left"?(f.value=X.distance,k.value=ae*G):X.edge==="right"?(f.value=z-U-X.distance,k.value=ae*G):X.edge==="top"?(f.value=le*z,k.value=X.distance):(f.value=le*z,k.value=G-W-X.distance),f.value=Yt(f.value,0,z-U),k.value=Yt(k.value,0,G-W)}},"adjustMenuPosition"));const _=L(!1),S=n(()=>{h.value&&(_.value=!0)},"onMouseEnterDropZone"),T=n(()=>{h.value&&(_.value=!1)},"onMouseLeaveDropZone");se(h,z=>{z?g.value&&(g.value=!1):(_.value&&(g.value=!0),_.value=!1)});const M=b(()=>nt(s("menu.interrupt"))),P=n(async()=>{l.value||await t.execute("Comfy.Interrupt")},"cancelCurrentJob"),B=b(()=>ne("w-[200px] border-dashed border-blue-500 opacity-80","m-1.5 flex items-center justify-center self-stretch","rounded-md before:w-50 before:-ml-50 before:h-full","pointer-events-auto",_.value&&"border-[3px] opacity-100 scale-105 shadow-[0_0_20px] shadow-blue-500")),H=b(()=>ne("actionbar pointer-events-auto z-1300",h.value&&"select-none pointer-events-none",g.value?"p-0 static border-none bg-transparent":"fixed shadow-interface"));return(z,G)=>{const U=Ie("tooltip");return d(),$("div",md,[m(h)&&!m(g)?(d(),$("div",{key:0,class:K(B.value),onMouseenter:S,onMouseleave:T},V(m(s)("actionbar.dockToTop")),35)):E("",!0),R(m(Gn),{class:K(["pointer-events-auto",H.value]),style:ve(m(w)),pt:{header:{class:"hidden"},content:{class:m(g)?"p-0":"p-1"}}},{default:A(()=>[c("div",{ref_key:"panelRef",ref:u,class:"flex items-center select-none gap-2"},[c("span",{ref_key:"dragHandleRef",ref:p,class:K(m(ne)("drag-handle cursor-grab w-3 h-max",m(h)&&"cursor-grabbing"))},null,2),(d(),O(Vl,{onResolve:y},{default:A(()=>[R(m(fd))]),_:1})),de((d(),O(Z,{variant:"destructive",size:"icon",disabled:m(l),"aria-label":m(s)("menu.interrupt"),onClick:P},{default:A(()=>G[0]||(G[0]=[c("i",{class:"icon-[lucide--x] size-4"},null,-1)])),_:1},8,["disabled","aria-label"])),[[U,M.value,void 0,{bottom:!0}]])],512)]),_:1},8,["style","class","pt"])])}}});function ds(e,o={}){const{isRoot:t=!0,includeDelete:s=!0,workflow:l}=o,{t:a}=pe(),i=Oe(),r=tt(),u=Ci(),p=Se(),g=Jn(),v=b(()=>l?.value??i.activeWorkflow),f=n(async w=>{!w||w===i.activeWorkflow||await r.openWorkflow(w)},"ensureWorkflowActive");return{menuItems:b(()=>{const w=v.value,h=w?g.isSubgraphBlueprint(w):!1,C=[],y=n((N,x,I,_=!0,S=!1,T=!1)=>{_&&(T&&C.push({separator:!0}),C.push({label:N,icon:x,command:I,disabled:S}))},"addItem");return y(a("g.rename"),"pi pi-pencil",async()=>{await f(v.value),e()},!0,t&&!w?.isPersisted),y(a("breadcrumbsMenu.duplicate"),"pi pi-copy",async()=>{w&&await r.duplicateWorkflow(w)},t&&!h),y(a("menuLabels.Save"),"pi pi-save",async()=>{await f(w),await p.execute("Comfy.SaveWorkflow")},t,!1,!0),y(a("menuLabels.Save As"),"pi pi-save",async()=>{await f(w),await p.execute("Comfy.SaveWorkflowAs")},t),y(u.isBookmarked(w?.path??"")?a("tabMenu.removeFromBookmarks"):a("tabMenu.addToBookmarks"),"pi pi-bookmark"+(u.isBookmarked(w?.path??"")?"-fill":""),async()=>{w?.path&&await u.toggleBookmarked(w.path)},t,w?.isTemporary??!1),y(a("menuLabels.Export"),"pi pi-download",async()=>{await f(w),await p.execute("Comfy.ExportWorkflow")},t),y(a("menuLabels.Export (API)"),"pi pi-download",async()=>{await f(w),await p.execute("Comfy.ExportWorkflowAPI")},t),y(a("breadcrumbsMenu.clearWorkflow"),"pi pi-trash",async()=>{await f(w),await p.execute("Comfy.ClearWorkflow")},!0,!1,!0),y(a("subgraphStore.publish"),"pi pi-upload",async()=>{w&&await r.saveWorkflowAs(w)},t&&h,!1,!0),y(a(h?"breadcrumbsMenu.deleteBlueprint":"breadcrumbsMenu.deleteWorkflow"),"pi pi-times",async()=>{w&&await r.deleteWorkflow(w)},t&&s,!1,!0),C})}}n(ds,"useWorkflowActionsMenu");const vd=n((e,o)=>{const t=e?.type;return t?!o[t]:!1},"isNodeMissingDefinition"),hd=n((e,o)=>{if(!e)return[];const t=m(o);return xi(e,s=>vd(s,t))},"collectMissingNodes"),yd=n((e,o)=>hd(e,o).length>0,"graphHasMissingNodes"),bd={key:0,class:"icon-[lucide--triangle-alert] text-warning-background"},wd={class:"p-breadcrumb-item-label px-2"},kd={key:2,class:"pi pi-angle-down text-[10px]"},Cd=q({__name:"SubgraphBreadcrumbItem",props:{item:{},isActive:{type:Boolean,default:!1}},setup(e,{expose:o}){const t=e,s=Tt(),l=b(()=>yd(J.rootGraph,s.nodeDefsByName)),{t:a}=pe(),i=L(),r=bt(),u=Oe(),p=tt(),g=L(!1),v=L(),f=L(),k=L(),w=n(async(S,T)=>{if(S&&S!==T){if(t.item.updateTitle?.(S),u.activeSubgraph)u.activeSubgraph.name=S;else if(u.activeWorkflow)try{await p.renameWorkflow(u.activeWorkflow,Fa.basePath+Si(S))}catch(P){console.error(P),r.showErrorDialog(P);return}const M=Xn();M.restoreState(M.exportState())}},"rename"),h=t.item.key==="root",C=b(()=>l.value&&h?a("breadcrumbsMenu.missingNodesWarning"):t.item.label),y=n(async()=>{if(h&&k.value?.offsetParent===null){await Se().execute("Comfy.RenameWorkflow");return}g.value=!0,v.value=t.item.label,Fe(()=>{f.value?.$el&&(f.value.$el.focus(),f.value.$el.select(),k.value&&(f.value.$el.style.width=`${Math.max(200,k.value.offsetWidth)}px`))})},"startRename"),{menuItems:N}=ds(y,{isRoot:h}),x=n(S=>{g.value||(S.detail===1?t.isActive?i.value?.toggle(S):t.item.command?.({item:t.item,originalEvent:S}):t.isActive&&S.detail===2&&(i.value?.hide(),S.stopPropagation(),S.preventDefault(),y()))},"handleClick"),I=n(async S=>{S&&await w(v.value,t.item.label),g.value=!1},"inputBlur");return o({toggleMenu:n(S=>{i.value?.toggle(S)},"toggleMenu")}),(S,T)=>{const M=Ie("tooltip");return d(),$(oe,null,[de((d(),$("a",{ref_key:"wrapperRef",ref:k,draggable:"false",href:"#",class:K(["p-breadcrumb-item-link h-8 cursor-pointer px-2",{"flex items-center gap-1":S.isActive,"p-breadcrumb-item-link-menu-visible":i.value?.overlayVisible,"p-breadcrumb-item-link-icon-visible":S.isActive,"active-breadcrumb-item":S.isActive}]),onClick:x},[l.value&&h?(d(),$("i",bd)):E("",!0),c("span",wd,V(S.item.label),1),S.item.isBlueprint?(d(),O(m(eo),{key:1,value:"Blueprint",severity:"primary"})):E("",!0),S.isActive?(d(),$("i",kd)):E("",!0)],2)),[[M,{value:C.value,showDelay:512},void 0,{bottom:!0}]]),S.isActive||h?(d(),O(m(Hn),{key:0,ref_key:"menu",ref:i,model:m(N),popup:!0,pt:{root:{style:"background-color: var(--comfy-menu-bg)"},itemLink:{class:"py-2"}}},null,8,["model"])):E("",!0),g.value?(d(),O(m(si),{key:1,ref_key:"itemInputRef",ref:f,modelValue:v.value,"onUpdate:modelValue":T[0]||(T[0]=P=>v.value=P),class:"fixed z-10000 px-2 py-2 text-[.8rem]",onBlur:T[1]||(T[1]=P=>I(!1)),onClick:T[2]||(T[2]=Ce(()=>{},["stop"])),onKeydown:[T[3]||(T[3]=oo(P=>I(!0),["enter"])),T[4]||(T[4]=oo(P=>I(!1),["esc"]))]},null,8,["modelValue"])):E("",!0)],64)}}}),xd=Le(Cd,[["__scopeId","data-v-d7b126c3"]]),ml=n((e,o)=>{o={debounceTime:25,useMutationObserver:!0,useResizeObserver:!0,...o};const t=L(!1),s=[],l=L(!1),a=n(()=>{t.value=e.scrollWidth>e.clientWidth,o.onCheck?.(t.value)},"checkOverflowFn"),i=o.debounceTime?on(a,o.debounceTime):a;return o.useMutationObserver&&s.push(Rl(e,i,{subtree:!0,childList:!0}).stop),o.useResizeObserver&&s.push(Ca(e,i).stop),{isOverflowing:$n(t),disposed:$n(l),checkOverflow:i,dispose:n(()=>{l.value=!0,s.forEach(r=>r())},"dispose")}},"useOverflowObserver"),ea=28,ta=8,hn=8,oa=20,Sd=q({__name:"SubgraphBreadcrumb",setup(e){const o=Oe(),t=Xn(),s=L(),l=L(),a=n((N,x)=>{N.key==="root"&&(l.value=x)},"setItemRef"),i=b(()=>o.activeWorkflow?.filename),r=b(()=>Jn().isSubgraphBlueprint(o.activeWorkflow)),u=L(!1),p=L(!1),g=b(()=>t.navigationStack.length>0),v=b(()=>({label:i.value,icon:"pi pi-home",key:"root",isBlueprint:r.value,command:n(()=>{const N=he().getCanvas();if(!N.graph)throw new TypeError("Canvas has no graph");N.setGraph(N.graph.rootGraph)},"command")})),f=b(()=>{const N=t.navigationStack.map(x=>({label:x.name,key:`subgraph-${x.id}`,command:n(()=>{const I=he().getCanvas();if(!I.graph)throw new TypeError("Canvas has no graph");I.setGraph(x)},"command"),updateTitle:n(I=>{const _=he().getCanvas().graph?.rootGraph;_&&_i(_,x.id,S=>{S.title=I})},"updateTitle")}));return[v.value,...N]}),k=b(()=>f.value.at(-1)?.key),w=n(N=>{l.value?.toggleMenu(N)},"handleMenuClick"),h=n(()=>{Se().execute("Comfy.Graph.ExitSubgraph")},"handleBackClick"),C=b(()=>s.value?s.value.$el?.querySelector(".p-breadcrumb-list"):null);let y;return se(C,N=>{y?.dispose(),y=void 0,N&&(y=ml(N,{onCheck:n(x=>{if(p.value=x,u.value){if(!x){const I=[...N.querySelectorAll(".p-breadcrumb-item")];if(I.length<3)return;const _=I.filter(U=>U.querySelector(".p-breadcrumb-item-link-icon-visible")).length,S=N.querySelectorAll(".p-breadcrumb-separator"),M=S[S.length-1].offsetWidth,P=(ea+hn+hn)*I.length+_*oa,B=(I.length-1)*M,H=(I.length-1)*(ta*2),z=P+B+H,G=N.clientWidth;z<=G&&(u.value=!1)}}else x&&(u.value=!0)},"onCheck")}))}),xa(()=>{y?.disposed.value||y?.checkOverflow()}),(N,x)=>(d(),$("div",{class:K(["subgraph-breadcrumb flex w-auto drop-shadow-[var(--interface-panel-drop-shadow)]",{"subgraph-breadcrumb-collapse":u.value,"subgraph-breadcrumb-overflow":p.value}]),style:ve({"--p-breadcrumb-gap":"0px","--p-breadcrumb-item-margin":`${ta/2}px`,"--p-breadcrumb-item-min-width":`${ea}px`,"--p-breadcrumb-item-padding":`${hn}px`,"--p-breadcrumb-icon-width":`${oa}px`})},[R(m(Ps),{class:"context-menu-button pointer-events-auto h-8 w-8 shrink-0 border border-transparent bg-transparent p-0 transition-all hover:rounded-lg hover:border-interface-stroke hover:bg-comfy-menu-bg",icon:"pi pi-bars",text:"",severity:"secondary",size:"small",onClick:w}),g.value?(d(),O(m(Ps),{key:0,class:"back-button pointer-events-auto h-8 w-8 shrink-0 border border-transparent bg-transparent p-0 transition-all hover:rounded-lg hover:border-interface-stroke hover:bg-comfy-menu-bg",text:"",severity:"secondary",size:"small",onClick:h},{default:A(()=>x[0]||(x[0]=[c("i",{class:"icon-[lucide--undo-2]"},null,-1)])),_:1})):E("",!0),R(m(ai),{ref_key:"breadcrumbRef",ref:s,class:K(["w-fit rounded-lg p-0",{hidden:!g.value}]),model:f.value,pt:{item:{class:"pointer-events-auto"}},"aria-label":N.$t("g.graphNavigation")},{item:A(({item:I})=>[R(xd,{ref:n(_=>a(I,_),"ref"),item:I,"is-active":I.key===k.value},null,8,["item","is-active"])]),separator:A(()=>x[1]||(x[1]=[c("span",{style:{transform:"scale(1.5)"}}," / ",-1)])),_:1},8,["class","model","aria-label"])],6))}}),_d=Le(Sd,[["__scopeId","data-v-50f75d4e"]]),Td={class:"flex flex-col gap-3 p-2"},$d={class:"flex flex-col gap-1"},Nd={class:"relative h-2 w-full overflow-hidden rounded-full border border-interface-stroke bg-interface-panel-surface"},Id={class:"flex items-start justify-end gap-4 text-[12px] leading-none"},Md={class:"flex items-center gap-1 text-text-primary opacity-90"},Pd={class:"font-bold"},Dd={class:"flex items-center gap-1 text-text-secondary"},Ad={class:"inline-block max-w-[10rem] truncate"},Ld={class:"flex items-center gap-1"},Ed={class:"flex items-center gap-4 text-[12px] text-text-primary"},Vd={class:"flex items-center gap-2"},Rd={class:"opacity-90"},Od={class:"font-bold"},Wd={class:"ml-1"},zd={class:"flex items-center gap-2"},Bd={class:"opacity-90"},Fd={class:"font-bold"},Ud={class:"ml-1"},Gd=q({__name:"QueueOverlayActive",props:{totalProgressStyle:{},currentNodeProgressStyle:{},totalPercentFormatted:{},currentNodePercentFormatted:{},currentNodeName:{},runningCount:{},queuedCount:{},bottomRowClass:{}},emits:["interruptAll","clearQueued","viewAllJobs"],setup(e){const{t:o}=pe(),t=b(()=>nt(o("sideToolbar.queueProgressOverlay.cancelJobTooltip"))),s=b(()=>nt(o("sideToolbar.queueProgressOverlay.clearQueueTooltip")));return(l,a)=>{const i=Sa("i18n-t"),r=Ie("tooltip");return d(),$("div",Td,[c("div",$d,[c("div",Nd,[c("div",{class:"absolute inset-0 h-full rounded-full transition-[width]",style:ve(l.totalProgressStyle)},null,4),c("div",{class:"absolute inset-0 h-full rounded-full transition-[width]",style:ve(l.currentNodeProgressStyle)},null,4)]),c("div",Id,[c("div",Md,[R(i,{keypath:"sideToolbar.queueProgressOverlay.total"},{percent:A(()=>[c("span",Pd,V(l.totalPercentFormatted),1)]),_:1})]),c("div",Dd,[c("span",null,V(m(o)("sideToolbar.queueProgressOverlay.currentNode")),1),c("span",Ad,V(l.currentNodeName),1),c("span",Ld,[c("span",null,V(l.currentNodePercentFormatted),1)])])])]),c("div",{class:K(l.bottomRowClass)},[c("div",Ed,[c("div",Vd,[c("span",Rd,[c("span",Od,V(l.runningCount),1),c("span",Wd,V(m(o)("sideToolbar.queueProgressOverlay.running")),1)]),l.runningCount>0?de((d(),O(Z,{key:0,variant:"destructive",size:"icon","aria-label":m(o)("sideToolbar.queueProgressOverlay.interruptAll"),onClick:a[0]||(a[0]=u=>l.$emit("interruptAll"))},{default:A(()=>a[3]||(a[3]=[c("i",{class:"icon-[lucide--x] block size-4 leading-none text-text-primary"},null,-1)])),_:1},8,["aria-label"])),[[r,t.value,void 0,{top:!0}]]):E("",!0)]),c("div",zd,[c("span",Bd,[c("span",Fd,V(l.queuedCount),1),c("span",Ud,V(m(o)("sideToolbar.queueProgressOverlay.queuedSuffix")),1)]),l.queuedCount>0?de((d(),O(Z,{key:0,variant:"destructive",size:"icon","aria-label":m(o)("sideToolbar.queueProgressOverlay.clearQueued"),onClick:a[1]||(a[1]=u=>l.$emit("clearQueued"))},{default:A(()=>a[4]||(a[4]=[c("i",{class:"icon-[lucide--list-x] block size-4 leading-none text-text-primary"},null,-1)])),_:1},8,["aria-label"])),[[r,s.value,void 0,{top:!0}]]):E("",!0)])]),R(Z,{class:"min-w-30 flex-1 px-2 py-0",variant:"secondary",size:"md",onClick:a[2]||(a[2]=u=>l.$emit("viewAllJobs"))},{default:A(()=>[$e(V(m(o)("sideToolbar.queueProgressOverlay.viewAllJobs")),1)]),_:1})],2)])}}}),Hd={class:"inline-flex items-center gap-2"},jd={key:0,class:"inline-flex items-center"},qd={class:"inline-flex items-center gap-2"},Kd={key:0,class:"relative inline-flex h-6 items-center"},Qd=["src","alt"],Yd={class:"text-[14px] font-normal text-text-primary"},Jd={class:"font-bold"},Xd={class:"font-bold"},Zd={class:"font-bold"},ep={class:"font-bold"},tp=q({__name:"CompletionSummaryBanner",props:{mode:{},completedCount:{},failedCount:{},thumbnailUrls:{default:n(()=>[],"default")},ariaLabel:{}},emits:["click"],setup(e,{emit:o}){const t=e,s=o;return(l,a)=>{const i=Sa("i18n-t");return d(),O(Z,{variant:"secondary",size:"lg",class:"group w-full justify-between gap-3 p-1 text-left font-normal hover:cursor-pointer focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary-background","aria-label":t.ariaLabel,onClick:a[0]||(a[0]=r=>s("click",r))},{default:A(()=>[c("span",Hd,[t.mode==="allFailed"?(d(),$("span",jd,a[1]||(a[1]=[c("i",{class:"ml-1 icon-[lucide--circle-alert] block size-4 leading-none text-destructive-background"},null,-1)]))):E("",!0),c("span",qd,[t.mode!=="allFailed"?(d(),$("span",Kd,[(d(!0),$(oe,null,be(t.thumbnailUrls,(r,u)=>(d(),$("span",{key:r+u,class:"inline-block h-6 w-6 overflow-hidden rounded-[6px] border-0 bg-secondary-background",style:ve({marginLeft:u===0?"0":"-12px"})},[c("img",{src:r,alt:l.$t("sideToolbar.queueProgressOverlay.preview"),class:"h-full w-full object-cover"},null,8,Qd)],4))),128))])):E("",!0),c("span",Yd,[t.mode==="allSuccess"?(d(),O(i,{key:0,keypath:"sideToolbar.queueProgressOverlay.jobsCompleted",plural:t.completedCount},{count:A(()=>[c("span",Jd,V(t.completedCount),1)]),_:1},8,["plural"])):t.mode==="mixed"?(d(),$(oe,{key:1},[R(i,{keypath:"sideToolbar.queueProgressOverlay.jobsCompleted",plural:t.completedCount},{count:A(()=>[c("span",Xd,V(t.completedCount),1)]),_:1},8,["plural"]),a[2]||(a[2]=c("span",null,", ",-1)),R(i,{keypath:"sideToolbar.queueProgressOverlay.jobsFailed",plural:t.failedCount},{count:A(()=>[c("span",Zd,V(t.failedCount),1)]),_:1},8,["plural"])],64)):(d(),O(i,{key:2,keypath:"sideToolbar.queueProgressOverlay.jobsFailed",plural:t.failedCount},{count:A(()=>[c("span",ep,V(t.failedCount),1)]),_:1},8,["plural"]))])])]),a[3]||(a[3]=c("span",{class:"flex items-center justify-center rounded p-1 text-text-secondary transition-colors duration-200 ease-in-out"},[c("i",{class:"icon-[lucide--chevron-down] block size-4 leading-none"})],-1))]),_:1},8,["aria-label"])}}}),op={class:"pointer-events-auto"},np=q({__name:"QueueOverlayEmpty",props:{summary:{}},emits:["summaryClick"],setup(e){const{t:o}=pe();return(t,s)=>(d(),$("div",op,[R(tp,{mode:t.summary.mode,"completed-count":t.summary.completedCount,"failed-count":t.summary.failedCount,"thumbnail-urls":t.summary.thumbnailUrls,"aria-label":m(o)("sideToolbar.queueProgressOverlay.expandCollapsedQueue"),onClick:s[0]||(s[0]=l=>t.$emit("summaryClick"))},null,8,["mode","completed-count","failed-count","thumbnail-urls","aria-label"])]))}}),sp={class:"flex h-12 items-center justify-between gap-2 border-b border-interface-stroke px-2"},ap={class:"px-2 text-[14px] font-normal text-text-primary"},lp={key:0,class:"ml-4 inline-flex items-center gap-1 text-blue-100"},ip={class:"font-bold"},rp={class:"ml-1"},up={key:0,class:"flex items-center gap-1"},cp={class:"flex flex-col items-stretch rounded-lg border border-interface-stroke bg-interface-panel-surface px-2 py-3 font-inter"},dp=q({__name:"QueueOverlayHeader",props:{headerTitle:{},showConcurrentIndicator:{type:Boolean},concurrentWorkflowCount:{}},emits:["clearHistory"],setup(e,{emit:o}){const t=o,{t:s}=pe(),l=L(null),a=b(()=>nt(s("g.more"))),i=n(u=>{l.value?.toggle(u)},"onMoreClick"),r=n(()=>{l.value?.hide(),t("clearHistory")},"onClearHistoryFromMenu");return(u,p)=>{const g=Ie("tooltip");return d(),$("div",sp,[c("div",ap,[c("span",null,V(u.headerTitle),1),u.showConcurrentIndicator?(d(),$("span",lp,[p[0]||(p[0]=c("span",{class:"inline-block size-2 rounded-full bg-blue-100"},null,-1)),c("span",null,[c("span",ip,V(u.concurrentWorkflowCount),1),c("span",rp,V(m(s)("sideToolbar.queueProgressOverlay.running")),1)])])):E("",!0)]),m(xt)?E("",!0):(d(),$("div",up,[de((d(),O(Z,{variant:"textonly",size:"icon","aria-label":m(s)("sideToolbar.queueProgressOverlay.moreOptions"),onClick:i},{default:A(()=>p[1]||(p[1]=[c("i",{class:"icon-[lucide--more-horizontal] block size-4 leading-none text-text-secondary"},null,-1)])),_:1},8,["aria-label"])),[[g,a.value,void 0,{top:!0}]]),R(m(et),{ref_key:"morePopoverRef",ref:l,dismissable:!0,"close-on-escape":!0,unstyled:"",pt:{root:{class:"absolute z-50"},content:{class:["bg-transparent border-none p-0 pt-2 rounded-lg shadow-lg font-inter"]}}},{default:A(()=>[c("div",cp,[R(Z,{class:"w-full justify-start",variant:"textonly",size:"sm","aria-label":m(s)("sideToolbar.queueProgressOverlay.clearHistory"),onClick:r},{default:A(()=>[p[2]||(p[2]=c("i",{class:"icon-[lucide--file-x-2] size-4 text-muted"},null,-1)),c("span",null,V(m(s)("sideToolbar.queueProgressOverlay.clearHistory")),1)]),_:1},8,["aria-label"])])]),_:1},512)]))])}}}),pp={class:"flex min-w-[14rem] flex-col items-stretch rounded-lg border border-interface-stroke bg-interface-panel-surface px-2 py-3 font-inter"},fp={key:0,class:"px-2 py-1"},mp=q({__name:"JobContextMenu",props:{entries:{}},emits:["action"],setup(e,{expose:o,emit:t}){const s=t,l=L(null);function a(u){l.value&&l.value.toggle(u)}n(a,"open");function i(){l.value?.hide()}n(i,"hide");function r(u){s("action",u)}return n(r,"onEntry"),o({open:a,hide:i}),(u,p)=>(d(),O(m(et),{ref_key:"jobItemPopoverRef",ref:l,dismissable:!0,"close-on-escape":!0,unstyled:"",pt:{root:{class:"absolute z-50"},content:{class:["bg-transparent border-none p-0 pt-2 rounded-lg shadow-lg font-inter"]}}},{default:A(()=>[c("div",pp,[(d(!0),$(oe,null,be(u.entries,g=>(d(),$(oe,{key:g.key},[g.kind==="divider"?(d(),$("div",fp,p[0]||(p[0]=[c("div",{class:"h-px bg-interface-stroke"},null,-1)]))):(d(),O(Z,{key:1,class:"w-full justify-start bg-transparent",variant:"textonly",size:"sm","aria-label":g.label,onClick:n(v=>r(g),"onClick")},{default:A(()=>[g.icon?(d(),$("i",{key:0,class:K([g.icon,"block size-4 shrink-0 leading-none text-text-secondary"])},null,2)):E("",!0),c("span",null,V(g.label),1)]),_:2},1032,["aria-label","onClick"]))],64))),128))])]),_:1},512))}}),gp={class:"flex items-center justify-between gap-2 px-3"},vp={class:"min-w-0 flex-1 overflow-x-auto"},hp={class:"inline-flex items-center gap-1 whitespace-nowrap"},yp={class:"ml-2 flex shrink-0 items-center gap-2"},bp={key:0,class:"pointer-events-none absolute -top-1 -right-1 inline-block size-2 rounded-full bg-base-foreground"},wp={class:"flex min-w-[12rem] flex-col items-stretch rounded-lg border border-interface-stroke bg-interface-panel-surface px-2 py-3"},kp={key:0,class:"icon-[lucide--check] size-4"},Cp={key:0,class:"icon-[lucide--check] block size-4 leading-none text-text-secondary"},xp={key:0,class:"pointer-events-none absolute -top-1 -right-1 inline-block size-2 rounded-full bg-base-foreground"},Sp={class:"flex min-w-[12rem] flex-col items-stretch rounded-lg border border-interface-stroke bg-interface-panel-surface px-2 py-3"},_p={key:0,class:"icon-[lucide--check] size-4 text-text-secondary"},Tp={key:0,class:"mx-2 mt-1 h-px"},$p=q({__name:"JobFiltersBar",props:{selectedJobTab:{},selectedWorkflowFilter:{},selectedSortMode:{},hasFailedJobs:{type:Boolean}},emits:["update:selectedJobTab","update:selectedWorkflowFilter","update:selectedSortMode"],setup(e,{emit:o}){const t=e,s=o,{t:l}=pe(),a=L(null),i=L(null),r=b(()=>nt(l("sideToolbar.queueProgressOverlay.filterBy"))),u=b(()=>nt(l("sideToolbar.queueProgressOverlay.sortBy"))),p=b(()=>t.hasFailedJobs?Ls:Ls.filter(C=>C!=="Failed")),g=n(C=>{a.value&&a.value.toggle(C)},"onFilterClick"),v=n(C=>{a.value?.hide?.(),s("update:selectedWorkflowFilter",C)},"selectWorkflowFilter"),f=n(C=>{i.value&&i.value.toggle(C)},"onSortClick"),k=n(C=>{i.value?.hide?.(),s("update:selectedSortMode",C)},"selectSortMode"),w=n(C=>l(C==="All"?"g.all":C==="Completed"?"g.completed":"g.failed"),"tabLabel"),h=n(C=>C==="mostRecent"?l("queue.jobList.sortMostRecent"):C==="totalGenerationTime"?l("queue.jobList.sortTotalGenerationTime"):"","sortLabel");return(C,y)=>{const N=Ie("tooltip");return d(),$("div",gp,[c("div",vp,[c("div",hp,[(d(!0),$(oe,null,be(p.value,x=>(d(),O(Z,{key:x,variant:C.selectedJobTab===x?"secondary":"muted-textonly",size:"sm",class:"px-3",onClick:n(I=>C.$emit("update:selectedJobTab",x),"onClick")},{default:A(()=>[$e(V(w(x)),1)]),_:2},1032,["variant","onClick"]))),128))])]),c("div",yp,[de((d(),O(Z,{key:0,variant:"secondary",size:"icon","aria-label":m(l)("sideToolbar.queueProgressOverlay.filterJobs"),onClick:g},{default:A(()=>[y[2]||(y[2]=c("i",{class:"icon-[lucide--list-filter] size-4"},null,-1)),C.selectedWorkflowFilter!=="all"?(d(),$("span",bp)):E("",!0)]),_:1},8,["aria-label"])),[[N,r.value,void 0,{top:!0}]]),(d(),O(m(et),{key:1,ref_key:"filterPopoverRef",ref:a,dismissable:!0,"close-on-escape":!0,unstyled:"",pt:{root:{class:"absolute z-50"},content:{class:["bg-transparent border-none p-0 pt-2 rounded-lg shadow-lg font-inter"]}}},{default:A(()=>[c("div",wp,[R(Z,{class:"w-full justify-between",variant:"textonly",size:"sm",onClick:y[0]||(y[0]=x=>v("all"))},{default:A(()=>[c("span",null,V(m(l)("sideToolbar.queueProgressOverlay.filterAllWorkflows")),1),C.selectedWorkflowFilter==="all"?(d(),$("i",kp)):E("",!0)]),_:1}),y[3]||(y[3]=c("div",{class:"mx-2 mt-1 h-px"},null,-1)),R(Z,{class:"w-full justify-between",variant:"textonly",onClick:y[1]||(y[1]=x=>v("current"))},{default:A(()=>[c("span",null,V(m(l)("sideToolbar.queueProgressOverlay.filterCurrentWorkflow")),1),C.selectedWorkflowFilter==="current"?(d(),$("i",Cp)):E("",!0)]),_:1})])]),_:1},512)),de((d(),O(Z,{variant:"secondary",size:"icon","aria-label":m(l)("sideToolbar.queueProgressOverlay.sortJobs"),onClick:f},{default:A(()=>[y[4]||(y[4]=c("i",{class:"icon-[lucide--arrow-up-down] size-4"},null,-1)),C.selectedSortMode!=="mostRecent"?(d(),$("span",xp)):E("",!0)]),_:1},8,["aria-label"])),[[N,u.value,void 0,{top:!0}]]),R(m(et),{ref_key:"sortPopoverRef",ref:i,dismissable:!0,"close-on-escape":!0,unstyled:"",pt:{root:{class:"absolute z-50"},content:{class:["bg-transparent border-none p-0 pt-2 rounded-lg shadow-lg font-inter"]}}},{default:A(()=>[c("div",Sp,[(d(!0),$(oe,null,be(m(Es),(x,I)=>(d(),$(oe,{key:x},[R(Z,{class:"w-full justify-between",variant:"textonly",size:"sm",onClick:n(_=>k(x),"onClick")},{default:A(()=>[c("span",null,V(h(x)),1),C.selectedSortMode===x?(d(),$("i",_p)):E("",!0)]),_:2},1032,["onClick"]),I<m(Es).length-1?(d(),$("div",Tp)):E("",!0)],64))),128))])]),_:1},512)])])}}}),na=n(e=>{const t=e?.status?.messages;if(!Array.isArray(t)||!t.length)return null;const s=t.find(i=>Array.isArray(i)&&i[0]==="execution_error");if(!s)return null;const l=s[1],a=String(l?.exception_message??"");return{detail:l,message:a}},"extractExecutionError"),Np=n(({taskForJob:e,copyToClipboard:o,dialog:t})=>{const s=b(()=>na(e.value)?.message??"");return{errorMessageValue:s,copyErrorMessage:n(()=>{s.value&&o(s.value)},"copyErrorMessage"),reportJobError:n(()=>{const i=na(e.value);if(i?.detail){t.showExecutionErrorDialog(i.detail);return}s.value&&t.showErrorDialog(new Error(s.value),{reportType:"queueJobError"})},"reportJobError")}},"useJobErrorReporting"),Mn=n(e=>{const o=Math.max(0,Math.floor(e/1e3)),t=Math.floor(o/60),s=o%60;return`${t}m ${s}s`},"formatElapsedTime"),Ip=n(e=>e.historyTasks.map(o=>Number(o.executionTimeInSeconds)).filter(o=>typeof o=="number"&&!Number.isNaN(o)),"pickRecentDurations"),Mp=n(({queueStore:e,executionStore:o,taskForJob:t,jobState:s,firstSeenTs:l,jobsAhead:a,nowTs:i})=>{const r=b(()=>o.runningWorkflowCount),u=b(()=>s.value==="pending"&&!!l.value&&(r.value??0)>1),p=b(()=>Ip(e).slice(-20)),g=b(()=>{const w=p.value;if(!w.length)return null;const h=w.slice().sort((T,M)=>T-M),C=h.reduce((T,M)=>T+M,0)/h.length,y=h[Math.min(h.length-1,Math.floor(h.length*.75))],N=e.runningTasks,x=i.value,I=N.map(T=>T.executionStartTimestamp).filter(T=>typeof T=="number").map(T=>{const M=Math.max(0,Math.floor((x-T)/1e3));return{lo:Math.max(0,Math.round(C-M)),hi:Math.max(0,Math.round(y-M))}});if(!I.length)return null;const _=I.reduce((T,M)=>Math.min(T,M.lo),1/0),S=I.reduce((T,M)=>Math.min(T,M.hi),1/0);return[_,S]}),v=b(()=>{const w=p.value;if(!w.length)return null;const h=a.value;if(h==null)return null;const C=w.slice().sort((_,S)=>_-S),y=C.reduce((_,S)=>_+S,0)/C.length,N=C[Math.min(C.length-1,Math.floor(C.length*.75))];if(h<=0)return g.value??[0,0];const x=Math.max(1,r.value||1),I=Math.ceil(h/x);return[Math.round(y*I),Math.round(N*I)]}),f=b(()=>{const w=p.value;if(!w.length)return null;const h=w.slice().sort((M,P)=>M-P),C=h.reduce((M,P)=>M+P,0)/h.length,y=h[Math.min(h.length-1,Math.floor(h.length*.75))],N=t.value,I=(s.value==="running"?N?.executionStartTimestamp:void 0)??l.value,_=I?Math.max(0,Math.floor((i.value-I)/1e3)):0,S=Math.max(0,Math.round(C-_)),T=Math.max(0,Math.round(y-_));return[S,T]}),k=b(()=>{const w=t.value,C=(s.value==="running"?w?.executionStartTimestamp:void 0)??l.value;return C?Mn(i.value-C):""});return{runningWorkflowCount:r,showParallelQueuedStats:u,estimateRangeSeconds:v,estimateRemainingRangeSeconds:f,timeElapsedValue:k}},"useQueueEstimates"),Pp={class:"w-[300px] min-w-[260px] rounded-lg border border-interface-stroke bg-interface-panel-surface shadow-md"},Dp={class:"flex items-center border-b border-interface-stroke p-4"},Ap={class:"text-[0.875rem] leading-normal font-normal text-text-primary"},Lp={class:"flex flex-col gap-6 px-4 pt-4 pb-4"},Ep={class:"grid grid-cols-2 items-center gap-x-2 gap-y-2"},Vp={class:"flex items-center text-[0.75rem] leading-normal font-normal text-text-primary"},Rp={class:"flex min-w-0 items-center text-[0.75rem] leading-normal font-normal text-text-secondary"},Op={class:"block min-w-0 truncate"},Wp={key:0,class:"grid grid-cols-2 items-center gap-x-2 gap-y-2"},zp={class:"flex items-center text-[0.75rem] leading-normal font-normal text-text-primary"},Bp={class:"flex min-w-0 items-center text-[0.75rem] leading-normal font-normal text-text-secondary"},Fp={class:"block min-w-0 truncate"},Up={key:1,class:"grid grid-cols-2 gap-x-2"},Gp={class:"flex items-center text-[0.75rem] leading-normal font-normal text-text-primary"},Hp={class:"flex items-center justify-between gap-4"},jp={class:"col-span-2 mt-2 rounded bg-interface-panel-hover-surface px-4 py-2 text-[0.75rem] leading-normal text-text-secondary"},qp=q({__name:"JobDetailsPopover",props:{jobId:{},workflowId:{}},setup(e){const o=e,t=b(()=>u("g.copy")),s=Oe(),l=Bt(),a=dt(),i=bt(),{locale:r,t:u}=pe(),p=b(()=>{const j=o.workflowId;if(!j)return"";const Y=s.activeWorkflow?.activeState?.id;return Y&&Y===j?s.activeWorkflow?.filename??j:j}),g=b(()=>o.jobId),{copyToClipboard:v}=Ti(),f=n(()=>{v(g.value)},"copyJobId"),k=b(()=>{const j=o.jobId,Y=n(te=>te.find(X=>String(X.promptId??"")===String(j)),"findIn");return Y(l.pendingTasks)||Y(l.runningTasks)||Y(l.historyTasks)||null}),w=b(()=>{const j=k.value;if(!j)return null;const Y=a.isPromptInitializing(String(j?.promptId));return Ua(j,Y)}),h=b(()=>k.value?.createTime),C=b(()=>h.value!==void 0?Vs(h.value,r.value):""),y=b(()=>{const j=k.value;return j?Number(j.queueIndex):null}),N=b(()=>{const j=y.value;return j==null?null:l.pendingTasks.filter(te=>Number(te.queueIndex)<j).length}),x=b(()=>{if(N.value==null)return"";const j=N.value;return u("queue.jobDetails.queuePositionValue",{count:j},j)}),I=L(Date.now());let _=null;ze(()=>{_=window.setInterval(()=>{I.value=Date.now()},1e3)}),yt(()=>{_!=null&&(clearInterval(_),_=null)});const{showParallelQueuedStats:S,estimateRangeSeconds:T,estimateRemainingRangeSeconds:M,timeElapsedValue:P}=Mp({queueStore:l,executionStore:a,taskForJob:k,jobState:w,firstSeenTs:h,jobsAhead:N,nowTs:I}),B=n((j,Y)=>{if(Y<=60){const ae=Math.max(1,Math.round(Y)),le=Math.max(1,Math.min(ae,Math.round(j)));return le===ae?u("queue.jobDetails.eta.seconds",{count:ae},ae):u("queue.jobDetails.eta.secondsRange",{lo:le,hi:ae})}if(j>=60&&Y<90)return u("queue.jobDetails.eta.minutes",{count:1},1);const te=Math.max(1,Math.floor(j/60)),X=Math.max(te,Math.ceil(Y/60));return te===X?u("queue.jobDetails.eta.minutes",{count:te},te):u("queue.jobDetails.eta.minutesRange",{lo:te,hi:X})},"formatEta"),H=b(()=>{const j=T.value;if(!j)return"";const[Y,te]=j;return B(Y,te)}),z=b(()=>{const j=M.value;if(!j)return"";const[Y,te]=j;return B(Y,te)}),G=b(()=>[{label:u("queue.jobDetails.workflow"),value:p.value},{label:u("queue.jobDetails.jobId"),value:g.value,canCopy:!0}]),U=b(()=>{if(w.value==="pending"){if(!h.value)return[];const j=[{label:u("queue.jobDetails.queuedAt"),value:C.value}];return S.value&&j.push({label:u("queue.jobDetails.queuePosition"),value:x.value},{label:u("queue.jobDetails.timeElapsed"),value:P.value},{label:u("queue.jobDetails.estimatedStartIn"),value:H.value}),j}if(w.value==="running")return h.value?[{label:u("queue.jobDetails.queuedAt"),value:C.value},{label:u("queue.jobDetails.timeElapsed"),value:P.value},{label:u("queue.jobDetails.estimatedFinishIn"),value:z.value}]:[];if(w.value==="completed"){const j=k.value,Y=j?.executionEndTimestamp,te=j?.executionTime,X=Y?Vs(Y,r.value):"",ae=te!==void 0?Mn(te):"";return te!==void 0&&(te/36e5).toFixed(3)+"",[{label:u("queue.jobDetails.generatedOn"),value:X},{label:u("queue.jobDetails.totalGenerationTime"),value:ae}]}if(w.value==="failed"){const Y=k.value?.executionTime,te=Y!==void 0?Mn(Y):"";return Y!==void 0&&(Y/36e5).toFixed(3)+"",[{label:u("queue.jobDetails.queuedAt"),value:C.value},{label:u("queue.jobDetails.failedAfter"),value:te}]}return[]}),{errorMessageValue:W,copyErrorMessage:F,reportJobError:Q}=Np({taskForJob:k,copyToClipboard:v,dialog:i});return(j,Y)=>(d(),$("div",Pp,[c("div",Dp,[c("span",Ap,V(m(u)("queue.jobDetails.header")),1)]),c("div",Lp,[c("div",Ep,[(d(!0),$(oe,null,be(G.value,te=>(d(),$(oe,{key:te.label},[c("div",Vp,V(te.label),1),c("div",Rp,[c("span",Op,V(te.value),1),te.canCopy?(d(),O(Z,{key:0,size:"icon",variant:"muted-textonly","aria-label":t.value,onClick:Ce(f,["stop"])},{default:A(()=>Y[0]||(Y[0]=[c("i",{class:"icon-[lucide--copy] size-4"},null,-1)])),_:1},8,["aria-label"])):E("",!0)])],64))),128))]),U.value.length?(d(),$("div",Wp,[(d(!0),$(oe,null,be(U.value,te=>(d(),$(oe,{key:te.label},[c("div",zp,V(te.label),1),c("div",Bp,[c("span",Fp,V(te.value),1)])],64))),128))])):E("",!0),w.value==="failed"?(d(),$("div",Up,[c("div",Gp,V(m(u)("queue.jobDetails.errorMessage")),1),c("div",Hp,[R(Z,{class:"justify-start px-0",variant:"muted-textonly",size:"sm","icon-position":"right",onClick:Ce(m(F),["stop"])},{default:A(()=>[c("span",null,V(t.value),1),Y[1]||(Y[1]=c("i",{class:"icon-[lucide--copy] block size-3.5 leading-none"},null,-1))]),_:1},8,["onClick"]),R(Z,{class:"justify-start px-0",variant:"muted-textonly",size:"sm","icon-position":"right",onClick:Ce(m(Q),["stop"])},{default:A(()=>[c("span",null,V(m(u)("queue.jobDetails.report")),1),Y[2]||(Y[2]=c("i",{class:"icon-[lucide--message-circle-warning] block size-3.5 leading-none"},null,-1))]),_:1},8,["onClick"])]),c("div",jp,V(m(W)),1)])):E("",!0)])]))}}),Kp={class:"w-[300px] min-w-[260px] rounded-lg shadow-md"},Qp={class:"p-3"},Yp={class:"relative aspect-square w-full overflow-hidden rounded-lg"},Jp=["src","alt"],Xp={key:0,class:"absolute bottom-2 left-2 rounded px-2 py-0.5 text-xs text-text-primary",style:{background:"rgba(217, 217, 217, 0.40)",backdropFilter:"blur(2px)"}},Zp={class:"mt-2 text-center"},ef=["title"],tf={key:0,class:"mt-1 text-[0.75rem] leading-normal text-text-secondary"},of=q({inheritAttrs:!1,__name:"QueueAssetPreview",props:{imageUrl:{},name:{},timeLabel:{}},emits:["image-click"],setup(e){const o=L(null),t=L(null),s=L(null),l=n(()=>{const a=o.value;a&&(t.value=a.naturalWidth||null,s.value=a.naturalHeight||null)},"onImgLoad");return(a,i)=>(d(),$("div",Kp,[c("div",Qp,[c("div",Yp,[c("img",{ref_key:"imgRef",ref:o,src:a.imageUrl,alt:a.name,class:"h-full w-full cursor-pointer object-contain",onClick:i[0]||(i[0]=r=>a.$emit("image-click")),onLoad:l},null,40,Jp),a.timeLabel?(d(),$("div",Xp,V(a.timeLabel),1)):E("",!0)]),c("div",Zp,[c("div",{class:"truncate text-[0.875rem] leading-normal font-semibold text-text-primary",title:a.name},V(a.name),9,ef),t.value&&s.value?(d(),$("div",tf,V(t.value)+"x"+V(s.value),1)):E("",!0)])])]))}}),nf={class:"relative z-1 flex items-center gap-1"},sf={class:"relative inline-flex items-center justify-center"},af={class:"inline-flex h-6 w-6 items-center justify-center overflow-hidden rounded-[6px]"},lf=["src"],rf={class:"relative z-1 min-w-0 flex-1"},uf=["title"],cf={class:"relative z-1 flex items-center gap-2 text-text-secondary"},df={key:"actions",class:"inline-flex items-center gap-2 pr-1"},pf={key:"secondary",class:"pr-2"},ff=q({__name:"QueueJobItem",props:{jobId:{},workflowId:{default:void 0},state:{},title:{},rightText:{default:""},iconName:{default:void 0},iconImageUrl:{default:void 0},showClear:{type:Boolean,default:void 0},showMenu:{type:Boolean,default:void 0},progressTotalPercent:{default:void 0},progressCurrentPercent:{default:void 0},activeDetailsId:{default:null}},emits:["cancel","delete","menu","view","details-enter","details-leave"],setup(e,{emit:o}){const t=e,s=o,{t:l}=pe(),{progressBarContainerClass:a,progressBarPrimaryClass:i,progressBarSecondaryClass:r,hasProgressPercent:u,hasAnyProgressPercent:p,progressPercentStyle:g}=$i(),v=b(()=>nt(l("g.cancel"))),f=b(()=>nt(l("g.delete"))),k=b(()=>nt(l("g.more"))),w=L(null),h=b(()=>t.activeDetailsId===t.jobId),C=n(()=>{I.value||s("details-enter",t.jobId)},"onRowEnter"),y=n(()=>s("details-leave",t.jobId),"onRowLeave"),N=n(()=>s("details-enter",t.jobId),"onPopoverEnter"),x=n(()=>s("details-leave",t.jobId),"onPopoverLeave"),I=L(!1),_=L(null),S=L(null),T=n(()=>{_.value!==null&&(clearTimeout(_.value),_.value=null)},"clearPreviewHideTimer"),M=n(()=>{S.value!==null&&(clearTimeout(S.value),S.value=null)},"clearPreviewShowTimer"),P=b(()=>t.state==="completed"&&!!t.iconImageUrl),B=n(()=>{P.value&&(T(),M(),S.value=window.setTimeout(()=>{I.value=!0,S.value=null},200))},"scheduleShowPreview"),H=n(()=>{T(),M(),_.value=window.setTimeout(()=>{I.value=!1,_.value=null},150)},"scheduleHidePreview"),z=n(()=>B(),"onIconEnter"),G=n(()=>H(),"onIconLeave"),U=n(()=>B(),"onPreviewEnter"),W=n(()=>H(),"onPreviewLeave"),F=L(null),Q=n(()=>{const Ve=w.value;if(!Ve)return;const _e=Ve.getBoundingClientRect(),Be=8;F.value={top:_e.top,right:window.innerWidth-_e.left+Be}},"updatePopoverPosition"),j=b(()=>h.value||I.value&&P.value);se(j,Ve=>{Ve?Fe(Q):F.value=null},{immediate:!1});const Y=L(!1),te=b(()=>t.iconName?t.iconName:Rs(t.state)),X=b(()=>t.state==="pending"&&te.value===Rs("pending")&&!t.iconImageUrl),ae=b(()=>t.showClear!==void 0?t.showClear:t.state!=="completed"),le=n(()=>s("details-leave",t.jobId),"emitDetailsLeave"),Ne=n(()=>{le(),s("cancel")},"onCancelClick"),Ue=n(()=>{le(),s("delete")},"onDeleteClick"),Qe=n(Ve=>{(t.showMenu===void 0||t.showMenu)&&s("menu",Ve)},"onContextMenu");return(Ve,_e)=>{const Be=Ie("tooltip");return d(),$("div",{ref_key:"rowRef",ref:w,class:"relative",onMouseenter:C,onMouseleave:y,onContextmenu:Ce(Qe,["stop","prevent"])},[(d(),O(Mt,{to:"body"},[!I.value&&h.value&&F.value?(d(),$("div",{key:0,class:"fixed z-50",style:ve({top:`${F.value.top}px`,right:`${F.value.right}px`}),onMouseenter:N,onMouseleave:x},[R(qp,{"job-id":t.jobId,"workflow-id":t.workflowId},null,8,["job-id","workflow-id"])],36)):E("",!0)])),(d(),O(Mt,{to:"body"},[I.value&&P.value&&F.value?(d(),$("div",{key:0,class:"fixed z-50",style:ve({top:`${F.value.top}px`,right:`${F.value.right}px`}),onMouseenter:U,onMouseleave:W},[R(of,{"image-url":Ve.iconImageUrl,name:t.title,"time-label":Ve.rightText||void 0,onImageClick:_e[0]||(_e[0]=Je=>s("view"))},null,8,["image-url","name","time-label"])],36)):E("",!0)])),c("div",{class:"relative flex items-center justify-between gap-2 overflow-hidden rounded-lg border border-secondary-background bg-secondary-background p-1 text-[12px] text-text-primary transition-colors duration-150 ease-in-out hover:border-secondary-background-hover hover:bg-secondary-background-hover",onMouseenter:_e[3]||(_e[3]=Je=>Y.value=!0),onMouseleave:_e[4]||(_e[4]=Je=>Y.value=!1)},[t.state==="running"&&m(p)(t.progressTotalPercent,t.progressCurrentPercent)?(d(),$("div",{key:0,class:K(m(a))},[m(u)(t.progressTotalPercent)?(d(),$("div",{key:0,class:K(m(i)),style:ve(m(g)(t.progressTotalPercent))},null,6)):E("",!0),m(u)(t.progressCurrentPercent)?(d(),$("div",{key:1,class:K(m(r)),style:ve(m(g)(t.progressCurrentPercent))},null,6)):E("",!0)],2)):E("",!0),c("div",nf,[c("div",sf,[c("div",{class:"absolute left-1/2 top-1/2 size-10 -translate-x-1/2 -translate-y-1/2",onMouseenter:Ce(z,["stop"]),onMouseleave:Ce(G,["stop"])},null,32),c("div",af,[Ve.iconImageUrl?(d(),$("img",{key:0,src:Ve.iconImageUrl,class:"h-full w-full object-cover"},null,8,lf)):(d(),$("i",{key:1,class:K(m(ne)(te.value,"size-4",X.value&&"animate-spin"))},null,2))])])]),c("div",rf,[c("div",{class:"truncate opacity-90",title:t.title},[ye(Ve.$slots,"primary",{},()=>[$e(V(t.title),1)])],8,uf)]),c("div",cf,[R(Xo,{mode:"out-in","enter-active-class":"transition-opacity transition-transform duration-150 ease-out","leave-active-class":"transition-opacity transition-transform duration-150 ease-in","enter-from-class":"opacity-0 translate-y-0.5","enter-to-class":"opacity-100 translate-y-0","leave-from-class":"opacity-100 translate-y-0","leave-to-class":"opacity-0 translate-y-0.5"},{default:A(()=>[Y.value?(d(),$("div",df,[t.state==="failed"&&ae.value?de((d(),O(Z,{key:0,variant:"destructive",size:"icon","aria-label":m(l)("g.delete"),onClick:Ce(Ue,["stop"])},{default:A(()=>_e[5]||(_e[5]=[c("i",{class:"icon-[lucide--trash-2] size-4"},null,-1)])),_:1},8,["aria-label"])),[[Be,f.value,void 0,{top:!0}]]):t.state!=="completed"&&t.state!=="running"&&ae.value?de((d(),O(Z,{key:1,variant:"destructive",size:"icon","aria-label":m(l)("g.cancel"),onClick:Ce(Ne,["stop"])},{default:A(()=>_e[6]||(_e[6]=[c("i",{class:"icon-[lucide--x] size-4"},null,-1)])),_:1},8,["aria-label"])),[[Be,v.value,void 0,{top:!0}]]):t.state==="completed"?(d(),O(Z,{key:2,variant:"textonly",size:"sm",onClick:_e[1]||(_e[1]=Ce(Je=>s("view"),["stop"]))},{default:A(()=>[$e(V(m(l)("menuLabels.View")),1)]),_:1})):E("",!0),t.showMenu===void 0||t.showMenu?de((d(),O(Z,{key:3,variant:"textonly",size:"icon-sm","aria-label":m(l)("g.more"),onClick:_e[2]||(_e[2]=Ce(Je=>s("menu",Je),["stop"]))},{default:A(()=>_e[7]||(_e[7]=[c("i",{class:"icon-[lucide--more-horizontal] size-4"},null,-1)])),_:1},8,["aria-label"])),[[Be,k.value,void 0,{top:!0}]]):E("",!0)])):t.state!=="running"?(d(),$("div",pf,[ye(Ve.$slots,"secondary",{},()=>[$e(V(t.rightText),1)])])):E("",!0)]),_:3}),t.state==="running"&&ae.value?de((d(),O(Z,{key:0,variant:"destructive",size:"icon","aria-label":m(l)("g.cancel"),onClick:Ce(Ne,["stop"])},{default:A(()=>_e[8]||(_e[8]=[c("i",{class:"icon-[lucide--x] size-4"},null,-1)])),_:1},8,["aria-label"])),[[Be,v.value,void 0,{top:!0}]]):E("",!0)])],32)],544)}}}),mf={class:"flex flex-col gap-4 px-3 pb-4"},gf={class:"text-[12px] leading-none text-text-secondary"},vf=q({__name:"JobGroupsList",props:{displayedJobGroups:{}},emits:["cancelItem","deleteItem","menu","viewItem"],setup(e,{emit:o}){const t=e,s=o,l=n(w=>{s("cancelItem",w)},"emitCancelItem"),a=n(w=>{s("deleteItem",w)},"emitDeleteItem"),i=L(null),r=L(null),u=L(null),p=n(()=>{r.value!==null&&(clearTimeout(r.value),r.value=null)},"clearHideTimer"),g=n(()=>{u.value!==null&&(clearTimeout(u.value),u.value=null)},"clearShowTimer"),v=n(w=>{p(),g(),u.value=window.setTimeout(()=>{i.value=w,u.value=null},200)},"onDetailsEnter"),f=n(w=>{p(),g(),r.value=window.setTimeout(()=>{i.value===w&&(i.value=null),r.value=null},150)},"onDetailsLeave"),k=n(()=>{p(),g(),i.value=null},"resetActiveDetails");return se(()=>t.displayedJobGroups,w=>{const h=i.value;if(!h)return;w.some(y=>y.items.some(N=>N.id===h))||k()}),ut(k),(w,h)=>(d(),$("div",mf,[(d(!0),$(oe,null,be(w.displayedJobGroups,C=>(d(),$("div",{key:C.key,class:"flex flex-col gap-2"},[c("div",gf,V(C.label),1),(d(!0),$(oe,null,be(C.items,y=>(d(),O(ff,{key:y.id,"job-id":y.id,"workflow-id":y.taskRef?.workflow?.id,state:y.state,title:y.title,"right-text":y.meta,"icon-name":y.iconName,"icon-image-url":y.iconImageUrl,"show-clear":y.showClear,"show-menu":!0,"progress-total-percent":y.progressTotalPercent,"progress-current-percent":y.progressCurrentPercent,"running-node-name":y.runningNodeName,"active-details-id":i.value,onCancel:n(N=>l(y),"onCancel"),onDelete:n(N=>a(y),"onDelete"),onMenu:n(N=>w.$emit("menu",y,N),"onMenu"),onView:n(N=>w.$emit("viewItem",y),"onView"),onDetailsEnter:v,onDetailsLeave:f},null,8,["job-id","workflow-id","state","title","right-text","icon-name","icon-image-url","show-clear","progress-total-percent","progress-current-percent","running-node-name","active-details-id","onCancel","onDelete","onMenu","onView"]))),128))]))),128))]))}}),hf={class:"flex w-full flex-col gap-4"},yf={class:"flex items-center justify-between px-3"},bf={class:"ml-4 inline-flex items-center"},wf={class:"inline-flex h-6 items-center text-[12px] leading-none text-text-primary opacity-90"},kf={class:"font-bold"},Cf={class:"ml-1"},xf={class:"flex-1 min-h-0 overflow-y-auto"},Sf=q({__name:"QueueOverlayExpanded",props:{headerTitle:{},showConcurrentIndicator:{type:Boolean},concurrentWorkflowCount:{},queuedCount:{},selectedJobTab:{},selectedWorkflowFilter:{},selectedSortMode:{},displayedJobGroups:{},hasFailedJobs:{type:Boolean}},emits:["showAssets","clearHistory","clearQueued","update:selectedJobTab","update:selectedWorkflowFilter","update:selectedSortMode","cancelItem","deleteItem","viewItem"],setup(e,{emit:o}){const t=o,{t:s}=pe(),l=L(null),a=L(null),{jobMenuEntries:i}=Ni(()=>l.value,v=>t("viewItem",v)),r=n(v=>{t("cancelItem",v)},"onCancelItemEvent"),u=n(v=>{t("deleteItem",v)},"onDeleteItemEvent"),p=n((v,f)=>{l.value=v,a.value?.open(f)},"onMenuItem"),g=n(async v=>{v.kind!=="divider"&&(v.onClick&&await v.onClick(),a.value?.hide())},"onJobMenuAction");return(v,f)=>(d(),$("div",hf,[R(dp,{"header-title":v.headerTitle,"show-concurrent-indicator":v.showConcurrentIndicator,"concurrent-workflow-count":v.concurrentWorkflowCount,onClearHistory:f[0]||(f[0]=k=>v.$emit("clearHistory"))},null,8,["header-title","show-concurrent-indicator","concurrent-workflow-count"]),c("div",yf,[R(Z,{class:"grow gap-1 justify-center",variant:"secondary",size:"sm",onClick:f[1]||(f[1]=k=>v.$emit("showAssets"))},{default:A(()=>[f[7]||(f[7]=c("i",{class:"icon-[comfy--image-ai-edit] size-4"},null,-1)),c("span",null,V(m(s)("sideToolbar.queueProgressOverlay.showAssets")),1)]),_:1}),c("div",bf,[c("div",wf,[c("span",kf,V(v.queuedCount),1),c("span",Cf,V(m(s)("sideToolbar.queueProgressOverlay.queuedSuffix")),1)]),v.queuedCount>0?(d(),O(Z,{key:0,class:"ml-2",variant:"destructive",size:"icon","aria-label":m(s)("sideToolbar.queueProgressOverlay.clearQueued"),onClick:f[2]||(f[2]=k=>v.$emit("clearQueued"))},{default:A(()=>f[8]||(f[8]=[c("i",{class:"icon-[lucide--list-x] size-4"},null,-1)])),_:1},8,["aria-label"])):E("",!0)])]),R($p,{"selected-job-tab":v.selectedJobTab,"selected-workflow-filter":v.selectedWorkflowFilter,"selected-sort-mode":v.selectedSortMode,"has-failed-jobs":v.hasFailedJobs,"onUpdate:selectedJobTab":f[3]||(f[3]=k=>v.$emit("update:selectedJobTab",k)),"onUpdate:selectedWorkflowFilter":f[4]||(f[4]=k=>v.$emit("update:selectedWorkflowFilter",k)),"onUpdate:selectedSortMode":f[5]||(f[5]=k=>v.$emit("update:selectedSortMode",k))},null,8,["selected-job-tab","selected-workflow-filter","selected-sort-mode","has-failed-jobs"]),c("div",xf,[R(vf,{"displayed-job-groups":v.displayedJobGroups,onCancelItem:r,onDeleteItem:u,onViewItem:f[6]||(f[6]=k=>v.$emit("viewItem",k)),onMenu:p},null,8,["displayed-job-groups"])]),R(mp,{ref_key:"jobContextMenuRef",ref:a,entries:m(i),onAction:g},null,8,["entries"])]))}}),_f={class:"w-[360px] rounded-2xl border border-interface-stroke bg-interface-panel-surface text-text-primary shadow-interface font-inter"},Tf={class:"flex items-center justify-between border-b border-interface-stroke px-4 py-4"},$f={class:"m-0 text-[14px] font-normal leading-none"},Nf={class:"flex flex-col gap-4 px-4 py-4 text-[14px] text-text-secondary"},If={class:"m-0"},Mf={class:"m-0"},Pf={class:"flex items-center justify-end px-4 py-4"},Df={class:"flex items-center gap-4 leading-none"},Af=q({__name:"QueueClearHistoryDialog",setup(e){const o=ct(),t=Bt(),{t:s}=pe(),{wrapWithErrorHandlingAsync:l}=Ft(),a=L(!1),i=l(async()=>{await t.clear(["history"]),o.closeDialog()},void 0,()=>{a.value=!1}),r=n(async()=>{a.value||(a.value=!0,await i())},"onConfirm"),u=n(()=>{o.closeDialog()},"onCancel");return(p,g)=>(d(),$("section",_f,[c("header",Tf,[c("p",$f,V(m(s)("sideToolbar.queueProgressOverlay.clearHistoryDialogTitle")),1),R(Z,{size:"icon",variant:"muted-textonly","aria-label":m(s)("g.close"),onClick:u},{default:A(()=>g[0]||(g[0]=[c("i",{class:"icon-[lucide--x] block size-4 leading-none"},null,-1)])),_:1},8,["aria-label"])]),c("div",Nf,[c("p",If,V(m(s)("sideToolbar.queueProgressOverlay.clearHistoryDialogDescription")),1),c("p",Mf,V(m(s)("sideToolbar.queueProgressOverlay.clearHistoryDialogAssetsNote")),1)]),c("footer",Pf,[c("div",Df,[R(Z,{variant:"muted-textonly",size:"lg",onClick:u},{default:A(()=>[$e(V(m(s)("g.cancel")),1)]),_:1}),R(Z,{variant:"secondary",size:"lg",disabled:a.value,onClick:r},{default:A(()=>[$e(V(m(s)("g.clear")),1)]),_:1},8,["disabled"])])])]))}}),Lf=n(()=>{const e=Bt(),o=dt(),t=b(()=>e.runningTasks.length>0||!o.isIdle),s=L(null),l=L(null),a=L(null),i=n(()=>{a.value!==null&&(clearTimeout(a.value),a.value=null)},"clearDismissTimer"),r=n(()=>{i(),a.value=window.setTimeout(()=>{l.value=null,a.value=null},6e3)},"startDismissTimer"),u=n(()=>{l.value=null,i()},"clearSummary");return se(t,(g,v)=>{if(!v&&g&&(s.value=Date.now()),v&&!g){const f=s.value??0,k=e.historyTasks.filter(N=>{const x=N.executionEndTimestamp;return typeof x=="number"&&x>=f});if(!k.length){l.value=null,i();return}let w=0,h=0;const C=[];for(const N of k){const x=Ua(N,!1);if(x==="completed"){w++;const I=N.previewOutput;I?.isImage&&C.push(I.urlWithTimestamp)}else x==="failed"&&h++}if(w===0&&h===0){l.value=null,i();return}let y="mixed";h===0?y="allSuccess":w===0&&(y="allFailed"),l.value={mode:y,completedCount:w,failedCount:h,thumbnailUrls:C.slice(0,3)},r()}},{immediate:!0}),{summary:b(()=>l.value),clearSummary:u}},"useCompletionSummary");function Ef(e){const o=L(-1),t=Ze([]);return{galleryActiveIndex:o,galleryItems:t,onViewItem:n(l=>{const a=e().flatMap(u=>{const p=u.previewOutput;return p&&p.supportsPreview?[p]:[]});if(!a.length)return;t.value=a;const i=l.taskRef?.previewOutput?.url,r=i?a.findIndex(u=>u.url===i):0;o.value=r>=0?r:0},"onViewItem")}}n(Ef,"useResultGallery");const Vf={class:K(["flex","justify-end","w-full","pointer-events-none"])},Rf=q({__name:"QueueProgressOverlay",props:{expanded:{type:Boolean},menuHovered:{type:Boolean,default:!1}},emits:["update:expanded"],setup(e,{emit:o}){const t=e,s=o,{t:l}=pe(),a=Bt(),i=Se(),r=dt(),u=jo(),p=ct(),g=Kn(),v=Ii(),{wrapWithErrorHandlingAsync:f}=Ft(),{totalPercentFormatted:k,currentNodePercentFormatted:w,totalProgressStyle:h,currentNodeProgressStyle:C}=Mi(),y=L(!1),N=b(()=>y.value||t.menuHovered),x=L(!1),I=b({get:n(()=>t.expanded===void 0?x.value:t.expanded,"get"),set:n(we=>{t.expanded===void 0&&(x.value=we),s("update:expanded",we)},"set")}),{summary:_,clearSummary:S}=Lf(),T=b(()=>_.value!==null),M=b(()=>a.runningTasks.length),P=b(()=>a.pendingTasks.length),B=b(()=>!r.isIdle),H=b(()=>M.value>0||B.value),z=b(()=>M.value+P.value),G=b(()=>I.value?"expanded":H.value?"active":T.value?"empty":"hidden"),U=b(()=>G.value==="expanded"||G.value==="empty"||G.value==="active"&&N.value),W=b(()=>G.value!=="hidden"),F=b(()=>U.value?"border-interface-stroke bg-interface-panel-surface shadow-interface":"border-transparent bg-transparent shadow-none"),Q=b(()=>`flex items-center justify-end gap-4 transition-opacity duration-200 ease-in-out ${G.value==="active"&&N.value?"opacity-100 pointer-events-auto":"opacity-0 pointer-events-none"}`),j=b(()=>H.value?`${z.value} ${l("sideToolbar.queueProgressOverlay.activeJobsSuffix")}`:l("sideToolbar.queueProgressOverlay.jobQueue")),Y=b(()=>r.runningWorkflowCount),te=b(()=>Y.value>1),{selectedJobTab:X,selectedWorkflowFilter:ae,selectedSortMode:le,hasFailedJobs:Ne,filteredTasks:Ue,groupedJobItems:Qe,currentNodeName:Ve}=Pi(),_e=b(()=>Qe.value),Be=f(async we=>{const Ee=we.taskRef?.promptId;Ee&&(we.state==="running"||we.state==="initialization"?(await Te.interrupt(Ee),await a.update()):we.state==="pending"&&(await Te.deleteItem("queue",Ee),await a.update()))}),Je=f(async we=>{we.taskRef&&await a.delete(we.taskRef)}),{galleryActiveIndex:wt,galleryItems:fo,onViewItem:jt}=Ef(()=>Ue.value),qt=n(we=>{I.value=we},"setExpanded"),ft=n(()=>{qt(!0)},"openExpandedFromEmpty"),$t=n(()=>{qt(!0)},"viewAllJobs"),Lt=n(()=>{ft(),S()},"onSummaryClick"),ot=n(()=>{u.activeSidebarTabId="assets"},"openAssetsSidebar"),Kt=n(async we=>{const Ee=we.taskRef,ee=Ee?.promptId,ie=Ee?.previewOutput;if(!ee||!ie)return;const mt=String(ee);if(ot(),await Fe(),await g.updateHistory(),!g.historyAssets.find(Nt=>Nt.id===mt))throw new Error("Asset not found in media assets panel");v.setSelection([mt])},"focusAssetInSidebar"),mo=f(async we=>{jt(we),await Kt(we)}),Qt=f(async()=>{await i.execute("Comfy.ClearPendingTasks")}),fe=f(async()=>{const Ee=a.runningTasks.map(ee=>ee.promptId).filter(ee=>typeof ee=="string"&&ee.length>0);Ee.length&&await Promise.all(Ee.map(ee=>Te.interrupt(ee)))}),xe=n(()=>{p.showDialog({key:"queue-clear-history",component:Af,dialogComponentProps:{headless:!0,closable:!1,closeOnEscape:!0,dismissableMask:!0,pt:{root:{class:"max-w-[360px] w-auto bg-transparent border-none shadow-none"},content:{class:"!p-0 bg-transparent"}}}})},"showClearHistoryDialog"),De=n(()=>{xe()},"onClearHistoryFromMenu");return(we,Ee)=>(d(),$(oe,null,[de(c("div",Vf,[c("div",{class:K(["pointer-events-auto flex w-[350px] min-w-[310px] max-h-[60vh] flex-col overflow-hidden rounded-lg border font-inter transition-colors duration-200 ease-in-out",F.value]),onMouseenter:Ee[3]||(Ee[3]=ee=>y.value=!0),onMouseleave:Ee[4]||(Ee[4]=ee=>y.value=!1)},[I.value?(d(),O(Sf,{key:0,"selected-job-tab":m(X),"onUpdate:selectedJobTab":Ee[0]||(Ee[0]=ee=>it(X)?X.value=ee:null),"selected-workflow-filter":m(ae),"onUpdate:selectedWorkflowFilter":Ee[1]||(Ee[1]=ee=>it(ae)?ae.value=ee:null),"selected-sort-mode":m(le),"onUpdate:selectedSortMode":Ee[2]||(Ee[2]=ee=>it(le)?le.value=ee:null),class:"flex-1 min-h-0","header-title":j.value,"show-concurrent-indicator":te.value,"concurrent-workflow-count":Y.value,"queued-count":P.value,"displayed-job-groups":_e.value,"has-failed-jobs":m(Ne),onShowAssets:ot,onClearHistory:De,onClearQueued:m(Qt),onCancelItem:m(Be),onDeleteItem:m(Je),onViewItem:m(mo)},null,8,["selected-job-tab","selected-workflow-filter","selected-sort-mode","header-title","show-concurrent-indicator","concurrent-workflow-count","queued-count","displayed-job-groups","has-failed-jobs","onClearQueued","onCancelItem","onDeleteItem","onViewItem"])):H.value?(d(),O(Gd,{key:1,"total-progress-style":m(h),"current-node-progress-style":m(C),"total-percent-formatted":m(k),"current-node-percent-formatted":m(w),"current-node-name":m(Ve),"running-count":M.value,"queued-count":P.value,"bottom-row-class":Q.value,onInterruptAll:m(fe),onClearQueued:m(Qt),onViewAllJobs:$t},null,8,["total-progress-style","current-node-progress-style","total-percent-formatted","current-node-percent-formatted","current-node-name","running-count","queued-count","bottom-row-class","onInterruptAll","onClearQueued"])):m(_)?(d(),O(np,{key:2,summary:m(_),onSummaryClick:Lt},null,8,["summary"])):E("",!0)],34)],512),[[Xe,W.value]]),R(Di,{"active-index":m(wt),"onUpdate:activeIndex":Ee[5]||(Ee[5]=ee=>it(wt)?wt.value=ee:null),"all-gallery-items":m(fo)},null,8,["active-index","all-gallery-items"])],64))}}),Of=At("actionBarButton",()=>{const e=Zn();return{buttons:b(()=>e.extensions.flatMap(t=>t.actionBarButtons??[]))}}),Wf={class:"flex h-full shrink-0 items-center gap-1"},zf={key:0},Bf=q({__name:"ActionBarButtons",setup(e){const o=Of(),s=Jo(en).smaller("sm");return(l,a)=>{const i=Ie("tooltip");return d(),$("div",Wf,[(d(!0),$(oe,null,be(m(o).buttons,(r,u)=>de((d(),O(Z,{key:u,"aria-label":r.tooltip||r.label,class:K([r.class,"h-7 rounded-full"]),variant:"muted-textonly",size:"sm",onClick:r.onClick},{default:A(()=>[c("i",{class:K(r.icon)},null,2),!m(s)&&r.label?(d(),$("span",zf,V(r.label),1)):E("",!0)]),_:2},1032,["aria-label","class","onClick"])),[[i,r.tooltip,void 0,{bottom:!0}]])),128))])}}}),Ff={class:"current-user-popover w-80 -m-3 p-2 rounded-lg border border-border-default bg-base-background shadow-[1px_1px_8px_0_rgba(0,0,0,0.4)]"},Uf={class:"flex flex-col items-center px-0 py-3 mb-4"},Gf={class:"my-0 mb-1 truncate text-base font-bold text-base-foreground"},Hf={key:0,class:"my-0 truncate text-sm text-muted"},jf={key:1,class:"my-0 text-xs text-foreground bg-secondary-background-hover rounded-full uppercase px-2 py-0.5 font-bold mt-2"},qf={key:0,class:"flex items-center gap-2 px-4 py-2"},Kf={key:1,class:"text-base font-semibold text-base-foreground"},Qf={class:"icon-[lucide--circle-help] cursor-help text-base text-muted-foreground mr-auto"},Yf={key:1,class:"flex justify-center px-4"},Jf={class:"text-sm text-base-foreground flex-1"},Xf={class:"text-sm text-base-foreground flex-1"},Zf={key:0,class:"text-xs font-bold text-base-background bg-base-foreground px-1.5 py-0.5 rounded-full"},em={class:"text-sm text-base-foreground flex-1"},tm={class:"text-sm text-base-foreground flex-1"},om={class:"text-sm text-base-foreground flex-1"},nm=q({__name:"CurrentUserPopover",emits:["close"],setup(e,{emit:o}){const t=o,{buildDocsUrl:s,docsPaths:l}=uo(),{userDisplayName:a,userEmail:i,userPhotoUrl:r,handleSignOut:u}=Ut(),p=Ga(),g=Ha(),v=bt(),{isActiveSubscription:f,subscriptionTierName:k,subscriptionTier:w,fetchStatus:h}=Yn(),C=sd(),{locale:y}=pe(),N=b(()=>{const H=g.balance?.effective_balance_micros??g.balance?.amount_micros??0;return Ai({cents:H,locale:y.value,numberOptions:{minimumFractionDigits:0,maximumFractionDigits:2}})}),x=b(()=>{const H=w.value;return H==="FOUNDERS_EDITION"||H==="STANDARD"||H==="CREATOR"}),I=n(()=>{v.showSettingsDialog("user"),t("close")},"handleOpenUserSettings"),_=n(()=>{C.show(),t("close")},"handleOpenPlansAndPricing"),S=n(()=>{v.showSettingsDialog("credits"),t("close")},"handleOpenPlanAndCreditsSettings"),T=n(()=>{v.showTopUpCreditsDialog(),t("close")},"handleTopUp"),M=n(()=>{window.open(s(l.partnerNodesPricing,{includeLocale:!0}),"_blank"),t("close")},"handleOpenPartnerNodesInfo"),P=n(async()=>{await u(),t("close")},"handleLogout"),B=n(async()=>{await h()},"handleSubscribed");return ze(()=>{p.fetchBalance()}),(H,z)=>{const G=Ie("tooltip");return d(),$("div",Ff,[c("div",Uf,[R(rl,{class:"mb-1","photo-url":m(r),"pt:icon:class":{"text-2xl!":!m(r)},size:"large"},null,8,["photo-url","pt:icon:class"]),c("h3",Gf,V(m(a)||H.$t("g.user")),1),m(i)?(d(),$("p",Hf,V(m(i)),1)):E("",!0),m(k)?(d(),$("span",jf,V(m(k)),1)):E("",!0)]),m(f)?(d(),$("div",qf,[z[0]||(z[0]=c("i",{class:"icon-[lucide--component] text-amber-400 text-sm"},null,-1)),m(g).isFetchingBalance?(d(),O(m(jn),{key:0,width:"4rem",height:"1.25rem",class:"w-full"})):(d(),$("span",Kf,V(N.value),1)),de(c("i",Qf,null,512),[[G,{value:H.$t("credits.unified.tooltip"),showDelay:300}]]),R(Z,{variant:"secondary",size:"sm",class:"text-base-foreground","data-testid":"add-credits-button",onClick:T},{default:A(()=>[$e(V(H.$t("subscription.addCredits")),1)]),_:1})])):(d(),$("div",Yf,[R(nd,{fluid:!1,label:H.$t("subscription.subscribeToComfyCloud"),size:"sm",variant:"gradient",onSubscribed:B},null,8,["label"])])),R(m(Ds),{class:"my-2 mx-0"}),m(f)?(d(),$("div",{key:2,class:"flex items-center gap-2 px-4 py-2 cursor-pointer hover:bg-secondary-background-hover","data-testid":"partner-nodes-menu-item",onClick:M},[z[1]||(z[1]=c("i",{class:"icon-[lucide--tag] text-muted-foreground text-sm"},null,-1)),c("span",Jf,V(H.$t("subscription.partnerNodesCredits")),1)])):E("",!0),c("div",{class:"flex items-center gap-2 px-4 py-2 cursor-pointer hover:bg-secondary-background-hover","data-testid":"plans-pricing-menu-item",onClick:_},[z[2]||(z[2]=c("i",{class:"icon-[lucide--receipt-text] text-muted-foreground text-sm"},null,-1)),c("span",Xf,V(H.$t("subscription.plansAndPricing")),1),x.value?(d(),$("span",Zf,V(H.$t("subscription.upgrade")),1)):E("",!0)]),m(f)?(d(),$("div",{key:3,class:"flex items-center gap-2 px-4 py-2 cursor-pointer hover:bg-secondary-background-hover","data-testid":"manage-plan-menu-item",onClick:S},[z[3]||(z[3]=c("i",{class:"icon-[lucide--file-text] text-muted-foreground text-sm"},null,-1)),c("span",em,V(H.$t("subscription.managePlan")),1)])):E("",!0),c("div",{class:"flex items-center gap-2 px-4 py-2 cursor-pointer hover:bg-secondary-background-hover","data-testid":"user-settings-menu-item",onClick:I},[z[4]||(z[4]=c("i",{class:"icon-[lucide--settings-2] text-muted-foreground text-sm"},null,-1)),c("span",tm,V(H.$t("userSettings.accountSettings")),1)]),R(m(Ds),{class:"my-2 mx-0"}),c("div",{class:"flex items-center gap-2 px-4 py-2 cursor-pointer hover:bg-secondary-background-hover","data-testid":"logout-menu-item",onClick:P},[z[5]||(z[5]=c("i",{class:"icon-[lucide--log-out] text-muted-foreground text-sm"},null,-1)),c("span",om,V(H.$t("auth.signOut.signOut")),1)])])}}}),sm={key:0,class:"icon-[lucide--chevron-down] size-3 px-1"},ps=q({__name:"CurrentUserButton",props:{showArrow:{type:Boolean,default:!0},compact:{type:Boolean,default:!1}},setup(e){const{isLoggedIn:o,userPhotoUrl:t}=Ut(),s=L(null),l=b(()=>t.value??void 0),a=n(()=>{s.value?.hide()},"closePopover");return(i,r)=>(d(),$("div",null,[m(o)?(d(),O(Z,{key:0,class:"p-1 hover:bg-transparent",variant:"muted-textonly","aria-label":i.$t("g.currentUser"),onClick:r[0]||(r[0]=u=>s.value?.toggle(u))},{default:A(()=>[c("div",{class:K(m(ne)("flex items-center gap-1 rounded-full hover:bg-interface-button-hover-surface justify-center",i.compact&&"size-full "))},[R(rl,{"photo-url":l.value,class:K(i.compact&&"size-full")},null,8,["photo-url","class"]),i.showArrow?(d(),$("i",sm)):E("",!0)],2)]),_:1},8,["aria-label"])):E("",!0),R(m(et),{ref_key:"popover",ref:s,"show-arrow":!1,pt:{root:{class:"rounded-lg"}}},{default:A(()=>[R(nm,{onClose:a})]),_:1},512)]))}}),am={class:"mb-1"},lm=["href"],fs=q({__name:"LoginButton",props:{class:{}},setup(e){const{isLoggedIn:o,handleSignIn:t}=Ut(),{buildDocsUrl:s}=uo(),l=s("/tutorials/api-nodes/overview#api-nodes",{includeLocale:!0}),a=L(null);let i=null,r=null;const u=n(v=>{i&&(clearTimeout(i),i=null),r&&(clearTimeout(r),r=null),r=setTimeout(()=>{a.value&&a.value.show(v,v.target)},200)},"showPopover"),p=n(()=>{i&&(clearTimeout(i),i=null)},"cancelHidePopover"),g=n(()=>{r&&(clearTimeout(r),r=null),i=setTimeout(()=>{a.value&&a.value.hide()},150)},"hidePopover");return(v,f)=>(d(),$(oe,null,[m(o)?E("",!0):(d(),O(Z,{key:0,variant:"textonly",size:"icon",class:K(m(ne)("group rounded-full text-base-foreground p-0",e.class)),"aria-label":m(ce)("g.login"),onClick:f[0]||(f[0]=k=>m(t)()),onMouseenter:u,onMouseleave:g},{default:A(()=>f[1]||(f[1]=[c("span",{class:"flex size-full items-center justify-center rounded-full bg-secondary-background transition-colors group-hover:bg-transparent"},[c("i",{class:"icon-[lucide--user] size-4"})],-1)])),_:1},8,["class","aria-label"])),R(m(et),{ref_key:"popoverRef",ref:a,class:"p-2",onMouseout:g,onMouseover:p},{default:A(()=>[c("div",null,[c("div",am,V(m(ce)("auth.loginButton.tooltipHelp")),1),c("a",{href:m(l),target:"_blank",class:"text-neutral-500 hover:text-primary"},V(m(ce)("auth.loginButton.tooltipLearnMore")),9,lm)])]),_:1},512)],64))}}),sa=_a.create({baseURL:ja(),headers:{"Content-Type":"application/json"}}),im=n(()=>{const e=L(!1),o=L(null);se(()=>ja(),a=>{sa.defaults.baseURL=a});const t=n((a,i,r)=>{if(!_a.isAxiosError(a))return a instanceof Error?`${i}: ${a.message}`:`${i}: Unknown error occurred`;const u=a;if(u.response){const{status:p,data:g}=u.response;if(r&&r[p])return r[p];switch(p){case 400:return`Bad request: ${g?.message||"Invalid input"}`;case 401:return"Unauthorized: Authentication required";case 403:return`Forbidden: ${g?.message||"Access denied"}`;case 404:return`Not found: ${g?.message||"Resource not found"}`;case 500:return`Server error: ${g?.message||"Internal server error"}`;default:return`${i}: ${g?.message||u.message}`}}return`${i}: ${u.message}`},"handleApiError"),s=n(async(a,i,r)=>{e.value=!0,o.value=null;try{return(await a()).data}catch(u){return Li(u)||(o.value=t(u,i,r)),null}finally{e.value=!1}},"executeApiRequest");return{isLoading:e,error:o,getReleases:n(async(a,i)=>{const r="/releases";return await s(()=>sa.get(r,{params:a,signal:i}),"Failed to get releases",{400:"Invalid project or version parameter"})},"getReleases")}},"useReleaseService"),po=At("release",()=>{const e=L([]),o=L(!1),t=L(null),s=im(),l=es(),a=re(),i=b(()=>l?.systemStats?.system?.comfyui_version??""),r=b(()=>a.get("Comfy.Locale")),u=b(()=>a.get("Comfy.Release.Version")),p=b(()=>a.get("Comfy.Release.Status")),g=b(()=>a.get("Comfy.Release.Timestamp")),v=b(()=>a.get("Comfy.Notification.ShowVersionUpdates")),f=b(()=>e.value[0]??null),k=b(()=>e.value.slice(0,3)),w=4320*60*1e3,h=n((H,z)=>Vt.valid(H)&&Vt.valid(z)?Vt.compare(H,z):H===z?0:1,"compareVersions"),C=b(()=>!!f.value&&h(f.value.version,i.value||"0.0.0")>0),y=b(()=>!!f.value&&h(f.value.version,i.value||"0.0.0")===0),N=b(()=>{const H=f.value?.attention;return H==="medium"||H==="high"}),x=b(()=>!(!Ke()||xt||!v.value||!C.value||!N.value||u.value===f.value?.version&&["skipped","changelog seen"].includes(p.value))),I=b(()=>{if(!Ke()||xt||!v.value||!C.value)return!1;const{version:H}=f.value;return u.value===H&&p.value==="changelog seen"?!1:N.value?!0:!(u.value===H&&p.value==="skipped"&&g.value&&Date.now()-g.value>=w)}),_=b(()=>!(!Ke()&&!xt||!v.value||!f.value||!!Vt.valid(i.value)&&!y.value||u.value===f.value.version&&p.value==="what's new seen"));async function S(H){H!==f.value?.version||p.value==="changelog seen"||(await a.set("Comfy.Release.Version",H),await a.set("Comfy.Release.Status","skipped"),await a.set("Comfy.Release.Timestamp",Date.now()))}n(S,"handleSkipRelease");async function T(H){H===f.value?.version&&(await a.set("Comfy.Release.Version",H),await a.set("Comfy.Release.Status","changelog seen"),await a.set("Comfy.Release.Timestamp",Date.now()))}n(T,"handleShowChangelog");async function M(H){H===f.value?.version&&(await a.set("Comfy.Release.Version",H),await a.set("Comfy.Release.Status","what's new seen"),await a.set("Comfy.Release.Timestamp",Date.now()))}n(M,"handleWhatsNewSeen");async function P(){if(!o.value&&v.value&&!l.systemStats?.system?.argv?.includes("--disable-api-nodes")){o.value=!0,t.value=null;try{l.systemStats||await Ta(l.isInitialized);const H=await s.getReleases({project:xt?"cloud":"comfyui",current_version:i.value,form_factor:l.getFormFactor(),locale:Ei(r.value)});H!==null?e.value=H:s.error.value&&(t.value=s.error.value)}catch(H){t.value=H instanceof Error?H.message:"Unknown error occurred"}finally{o.value=!1}}}n(P,"fetchReleases");async function B(){await P()}return n(B,"initialize"),{releases:e,isLoading:o,error:t,recentRelease:f,recentReleases:k,shouldShowToast:x,shouldShowRedDot:I,shouldShowPopup:_,shouldShowUpdateButton:C,handleSkipRelease:S,handleShowChangelog:T,handleWhatsNewSeen:M,fetchReleases:P,initialize:B}}),rm=Object.freeze(Object.defineProperty({__proto__:null,useReleaseStore:po},Symbol.toStringTag,{value:"Module"})),um={class:"min-w-0 flex-1"},cm={class:"mx-1 flex flex-col items-end gap-1"},dm={class:"flex items-center gap-2"},pm={key:0,class:"pointer-events-auto flex h-12 shrink-0 items-center rounded-lg border border-interface-stroke bg-comfy-menu-bg px-2 shadow-interface"},fm={key:0,class:"absolute top-0.5 right-1 size-2 rounded-full bg-red-500"},mm={class:"actionbar-container pointer-events-auto flex gap-2 h-12 items-center rounded-lg border border-interface-stroke bg-comfy-menu-bg px-2 shadow-interface"},gm={key:0,class:"absolute -top-1 -right-1 min-w-[16px] rounded-full bg-primary-background py-0.25 text-[10px] font-medium leading-[14px] text-base-foreground"},vm=q({__name:"TopMenuSection",setup(e){const o=re(),t=rt(),s=io(),l=vt(),{isLoggedIn:a}=Ut(),i=Ke(),{t:r}=pe(),{toastErrorHandler:u}=Ft(),p=Se(),g=Bt(),v=In(),{isOverlayExpanded:f}=qe(v),k=po(),{shouldShowRedDot:w}=qe(k),{shouldShowRedDot:h}=ts(),C=L(!1),y=b(()=>g.pendingTasks.length),N=b(()=>o.get("Comfy.UI.TabBarLayout")==="Integrated"),x=b(()=>nt(r("sideToolbar.queueProgressOverlay.viewJobHistory"))),I=b(()=>nt(r("menu.customNodesManager"))),_=b(()=>w.value||h.value),{isOpen:S}=qe(s),T=b(()=>nt(r("rightSidePanel.togglePanel"))),M=L();ze(()=>{M.value&&(J.menu.element.style.width="fit-content",M.value.appendChild(J.menu.element))});const P=n(()=>{p.execute("Comfy.Queue.ToggleOverlay")},"toggleQueueOverlay"),B=n(async()=>{try{await l.openManager({initialTab:to.All,showToastOnLegacyError:!1})}catch(H){try{u(H)}catch(z){console.error(H),console.error(z)}}},"openCustomNodeManager");return(H,z)=>{const G=Ie("tooltip");return m(t).focusMode?E("",!0):(d(),$("div",{key:0,class:"ml-1 flex gap-x-0.5 pt-1",onMouseenter:z[1]||(z[1]=U=>C.value=!0),onMouseleave:z[2]||(z[2]=U=>C.value=!1)},[c("div",um,[R(_d)]),c("div",cm,[c("div",dm,[m(l).shouldShowManagerButtons.value?(d(),$("div",pm,[de((d(),O(Z,{variant:"secondary",size:"icon","aria-label":m(r)("menu.customNodesManager"),class:"relative",onClick:B},{default:A(()=>[z[3]||(z[3]=c("i",{class:"icon-[lucide--puzzle] size-4"},null,-1)),_.value?(d(),$("span",fm)):E("",!0)]),_:1},8,["aria-label"])),[[G,I.value,void 0,{bottom:!0}]])])):E("",!0),c("div",mm,[R(Bf),c("div",{ref_key:"legacyCommandsContainerRef",ref:M,class:"[&:not(:has(*>*:not(:empty)))]:hidden"},null,512),R(gd),de((d(),O(Z,{type:"destructive",size:"icon","aria-pressed":m(f),"aria-label":m(r)("sideToolbar.queueProgressOverlay.expandCollapsedQueue"),onClick:P},{default:A(()=>[z[4]||(z[4]=c("i",{class:"icon-[lucide--history] size-4"},null,-1)),y.value>0?(d(),$("span",gm,V(y.value),1)):E("",!0)]),_:1},8,["aria-pressed","aria-label"])),[[G,x.value,void 0,{bottom:!0}]]),m(a)&&!N.value?(d(),O(ps,{key:0,class:"shrink-0"})):m(i)&&!N.value?(d(),O(fs,{key:1})):E("",!0),m(S)?E("",!0):de((d(),O(Z,{key:2,type:"secondary",size:"icon","aria-label":m(r)("rightSidePanel.togglePanel"),onClick:m(s).togglePanel},{default:A(()=>z[5]||(z[5]=[c("i",{class:"icon-[lucide--panel-right] size-4"},null,-1)])),_:1},8,["aria-label","onClick"])),[[G,T.value,void 0,{bottom:!0}]])])]),R(Rf,{expanded:m(f),"onUpdate:expanded":z[0]||(z[0]=U=>it(f)?f.value=U:null),"menu-hovered":C.value},null,8,["expanded","menu-hovered"])])],32))}}}),ms=q({__name:"ExtensionSlot",props:{extension:{}},setup(e){const o=e,t=n((s,l)=>{s.render(l)},"mountCustomExtension");return ut(()=>{o.extension.type==="custom"&&o.extension.destroy&&o.extension.destroy()}),(s,l)=>s.extension.type==="vue"?(d(),O(no(s.extension.component),{key:0})):(d(),$("div",{key:1,ref:n(a=>{a&&t(o.extension,a)},"ref")},null,512))}}),hm={class:"flex h-full flex-col"},ym={class:"flex w-full justify-between"},bm={class:"tabs-container font-inter"},wm={class:"font-normal"},km={class:"flex items-center gap-2"},Cm={class:"h-0 grow"},xm=q({__name:"BottomPanel",setup(e){const o=ro(),t=bt(),{t:s}=pe(),l=b(()=>{const p=o.activeBottomPanelTabId;return p==="shortcuts-essentials"||p==="shortcuts-view-controls"}),a=n(p=>p!=="shortcuts-essentials"&&p!=="shortcuts-view-controls","shouldCapitalizeTab"),i=n(p=>{const g=p.titleKey?s(p.titleKey):p.title||"";return a(p.id)?g.toUpperCase():g},"getTabDisplayTitle"),r=n(async()=>{t.showSettingsDialog("keybinding")},"openKeybindingSettings"),u=n(()=>{o.activePanel=null},"closeBottomPanel");return(p,g)=>(d(),$("div",hm,[(d(),O(m(li),{key:p.$i18n.locale,value:m(o).activeBottomPanelTabId,"onUpdate:value":g[0]||(g[0]=v=>m(o).activeBottomPanelTabId=v),style:{"--p-tabs-tablist-background":"var(--comfy-menu-bg)"}},{default:A(()=>[R(m(ii),{"pt:tab-list":"border-none h-full flex items-center py-2 border-b-1 border-solid",class:"bg-transparent"},{default:A(()=>[c("div",ym,[c("div",bm,[(d(!0),$(oe,null,be(m(o).bottomPanelTabs,v=>(d(),O(m(ri),{key:v.id,value:v.id,class:K(["m-1 mx-2 border-none font-inter",{"tab-list-single-item":m(o).bottomPanelTabs.length===1}]),"pt:root":n(f=>({class:{"p-3 rounded-lg":!0,"pointer-events-none":m(o).bottomPanelTabs.length===1},style:{color:"var(--fg-color)",backgroundColor:!f.context.active||m(o).bottomPanelTabs.length===1?"":"var(--bg-color)"}}),"pt:root")},{default:A(()=>[c("span",wm,V(i(v)),1)]),_:2},1032,["value","class","pt:root"]))),128))]),c("div",km,[l.value?(d(),O(Z,{key:0,variant:"muted-textonly",size:"sm",onClick:r},{default:A(()=>[g[1]||(g[1]=c("i",{class:"pi pi-cog"},null,-1)),$e(" "+V(p.$t("shortcuts.manageShortcuts")),1)]),_:1})):E("",!0),R(Z,{class:"justify-self-end",variant:"muted-textonly",size:"sm","aria-label":m(s)("g.close"),onClick:u},{default:A(()=>g[2]||(g[2]=[c("i",{class:"pi pi-times"},null,-1)])),_:1},8,["aria-label"])])])]),_:1})]),_:1},8,["value"])),c("div",Cm,[m(o).bottomPanelVisible&&m(o).activeBottomPanelTab?(d(),O(ms,{key:0,extension:m(o).activeBottomPanelTab},null,8,["extension"])):E("",!0)])]))}}),Sm=Le(xm,[["__scopeId","data-v-9d1ea2c9"]]);function gl(e={}){const{useTransform:o=!1}=e,s=he().getCanvas(),{canvasPosToClientPos:l,update:a}=Vi(s.canvas,s),i=re();se([()=>i.get("Comfy.Sidebar.Location"),()=>i.get("Comfy.Sidebar.Size"),()=>i.get("Comfy.UseNewMenu")],()=>a(),{flush:"post"});const r=L({}),u=n(g=>{const{pos:v,size:f,scale:k=s.ds.scale}=g,[w,h]=l(v),[C,y]=f;return o?{position:"fixed",transformOrigin:"0 0",transform:`scale(${k})`,left:`${w}px`,top:`${h}px`,width:`${C}px`,height:`${y}px`}:{position:"fixed",left:`${w}px`,top:`${h}px`,width:`${C*k}px`,height:`${y*k}px`}},"computeStyle");return{style:r,updatePosition:n(g=>{r.value=u(g)},"updatePosition")}}n(gl,"useAbsolutePosition");function _m(e,o){const t=Math.max(e.x,o.x),s=Math.max(e.y,o.y),l=Math.min(e.x+e.width,o.x+o.width),a=Math.min(e.y+e.height,o.y+o.height);return t>=l||s>=a?null:[t,s,l-t,a-s]}n(_m,"intersect");const Tm=n((e={})=>{const o=L({}),{margin:t=4}=e,s=n((a,i,r,u)=>{if(!r&&u){const{scale:p,offset:g}=u,v=_m({x:a.left-i.left,y:a.top-i.top,width:a.width,height:a.height},{x:(u.x+g[0]-t)*p,y:(u.y+g[1]-t)*p,width:(u.width+2*t)*p,height:(u.height+2*t)*p});if(!v)return"";const f=(v[0]-a.left+i.left)/p+"px",k=(v[1]-a.top+i.top)/p+"px",w=v[2]/p+"px",h=v[3]/p+"px";return`polygon(0% 0%, 0% 100%, ${f} 100%, ${f} ${k}, calc(${f} + ${w}) ${k}, calc(${f} + ${w}) calc(${k} + ${h}), ${f} calc(${k} + ${h}), ${f} 100%, 100% 100%, 100% 0%)`}return""},"calculateClipPath");return{style:o,updateClipPath:n((a,i,r,u)=>{const p=a.getBoundingClientRect(),g=i.getBoundingClientRect(),v=s(p,g,r,u);o.value={clipPath:v||"none",willChange:"clip-path"}},"updateClipPath")}},"useDomClipping"),$m=["title"],Nm=q({__name:"DomWidget",props:{widgetState:{}},emits:["update:widgetValue"],setup(e,{emit:o}){const t=e.widgetState.widget,s=o,l=L(),a=L({}),{style:i,updatePosition:r}=gl({useTransform:!0}),{style:u,updateClipPath:p}=Tm(),g=he(),v=re(),f=b(()=>v.get("Comfy.DOMClippingEnabled")),k=n(()=>{const x=g.canvas;if(!x||!l.value)return;const I=Object.values(x.selected_nodes??{})[0];if(!I){p(l.value,x.canvas,!1,void 0);return}const _=I===e.widgetState.widget.node,S=I?.renderArea,T=x.ds.offset,M=x.ds.scale,P=S?{x:S[0],y:S[1],width:S[2],height:S[3],scale:M,offset:[T[0],T[1]]}:void 0;p(l.value,x.canvas,_,P)},"updateDomClipping"),{left:w,top:h}=Fn(g.getCanvas().canvas);se([()=>e.widgetState,w,h],([x,I,_])=>{r(x),f.value&&k(),a.value={...i.value,...f.value?u.value:{},zIndex:x.zIndex,pointerEvents:x.readonly||t.computedDisabled?"none":"auto",opacity:t.computedDisabled?.5:1}},{deep:!0}),se(()=>e.widgetState.visible,(x,I)=>{!x&&I&&t.options.onHide?.(t)}),Re(document,"mousedown",x=>{!yo(t)||!e.widgetState.visible||!t.element.blur||t.element.contains(x.target)||t.element.blur()}),ze(()=>{yo(t)&&Re(t.element,t.options.selectOn??["focus","click"],()=>{const x=g.canvas;x?.selectNode(e.widgetState.widget.node),x?.bringToFront(e.widgetState.widget.node)})});const y=t.node.constructor.nodeData?.inputs?.[t.name]?.tooltip,N=n(()=>{e.widgetState.visible&&yo(t)&&l.value&&(l.value.contains(t.element)||l.value.appendChild(t.element))},"mountElementIfVisible");return ze(()=>{Fe(()=>{N()}).catch(x=>{console.error("Error mounting DOM widget element:",x)})}),se(()=>e.widgetState.visible,()=>{N()}),(x,I)=>de((d(),$("div",{ref_key:"widgetElement",ref:l,class:"dom-widget",title:m(y),style:ve(a.value)},[m(Ri)(m(t))?(d(),O(no(m(t).component),_t({key:0,"model-value":m(t).value,widget:m(t)},m(t).props,{"onUpdate:modelValue":I[0]||(I[0]=_=>s("update:widgetValue",_))}),null,16,["model-value","widget"])):E("",!0)],12,$m)),[[Xe,x.widgetState.visible]])}}),Im=Le(Nm,[["__scopeId","data-v-781496d2"]]),Mm={class:"isolate"},Pm=q({__name:"DomWidgets",setup(e){const o=Oi(),t=b(()=>[...o.widgetStates.values()]),s=n(()=>{const a=l.canvas;if(!a)return;const i=a.low_quality,r=a.graph;for(const u of t.value){const p=u.widget;if(!p.isVisible()||!u.active){u.visible=!1;continue}const g=p.node,v=r?.nodes.includes(g);if(u.visible=!!v&&a.isNodeVisible(g)&&!(p.options.hideOnZoom&&i),u.visible&&g){const f=p.margin;u.pos=[g.pos[0]+f,g.pos[1]+f+p.y],u.size=[(p.width??g.width)-f*2,(p.computedHeight??50)-f*2],u.zIndex=a.graph?.nodes.indexOf(g)??-1,u.readonly=a.read_only}}},"updateWidgets"),l=he();return St(()=>l.canvas,a=>a.onDrawForeground=so(a.onDrawForeground,s),{immediate:!0}),(a,i)=>(d(),$("div",Mm,[(d(!0),$(oe,null,be(t.value,r=>(d(),O(Im,{key:r.widget.id,"widget-state":r,"onUpdate:widgetValue":n(u=>r.widget.value=u,"onUpdate:widgetValue")},null,8,["widget-state","onUpdate:widgetValue"]))),128))]))}});function Dm(){const e=L(!1),o=n(()=>{e.value=!0},"showModal"),t=n(()=>{e.value=!1},"hideModal"),s=n(()=>{e.value=!e.value},"toggleModal"),l=b(()=>e.value);return{isModalVisible:e,showModal:o,hideModal:t,toggleModal:s,hasActivePopup:l}}n(Dm,"useZoomControls");function Am(e,o){const t=new Map,s=L(""),l=L(0),a=L({bounds:!1,nodes:!1,connections:!1,viewport:!1}),i=Pe.getVersion(),r=new Map,u=Ol(()=>{o()},500),p=n(()=>{const h=e.value;if(!h||r.has(h.id))return;const C={onNodeAdded:h.onNodeAdded,onNodeRemoved:h.onNodeRemoved,onConnectionChange:h.onConnectionChange,onTrigger:h.onTrigger};r.set(h.id,C),h.onNodeAdded=function(y){C.onNodeAdded?.call(this,y),u()},h.onNodeRemoved=function(y){C.onNodeRemoved?.call(this,y),t.delete(y.id),u()},h.onConnectionChange=function(y){C.onConnectionChange?.call(this,y),u()},h.onTrigger=function(y){C.onTrigger?.call(this,y),y.type==="node:property:changed"&&(y.property==="mode"||y.property==="bgcolor"||y.property==="color")&&(t.delete(String(y.nodeId)),u())}},"setupEventListeners"),g=n(h=>{const C=h||e.value;if(!C)return;const y=r.get(C.id);if(!y){console.error("Attempted to cleanup event listeners for graph that was never set up");return}C.onNodeAdded=y.onNodeAdded,C.onNodeRemoved=y.onNodeRemoved,C.onConnectionChange=y.onConnectionChange,C.onTrigger=y.onTrigger,r.delete(C.id)},"cleanupEventListeners");return{updateFlags:a,setupEventListeners:p,cleanupEventListeners:g,checkForChanges:n(()=>{const h=e.value;if(!h)return!1;let C=!1,y=!1,N=!1;const x=qa.create(h),I=x.getNodeCount();I!==l.value&&(C=!0,l.value=I);const _=x.getNodes();for(const M of _){const P=M.id,B=`${M.x},${M.y},${M.width},${M.height}`;t.get(P)!==B&&(y=!0,t.set(P,B))}const S=new Set(_.map(M=>M.id));for(const[M]of t)S.has(M)||(t.delete(M),C=!0);const T=JSON.stringify(h.links||{});return T!==s.value&&(N=!0,s.value=T),(C||y)&&(a.value.bounds=!0,a.value.nodes=!0),N&&(a.value.connections=!0),C||y||N},"checkForChangesInternal"),init:n(()=>{p(),Te.addEventListener("graphChanged",u),se(i,()=>{u()})},"init"),destroy:n(()=>{g(),Te.removeEventListener("graphChanged",u),t.clear()},"destroy"),clearCache:n(()=>{t.clear(),s.value="",l.value=0},"clearCache")}}n(Am,"useMinimapGraph");function Lm(e,o,t,s,l,a,i){const r=L(!1),u=L({left:0,top:0,width:s,height:l}),p=n(()=>{if(!e.value)return;const C=e.value.getBoundingClientRect();u.value={left:C.left,top:C.top,width:C.width,height:C.height}},"updateContainerRect"),g=n(C=>{r.value=!0,p();const y=C.currentTarget;y instanceof HTMLElement&&y.setPointerCapture(C.pointerId),v(C)},"handlePointerDown"),v=n(C=>{if(!r.value||!i.value)return;const y=C.clientX-u.value.left,N=C.clientY-u.value.top,x=(s-o.value.width*t.value)/2,I=(l-o.value.height*t.value)/2,_=(y-x)/t.value+o.value.minX,S=(N-I)/t.value+o.value.minY;a(_,S)},"handlePointerMove"),f=n(C=>{if(r.value=!1,!C)return;const y=C.currentTarget;y instanceof HTMLElement&&y.hasPointerCapture(C.pointerId)&&y.releasePointerCapture(C.pointerId)},"releasePointer");return{isDragging:r,containerRect:u,updateContainerRect:p,handlePointerDown:g,handlePointerMove:v,handlePointerUp:f,handlePointerCancel:f,handleWheel:n(C=>{C.preventDefault();const y=i.value;if(!y)return;u.value.left===0&&u.value.top===0&&e.value&&p();const N=y.ds,x=C.deltaY>0?.9:1.1,I=N.scale*x;if(I<.1||I>10)return;const T=C.clientX-u.value.left,M=C.clientY-u.value.top,P=(s-o.value.width*t.value)/2,B=(l-o.value.height*t.value)/2,H=(T-P)/t.value+o.value.minX,z=(M-B)/t.value+o.value.minY;N.scale=I,a(H,z)},"handleWheel")}}n(Lm,"useMinimapInteraction");function Em(e,o,t,s,l,a,i,r){const u=L(!0),p=L(!0),g=n(()=>{const k=o.value;if(!e.value||!k)return;const w=e.value.getContext("2d");if(!w)return;if(!k._nodes||k._nodes.length===0){w.clearRect(0,0,i,r);return}(u.value||l.value.nodes||l.value.connections)&&(Wi(e.value,k,{bounds:t.value,scale:s.value,settings:{nodeColors:a.nodeColors.value,showLinks:a.showLinks.value,showGroups:a.showGroups.value,renderBypass:a.renderBypass.value,renderError:a.renderError.value},width:i,height:r}),u.value=!1,l.value.nodes=!1,l.value.connections=!1)},"renderMinimap");return{needsFullRedraw:u,needsBoundsUpdate:p,renderMinimap:g,updateMinimap:n((k,w)=>{(p.value||l.value.bounds)&&(k(),p.value=!1,l.value.bounds=!1,u.value=!0,l.value.viewport=!0),(u.value||l.value.nodes||l.value.connections)&&g(),l.value.viewport&&(w(),l.value.viewport=!1)},"updateMinimap"),forceFullRedraw:n(()=>{u.value=!0,l.value.bounds=!0,l.value.nodes=!0,l.value.connections=!0,l.value.viewport=!0},"forceFullRedraw")}}n(Em,"useMinimapRenderer");function Vm(){const e=re(),o=pt(),t=b(()=>e.get("Comfy.Minimap.NodeColors")),s=b(()=>e.get("Comfy.Minimap.ShowLinks")),l=b(()=>e.get("Comfy.Minimap.ShowGroups")),a=b(()=>e.get("Comfy.Minimap.RenderBypassState")),i=b(()=>e.get("Comfy.Minimap.RenderErrorState")),r=253,u=200,p=b(()=>o.completedActivePalette.light_theme),g=b(()=>({width:`${r}px`,height:`${u}px`,border:"1px solid var(--interface-stroke)",borderRadius:"8px"})),v=b(()=>({width:"210px",height:`${u}px`,border:"1px solid var(--interface-stroke)",borderRadius:"8px"}));return{nodeColors:t,showLinks:s,showGroups:l,renderBypass:a,renderError:i,containerStyles:g,panelStyles:v,isLightTheme:p}}n(Vm,"useMinimapSettings");function Rm(e,o,t,s){const l=L({minX:0,minY:0,maxX:0,maxY:0,width:0,height:0}),a=L(1),i=L({x:0,y:0,width:0,height:0}),r=L({width:0,height:0}),u=n(()=>{const C=e.value;if(!C)return;const y=C.canvas,N=window.devicePixelRatio||1;r.value={width:y.clientWidth||y.width/N,height:y.clientHeight||y.height/N}},"updateCanvasDimensions"),p=n(()=>{const C=qa.create(o.value);if(!C.hasData())return{minX:0,minY:0,maxX:100,maxY:100,width:100,height:100};const y=C.getBounds();return zi(y)},"calculateGraphBounds"),g=n(()=>Bi(l.value,t,s),"calculateScale"),v=n(()=>{const C=e.value;if(!C)return;(r.value.width===0||r.value.height===0)&&u();const y=C.ds,N=r.value.width/y.scale,x=r.value.height/y.scale,I=-y.offset[0],_=-y.offset[1],S=(t-l.value.width*a.value)/2,T=(s-l.value.height*a.value)/2;i.value={x:(I-l.value.minX)*a.value+S,y:(_-l.value.minY)*a.value+T,width:N*a.value,height:x*a.value}},"updateViewport"),f=n(()=>{l.value=p(),a.value=g()},"updateBounds"),k=n((C,y)=>{const N=e.value;if(!N)return;(r.value.width===0||r.value.height===0)&&u();const x=N.ds,I=r.value.width/x.scale,_=r.value.height/x.scale;x.offset[0]=-(C-I/2),x.offset[1]=-(y-_/2),N.setDirty(!0,!0)},"centerViewOn"),{resume:w,pause:h}=lo(v);return{bounds:b(()=>l.value),scale:b(()=>a.value),viewportTransform:b(()=>i.value),canvasDimensions:b(()=>r.value),updateCanvasDimensions:u,updateViewport:v,updateBounds:f,centerViewOn:k,startViewportSync:w,stopViewportSync:h}}n(Rm,"useMinimapViewport");function gs({canvasRefMaybe:e,containerRefMaybe:o}={}){const t=he(),s=Oe(),l=re(),a=L(null),i=e??Ze(null),r=o??Ze(null),u=L(!0),p=L(!1),g=250,v=200,f=b(()=>t.canvas),k=b(()=>s.activeSubgraph||f.value?.graph),w=Vm(),{nodeColors:h,showLinks:C,showGroups:y,renderBypass:N,renderError:x,containerStyles:I,panelStyles:_}=w,S=n(async(j,Y)=>{await l.set(j,Y),B.forceFullRedraw(),B.updateMinimap(T.updateBounds,T.updateViewport)},"updateOption"),T=Rm(f,k,g,v),M=Lm(r,T.bounds,T.scale,g,v,T.centerViewOn,f),P=Am(k,()=>{B.forceFullRedraw(),B.updateMinimap(T.updateBounds,T.updateViewport)}),B=Em(i,k,T.bounds,T.scale,P.updateFlags,w,g,v),{pause:H,resume:z}=lo(async()=>{u.value&&await P.checkForChanges()&&B.updateMinimap(T.updateBounds,T.updateViewport)},{immediate:!1}),G=n(async()=>{p.value||(u.value=l.get("Comfy.Minimap.Visible"),f.value&&k.value&&(P.init(),r.value&&M.updateContainerRect(),T.updateCanvasDimensions(),window.addEventListener("resize",M.updateContainerRect),window.addEventListener("scroll",M.updateContainerRect),window.addEventListener("resize",T.updateCanvasDimensions),B.forceFullRedraw(),B.updateMinimap(T.updateBounds,T.updateViewport),T.updateViewport(),u.value&&(z(),T.startViewportSync()),p.value=!0))},"init"),U=n(()=>{H(),T.stopViewportSync(),P.destroy(),window.removeEventListener("resize",M.updateContainerRect),window.removeEventListener("scroll",M.updateContainerRect),window.removeEventListener("resize",T.updateCanvasDimensions),p.value=!1},"destroy");se(f,async(j,Y)=>{Y&&(P.cleanupEventListeners(),H(),T.stopViewportSync(),P.destroy(),window.removeEventListener("resize",M.updateContainerRect),window.removeEventListener("scroll",M.updateContainerRect),window.removeEventListener("resize",T.updateCanvasDimensions)),j&&!p.value&&await G()},{immediate:!0,flush:"post"}),se(k,(j,Y)=>{j&&j!==Y&&(P.cleanupEventListeners(Y||void 0),P.setupEventListeners(),B.forceFullRedraw(),B.updateMinimap(T.updateBounds,T.updateViewport))}),se(u,async j=>{j?(r.value&&M.updateContainerRect(),T.updateCanvasDimensions(),B.forceFullRedraw(),await Fe(),await Fe(),B.updateMinimap(T.updateBounds,T.updateViewport),T.updateViewport(),z(),T.startViewportSync()):(H(),T.stopViewportSync())});const W=n(async()=>{u.value=!u.value,await l.set("Comfy.Minimap.Visible",u.value)},"toggle"),F=n(j=>{a.value=j},"setMinimapRef"),Q=b(()=>{const j=T.viewportTransform.value;return{transform:`translate(${j.x}px, ${j.y}px)`,width:`${j.width}px`,height:`${j.height}px`,border:`2px solid ${w.isLightTheme.value?"#E0E0E0":"#FFF"}`,backgroundColor:"rgba(255, 255, 255, 0.2)",willChange:"transform",backfaceVisibility:"hidden",perspective:"1000px",pointerEvents:"none"}});return{visible:b(()=>u.value),initialized:b(()=>p.value),containerStyles:I,viewportStyles:Q,panelStyles:_,width:g,height:v,nodeColors:h,showLinks:C,showGroups:y,renderBypass:N,renderError:x,init:G,destroy:U,toggle:W,renderMinimap:B.renderMinimap,handlePointerDown:M.handlePointerDown,handlePointerMove:M.handlePointerMove,handlePointerUp:M.handlePointerUp,handlePointerCancel:M.handlePointerCancel,handleWheel:M.handleWheel,setMinimapRef:F,updateOption:S}}n(gs,"useMinimap");const Om={class:"flex items-center gap-1 pr-0.5"},Wm={class:"rounded-lg bg-interface-panel-selected-surface p-2 group-hover:bg-interface-button-hover-surface"},zm={class:"flex flex-col gap-1"},Bm={class:"flex items-center gap-2"},Fm={class:"text-[9px] text-text-primary"},Um={class:"flex items-center gap-2"},Gm={class:"text-[9px] text-text-primary"},Hm=q({__name:"CanvasModeSelector",props:{buttonStyles:{}},setup(e){const o=L(),t=L(),s=Se(),l=he(),a=b(()=>l.canvas?.read_only??!1),i=b(()=>a.value?"icon-[lucide--hand]":"icon-[lucide--mouse-pointer-2]"),r=b(()=>s.formatKeySequence(s.getCommand("Comfy.Canvas.Unlock")).toUpperCase()),u=b(()=>s.formatKeySequence(s.getCommand("Comfy.Canvas.Lock")).toUpperCase()),p=n(f=>{const k=o.value?.$el||o.value;t.value?.toggle(f,k)},"toggle"),g=n(f=>{f==="select"&&a.value?s.execute("Comfy.Canvas.Unlock"):f==="hand"&&!a.value&&s.execute("Comfy.Canvas.Lock"),t.value?.hide()},"setMode"),v=b(()=>({root:{class:"absolute z-50 -translate-y-2"},content:{class:["mb-2 text-text-primary","shadow-lg border border-interface-stroke","bg-nav-background","rounded-lg","p-2 px-3","min-w-39","select-none"]}}));return(f,k)=>(d(),$(oe,null,[R(Z,{ref_key:"buttonRef",ref:o,variant:"secondary",class:"group h-8 rounded-none! bg-comfy-menu-bg p-0 transition-none! hover:rounded-lg! hover:bg-interface-button-hover-surface!",style:ve(f.buttonStyles),onClick:p},{default:A(()=>[c("div",Om,[c("div",Wm,[c("i",{class:K([i.value,"block h-4 w-4"])},null,2)]),k[2]||(k[2]=c("i",{class:"icon-[lucide--chevron-down] block h-4 w-4 pr-1.5"},null,-1))])]),_:1},8,["style"]),R(m(et),{ref_key:"popover",ref:t,"auto-z-index":!0,"base-z-index":1e3,dismissable:!0,"close-on-escape":!0,unstyled:"",pt:v.value},{default:A(()=>[c("div",zm,[c("div",{class:"flex cursor-pointer items-center justify-between px-3 py-2 text-sm hover:bg-node-component-surface-hovered",onClick:k[0]||(k[0]=w=>g("select"))},[c("div",Bm,[k[3]||(k[3]=c("i",{class:"icon-[lucide--mouse-pointer-2] h-4 w-4"},null,-1)),c("span",null,V(f.$t("graphCanvasMenu.select")),1)]),c("span",Fm,V(r.value),1)]),c("div",{class:"flex cursor-pointer items-center justify-between rounded px-3 py-2 text-sm hover:bg-node-component-surface-hovered",onClick:k[1]||(k[1]=w=>g("hand"))},[c("div",Um,[k[4]||(k[4]=c("i",{class:"icon-[lucide--hand] h-4 w-4"},null,-1)),c("span",null,V(f.$t("graphCanvasMenu.hand")),1)]),c("span",Gm,V(u.value),1)])])]),_:1},8,["pt"])],64))}}),jm={key:0,class:"absolute right-0 bottom-[62px] z-1300 flex w-[250px] justify-center border-0! bg-inherit!"},qm={class:"flex flex-col gap-1"},Km={class:"font-medium"},Qm={class:"text-[9px] text-text-primary"},Ym={class:"font-medium"},Jm={class:"text-[9px] text-text-primary"},Xm={class:"font-medium"},Zm={class:"text-[9px] text-text-primary"},eg=q({__name:"ZoomControlsModal",props:{visible:{type:Boolean}},setup(e){const o=gs(),t=Se(),s=he(),{formatKeySequence:l}=Se(),a=e,i=L(null),r=n(C=>{const y=C.value;isNaN(y)||y<1||y>1e3||s.setAppZoomFromPercentage(y)},"applyZoom"),u=n(C=>{t.execute(C)},"executeCommand"),p=n(C=>{if(i.value)return;const y=n(()=>t.execute(C),"cmd");y(),i.value=window.setInterval(y,100)},"startRepeat"),g=n(()=>{i.value&&(clearInterval(i.value),i.value=null)},"stopRepeat"),v=b(()=>({...o.containerStyles.value,height:void 0,width:void 0})),f=b(()=>l(t.getCommand("Comfy.Canvas.ZoomIn"))),k=b(()=>l(t.getCommand("Comfy.Canvas.ZoomOut"))),w=b(()=>l(t.getCommand("Comfy.Canvas.FitView"))),h=L(null);return se(()=>a.visible,async C=>{C&&(await Fe(),h.value?.querySelector("input")?.focus())}),(C,y)=>C.visible?(d(),$("div",jm,[c("div",{class:"w-4/5 rounded-lg border border-interface-stroke bg-interface-panel-surface p-2 text-text-primary shadow-lg select-none",style:ve(v.value),onClick:y[3]||(y[3]=Ce(()=>{},["stop"]))},[c("div",qm,[c("div",{class:"flex cursor-pointer items-center justify-between rounded px-3 py-2 text-sm hover:bg-node-component-surface-hovered",onMousedown:y[0]||(y[0]=N=>p("Comfy.Canvas.ZoomIn")),onMouseup:g,onMouseleave:g},[c("span",Km,V(C.$t("graphCanvasMenu.zoomIn")),1),c("span",Qm,V(f.value),1)],32),c("div",{class:"flex cursor-pointer items-center justify-between rounded px-3 py-2 text-sm hover:bg-node-component-surface-hovered",onMousedown:y[1]||(y[1]=N=>p("Comfy.Canvas.ZoomOut")),onMouseup:g,onMouseleave:g},[c("span",Ym,V(C.$t("graphCanvasMenu.zoomOut")),1),c("span",Jm,V(k.value),1)],32),c("div",{class:"flex cursor-pointer items-center justify-between rounded px-3 py-2 text-sm hover:bg-node-component-surface-hovered",onClick:y[2]||(y[2]=N=>u("Comfy.Canvas.FitView"))},[c("span",Xm,V(C.$t("zoomControls.zoomToFit")),1),c("span",Zm,V(w.value),1)]),c("div",{ref_key:"zoomInputContainer",ref:h,class:"zoomInputContainer flex items-center gap-1 rounded bg-input-surface p-2"},[R(m(ui),{"default-value":m(s).appScalePercentage,min:1,max:1e3,"show-buttons":!1,"use-grouping":!1,unstyled:!0,"input-class":"bg-transparent border-none outline-hidden text-sm shadow-none my-0 w-full",fluid:"",onInput:r,onKeyup:oo(r,["enter"])},null,8,["default-value"]),y[4]||(y[4]=c("span",{class:"flex-shrink-0 text-sm text-text-primary"},"%",-1))],512)])],4)])):E("",!0)}}),tg={class:"inline-flex items-center gap-1 px-2 text-xs"},og=q({__name:"GraphCanvasMenu",setup(e){const{t:o}=pe(),t=Se(),{formatKeySequence:s}=Se(),l=he(),a=re(),i=co(),r=gs(),{isModalVisible:u,toggleModal:p,hideModal:g,hasActivePopup:v}=Dm(),f=b(()=>{const P=["borderRadius"],B=["borderRadius"],H={border:"none"},z=r.containerStyles.value,G={...Object.fromEntries(Object.entries(z).filter(([W])=>B.includes(W))),...H},U=Object.entries(z).filter(([W])=>P.includes(W)).reduce((W,[F,Q])=>({...W,[F]:Q}),{});return{buttonStyles:G,buttonGroupStyles:U}}),k=b(()=>a.get("Comfy.LinkRenderMode")===ge.HIDDEN_LINK),w=b(()=>s(t.getCommand("Comfy.Canvas.FitView")).toUpperCase()),h=b(()=>s(t.getCommand("Comfy.Canvas.ToggleMinimap")).toUpperCase()),C=b(()=>["bg-comfy-menu-bg",u.value?"not-active:bg-interface-panel-selected-surface!":"","hover:bg-interface-button-hover-surface!","p-0","h-8","w-15"]),y=b(()=>({"bg-comfy-menu-bg":!0,"hover:bg-interface-button-hover-surface!":!0,"not-active:bg-interface-panel-selected-surface!":a.get("Comfy.Minimap.Visible"),"p-0":!0,"w-8":!0,"h-8":!0})),N=b(()=>{const P=o("graphCanvasMenu.fitView"),B=w.value;return B?`${P} (${B})`:P}),x=b(()=>{const P=a.get("Comfy.Minimap.Visible")?o("zoomControls.hideMinimap"):o("zoomControls.showMinimap"),B=h.value;return B?`${P} (${B})`:P}),I=b(()=>k.value?o("graphCanvasMenu.showLinks"):o("graphCanvasMenu.hideLinks")),_=b(()=>k.value?o("graphCanvasMenu.showLinks"):o("graphCanvasMenu.hideLinks")),S=b(()=>["bg-comfy-menu-bg",k.value?"not-active:bg-interface-panel-selected-surface!":"","hover:bg-interface-button-hover-surface!","p-0","w-8","h-8"]);ze(()=>{l.initScaleSync()});const T=n(()=>{t.execute("Comfy.Canvas.ToggleMinimap")},"onMinimapToggleClick"),M=n(()=>{t.execute("Comfy.Canvas.ToggleLinkVisibility")},"onLinkVisibilityToggleClick");return ut(()=>{l.cleanupScaleSync()}),(P,B)=>{const H=Ie("tooltip");return d(),$("div",null,[R(eg,{visible:m(u),onClose:m(g)},null,8,["visible","onClose"]),m(v)?(d(),$("div",{key:0,class:"fixed inset-0 z-1200",onClick:B[0]||(B[0]=(...z)=>m(g)&&m(g)(...z))})):E("",!0),R(m(ci),{class:"absolute right-0 bottom-0 z-1200 flex-row gap-1 border-[1px] border-interface-stroke bg-comfy-menu-bg p-2",style:ve({...f.value.buttonGroupStyles}),onWheel:m(i).handleWheel},{default:A(()=>[R(Hm,{"button-styles":f.value.buttonStyles},null,8,["button-styles"]),B[6]||(B[6]=c("div",{class:"h-[27px] w-[1px] self-center bg-node-divider"},null,-1)),de((d(),O(Z,{variant:"secondary","aria-label":N.value,style:ve(f.value.buttonStyles),class:"h-8 w-8 bg-comfy-menu-bg p-0 hover:bg-interface-button-hover-surface!",onClick:B[1]||(B[1]=()=>m(t).execute("Comfy.Canvas.FitView"))},{default:A(()=>B[2]||(B[2]=[c("i",{class:"icon-[lucide--focus] h-4 w-4"},null,-1)])),_:1},8,["aria-label","style"])),[[H,N.value,void 0,{top:!0}]]),de((d(),O(Z,{variant:"secondary",class:K(C.value),"aria-label":m(o)("zoomControls.label"),"data-testid":"zoom-controls-button",style:ve(f.value.buttonStyles),onClick:m(p)},{default:A(()=>[c("span",tg,[c("span",null,V(m(l).appScalePercentage)+"%",1),B[3]||(B[3]=c("i",{class:"icon-[lucide--chevron-down] h-4 w-4"},null,-1))])]),_:1},8,["class","aria-label","style","onClick"])),[[H,m(o)("zoomControls.label"),void 0,{top:!0}]]),B[7]||(B[7]=c("div",{class:"h-[27px] w-[1px] self-center bg-node-divider"},null,-1)),de((d(),O(Z,{variant:"secondary","aria-label":x.value,"data-testid":"toggle-minimap-button",style:ve(f.value.buttonStyles),class:K(y.value),onClick:T},{default:A(()=>B[4]||(B[4]=[c("i",{class:"icon-[lucide--map] h-4 w-4"},null,-1)])),_:1},8,["aria-label","style","class"])),[[H,x.value,void 0,{top:!0}]]),de((d(),O(Z,{variant:"secondary",class:K(S.value),"aria-label":_.value,"data-testid":"toggle-link-visibility-button",style:ve(f.value.buttonStyles),onClick:M},{default:A(()=>B[5]||(B[5]=[c("i",{class:"icon-[lucide--route-off] h-4 w-4"},null,-1)])),_:1},8,["class","aria-label","style"])),[[H,{value:I.value,pt:{root:{style:"z-index: 2; transform: translateY(-20px);"}}},void 0,{top:!0}]])]),_:1},8,["style","onWheel"])])}}}),ng=q({__name:"NodeTooltip",setup(e){let o;const t=Tt(),s=re(),l=L(),a=L(""),i=L(),r=L();function u(){return a.value=""}n(u,"hideTooltip");async function p(f){if(!f)return;i.value=J.canvas.mouse[0]+"px",r.value=J.canvas.mouse[1]+"px",a.value=f,await Fe();const k=l.value?.getBoundingClientRect();k&&(k.right>window.innerWidth&&(i.value=J.canvas.mouse[0]-k.width+"px"),k.top<0&&(r.value=J.canvas.mouse[1]+k.height+"px"))}n(p,"showTooltip");function g(){const{canvas:f}=J,k=f?.node_over;if(!k)return;const w=k.constructor,h=t.nodeDefsByName[k.type??""];if(w.title_mode!==ge.NO_TITLE&&f.graph_mouse[1]<k.pos[1])return p(h?.description);if(k.flags?.collapsed)return;const C=Fi(k,f.graph_mouse[0],f.graph_mouse[1],[0,0]);if(C!==-1){const x=k.inputs[C].name,I=Ae(`nodeDefs.${He(k.type??"")}.inputs.${He(x)}.tooltip`,h?.inputs[x]?.tooltip??"");return p(I)}const y=Ui(k,f.graph_mouse[0],f.graph_mouse[1],[0,0]);if(y!==-1){const x=Ae(`nodeDefs.${He(k.type??"")}.outputs.${y}.tooltip`,h?.outputs[y]?.tooltip??"");return p(x)}const N=J.canvas.getWidgetAtCursor();if(N&&!yo(N)){const x=Ae(`nodeDefs.${He(k.type??"")}.inputs.${He(N.name)}.tooltip`,h?.inputs[N.name]?.tooltip??"");return p(N.tooltip??x)}}return n(g,"onIdle"),Re(window,"mousemove",n(f=>{u(),clearTimeout(o),f.target.nodeName==="CANVAS"&&(o=window.setTimeout(g,s.get("LiteGraph.Node.TooltipDelay")))},"onMouseMove")),Re(window,"click",u),(f,k)=>a.value?(d(),$("div",{key:0,ref_key:"tooltipRef",ref:l,class:"node-tooltip",style:ve({left:i.value,top:r.value})},V(a.value),5)):E("",!0)}}),sg=Le(ng,[["__scopeId","data-v-96b1458a"]]),ag=q({__name:"BypassButton",setup(e){const o=Se(),t=n(async()=>{await o.execute("Comfy.Canvas.ToggleSelectedNodes.Bypass")},"toggleBypass");return(s,l)=>{const a=Ie("tooltip");return de((d(),O(Z,{variant:"muted-textonly","aria-label":s.$t("commands.Comfy_Canvas_ToggleSelectedNodes_Bypass.label"),"data-testid":"bypass-button",class:"hover:bg-secondary-background",onClick:t},{default:A(()=>l[0]||(l[0]=[c("i",{class:"icon-[lucide--redo-dot] size-4"},null,-1)])),_:1},8,["aria-label"])),[[a,{value:s.$t("commands.Comfy_Canvas_ToggleSelectedNodes_Bypass.label"),showDelay:1e3},void 0,{top:!0}]])}}}),lg={class:"relative"},ig={class:"flex items-center gap-1 px-0"},rg={key:0,class:"color-picker-container absolute -top-10 left-1/2"},ug=["data-testid"],cg=q({__name:"ColorPickerButton",setup(e){const{t:o}=pe(),t=he(),s=pt(),l=Oe(),a=b(()=>s.completedActivePalette.light_theme),i=n(C=>Rt(C,{lightness:.5}),"toLightThemeColor"),r=L(!1),u={name:"noColor",localizedName:o("color.noColor"),value:{dark:ge.NODE_DEFAULT_BGCOLOR,light:i(ge.NODE_DEFAULT_BGCOLOR)}},p=[u,...Object.entries(Ye.node_colors).map(([C,y])=>({name:C,localizedName:o(`color.${C}`),value:{dark:y.bgcolor,light:i(y.bgcolor)}}))],g=L(null),v=n(C=>{const y=C?.name??u.name,N=y===u.name?null:Ye.node_colors[y];for(const x of t.selectedItems)Oo(x)&&x.setColorOption(N);t.canvas?.setDirty(!0,!0),f.value=N,r.value=!1,l.activeWorkflow?.changeTracker.checkState()},"applyColor"),f=L(null),k=b(()=>f.value?a.value?i(f.value?.bgcolor):f.value?.bgcolor:null),w=b(()=>f.value?.bgcolor?p.find(y=>y.value.dark===f.value?.bgcolor||y.value.light===f.value?.bgcolor)?.localizedName??u.localizedName:null),h=n(C=>{r.value=!1,g.value=null,f.value=Gi(C)},"updateColorSelectionFromNode");return se(()=>t.selectedItems,C=>{h(C)},{immediate:!0}),(C,y)=>{const N=Ie("tooltip");return d(),$("div",lg,[de((d(),O(Z,{"data-testid":"color-picker-button",variant:"muted-textonly","aria-label":m(o)("g.color"),onClick:y[0]||(y[0]=()=>r.value=!r.value)},{default:A(()=>[c("div",ig,[c("i",{class:"pi pi-circle-fill",style:ve({color:k.value??""})},null,4),y[1]||(y[1]=c("i",{class:"icon-[lucide--chevron-down]"},null,-1))])]),_:1},8,["aria-label"])),[[N,{value:w.value??m(o)("color.noColor"),showDelay:1e3},void 0,{top:!0}]]),r.value?(d(),$("div",rg,[R(m(Ra),{"model-value":g.value,options:p,"option-label":"name","data-key":"value","onUpdate:modelValue":v},{option:A(({option:x})=>[de(c("i",{class:"pi pi-circle-fill",style:ve({color:a.value?x.value.light:x.value.dark}),"data-testid":x.name},null,12,ug),[[N,x.localizedName,void 0,{top:!0}]])]),_:1},8,["model-value"])])):E("",!0)])}}}),dg=Le(cg,[["__scopeId","data-v-2197e0a1"]]),pg=q({__name:"ConfigureSubgraph",setup(e){const o=io(),t=n(()=>{o.openPanel("subgraph")},"handleClick");return(s,l)=>{const a=Ie("tooltip");return de((d(),O(Z,{variant:"muted-textonly","aria-label":s.$t("commands.Comfy_Graph_EditSubgraphWidgets.label"),onClick:t},{default:A(()=>l[0]||(l[0]=[c("i",{class:"icon-[lucide--settings-2]"},null,-1)])),_:1},8,["aria-label"])),[[a,{value:s.$t("commands.Comfy_Graph_EditSubgraphWidgets.label"),showDelay:1e3},void 0,{top:!0}]])}}}),fg=q({__name:"ConvertToSubgraphButton",setup(e){const o=Se(),{isSingleSubgraph:t,hasAnySelection:s}=Gt(),l=t,a=b(()=>s.value&&!t.value);return(i,r)=>{const u=Ie("tooltip");return m(l)?de((d(),O(Z,{key:0,variant:"muted-textonly","aria-label":i.$t("commands.Comfy_Graph_UnpackSubgraph.label"),"data-testid":"convert-to-subgraph-button",onClick:r[0]||(r[0]=()=>m(o).execute("Comfy.Graph.UnpackSubgraph"))},{default:A(()=>r[2]||(r[2]=[c("i",{class:"icon-[lucide--expand] size-4"},null,-1)])),_:1},8,["aria-label"])),[[u,{value:i.$t("commands.Comfy_Graph_UnpackSubgraph.label"),showDelay:1e3},void 0,{top:!0}]]):a.value?de((d(),O(Z,{key:1,variant:"muted-textonly",size:"icon","aria-label":i.$t("commands.Comfy_Graph_ConvertToSubgraph.label"),"data-testid":"convert-to-subgraph-button",onClick:r[1]||(r[1]=()=>m(o).execute("Comfy.Graph.ConvertToSubgraph"))},{default:A(()=>r[3]||(r[3]=[c("i",{class:"icon-[lucide--shrink] size-4"},null,-1)])),_:1},8,["aria-label"])),[[u,{value:i.$t("commands.Comfy_Graph_ConvertToSubgraph.label"),showDelay:1e3},void 0,{top:!0}]]):E("",!0)}}}),mg=q({__name:"DeleteButton",setup(e){const o=Se(),{selectedItems:t}=Gt(),s=b(()=>t.value.some(l=>l.removable!==!1));return(l,a)=>{const i=Ie("tooltip");return de((d(),O(Z,{variant:"muted-textonly","aria-label":l.$t("commands.Comfy_Canvas_DeleteSelectedItems.label"),"data-testid":"delete-button",onClick:a[0]||(a[0]=()=>m(o).execute("Comfy.Canvas.DeleteSelectedItems"))},{default:A(()=>a[1]||(a[1]=[c("i",{class:"icon-[lucide--trash-2]"},null,-1)])),_:1},8,["aria-label"])),[[Xe,s.value],[i,{value:l.$t("commands.Comfy_Canvas_DeleteSelectedItems.label"),showDelay:1e3},void 0,{top:!0}]])}}}),gg=q({__name:"ExecuteButton",setup(e){const{t:o}=pe(),t=Se(),s=he(),{selectedNodes:l}=Gt(),a=s.getCanvas(),i=L(!1),r=b(()=>l.value.filter(ao).filter(Hi));function u(){if(this.selected&&this.constructor.nodeData?.output_node&&i.value)return{color:"orange",lineWidth:2,padding:10}}n(u,"outputNodeStokeStyle");const p=n(()=>{i.value=!0;for(const f of r.value)f.strokeStyles.outputNode=u;a.setDirty(!0)},"handleMouseEnter"),g=n(()=>{i.value=!1,a.setDirty(!0)},"handleMouseLeave"),v=n(async()=>{await t.execute("Comfy.QueueSelectedOutputNodes")},"handleClick");return(f,k)=>{const w=Ie("tooltip");return de((d(),O(Z,{variant:"primary","aria-label":m(o)("selectionToolbox.executeButton.tooltip"),onMouseenter:k[0]||(k[0]=()=>p()),onMouseleave:k[1]||(k[1]=()=>g()),onClick:v},{default:A(()=>k[2]||(k[2]=[c("i",{class:"icon-[lucide--play]"},null,-1)])),_:1},8,["aria-label"])),[[w,{value:m(o)("selectionToolbox.executeButton.tooltip"),showDelay:1e3},void 0,{top:!0}]])}}}),vg=q({__name:"ExtensionCommandButton",props:{command:{}},setup(e){const o=Se();return(t,s)=>{const l=Ie("tooltip");return de((d(),O(Z,{variant:"muted-textonly","aria-label":m(Ae)(`commands.${m(He)(t.command.id)}.label`,""),onClick:s[0]||(s[0]=()=>m(o).execute(t.command.id))},{default:A(()=>[c("i",{class:K([typeof t.command.icon=="function"?t.command.icon():t.command.icon])},null,2)]),_:1},8,["aria-label"])),[[l,{value:m(Ae)(`commands.${m(He)(t.command.id)}.label`,"")||void 0,showDelay:1e3},void 0,{top:!0}]])}}}),hg=q({__name:"InfoButton",setup(e){const o=io(),t=n(()=>{o.openPanel("info")},"onInfoClick");return(s,l)=>{const a=Ie("tooltip");return de((d(),O(Z,{"data-testid":"info-button",variant:"muted-textonly","aria-label":s.$t("g.info"),onClick:t},{default:A(()=>l[0]||(l[0]=[c("i",{class:"icon-[lucide--info]"},null,-1)])),_:1},8,["aria-label"])),[[a,{value:s.$t("g.info"),showDelay:1e3},void 0,{top:!0}]])}}}),yg=q({__name:"Load3DViewerButton",setup(e){const o=Se(),t=n(()=>{o.execute("Comfy.3DViewer.Open3DViewer")},"open3DViewer");return(s,l)=>{const a=Ie("tooltip");return de((d(),O(Z,{variant:"muted-textonly","aria-label":s.$t("commands.Comfy_3DViewer_Open3DViewer.label"),onClick:t},{default:A(()=>l[0]||(l[0]=[c("i",{class:"icon-[lucide--pencil]"},null,-1)])),_:1},8,["aria-label"])),[[a,{value:s.$t("commands.Comfy_3DViewer_Open3DViewer.label"),showDelay:1e3},void 0,{top:!0}]])}}}),bg=q({__name:"MaskEditorButton",setup(e){const o=Se(),{isSingleImageNode:t}=Gt(),s=n(()=>{o.execute("Comfy.MaskEditor.OpenMaskEditor")},"openMaskEditor");return(l,a)=>{const i=Ie("tooltip");return de((d(),O(Z,{variant:"muted-textonly","aria-label":l.$t("commands.Comfy_MaskEditor_OpenMaskEditor.label"),onClick:s},{default:A(()=>a[0]||(a[0]=[c("i",{class:"icon-[comfy--mask]"},null,-1)])),_:1},8,["aria-label"])),[[Xe,m(t)],[i,{value:l.$t("commands.Comfy_MaskEditor_OpenMaskEditor.label"),showDelay:1e3},void 0,{top:!0}]])}}}),wg=n(e=>e!=null&&typeof e=="object"&&"refresh"in e&&typeof e.refresh=="function","isRefreshableWidget"),kg=n(()=>{const e=he(),o=L([]);ke(()=>{o.value=e.selectedItems.filter(ao)});const t=b(()=>o.value.flatMap(a=>{if(!a.widgets)return[];const i=[];for(const r of a.widgets)wg(r)&&i.push(r);return i})),s=b(()=>t.value.length>0);async function l(){s.value&&await Promise.all(t.value.map(a=>a.refresh()))}return n(l,"refreshSelected"),{isRefreshable:s,refreshSelected:l}},"useRefreshableSelection"),Cg=q({__name:"RefreshSelectionButton",setup(e){const{t:o}=pe(),{isRefreshable:t,refreshSelected:s}=kg();return(l,a)=>{const i=Ie("tooltip");return de((d(),O(Z,{variant:"muted-textonly","aria-label":m(o)("g.refreshNode"),"data-testid":"refresh-button",onClick:m(s)},{default:A(()=>a[0]||(a[0]=[c("i",{class:"icon-[lucide--refresh-cw]"},null,-1)])),_:1},8,["aria-label","onClick"])),[[Xe,m(t)],[i,m(o)("g.refreshNode"),void 0,{top:!0}]])}}}),xg=q({__name:"SaveToSubgraphLibrary",setup(e){const o=Se(),t=he(),s=b(()=>t.selectedItems?.length===1&&t.selectedItems[0]instanceof os);return(l,a)=>{const i=Ie("tooltip");return de((d(),O(Z,{variant:"muted-textonly","aria-label":l.$t("commands.Comfy_PublishSubgraph.label"),onClick:a[0]||(a[0]=()=>m(o).execute("Comfy.PublishSubgraph"))},{default:A(()=>a[1]||(a[1]=[c("i",{class:"icon-[lucide--book-open]"},null,-1)])),_:1},8,["aria-label"])),[[Xe,s.value],[i,{value:l.$t("commands.Comfy_PublishSubgraph.label"),showDelay:1e3},void 0,{top:!0}]])}}}),vo=L(!1),Sg=L(0),_g=L(0),st=L(!1);let Et=!1,at=null;function Wo(e){const o=e.canvas;if(!o)return null;const t=Array.from(o.selectedItems);if(t.length!==1)return null;const s=t[0];return ao(s)?`N:${s.id}`:ss(s)?`G:${s.id}`:null}n(Wo,"buildSelectionSignature");function Tg(e){return at?Wo(e)===at:!1}n(Tg,"currentSelectionMatchesSignature");function $g(e){const o=he(),t=o.getCanvas(),{getSelectableItems:s}=ns(),{shouldRenderVueNodes:l}=qo(),a=L({x:0,y:0}),i=L(!1),{left:r,top:u}=Fn(t.canvas),p=b(()=>{const y=o.canvas?.state?.draggingItems??!1,N=l.value&&Pe.isDraggingVueNodes.value;return y||N}),g=n(()=>{const y=s();if(!y.size){i.value=!1;return}if(p.value){i.value=!1;return}i.value=!0;const N=[];for(const I of y)if(I.id!=null)if(l.value&&typeof I.id=="string"){const _=Pe.getNodeLayoutRef(I.id).value;_&&N.push([_.bounds.x,_.bounds.y,_.bounds.width,_.bounds.height])}else(I instanceof ht||I instanceof Ot)&&N.push([I.pos[0],I.pos[1]-ge.NODE_TITLE_HEIGHT,I.size[0],I.size[1]+ge.NODE_TITLE_HEIGHT]);const x=ji(N);x&&(a.value={x:x.x+x.width/2,y:x.y-10},v())},"updateSelectionBounds"),v=n(()=>{if(!i.value)return;const{scale:y,offset:N}=t.ds,x=(a.value.x+N[0])*y+r.value,I=(a.value.y+N[1])*y+u.value;e.value&&(e.value.style.setProperty("--tb-x",`${x}px`),e.value.style.setProperty("--tb-y",`${I}px`))},"updateTransform"),{resume:f,pause:k}=lo(v);ke(()=>{i.value?f():k()}),se(()=>o.getCanvas().state.selectionChanged,y=>{y&&((st.value||at)&&(st.value=!1,Et=!1,vo.value?at=Wo(o):at=null),g(),o.getCanvas().state.selectionChanged=!1)},{immediate:!0}),se(()=>vo.value,y=>{y?at=Wo(o):o.canvas?.state?.draggingItems||(at=null,st.value&&(st.value=!1))});const w=n(y=>{if(y){h();return}C()},"handleDragStateChange"),h=n(()=>{if(i.value=!1,!vo.value){st.value=!1,Et=!1;return}if(Wo(o)!==at&&(at=null),vo.value=!1,Et=!0,st.value=!!at,st.value){Sg.value++;return}Et=!1},"handleDragStart"),C=n(()=>{requestAnimationFrame(()=>{g();const y=Tg(o),N=Et&&i.value&&st.value&&y;st.value=N&&st.value,Et=!1,N&&_g.value++})},"handleDragEnd");return se(p,w),yt(()=>{Ng()}),{visible:i}}n($g,"useSelectionToolboxPosition");function Ng(){vo.value=!1,st.value=!1,Et=!1,at=null}n(Ng,"resetMoreOptionsState");const Ig=new Set(["Properties","Colors","Shapes","Title","Mode","Properties Panel","Copy (Clipspace)"]),Mg=new Set(["Rename","Copy","Duplicate","Clone","Run Branch","Pin","Unpin","Bypass","Remove Bypass","Mute","Convert to Subgraph","Frame selection","Minimize Node","Expand","Collapse","Node Info","Resize","Title","Properties Panel","Adjust Size","Color","Colors","Shape","Shapes","Mode","Open Image","Copy Image","Save Image","Open in Mask Editor","Edit Subgraph Widgets","Unpack Subgraph","Copy (Clipspace)","Paste (Clipspace)","Align Selected To","Distribute Nodes","Delete","Remove","Show Advanced","Hide Advanced"]);function aa(e){return e.toLowerCase().replace(/^un/,"").trim()}n(aa,"normalizeLabel");function Pg(e,o){const t=aa(e),s={color:["color","colors"],shape:["shape","shapes"],pin:["pin","unpin"],delete:["remove","delete"],duplicate:["clone","duplicate"]};return o.some(l=>{if(!l.label)return!1;const a=aa(l.label);if(a===t)return!0;for(const i of Object.values(s))if(i.includes(t)&&i.includes(a))return!0;return!1})}n(Pg,"isDuplicateItem");function Dg(e){return Mg.has(e)}n(Dg,"isCoreMenuItem");function Ag(e){const o=new Map,t=[];for(const a of e){if(a.type==="divider"||a.type==="category"){t.push(a);continue}if(!a.label){t.push(a);continue}o.has(a.label)||o.set(a.label,[]),o.get(a.label).push(a)}const s=[],l=new Set;for(const a of e){if(a.type==="divider"||a.type==="category"||!a.label){if(t.includes(a)){s.push(a);const u=t.indexOf(a);t.splice(u,1)}continue}if(l.has(a.label))continue;l.add(a.label);const i=o.get(a.label);if(i.length===1){s.push(i[0]);continue}const r=i.find(u=>u.source==="vue");r?s.push(r):s.push(i[0])}return s}n(Ag,"removeDuplicateMenuOptions");const Lg=["Rename","Copy","Duplicate","Run Branch","Pin","Unpin","Bypass","Remove Bypass","Mute","Convert to Subgraph","Frame selection","Minimize Node","Expand","Collapse","Resize","Clone","Node Info","Color","Open in Mask Editor","Open Image","Copy Image","Save Image","Copy (Clipspace)","Paste (Clipspace)","Convert to Group Node (Deprecated)"];function yn(e){const o=Lg.indexOf(e);return o===-1?999:o}n(yn,"getMenuItemOrder");function Pn(e){const o=Ag(e),t=new Map,s=[];let l;for(const g of o){if(g.type==="divider"||g.type==="category")continue;if((g.label==="Delete"||g.label==="Remove")&&!g.hasSubmenu){l=g;continue}g.label&&Dg(g.label)?t.set(g.label,g):s.push(g)}const a=[],i=Array.from(t.keys());i.sort((g,v)=>yn(g)-yn(v));const r=n(g=>g<=2?1:g<=8?2:g<=15?3:g<=17?4:5,"getSectionNumber");let u=0;for(const g of i){const v=t.get(g),f=yn(g),k=r(f);u>0&&k!==u&&a.push({type:"divider"}),a.push(v),u=k}const p=[];return p.push(...a),s.length>0&&(p.push({type:"divider"}),p.push({label:"Extensions",type:"category",disabled:!0}),p.push(...s)),l&&(p.push({type:"divider"}),p.push(l)),p}n(Pn,"buildStructuredMenu");function Eg(e,o,t=!0){const s=[];for(const l of e){if(l===null){s.push({type:"divider"});continue}if(!l.content||Ig.has(l.content)||Pg(l.content,s))continue;const a={label:l.content,source:"litegraph"};if(l.disabled&&(a.disabled=!0),l.has_submenu){if(l.submenu?.options)a.hasSubmenu=!0,a.submenu=vl(l.submenu.options);else if(l.callback&&!l.disabled){a.hasSubmenu=!0;const i=Vg(l,o);i?a.submenu=i:console.warn("[ContextMenuConverter] Failed to capture submenu for:",l.content)}}else l.callback&&!l.disabled&&(a.action=()=>{try{l.callback?.call(l,l.value,{},void 0,void 0,l)}catch(i){console.error("Error executing context menu callback:",i)}});s.push(a)}return t?Pn(s):s}n(Eg,"convertContextMenuToOptions");function Vg(e,o){let t,s;const l=ge.ContextMenu;try{ge.ContextMenu=function(a,i){return t=a,s=i,{close:n(()=>{},"close"),root:document.createElement("div")}};try{const a=new MouseEvent("click",{bubbles:!0,cancelable:!0,clientX:0,clientY:0}),i={close:n(()=>{},"close"),root:document.createElement("div")};e.callback?.call(e,e.value,{},a,i,o)}catch(a){console.warn("[ContextMenuConverter] Error executing callback for:",e.content,a)}}finally{ge.ContextMenu=l}if(t)return vl(t,s);console.warn("[ContextMenuConverter] No items captured for:",e.content)}n(Vg,"captureDynamicSubmenu");function vl(e,o){const t=[];for(const s of e){if(s===null)continue;if(typeof s=="string"){const i={label:s,action:n(()=>{try{o?.callback&&o.callback.call(null,s,o,void 0,void 0,o.extra)}catch(r){console.error("Error executing string item callback:",r)}},"action")};t.push(i);continue}if(!s.content)continue;const a={label:Rg(s.content),action:n(()=>{try{s.callback?.call(s,s.value,{},void 0,void 0,s)}catch(i){console.error("Error executing submenu callback:",i)}},"action")};s.disabled&&(a.disabled=!0),t.push(a)}return t}n(vl,"convertSubmenuToOptions");function Rg(e){return Ct.sanitize(e,{ALLOWED_TAGS:[]}).trim()||e.replace(/<[^>]*>/g,"").trim()||e}n(Rg,"stripHtmlTags");function vs(){const e=he(),o=Oe();return{refreshCanvas:n(()=>{e.canvas?.emitBeforeChange(),e.canvas?.setDirty(!0,!0),e.canvas?.graph?.afterChange(),e.canvas?.emitAfterChange(),o.activeWorkflow?.changeTracker?.checkState()},"refreshCanvas")}}n(vs,"useCanvasRefresh");function hs(){const{t:e}=pe(),o=he(),t=pt(),s=vs(),l=b(()=>t.completedActivePalette.light_theme),a=n(k=>Rt(k,{lightness:.5}),"toLightThemeColor"),i={name:"noColor",localizedName:e("color.noColor"),value:{dark:ge.NODE_DEFAULT_BGCOLOR,light:a(ge.NODE_DEFAULT_BGCOLOR)}},r=[i,...Object.entries(Ye.node_colors).map(([k,w])=>({name:k,localizedName:e(`color.${k}`),value:{dark:w.bgcolor,light:a(w.bgcolor)}}))],u=[{name:"default",localizedName:e("shape.default"),value:Pt.ROUND},{name:"box",localizedName:e("shape.box"),value:Pt.BOX},{name:"card",localizedName:e("shape.CARD"),value:Pt.CARD}];return{colorOptions:r,shapeOptions:u,applyColor:n(k=>{const w=k?.name??i.name,h=w===i.name?null:Ye.node_colors[w];for(const C of o.selectedItems)Oo(C)&&C.setColorOption(h);s.refreshCanvas()},"applyColor"),applyShape:n(k=>{const w=Array.from(o.selectedItems).filter(h=>h instanceof ht);w.length!==0&&(w.forEach(h=>{h.shape=k.value}),s.refreshCanvas())},"applyShape"),getCurrentColor:n(()=>{const k=Array.from(o.selectedItems);if(k.length===0)return null;const w=k.find(y=>Oo(y));if(!w||!Oo(w))return null;const C=w.getColorOption()?.bgcolor??null;return r.find(y=>y.value.dark===C||y.value.light===C)??i},"getCurrentColor"),getCurrentShape:n(()=>{const k=Array.from(o.selectedItems).filter(C=>C instanceof ht);if(k.length===0)return null;const h=k[0].shape??Pt.ROUND;return u.find(C=>C.value===h)??u[0]},"getCurrentShape"),isLightTheme:l}}n(hs,"useNodeCustomization");function Og(){const{t:e}=pe(),o=he(),t=Oe(),s=re(),l=vs(),{shapeOptions:a,colorOptions:i,isLightTheme:r}=hs();return{getFitGroupToNodesOption:n(f=>({label:"Fit Group To Nodes",icon:"icon-[lucide--move-diagonal-2]",action:n(()=>{try{f.recomputeInsideNodes()}catch(w){console.warn("Failed to recompute group nodes:",w);return}const k=s.get("Comfy.GroupSelectedNodes.Padding");f.resizeTo(f.children,k),f.graph?.change(),o.canvas?.setDirty(!0,!0),t.activeWorkflow?.changeTracker?.checkState()},"action")}),"getFitGroupToNodesOption"),getGroupShapeOptions:n((f,k)=>({label:e("contextMenu.Shape"),icon:"icon-[lucide--box]",hasSubmenu:!0,submenu:a.map(w=>({label:w.localizedName,action:n(()=>{(f.nodes||[]).forEach(C=>C.shape=w.value),l.refreshCanvas(),k()},"action")}))}),"getGroupShapeOptions"),getGroupColorOptions:n((f,k)=>({label:e("contextMenu.Color"),icon:"icon-[lucide--palette]",hasSubmenu:!0,submenu:i.map(w=>({label:w.localizedName,color:r.value?w.value.light:w.value.dark,action:n(()=>{f.color=r.value?w.value.light:w.value.dark,l.refreshCanvas(),k()},"action")}))}),"getGroupColorOptions"),getGroupModeOptions:n((f,k)=>{const w=[];try{f.recomputeInsideNodes()}catch(N){return console.warn("Failed to recompute group nodes for mode options:",N),w}const h=f.nodes||[];if(!h.length)return w;let C=!0;for(let N=1;N<h.length;N++)if(h[N].mode!==h[0].mode){C=!1;break}const y=n((N,x)=>({label:e(`selectionToolbox.${N}`),icon:x===We.BYPASS?"icon-[lucide--ban]":x===We.NEVER?"icon-[lucide--zap-off]":"icon-[lucide--play]",action:n(()=>{h.forEach(I=>{I.mode=x}),o.canvas?.setDirty(!0,!0),f.graph?.change(),t.activeWorkflow?.changeTracker?.checkState(),k()},"action")}),"createModeAction");if(C)switch(h[0].mode){case We.ALWAYS:w.push(y("Set Group Nodes to Never",We.NEVER)),w.push(y("Bypass Group Nodes",We.BYPASS));break;case We.NEVER:w.push(y("Set Group Nodes to Always",We.ALWAYS)),w.push(y("Bypass Group Nodes",We.BYPASS));break;case We.BYPASS:w.push(y("Set Group Nodes to Always",We.ALWAYS)),w.push(y("Set Group Nodes to Never",We.NEVER));break;default:w.push(y("Set Group Nodes to Always",We.ALWAYS)),w.push(y("Set Group Nodes to Never",We.NEVER)),w.push(y("Bypass Group Nodes",We.BYPASS));break}else w.push(y("Set Group Nodes to Always",We.ALWAYS)),w.push(y("Set Group Nodes to Never",We.NEVER)),w.push(y("Bypass Group Nodes",We.BYPASS));return w},"getGroupModeOptions")}}n(Og,"useGroupMenuOptions");function Wg(){const{t:e}=pe(),o=n(()=>{Se().execute("Comfy.MaskEditor.OpenMaskEditor")},"openMaskEditor"),t=n(i=>{if(!i?.imgs?.length)return;const r=i.imgs[i.imageIndex??0];if(!r)return;const u=new URL(r.src);u.searchParams.delete("preview"),window.open(u.toString(),"_blank")},"openImage"),s=n(async i=>{if(!i?.imgs?.length)return;const r=i.imgs[i.imageIndex??0];if(!r)return;const u=document.createElement("canvas"),p=u.getContext("2d");if(p){u.width=r.naturalWidth,u.height=r.naturalHeight,p.drawImage(r,0,0);try{const g=await new Promise(v=>{u.toBlob(v,"image/png")});if(!g){console.warn("Failed to create image blob");return}if(!navigator.clipboard?.write){console.warn("Clipboard API not available");return}await navigator.clipboard.write([new ClipboardItem({"image/png":g})])}catch(g){console.error("Failed to copy image to clipboard:",g)}}},"copyImage"),l=n(i=>{if(!i?.imgs?.length)return;const r=i.imgs[i.imageIndex??0];if(r)try{const u=new URL(r.src);u.searchParams.delete("preview"),as(u.toString())}catch(u){console.error("Failed to save image:",u)}},"saveImage");return{getImageMenuOptions:n(i=>i?.imgs?.length?[{label:e("contextMenu.Open in Mask Editor"),action:n(()=>o(),"action")},{label:e("contextMenu.Open Image"),icon:"icon-[lucide--external-link]",action:n(()=>t(i),"action")},{label:e("contextMenu.Copy Image"),icon:"icon-[lucide--copy]",action:n(()=>s(i),"action")},{label:e("contextMenu.Save Image"),icon:"icon-[lucide--download]",action:n(()=>l(i),"action")}]:[],"getImageMenuOptions")}}n(Wg,"useImageMenuOptions");function zg(){const{getSelectedNodes:e,toggleSelectedNodesMode:o}=ns(),t=Se(),s=Oe();return{adjustNodeSize:n(()=>{e().forEach(g=>{const v=g.computeSize();g.setSize([v[0],v[1]])}),J.canvas.setDirty(!0,!0),s.activeWorkflow?.changeTracker?.checkState()},"adjustNodeSize"),toggleNodeCollapse:n(()=>{e().forEach(g=>{g.collapse()}),J.canvas.setDirty(!0,!0),s.activeWorkflow?.changeTracker?.checkState()},"toggleNodeCollapse"),toggleNodePin:n(()=>{e().forEach(g=>{g.pin(!g.pinned)}),J.canvas.setDirty(!0,!0),s.activeWorkflow?.changeTracker?.checkState()},"toggleNodePin"),toggleNodeBypass:n(()=>{o(We.BYPASS),J.canvas.setDirty(!0,!0)},"toggleNodeBypass"),runBranch:n(async()=>{const p=e();Ka(p).length!==0&&await t.execute("Comfy.QueueSelectedOutputNodes")},"runBranch")}}n(zg,"useSelectedNodeActions");function Bg(){const{t:e}=pe(),{shapeOptions:o,applyShape:t,applyColor:s,colorOptions:l,isLightTheme:a}=hs(),{adjustNodeSize:i,toggleNodeCollapse:r,toggleNodePin:u,toggleNodeBypass:p,runBranch:g}=zg(),v=b(()=>o.map(x=>({label:x.localizedName,action:n(()=>t(x),"action")}))),f=b(()=>l.map(x=>({label:x.localizedName,color:a.value?x.value.light:x.value.dark,action:n(()=>s(x.name==="noColor"?null:x),"action")})));return{getNodeInfoOption:n(x=>({label:e("contextMenu.Node Info"),icon:"icon-[lucide--info]",action:x}),"getNodeInfoOption"),getAdjustSizeOption:n(()=>({label:e("contextMenu.Adjust Size"),icon:"icon-[lucide--move-diagonal-2]",action:i}),"getAdjustSizeOption"),getNodeVisualOptions:n((x,I)=>[{label:x.collapsed?e("contextMenu.Expand Node"):e("contextMenu.Minimize Node"),icon:x.collapsed?"icon-[lucide--maximize-2]":"icon-[lucide--minimize-2]",action:n(()=>{r(),I()},"action")},{label:e("contextMenu.Shape"),icon:"icon-[lucide--box]",hasSubmenu:!0,submenu:v.value,action:n(()=>{},"action")},{label:e("contextMenu.Color"),icon:"icon-[lucide--palette]",hasSubmenu:!0,submenu:f.value,isColorPicker:!0,action:n(()=>{},"action")}],"getNodeVisualOptions"),getPinOption:n((x,I)=>({label:x.pinned?e("contextMenu.Unpin"):e("contextMenu.Pin"),icon:x.pinned?"icon-[lucide--pin-off]":"icon-[lucide--pin]",action:n(()=>{u(),I()},"action")}),"getPinOption"),getBypassOption:n((x,I)=>({label:x.bypassed?e("contextMenu.Remove Bypass"):e("contextMenu.Bypass"),icon:"icon-[lucide--redo-dot]",shortcut:"Ctrl+B",action:n(()=>{p(),I()},"action")}),"getBypassOption"),getRunBranchOption:n(()=>({label:e("contextMenu.Run Branch"),icon:"icon-[lucide--play]",action:g}),"getRunBranchOption"),colorSubmenu:f}}n(Bg,"useNodeMenuOptions");function hl(){const e=re(),o=an(),{hasMultipleSelection:t}=Gt(),s=b(()=>t.value);return{frameNodes:n(()=>{const{canvas:a}=J;if(!a.selectedItems?.size)return;const i=new Ot,r=e.get("Comfy.GroupSelectedNodes.Padding");i.resizeTo(a.selectedItems,r),a.graph?.add(i),o.titleEditorTarget=i},"frameNodes"),canFrame:s}}n(hl,"useFrameNodes");function Fg(){const{t:e}=pe(),o=he(),t=vs(),s=[{name:"top",localizedName:e("contextMenu.Top"),value:"top",icon:"icon-[lucide--align-start-vertical]"},{name:"bottom",localizedName:e("contextMenu.Bottom"),value:"bottom",icon:"icon-[lucide--align-end-vertical]"},{name:"left",localizedName:e("contextMenu.Left"),value:"left",icon:"icon-[lucide--align-start-horizontal]"},{name:"right",localizedName:e("contextMenu.Right"),value:"right",icon:"icon-[lucide--align-end-horizontal]"}],l=[{name:"horizontal",localizedName:e("contextMenu.Horizontal"),value:!0,icon:"icon-[lucide--align-center-horizontal]"},{name:"vertical",localizedName:e("contextMenu.Vertical"),value:!1,icon:"icon-[lucide--align-center-vertical]"}];return{alignOptions:s,distributeOptions:l,applyAlign:n(r=>{const u=Array.from(o.selectedItems).filter(g=>ao(g));if(u.length===0)return;const p=Ki(u,r.value);o.canvas?.repositionNodesVueMode(p),t.refreshCanvas()},"applyAlign"),applyDistribute:n(r=>{const u=Array.from(o.selectedItems).filter(g=>ao(g));if(u.length<2)return;const p=qi(u,r.value);o.canvas?.repositionNodesVueMode(p),t.refreshCanvas()},"applyDistribute")}}n(Fg,"useNodeArrangement");function Ug(){const e=he(),o=Dt(),t=bt(),s=an(),l=Oe();return{copySelection:n(()=>{const g=J.canvas;if(!g.selectedItems||g.selectedItems.size===0){o.add({severity:"warn",summary:ce("g.nothingToCopy"),detail:ce("g.selectItemsToCopy"),life:3e3});return}g.copyToClipboard(),o.add({severity:"success",summary:ce("g.copied"),detail:ce("g.itemsCopiedToClipboard"),life:2e3})},"copySelection"),pasteSelection:n(()=>{J.canvas.pasteFromClipboard({connectInputs:!1}),l.activeWorkflow?.changeTracker?.checkState()},"pasteSelection"),duplicateSelection:n(()=>{const g=J.canvas;if(!g.selectedItems||g.selectedItems.size===0){o.add({severity:"warn",summary:ce("g.nothingToDuplicate"),detail:ce("g.selectItemsToDuplicate"),life:3e3});return}g.copyToClipboard(),g.selectedItems.clear(),e.updateSelectedItems(),g.pasteFromClipboard({connectInputs:!1}),l.activeWorkflow?.changeTracker?.checkState()},"duplicateSelection"),deleteSelection:n(()=>{const g=J.canvas;if(!g.selectedItems||g.selectedItems.size===0){o.add({severity:"warn",summary:ce("g.nothingToDelete"),detail:ce("g.selectItemsToDelete"),life:3e3});return}g.deleteSelected(),g.setDirty(!0,!0),l.activeWorkflow?.changeTracker?.checkState()},"deleteSelection"),renameSelection:n(async()=>{const g=Array.from(e.selectedItems);if(g.length===1){const v=g[0];if(v instanceof ht){s.titleEditorTarget=v;return}const f="title"in v?v.title:"",k=await t.prompt({title:ce("g.rename"),message:ce("g.enterNewName"),defaultValue:f});if(k&&k!==f&&"title"in v){const w=v;w.title=k,J.canvas.setDirty(!0,!0),l.activeWorkflow?.changeTracker?.checkState()}return}if(g.length>1){const v=await t.prompt({title:ce("g.batchRename"),message:ce("g.enterBaseName"),defaultValue:"Item"});v&&(g.forEach((f,k)=>{if("title"in f){const w=f;w.title=`${v} ${k+1}`}}),J.canvas.setDirty(!0,!0),l.activeWorkflow?.changeTracker?.checkState());return}o.add({severity:"warn",summary:ce("g.nothingToRename"),detail:ce("g.selectItemsToRename"),life:3e3})},"renameSelection")}}n(Ug,"useSelectionOperations");function Gg(){const{t:e}=pe(),{copySelection:o,duplicateSelection:t,deleteSelection:s,renameSelection:l}=Ug(),{alignOptions:a,distributeOptions:i,applyAlign:r,applyDistribute:u}=Fg(),{convertToSubgraph:p,unpackSubgraph:g,addSubgraphToLibrary:v}=Qa(),{frameNodes:f}=hl(),k=b(()=>a.map(I=>({label:I.localizedName,icon:I.icon,action:n(()=>r(I),"action")}))),w=b(()=>i.map(I=>({label:I.localizedName,icon:I.icon,action:n(()=>u(I),"action")})));return{getBasicSelectionOptions:n(()=>[{label:e("contextMenu.Rename"),action:l},{label:e("contextMenu.Copy"),shortcut:"Ctrl+C",action:o},{label:e("contextMenu.Duplicate"),shortcut:"Ctrl+D",action:t}],"getBasicSelectionOptions"),getSubgraphOptions:n(({hasSubgraphs:I,hasMultipleSelection:_})=>{const S={label:e("contextMenu.Convert to Subgraph"),icon:"icon-[lucide--shrink]",action:p,badge:Dn.NEW},T=[];return(!I||_)&&T.push(S),I&&T.push({label:e("contextMenu.Add Subgraph to Library"),icon:"icon-[lucide--folder-plus]",action:v},{label:e("contextMenu.Unpack Subgraph"),icon:"icon-[lucide--expand]",action:g}),T},"getSubgraphOptions"),getMultipleNodesOptions:n(()=>{const I=n(()=>{Se().execute("Comfy.GroupNode.ConvertSelectedNodesToGroupNode")},"convertToGroupNodes");return[{label:e("contextMenu.Convert to Group Node"),icon:"icon-[lucide--group]",action:I,badge:Dn.DEPRECATED},{label:e("g.frameNodes"),icon:"icon-[lucide--frame]",action:f}]},"getMultipleNodesOptions"),getDeleteOption:n(()=>({label:e("contextMenu.Delete"),icon:"icon-[lucide--trash-2]",shortcut:"Delete",action:s}),"getDeleteOption"),getAlignmentOptions:n(()=>[{label:e("contextMenu.Align Selected To"),icon:"icon-[lucide--align-start-horizontal]",hasSubmenu:!0,submenu:k.value,action:n(()=>{},"action")},{label:e("contextMenu.Distribute Nodes"),icon:"icon-[lucide--align-center-horizontal]",hasSubmenu:!0,submenu:w.value,action:n(()=>{},"action")}],"getAlignmentOptions"),alignSubmenu:k,distributeSubmenu:w}}n(Gg,"useSelectionMenuOptions");var Dn=(e=>(e.NEW="new",e.DEPRECATED="deprecated",e))(Dn||{});let So=null;function Hg(e){So?.toggle&&So.toggle(e)}n(Hg,"toggleNodeOptions");function jg(e){So?.show&&So.show(e)}n(jg,"showNodeOptions");function An(e){So=e}n(An,"registerNodeOptionsInstance");function qg(e){return e.map(o=>o.type==="divider"||o.type==="category"?o:{...o,source:"vue"})}n(qg,"markAsVueOptions");function Kg(){const{selectedItems:e,selectedNodes:o,nodeDef:t,showNodeHelp:s,hasSubgraphs:l,hasImageNode:a,hasOutputNodesSelected:i,hasMultipleSelection:r,computeSelectionFlags:u}=Gt(),p=he(),{getImageMenuOptions:g}=Wg(),{getNodeInfoOption:v,getNodeVisualOptions:f,getPinOption:k,getBypassOption:w,getRunBranchOption:h}=Bg(),{getFitGroupToNodesOption:C,getGroupColorOptions:y,getGroupModeOptions:N}=Og(),{getBasicSelectionOptions:x,getSubgraphOptions:I,getMultipleNodesOptions:_}=Gg(),S=l,T=r,M=L(0),P=n(()=>{M.value++},"bump"),B=b(()=>{M.value;const z=u(),G=e.value.filter(ss),U=G.length===1&&o.value.length===0?G[0]:null,W=S.value,F=[];if(o.value.length===1&&!U&&p.canvas)try{const X=o.value[0],ae=p.canvas.getNodeMenuOptions(X);F.push(...Eg(ae,X,!1))}catch(X){console.error("Error getting LiteGraph menu items:",X)}const Q=[],j=x();if(Q.push(...j),Q.push({type:"divider"}),i.value){const X=h();Q.push(X)}if(!U){const X=k(z,P),ae=w(z,P);Q.push(X),Q.push(ae)}if(U){const X=N(U,P);Q.push(...X)}if(Q.push({type:"divider"}),Q.push(...I({hasSubgraphs:W,hasMultipleSelection:T.value})),T.value&&Q.push(..._()),U)Q.push(C(U));else{const X=f(z,P);X.length>0&&Q.push(X[0])}if(Q.push({type:"divider"}),t.value&&Q.push(v(s)),U)Q.push(y(U,P));else{const X=f(z,P);X.length>1&&Q.push(X[1]),X.length>2&&Q.push(X[2])}Q.push({type:"divider"}),a.value&&o.value.length>0&&(Q.push(...g(o.value[0])),Q.push({type:"divider"}));const Y=qg(Q);if(F.length>0){const X=[...F,...Y];return Pn(X)}return Pn(Y)}),H=b(()=>B.value.filter(z=>z.hasSubmenu&&z.submenu));return{menuOptions:B,menuOptionsWithSubmenu:H,bump:P,hasSubgraphs:S,registerNodeOptionsInstance:An}}n(Kg,"useMoreOptionsMenu");const Qg=["title","onClick"],Yg={key:0,class:"icon-[lucide--check] size-4 flex-shrink-0"},Jg={key:1,class:"w-4 flex-shrink-0"},Xg=q({__name:"ColorPickerMenu",props:{option:{}},emits:["submenu-click"],setup(e,{expose:o,emit:t}){const s=e,l=t,{getCurrentShape:a}=hs(),i=L();o({toggle:n((v,f)=>{i.value?.toggle(v,f)},"toggle")});const u=n(v=>{v.disabled||(l("submenu-click",v),i.value?.hide())},"handleSubmenuClick"),p=n(v=>{if(v.color)return!1;const f=a();return f?f.localizedName===v.label:!1},"isShapeSelected"),g=b(()=>s.option.submenu&&s.option.submenu.length>0&&s.option.submenu.every(v=>v.color&&!v.icon));return(v,f)=>(d(),O(m(et),{ref_key:"popoverRef",ref:i,"auto-z-index":!0,"base-z-index":1100,dismissable:!0,"close-on-escape":!0,unstyled:"",pt:{root:{class:"absolute z-60"},content:{class:["text-base-foreground rounded-lg","shadow-lg border border-base-background","bg-interface-panel-surface"]}}},{default:A(()=>[c("div",{class:K(g.value?"flex flex-col gap-1 p-2":"flex flex-col p-2 min-w-40")},[(d(!0),$(oe,null,be(v.option.submenu,k=>(d(),$("div",{key:k.label,class:K(m(ne)("hover:bg-secondary-background-hover rounded cursor-pointer",g.value?"w-7 h-7 flex items-center justify-center":"flex items-center gap-2 px-3 py-1.5 text-sm",k.disabled?"cursor-not-allowed pointer-events-none text-node-icon-disabled":"hover:bg-secondary-background-hover")),title:k.label,onClick:n(w=>u(k),"onClick")},[k.color?(d(),$("div",{key:0,class:"size-5 rounded-full border border-border-default",style:ve({backgroundColor:k.color})},null,4)):k.color?E("",!0):(d(),$(oe,{key:1},[p(k)?(d(),$("i",Yg)):(d(),$("div",Jg)),c("span",null,V(k.label),1)],64))],10,Qg))),128))],2)]),_:1},512))}}),Zg=["onClick"],ev={class:"flex-1"},tv={key:1,class:"flex h-3.5 min-w-3.5 items-center justify-center rounded bg-interface-menu-keybind-surface-default px-1 py-0 text-xs"},ov={key:2,class:"icon-[lucide--chevron-right] size-4 opacity-60"},nv=q({__name:"NodeContextMenu",setup(e,{expose:o}){const t=L(),s=L(),l=L(!1),{menuOptions:a,bump:i}=Kg(),r=he(),u=L({x:0,y:0}),p=r.getCanvas(),{left:g,top:v}=Fn(p.canvas);let f=0,k=0,w=0;const h=n(()=>{if(!l.value)return;const U=t.value?.container;if(!U)return;const{scale:W,offset:F}=p.ds;if(W===f&&F[0]===k&&F[1]===w)return;f=W,k=F[0],w=F[1];const Q=(u.value.x+F[0])*W+g.value,j=(u.value.y+F[1])*W+v.value;U.style.left=`${Q}px`,U.style.top=`${j}px`},"updateMenuPosition"),{resume:C,pause:y}=lo(h,{immediate:!1});ke(()=>{l.value?C():y()}),Re(window,"touchstart",G=>{if(!l.value||!t.value)return;const U=G.target,W=t.value,F=W.container||W.$el;F&&!F.contains(U)&&T()},{passive:!0});const N=b(()=>a.value.find(G=>G.isColorPicker));function x(G){return!!G.isColorPicker}n(x,"isColorOption");function I(G){if(G.type==="divider")return{separator:!0};const U=x(G),W={label:G.label,icon:G.icon,disabled:G.disabled,shortcut:G.shortcut,isColorSubmenu:U,originalOption:G};return G.hasSubmenu&&G.submenu&&!U&&(W.items=G.submenu.map(F=>({label:F.label,icon:F.icon,disabled:F.disabled,command:n(()=>{F.action(),T()},"command")}))),!G.hasSubmenu&&G.action&&(W.command=()=>{G.action?.(),T()}),W}n(I,"convertToMenuItem");const _=b(()=>a.value.map(I));function S(G){i();const U=G.clientX-g.value,W=G.clientY-v.value,{scale:F,offset:Q}=p.ds;u.value={x:U/F-Q[0],y:W/F-Q[1]},f=F,k=Q[0],w=Q[1],l.value=!0,t.value?.show(G)}n(S,"show");function T(){t.value?.hide()}n(T,"hide");function M(G){l.value?T():S(G)}n(M,"toggle"),o({toggle:M,hide:T,isOpen:l,show:S});function P(G){G.stopPropagation(),G.preventDefault();const U=Array.from(G.currentTarget.children).find(W=>W.classList.contains("icon-[lucide--chevron-right]"));s.value?.toggle(G,U)}n(P,"showColorPopover");function B(G){G.action(),T()}n(B,"handleColorSelect");function H(){l.value=!0}n(H,"onMenuShow");function z(){l.value=!1}return n(z,"onMenuHide"),ze(()=>{An({toggle:M,show:S,hide:T,isOpen:l})}),yt(()=>{An(null)}),(G,U)=>(d(),$(oe,null,[R(m(Oa),{ref_key:"contextMenu",ref:t,model:_.value,class:"max-h-[80vh] md:max-h-none overflow-y-auto md:overflow-y-visible",onShow:H,onHide:z},{item:A(({item:W,props:F,hasSubmenu:Q})=>[c("a",_t(F.action,{class:"flex items-center gap-2 px-3 py-1.5",onClick:n(j=>W.isColorSubmenu?P(j):void 0,"onClick")}),[W.icon?(d(),$("i",{key:0,class:K([W.icon,"size-4"])},null,2)):E("",!0),c("span",ev,V(W.label),1),W.shortcut?(d(),$("span",tv,V(W.shortcut),1)):E("",!0),Q||W.isColorSubmenu?(d(),$("i",ov)):E("",!0)],16,Zg)]),_:1},8,["model"]),N.value?(d(),O(Xg,{ref_key:"colorPickerMenu",ref:s,key:"color-picker-menu",option:N.value,onSubmenuClick:B},null,8,["option"])):E("",!0)],64))}}),sv=q({__name:"FrameNodes",setup(e){const{frameNodes:o}=hl();return(t,s)=>{const l=Ie("tooltip");return de((d(),O(Z,{variant:"muted-textonly","aria-label":t.$t("g.frameNodes"),onClick:m(o)},{default:A(()=>s[0]||(s[0]=[c("i",{class:"icon-[lucide--frame]"},null,-1)])),_:1},8,["aria-label","onClick"])),[[l,{value:t.$t("g.frameNodes"),showDelay:1e3},void 0,{top:!0}]])}}}),av=q({__name:"NodeOptionsButton",setup(e){const o=n(t=>{Hg(t)},"handleClick");return(t,s)=>{const l=Ie("tooltip");return de((d(),O(Z,{"data-testid":"more-options-button",variant:"muted-textonly","aria-label":t.$t("g.moreOptions"),onClick:o},{default:A(()=>s[0]||(s[0]=[c("i",{class:"icon-[lucide--more-vertical]"},null,-1)])),_:1},8,["aria-label"])),[[l,{value:t.$t("g.moreOptions"),showDelay:1e3},void 0,{top:!0}]])}}}),lv={},iv={class:"h-6 w-px self-center bg-border-default"};function rv(e,o){return d(),$("div",iv)}n(rv,"_sfc_render$1");const la=Le(lv,[["render",rv]]),uv=q({__name:"SelectionToolbox",setup(e){const o=Se(),t=he(),s=Qi(),l=co(),a=L(),{visible:i}=$g(a),r=b(()=>{const G=new Set(t.selectedItems.map(U=>s.invokeExtensions("getSelectionToolboxCommands",U).flat()).flat());return Array.from(G).map(U=>o.getCommand(U)).filter(U=>U!==void 0)}),{hasAnySelection:u,hasMultipleSelection:p,isSingleNode:g,isSingleSubgraph:v,isSingleImageNode:f,hasAny3DNodeSelected:k,hasOutputNodesSelected:w,nodeDef:h}=Gt(),C=b(()=>!!h.value),y=b(()=>u.value),N=b(()=>u.value),x=b(()=>p.value),I=b(()=>v.value),_=b(()=>g.value||v.value||p.value),S=b(()=>k.value),T=b(()=>f.value),M=b(()=>u.value),P=b(()=>u.value),B=b(()=>w.value),H=b(()=>y.value||N.value||x.value||I.value),z=b(()=>_.value);return(G,U)=>(d(),$(oe,null,[c("div",{ref_key:"toolboxRef",ref:a,style:{transform:"translate(var(--tb-x), var(--tb-y))"},class:"pointer-events-none fixed top-0 left-0 z-40"},[R(Xo,{name:"slide-up"},{default:A(()=>[m(i)?(d(),O(m(Gn),{key:0,class:"selection-toolbox pointer-events-auto rounded-lg border border-interface-stroke bg-interface-panel-surface",pt:{header:"hidden",content:"p-2 h-12 flex flex-row gap-1"},onWheel:m(l).forwardEventToCanvas},{default:A(()=>[M.value?(d(),O(mg,{key:0})):E("",!0),C.value&&H.value?(d(),O(la,{key:1})):E("",!0),C.value?(d(),O(hg,{key:2})):E("",!0),y.value?(d(),O(dg,{key:3})):E("",!0),x.value?(d(),O(sv,{key:4})):E("",!0),N.value?(d(),O(fg,{key:5})):E("",!0),I.value?(d(),O(pg,{key:6})):E("",!0),I.value?(d(),O(xg,{key:7})):E("",!0),T.value?(d(),O(bg,{key:8})):E("",!0),H.value&&z.value?(d(),O(la,{key:9})):E("",!0),_.value?(d(),O(ag,{key:10})):E("",!0),P.value?(d(),O(Cg,{key:11})):E("",!0),S.value?(d(),O(yg,{key:12})):E("",!0),(d(!0),$(oe,null,be(r.value,W=>(d(),O(vg,{key:W.id,command:W},null,8,["command"]))),128)),B.value?(d(),O(gg,{key:13})):E("",!0),R(av)]),_:1},8,["onWheel"])):E("",!0)]),_:1})],512),R(nv)],64))}}),cv=Le(uv,[["__scopeId","data-v-c6489a20"]]),dv=q({__name:"TitleEditor",setup(e){const o=re(),t=L(!1),s=L(""),{style:l,updatePosition:a}=gl(),i=L({}),r=b(()=>({...l.value,...i.value})),u=an(),p=he(),g=L(!0),v=n(k=>{if(u.titleEditorTarget&&k?.trim()){const w=k.trim();u.titleEditorTarget.title=w;const h=u.titleEditorTarget;h instanceof ht&&h.isSubgraphNode?.()&&(h.subgraph.name=w),J.canvas.setDirty(!0,!0)}t.value=!1,u.titleEditorTarget=null,p.canvas.allow_dragcanvas=g.value},"onEdit");return se(()=>u.titleEditorTarget,k=>{if(k===null)return;s.value=k.title,t.value=!0;const w=p.canvas;g.value=w.allow_dragcanvas,w.allow_dragcanvas=!1;const h=w.ds.scale;if(k instanceof Ot){const C=k;a({pos:C.pos,size:[C.size[0],C.titleHeight]}),i.value={fontSize:`${C.font_size*h}px`}}else if(k instanceof ht){const C=k,[y,N]=C.getBounding();a({pos:[y,N],size:[C.width,ge.NODE_TITLE_HEIGHT]}),i.value={fontSize:`${12*h}px`}}}),Re(document,"litegraph:canvas",n(k=>{if(k.detail.subType==="group-double-click"){if(!o.get("Comfy.Group.DoubleClickTitleToEdit"))return;const w=k.detail.group,[h,C]=w.pos;k.detail.originalEvent.canvasY-C<=w.titleHeight&&(u.titleEditorTarget=w)}else if(k.detail.subType==="node-double-click"){if(!o.get("Comfy.Node.DoubleClickTitleToEdit"))return;const w=k.detail.node,[h,C]=w.pos;k.detail.originalEvent.canvasY-C<=0&&(u.titleEditorTarget=w)}},"canvasEventHandler")),(k,w)=>t.value?(d(),$("div",{key:0,class:"group-title-editor node-title-editor",style:ve(r.value)},[R(qn,{"is-editing":t.value,"model-value":s.value,onEdit:v},null,8,["is-editing","model-value"])],4)):E("",!0)}}),pv=Le(dv,[["__scopeId","data-v-aceb018c"]]),fv={key:0,class:"p-3"},mv=q({__name:"TabInfo",props:{nodes:{}},setup(e){const o=b(()=>e.nodes[0]),t=Tt(),s=Yi(),l=b(()=>t.fromLGraphNode(o.value));return St(l,a=>{s.openHelp(a)},{immediate:!0}),(a,i)=>l.value?(d(),$("div",fv,[R(Ji,{node:l.value},null,8,["node"])])):E("",!0)}}),gv=["placeholder"],yl=q({__name:"SidePanelSearch",props:Zo({searcher:{type:Function,default:n(async()=>{},"default")},updateKey:{}},{modelValue:{default:""},modelModifiers:{}}),emits:["update:modelValue"],setup(e){const o=ko(e,"modelValue"),t=L(!1),s=$a(o,100,{maxWait:100});se(o,a=>{t.value=a!==s.value});const l=Wl(()=>je(e.updateKey));return se([s,l],(a,i,r)=>{let u=!1,p;r(()=>{u=!0,p?.()}),e.searcher(s.value,g=>p=g).catch(g=>{console.error("[SidePanelSearch] searcher failed",g)}).finally(()=>{u||(t.value=!1)})},{immediate:!0}),(a,i)=>(d(),$("label",{class:K(m(ne)("mt-1 py-1.5 bg-secondary-background rounded-lg transition-all duration-150","flex-1 flex gap-2 px-2 items-center","text-base-foreground border-0","focus-within:ring focus-within:ring-component-node-widget-background-highlighted/80"))},[c("i",{class:K(m(ne)("size-4 text-muted-foreground",t.value?"icon-[lucide--loader-circle] animate-spin":"icon-[lucide--search]"))},null,2),de(c("input",{"onUpdate:modelValue":i[0]||(i[0]=r=>o.value=r),type:"text",class:"bg-transparent border-0 outline-0 ring-0 h-5",placeholder:a.$t("g.searchPlaceholder")},null,8,gv),[[zl,o.value]])],2))}}),vv=["fixed","increment","decrement","randomize"];function hv(e){return vv.includes(e)}n(hv,"isControlOption");function ia(e){return hv(e)?e:"randomize"}n(ia,"normalizeControlOption");function yv(e){e.vueTrack||Na((o,t)=>(e.callback=so(e.callback,t),e.vueTrack=o,{get(){},set(){}}))}n(yv,"widgetWithVueTrack");function bl(e){return yv(e),e.vueTrack(),e.value}n(bl,"useReactiveWidgetValue");function bv(e){const o=e.linkedWidgets?.find(t=>t.name=="control_after_generate");if(o)return{value:ia(o.value),update:n(t=>o.value=ia(t),"update")}}n(bv,"getControlWidget");function wv(e,o){return!e.isSubgraphNode()||!Xi(o)?void 0:e.subgraph.getNodeById(o._overlay.nodeId)?.type}n(wv,"getNodeType");const kv=n(e=>{if(!(e==null||e===void 0)){if(typeof e=="string"||typeof e=="number"||typeof e=="boolean")return e;if(typeof e=="object")return Array.isArray(e)&&e.length>0&&e.every(o=>o instanceof File),e;console.warn(`Invalid widget value type: ${typeof e}`,e)}},"normalizeWidgetValue");function wl(e,o){const t=Tt();return function(s){try{const l=t.getInputSpecForWidget(e,s.name),a=o.get(s.name),i=s.promoted?"ring ring-component-node-widget-promoted":s.advanced?"ring ring-component-node-widget-advanced":void 0,r=n(u=>{const p=kv(u);s.value=p??void 0,s.callback?.(p,J.canvas,e),e.widgets?.forEach(g=>g.triggerDraw?.())},"callback");return{name:s.name,type:s.type,value:bl(s),borderStyle:i,callback:r,controlWidget:bv(s),hasLayoutSize:typeof s.computeLayoutSize=="function",isDOMWidget:yo(s),label:s.label,nodeType:wv(e,s),options:s.options,spec:l,slotMetadata:a}}catch{return{name:s.name||"unknown",type:s.type||"text",value:void 0}}}}n(wl,"safeWidgetMapper");function Cv(e){return e==null||typeof e=="string"||typeof e=="number"||typeof e=="boolean"||typeof e=="object"}n(Cv,"isValidWidgetValue");function xv(e){const{createNode:o,deleteNode:t,setSource:s}=ln(),l=Ia(new Map),a=new Map,i=n(h=>{const C=a.get(h),y=l.get(h);if(!C||!y)return;const N=new Map;C.inputs?.forEach((x,I)=>{x?.widget?.name&&N.set(x.widget.name,{index:I,linked:x.link!=null})});for(const x of y.widgets??[]){const I=N.get(x.name);I&&(x.slotMetadata=I)}},"refreshNodeSlots");function r(h){const C=h.graph&&"id"in h.graph&&h.graph!==h.graph.rootGraph?String(h.graph.id):null,y=new Map,N=Ns(h.widgets??[]);Object.defineProperty(h,"widgets",{get(){return N},set(M){N.splice(0,N.length,...M)}});const x=Ns(h.inputs??[]);Object.defineProperty(h,"inputs",{get(){return x},set(M){x.splice(0,x.length,...M)}});const I=Bl(()=>(h.inputs?.forEach((M,P)=>{M?.widget?.name&&y.set(M.widget.name,{index:P,linked:M.link!=null})}),h.widgets?.map(wl(h,y))??[])),_=h.type||h.constructor?.comfyClass||h.constructor?.title||h.constructor?.name||"Unknown",S=h.constructor?.nodeData?.api_node??!1,T=h.badges;return{id:String(h.id),title:typeof h.title=="string"?h.title:"",type:_,mode:h.mode||0,titleMode:h.title_mode,selected:h.selected||!1,executing:!1,subgraphId:C,apiNode:S,badges:T,hasErrors:!!h.has_errors,widgets:I,inputs:x,outputs:h.outputs?[...h.outputs]:void 0,flags:h.flags?{...h.flags}:void 0,color:h.color||void 0,bgcolor:h.bgcolor||void 0,resizable:h.resizable,shape:h.shape}}n(r,"extractVueNodeData");const u=n(h=>a.get(h),"getNode"),p=n(()=>{if(!e?._nodes)return;const h=new Set(e._nodes.map(C=>String(C.id)));for(const C of Array.from(l.keys()))h.has(C)||(a.delete(C),l.delete(C));e._nodes.forEach(C=>{const y=String(C.id);a.set(y,C),l.set(y,r(C))})},"syncWithGraph"),g=n((h,C)=>{const y=String(h.id);a.set(y,h),l.set(y,r(h));const N=n(()=>{const x={x:h.pos[0],y:h.pos[1]},I={width:h.size[0],height:h.size[1]};s(Co.Canvas),o(y,{position:x,size:I,zIndex:h.order||0,visible:!0})},"initializeVueNodeLayout");window.app?.configuringGraph?h.onAfterGraphConfigured=so(h.onAfterGraphConfigured,()=>{l.set(y,r(h)),N()}):N(),C&&C(h)},"handleNodeAdded"),v=n((h,C)=>{const y=String(h.id);s(Co.Canvas),t(y),a.delete(y),l.delete(y),C&&C(h)},"handleNodeRemoved"),f=n((h,C,y)=>()=>{e.onNodeAdded=h||void 0,e.onNodeRemoved=C||void 0,e.onTrigger=y||void 0,a.clear(),l.clear()},"createCleanupFunction"),w=n(()=>{const h=e.onNodeAdded,C=e.onNodeRemoved,y=e.onTrigger;e.onNodeAdded=x=>{g(x,h)},e.onNodeRemoved=x=>{v(x,C)};const N={"node:property:changed":n(x=>{const I=String(x.nodeId),_=l.get(I);if(_)switch(x.property){case"title":l.set(I,{..._,title:String(x.newValue)});break;case"flags.collapsed":l.set(I,{..._,flags:{..._.flags,collapsed:!!x.newValue}});break;case"flags.pinned":l.set(I,{..._,flags:{..._.flags,pinned:!!x.newValue}});break;case"mode":l.set(I,{..._,mode:typeof x.newValue=="number"?x.newValue:0});break;case"color":l.set(I,{..._,color:typeof x.newValue=="string"?x.newValue:void 0});break;case"bgcolor":l.set(I,{..._,bgcolor:typeof x.newValue=="string"?x.newValue:void 0});break;case"shape":l.set(I,{..._,shape:typeof x.newValue=="number"?x.newValue:void 0})}},"node:property:changed"),"node:slot-errors:changed":n(x=>{i(String(x.nodeId))},"node:slot-errors:changed"),"node:slot-links:changed":n(x=>{x.slotType===Zi.INPUT&&i(String(x.nodeId))},"node:slot-links:changed")};return e.onTrigger=x=>{switch(x.type){case"node:property:changed":N["node:property:changed"](x);break;case"node:slot-errors:changed":N["node:slot-errors:changed"](x);break;case"node:slot-links:changed":N["node:slot-links:changed"](x);break}y?.(x)},p(),f(h||void 0,C||void 0,y||void 0)},"setupEventListeners")();return e._nodes&&e._nodes.length>0&&e._nodes.forEach(h=>{e.onNodeAdded&&e.onNodeAdded(h)}),{vueNodeData:l,getNode:u,cleanup:w}}n(xv,"useGraphNodeManager");const Sv={class:"flex flex-col bg-interface-panel-surface"},_v={class:"sticky top-0 z-10 flex items-center justify-between backdrop-blur-xl bg-inherit"},Tv=["disabled"],$v={class:"text-sm font-semibold line-clamp-2"},Nv={key:0,class:"pb-4"},Iv=q({__name:"PropertiesAccordionItem",props:Zo({isEmpty:{type:Boolean}},{collapse:{type:Boolean,default:!1},collapseModifiers:{}}),emits:["update:collapse"],setup(e){const o=ko(e,"collapse");return(t,s)=>{const l=Ie("tooltip");return d(),$("div",Sv,[c("div",_v,[de((d(),$("button",{type:"button",class:K(m(ne)("group min-h-12 bg-transparent border-0 outline-0 ring-0 w-full text-left flex items-center justify-between pl-4 pr-3",!t.isEmpty&&"cursor-pointer")),disabled:t.isEmpty,onClick:s[0]||(s[0]=a=>o.value=!o.value)},[c("span",$v,[ye(t.$slots,"label")]),t.isEmpty?E("",!0):(d(),$("i",{key:0,class:K(m(ne)("text-muted-foreground group-hover:text-base-foreground group-focus:text-base-foreground icon-[lucide--chevron-up] size-4 transition-all",o.value&&"-rotate-180"))},null,2))],10,Tv)),[[l,t.isEmpty?{value:t.$t("rightSidePanel.inputsNoneTooltip"),showDelay:1e3}:void 0]])]),!o.value&&!t.isEmpty?(d(),$("div",Nv,[ye(t.$slots,"default")])):E("",!0)])}}}),Mv={key:0,class:"space-y-4 rounded-lg bg-interface-surface px-4"},Pv={class:"min-h-8"},Dv={key:0,class:"text-sm leading-8 p-0 m-0 line-clamp-1"},Av=q({__name:"SectionWidgets",props:{label:{},widgets:{}},setup(e){tn("hideLayoutField",!0);const o=he(),{t}=pe();function s(r){return tr(r.type,r.name)||or}n(s,"getWidgetComponent");function l(r,u){r.value=u,r.callback?.(u),o.canvas?.setDirty(!0,!0)}n(l,"onWidgetValueChange");const a=b(()=>e.widgets.length===0),i=b(()=>e.label??(a.value?t("rightSidePanel.inputsNone"):t("rightSidePanel.inputs")));return(r,u)=>(d(),O(Iv,{"is-empty":a.value},{label:A(()=>[ye(r.$slots,"label",{},()=>[$e(V(i.value),1)])]),default:A(()=>[a.value?E("",!0):(d(),$("div",Mv,[(d(!0),$(oe,null,be(r.widgets,({widget:p,node:g},v)=>(d(),$("div",{key:`widget-${v}-${p.name}`,class:"widget-item gap-1.5 col-span-full grid grid-cols-subgrid"},[c("div",Pv,[p.name?(d(),$("p",Dv,V(p.label||p.name),1)):E("",!0)]),(d(),O(no(s(p)),{widget:p,"model-value":m(bl)(p),"node-id":String(g.id),"node-type":g.type,class:K(m(ne)("col-span-1",m(er)(p.type)&&"min-h-36")),"onUpdate:modelValue":n(f=>l(p,f),"onUpdate:modelValue")},null,8,["widget","model-value","node-id","node-type","class","onUpdate:modelValue"]))]))),128))]))]),_:3},8,["is-empty"]))}}),Lv={class:"px-4 pb-4 flex gap-2 border-b border-interface-stroke"},Ev=q({__name:"TabParameters",props:{nodes:{}},setup(e){const o=b(()=>e.nodes.map(l=>{const{widgets:a=[]}=l;return{widgets:a.filter(r=>!(r.options?.canvasOnly||r.options?.hidden)).map(r=>({node:l,widget:r})),node:l}})),t=Ze([]);async function s(l){if(l.trim()===""){t.value=o.value;return}const a=l.trim().toLowerCase().split(" ");t.value=o.value.map(i=>({...i,widgets:i.widgets.filter(({widget:r})=>{const u=r.label?.toLowerCase(),p=r.name.toLowerCase(),g=r.type.toLowerCase(),v=r.value?.toString().toLowerCase();return a.every(f=>p.includes(f)||u?.includes(f)||g?.includes(f)||v?.includes(f))})})).filter(i=>i.widgets.length>0)}return n(s,"searcher"),(l,a)=>(d(),$(oe,null,[c("div",Lv,[R(yl,{searcher:s,"update-key":o.value},null,8,["update-key"])]),(d(!0),$(oe,null,be(t.value,i=>(d(),O(Av,{key:i.node.id,label:o.value.length>1?i.node.title:void 0,widgets:i.widgets,"default-collapse":o.value.length>1&&o.value===t.value,class:"border-b border-interface-stroke"},null,8,["label","widgets","default-collapse"]))),128))],64))}}),Vv=["disabled","onClick"],Rv=q({__name:"FormSelectButton",props:{modelValue:{},options:{},optionLabel:{default:"label"},optionValue:{default:"value"},disabled:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{emit:o}){const t=e,s=o,l=n((u,p)=>{if(typeof u!="object")return u;const g=t.optionValue;return u[g]??u.value??u.name??u.label??p},"getOptionValue"),a=n(u=>{if(typeof u=="object"&&u!==null){const p=t.optionLabel;return u[p]??u.label??u.name??u.value??String(u)}return String(u)},"getOptionLabel"),i=n(u=>{const p=l(t.options[u],u);return String(p)===String(t.modelValue??"")},"isSelected"),r=n(u=>{if(t.disabled)return;const p=l(t.options[u],u);s("update:modelValue",p)},"handleSelect");return(u,p)=>(d(),$("div",{class:K(m(ne)(m(mu),"p-1 inline-flex justify-center items-center gap-1"))},[(d(!0),$(oe,null,be(u.options,(g,v)=>(d(),$("button",{key:l(g,v),class:K(m(ne)("flex-1 h-6 px-5 py-[5px] rounded flex justify-center items-center gap-1 transition-all duration-150 ease-in-out truncate min-w-[4ch]","bg-transparent border-none","text-center text-xs font-normal",{"bg-interface-menu-component-surface-selected":i(v)&&!u.disabled,"hover:bg-interface-menu-component-surface-selected/50":!i(v)&&!u.disabled,"opacity-50 cursor-not-allowed":u.disabled,"cursor-pointer":!u.disabled},i(v)&&!u.disabled?"text-text-primary":"text-text-secondary")),disabled:u.disabled,onClick:n(f=>r(v),"onClick")},V(a(g)),11,Vv))),128))],2))}}),Ov={class:"space-y-4 p-3 text-sm text-muted-foreground"},Wv={class:"flex flex-col gap-2"},zv={class:"flex flex-col gap-2"},Bv={class:"bg-secondary-background border-none rounded-lg p-1 grid grid-cols-5 gap-1 justify-items-center"},Fv=["onClick"],Uv=["data-testid"],Gv={class:"flex items-center justify-between"},Hv=q({__name:"TabSettings",props:{nodes:{}},setup(e){const o=e,t=Ze([]);ke(()=>{o.nodes?t.value=o.nodes:t.value=[]});const{t:s}=pe(),l=he(),a=pt(),i=b(()=>a.completedActivePalette.light_theme),r=b({get(){let w=null;const h=t.value;return h.length===0?null:(h.length>1?(w=h[0].mode,h.every(C=>C.mode===w)||(w=null)):w=h[0].mode,w)},set(w){t.value.forEach(h=>{h.mode=w}),ho(t),l.canvas?.setDirty(!0,!0)}}),u=b({get(){return t.value.some(w=>w.pinned)},set(w){t.value.forEach(h=>h.pin(w)),ho(t),l.canvas?.setDirty(!0,!0)}});function p(w){return{dark:Rt(w,{lightness:.3}),light:Rt(w,{lightness:.4}),ringDark:Rt(w,{lightness:.5}),ringLight:Rt(w,{lightness:.1})}}n(p,"getColorValue");const g={name:"noColor",localizedName:n(()=>s("color.noColor"),"localizedName"),value:p(ge.NODE_DEFAULT_BGCOLOR)},v=Object.entries(Ye.node_colors),f=[g,...v.map(([w,h])=>({name:w,localizedName:n(()=>s(`color.${w}`),"localizedName"),value:p(h.bgcolor)}))],k=b({get(){if(t.value.length===0)return null;const w=t.value.map(C=>C.getColorOption());let h=w[0];return w.every(C=>C===h)||(h=!1),h===!1?null:h==null||!h.bgcolor&&!h.color?g.name:v.find(([C,y])=>y.bgcolor===h.bgcolor&&y.color===h.color)?.[0]??null},set(w){if(w===null)return;const h=w===g.name?null:Ye.node_colors[w];for(const C of t.value)C.setColorOption(h);ho(t),l.canvas?.setDirty(!0,!0)}});return(w,h)=>{const C=Ie("tooltip");return d(),$("div",Ov,[c("div",Wv,[c("span",null,V(m(s)("rightSidePanel.nodeState")),1),R(Rv,{modelValue:r.value,"onUpdate:modelValue":h[0]||(h[0]=y=>r.value=y),class:"w-full",options:[{label:m(s)("rightSidePanel.normal"),value:m(We).ALWAYS},{label:m(s)("rightSidePanel.bypass"),value:m(We).BYPASS},{label:m(s)("rightSidePanel.mute"),value:m(We).NEVER}]},null,8,["modelValue","options"])]),c("div",zv,[c("span",null,V(m(s)("rightSidePanel.color")),1),c("div",Bv,[(d(),$(oe,null,be(f,y=>c("button",{key:y.name,class:K(m(ne)("size-8 rounded-lg bg-transparent border-0 outline-0 ring-0 text-left flex justify-center items-center cursor-pointer",y.name===k.value?"bg-interface-menu-component-surface-selected":"hover:bg-interface-menu-component-surface-selected")),onClick:n(N=>k.value=y.name,"onClick")},[de(c("div",{class:K(m(ne)("size-4 rounded-full ring-2 ring-gray-500/10")),style:ve({backgroundColor:i.value?y.value.light:y.value.dark,"--tw-ring-color":y.name===k.value?i.value?y.value.ringLight:y.value.ringDark:void 0}),"data-testid":y.name},null,14,Uv),[[C,y.localizedName(),void 0,{top:!0}]])],10,Fv)),64))])]),c("div",Gv,[c("span",null,V(m(s)("rightSidePanel.pinned")),1),R(m(Wa),{modelValue:u.value,"onUpdate:modelValue":h[1]||(h[1]=y=>u.value=y)},null,8,["modelValue"])])])}}}),jv={class:"pointer-events-none flex-1"},qv={class:"text-xs text-text-secondary line-clamp-1"},Kv={class:"text-sm line-clamp-1 leading-8"},Qv={key:0,class:"size-4 pointer-events-none icon-[lucide--grip-vertical]"},ra=q({__name:"SubgraphNodeWidget",props:{nodeTitle:{},widgetName:{},isDraggable:{type:Boolean},isPhysical:{type:Boolean},class:{type:[Array,Object,String,Number,null,Boolean]}},emits:["toggleVisibility"],setup(e){const o=e;function t(){return o.isPhysical?"icon-[lucide--link]":o.isDraggable?"icon-[lucide--eye]":"icon-[lucide--eye-off]"}return n(t,"getIcon"),(s,l)=>(d(),$("div",{class:K(m(ne)("flex py-1 px-2 break-all rounded items-center gap-1","bg-node-component-surface",o.isDraggable&&"draggable-item drag-handle cursor-grab [&.is-draggable]:cursor-grabbing hover:ring-1 ring-accent-background",o.class))},[c("div",jv,[c("div",qv,V(s.nodeTitle),1),c("div",Kv,V(s.widgetName),1)]),R(Z,{variant:"muted-textonly",size:"sm",disabled:s.isPhysical,onClick:l[0]||(l[0]=Ce(a=>s.$emit("toggleVisibility"),["stop"]))},{default:A(()=>[c("i",{class:K(t())},null,2)]),_:1},8,["disabled"]),s.isDraggable?(d(),$("div",Qv)):E("",!0)],2))}}),Yv={key:0,class:"subgraph-edit-section flex h-full flex-col"},Jv={class:"p-4 flex gap-2"},Xv={class:"flex-1"},Zv={key:0,class:"flex flex-col border-t border-interface-stroke"},eh={class:"sticky top-0 z-10 flex items-center justify-between backdrop-blur-xl min-h-12 px-4"},th={class:"text-sm font-semibold uppercase line-clamp-1"},oh={key:1,class:"flex flex-col border-t border-interface-stroke"},nh={class:"sticky top-0 z-10 flex items-center justify-between backdrop-blur-xl min-h-12 px-4"},sh={class:"text-sm font-semibold uppercase line-clamp-1"},ah={class:"pb-2 px-2 space-y-0.5 mt-0.5"},lh={key:2,class:"flex justify-center border-t border-interface-stroke py-4"},ih=q({__name:"SubgraphEditor",setup(e){const o=he(),t=L(void 0),s=L(),l=L(""),a=Na((S,T)=>({get(){S();const M=r.value;return M?nr(M.properties.proxyWidgets):[]},set(M){T();const P=r.value;if(M){if(!P){console.error("Attempted to toggle widgets with no node selected");return}P.properties.proxyWidgets=M}}}));async function i(S){l.value=S}n(i,"searcher");const r=b(()=>{const S=o.selectedItems[0];if(S instanceof os)return S}),u=b({get(){if(!r.value)return[];const S=r.value;function T([M,P]){if(M==="-1"){const z=S.widgets.find(G=>G.name===P);return z?[[{id:-1,title:"(Linked)",type:""},z]]:[]}const B=S.subgraph._nodes_by_id[M];if(!B?.widgets)return[];const H=B.widgets.find(z=>z.name===P);return H?[[B,H]]:[]}return n(T,"mapWidgets"),a.value.flatMap(T)},set(S){if(!r.value){console.error("Attempted to toggle widgets with no node selected");return}a.value=S.map(cn)}}),p=b(()=>{const S=r.value;if(!S)return[];const{updatePreviews:T}=To(),M=S.subgraph.nodes;for(const P of M)P.updateComputedDisabled(),T(P);return M.flatMap(h).filter(([P,B])=>!B.computedDisabled)}),g=b(()=>{if(!r.value)return[];const T=a.value;return p.value.filter(M=>!T.some(sr(M)))}),v=b(()=>{const S=l.value.toLowerCase();return S?g.value.filter(([T,M])=>T.title.toLowerCase().includes(S)||M.name.toLowerCase().includes(S)):g.value}),f=b(()=>r.value?v.value.filter(ar):[]),k=b(()=>{const S=l.value.toLowerCase();return S?u.value.filter(([T,M])=>T.title.toLowerCase().includes(S)||M.name.toLowerCase().includes(S)):u.value});function w(S){return`${S[0].id}: ${S[1].name}`}n(w,"toKey");function h(S){return S.widgets?S.widgets.map(T=>[S,T]):[]}n(h,"nodeWidgets");function C([S,T]){const M=r.value;if(!M)return[];ir(S,T,[M]),ho(a)}n(C,"demote");function y([S,T]){const M=r.value;if(!M)return[];rr(S,T,[M]),ho(a)}n(y,"promote");function N(){if(!r.value)return;const T=a.value,M=v.value.map(cn);T.push(...M),a.value=T}n(N,"showAll");function x(){r.value&&(a.value=a.value.filter(T=>!k.value.some(ur(T))||T[0]==="-1"))}n(x,"hideAll");function I(){if(!r.value)return;const T=a.value,M=f.value.map(cn);T.push(...M),a.value=T}n(I,"showRecommended");function _(){t.value?.dispose(),!(l.value||!s.value?.children?.length)&&(t.value=new cr(s.value,".draggable-item"),t.value.applyNewItemsOrder=function(){const S=[];let T=-1;this.getAllItems().forEach((H,z)=>{if(H===this.draggableItem){T=z;return}if(!this.isItemToggled(H)){S[z]=H;return}const G=this.isItemAbove(H)?z+1:z-1;S[G]=H});for(let H=0;H<this.getAllItems().length;H++)typeof S[H]>"u"&&(S[H]=this.draggableItem);const M=S.indexOf(this.draggableItem),P=u.value,[B]=P.splice(T,1);P.splice(M,0,B),u.value=P})}return n(_,"setDraggableState"),Zt(k,()=>{_()},{debounce:100}),ze(()=>{_(),r.value&&lr(r.value)}),ut(()=>{t.value?.dispose()}),(S,T)=>r.value?(d(),$("div",Yv,[c("div",Jv,[R(yl,{searcher:i})]),c("div",Xv,[k.value.length?(d(),$("div",Zv,[c("div",eh,[c("div",th,V(S.$t("subgraphStore.shown")),1),c("a",{class:"cursor-pointer text-right text-xs font-normal text-text-secondary hover:text-azure-600 whitespace-nowrap",onClick:Ce(x,["stop"])},V(S.$t("subgraphStore.hideAll")),1)]),c("div",{ref_key:"draggableItems",ref:s,class:"pb-2 px-2 space-y-0.5 mt-0.5"},[(d(!0),$(oe,null,be(k.value,([M,P])=>(d(),O(ra,{key:w([M,P]),class:"bg-interface-panel-surface","node-title":M.title,"widget-name":P.name,"is-shown":!0,"is-draggable":!l.value,"is-physical":M.id===-1,onToggleVisibility:n(B=>C([M,P]),"onToggleVisibility")},null,8,["node-title","widget-name","is-draggable","is-physical","onToggleVisibility"]))),128))],512)])):E("",!0),v.value.length?(d(),$("div",oh,[c("div",nh,[c("div",sh,V(S.$t("subgraphStore.hidden")),1),c("a",{class:"cursor-pointer text-right text-xs font-normal text-text-secondary hover:text-azure-600 whitespace-nowrap",onClick:Ce(N,["stop"])},V(S.$t("subgraphStore.showAll")),1)]),c("div",ah,[(d(!0),$(oe,null,be(v.value,([M,P])=>(d(),O(ra,{key:w([M,P]),class:"bg-interface-panel-surface","node-title":M.title,"widget-name":P.name,onToggleVisibility:n(B=>y([M,P]),"onToggleVisibility")},null,8,["node-title","widget-name","onToggleVisibility"]))),128))])])):E("",!0),f.value.length?(d(),$("div",lh,[R(Z,{size:"sm",class:"rounded border-none px-3 py-0.5",onClick:Ce(I,["stop"])},{default:A(()=>[$e(V(S.$t("subgraphStore.showRecommended")),1)]),_:1})])):E("",!0)])])):E("",!0)}}),rh={"data-testid":"properties-panel",class:"flex size-full flex-col bg-interface-panel-surface"},uh={class:"pt-1"},ch={class:"flex items-center justify-between pl-4 pr-3"},dh={class:"my-3.5 text-sm font-semibold line-clamp-2"},ph={class:"flex gap-2"},fh={key:0,class:"px-4 pb-2 pt-1"},mh={class:"scrollbar-thin flex-1 overflow-y-auto"},gh={key:0,class:"flex size-full p-4 items-start justify-start text-sm text-muted-foreground"},vh=q({__name:"RightSidePanel",setup(e){const o=he(),t=io(),s=re(),{t:l}=pe(),{selectedItems:a}=qe(o),{activeTab:i,isEditingSubgraph:r}=qe(t),u=b(()=>s.get("Comfy.Sidebar.Location")),p=b(()=>u.value==="right"?"icon-[lucide--panel-left]":"icon-[lucide--panel-right]"),g=b(()=>a.value.length>0),v=b(()=>a.value.filter(ao)),f=b(()=>w.value instanceof os),k=b(()=>v.value.length===1),w=b(()=>k.value?v.value[0]:null),h=b(()=>a.value.length),C=b(()=>k.value&&w.value?w.value.title||w.value.type||"Node":l("rightSidePanel.title",{count:h.value}));function y(){t.closePanel()}n(y,"closePanel");const N=b(()=>{const S=[{label:n(()=>l("rightSidePanel.parameters"),"label"),value:"parameters"},{label:n(()=>l("g.settings"),"label"),value:"settings"}];return(!g.value||k.value&&!f.value)&&S.push({label:n(()=>l("rightSidePanel.info"),"label"),value:"info"}),S});ke(()=>{!N.value.some(S=>S.value===i.value)&&!(i.value==="subgraph"&&f.value)&&t.openPanel(N.value[0].value)});const x=L(!1);function I(S){x.value=!1;const T=S.trim();if(!T)return;const M=je(w);M&&T!==M.title&&(M.title=T,o.canvas?.setDirty(!0,!1))}n(I,"handleTitleEdit");function _(){x.value=!1}return n(_,"handleTitleCancel"),(S,T)=>(d(),$("div",rh,[c("section",uh,[c("div",ch,[c("h3",dh,[k.value?(d(),O(qn,{key:0,"model-value":C.value,"is-editing":x.value,"input-attrs":{"data-testid":"node-title-input"},onEdit:I,onCancel:_,onDblclick:T[0]||(T[0]=M=>x.value=!0)},null,8,["model-value","is-editing"])):(d(),$(oe,{key:1},[$e(V(C.value),1)],64))]),c("div",ph,[f.value?(d(),O(Z,{key:0,variant:"secondary",size:"icon",class:K(m(ne)(m(r)&&"bg-secondary-background-selected")),onClick:T[1]||(T[1]=M=>m(t).openPanel(m(r)?"parameters":"subgraph"))},{default:A(()=>T[3]||(T[3]=[c("i",{class:"icon-[lucide--settings-2]"},null,-1)])),_:1},8,["class"])):E("",!0),R(Z,{variant:"secondary",size:"icon","aria-pressed":m(t).isOpen,"aria-label":m(l)("rightSidePanel.togglePanel"),onClick:y},{default:A(()=>[c("i",{class:K(m(ne)(p.value,"size-4"))},null,2)]),_:1},8,["aria-pressed","aria-label"])])]),g.value?(d(),$("nav",fh,[R(dr,{"model-value":m(i),"onUpdate:modelValue":T[2]||(T[2]=M=>{m(t).openPanel(M)})},{default:A(()=>[(d(!0),$(oe,null,be(N.value,M=>(d(),O(pr,{key:M.value,class:"text-sm py-1 px-2 font-inter",value:M.value},{default:A(()=>[$e(V(M.label()),1)]),_:2},1032,["value"]))),128))]),_:1},8,["model-value"])])):E("",!0)]),c("div",mh,[g.value?f.value&&m(r)?(d(),O(ih,{key:1,node:w.value},null,8,["node"])):(d(),$(oe,{key:2},[m(i)==="parameters"?(d(),O(Ev,{key:0,nodes:v.value},null,8,["nodes"])):m(i)==="info"?(d(),O(mv,{key:1,nodes:v.value},null,8,["nodes"])):m(i)==="settings"?(d(),O(Hv,{key:2,nodes:v.value},null,8,["nodes"])):E("",!0)],64)):(d(),$("div",gh,V(S.$t("rightSidePanel.noSelection")),1))])]))}}),ys=At("searchBox",()=>{const e=re(),{x:o,y:t}=Fl(),s=b(()=>e.get("Comfy.NodeSearchBoxImpl")==="default"),l=Ze(null);function a(u){l.value=u}n(a,"setPopoverRef");const i=L(!1);function r(){if(s.value){i.value=!i.value;return}l.value&&l.value.showSearchBox(new MouseEvent("click",{clientX:o.value,clientY:t.value,layerY:t.value}))}return n(r,"toggleVisible"),{newSearchBoxEnabled:s,setPopoverRef:a,toggleVisible:r,visible:i}}),hh={name:"AutoCompletePlus",extends:No,emits:["focused-option-changed"],data(){return{isComposing:!1}},mounted(){typeof No.mounted=="function"&&No.mounted.call(this);const e=this.$el.querySelector("input");e&&(e.addEventListener("compositionstart",()=>{this.isComposing=!0}),e.addEventListener("compositionend",()=>{this.isComposing=!1})),this.$watch(()=>this.focusedOptionIndex,(o,t)=>{this.$emit("focused-option-changed",o)})},methods:{onKeyDown(e){if(e.key==="Enter"&&this.isComposing){e.preventDefault(),e.stopPropagation();return}No.methods.onKeyDown.call(this,e)}}},yh={class:"option-container flex w-full cursor-pointer items-center justify-between overflow-hidden px-2 py-0"},bh={class:"option-display-name flex flex-col font-semibold"},wh={key:0},kh=["innerHTML"],Ch=["innerHTML"],xh={key:0,class:"option-category truncate text-sm font-light text-muted"},Sh={class:"option-badges"},_h=q({__name:"NodeSearchItem",props:{nodeDef:{},currentQuery:{}},setup(e){const o=re(),t=b(()=>o.get("Comfy.NodeSearchBoxImpl.ShowCategory")),s=b(()=>o.get("Comfy.NodeSearchBoxImpl.ShowIdName")),l=b(()=>o.get("Comfy.NodeSearchBoxImpl.ShowNodeFrequency")),a=ls(),i=b(()=>a.getNodeFrequency(p.nodeDef)),r=fr(),u=b(()=>r.isBookmarked(p.nodeDef)),p=e;return(g,v)=>(d(),$("div",yh,[c("div",bh,[c("div",null,[u.value?(d(),$("span",wh,v[0]||(v[0]=[c("i",{class:"pi pi-bookmark-fill mr-1 text-sm"},null,-1)]))):E("",!0),c("span",{innerHTML:m(Os)(g.nodeDef.display_name,g.currentQuery)},null,8,kh),v[1]||(v[1]=c("span",null,"",-1)),s.value?(d(),O(m(eo),{key:1,severity:"secondary"},{default:A(()=>[c("span",{innerHTML:m(Os)(g.nodeDef.name,g.currentQuery)},null,8,Ch)]),_:1})):E("",!0)]),t.value?(d(),$("div",xh,V(g.nodeDef.category.replaceAll("/"," > ")),1)):E("",!0)]),c("div",Sh,[g.nodeDef.experimental?(d(),O(m(eo),{key:0,value:g.$t("g.experimental"),severity:"primary"},null,8,["value"])):E("",!0),g.nodeDef.deprecated?(d(),O(m(eo),{key:1,value:g.$t("g.deprecated"),severity:"danger"},null,8,["value"])):E("",!0),l.value&&i.value>0?(d(),O(m(eo),{key:2,value:m(mr)(i.value,{roundToInt:!0}),severity:"secondary"},null,8,["value"])):E("",!0),g.nodeDef.nodeSource.type!==m(gr).Unknown?(d(),O(m(di),{key:3,class:"text-sm font-light"},{default:A(()=>[$e(V(g.nodeDef.nodeSource.displayText),1)]),_:1})):E("",!0)])]))}}),Th=Le(_h,[["__scopeId","data-v-acda36a0"]]),$h={class:"comfy-vue-node-search-container flex w-full min-w-96 items-center justify-center"},Nh={class:"_dialog-body"},Ih=q({__name:"NodeSearchBox",props:{filters:{},searchLimit:{default:64}},emits:["addFilter","removeFilter","addNode"],setup(e,{emit:o}){const t=re(),{t:s}=pe(),l=b(()=>t.get("Comfy.NodeSearchBoxImpl.NodePreview")),a=L(),i=L(!1),r=`comfy-vue-node-search-box-input-${Math.random()}`,u=L([]),p=L(null),g=L(""),v=b(()=>e.filters.length===0?s("g.searchNodes")+"...":""),f=Tt(),k=ls(),w=on(T=>{T.trim()},500),h=n(T=>{const M=T===""&&e.filters.length===0;g.value=T,u.value=M?k.topNodeDefs:[...f.nodeSearchService.searchNode(T,e.filters,{limit:e.searchLimit})],w(T)},"search"),C=o,y=n(T=>{C("addNode",T)},"onAddNode");let N=null;const x=n(async()=>{N??=document.getElementById(r),N&&(N.blur(),await Fe(()=>N?.focus()))},"reFocusInput");ze(()=>{N??=document.getElementById(r),N&&N.focus(),a.value.hide=()=>h(""),h(""),a.value.show()});const I=n(T=>{i.value=!1,C("addFilter",T)},"onAddFilter"),_=n(async(T,M)=>{T.stopPropagation(),T.preventDefault(),C("removeFilter",M),await x()},"onRemoveFilter"),S=n(T=>{if(T===-1){p.value=null;return}const M=u.value[T];p.value=M},"setHoverSuggestion");return(T,M)=>(d(),$("div",$h,[l.value&&p.value?(d(),$("div",{key:0,class:"comfy-vue-node-preview-container absolute top-[50px] left-[-375px] z-50 cursor-pointer",onMousedown:M[0]||(M[0]=Ce(P=>y(p.value),["stop"]))},[(d(),O(vr,{key:p.value?.name||"","node-def":p.value},null,8,["node-def"]))],32)):E("",!0),R(Z,{variant:"secondary","aria-label":T.$t("g.addNodeFilterCondition"),class:"filter-button z-10",onClick:M[1]||(M[1]=P=>i.value=!0)},{default:A(()=>M[6]||(M[6]=[c("i",{class:"pi pi-filter"},null,-1)])),_:1},8,["aria-label"]),R(m(za),{visible:i.value,"onUpdate:visible":M[2]||(M[2]=P=>i.value=P),class:"min-w-96","dismissable-mask":"",modal:"",onHide:x},{header:A(()=>[c("h3",null,V(T.$t("g.addNodeFilterCondition")),1)]),default:A(()=>[c("div",Nh,[R(hr,{onAddFilter:I})])]),_:1},8,["visible"]),R(hh,{ref_key:"autoCompletePlus",ref:a,"model-value":T.filters,class:"comfy-vue-node-search-box z-10 grow","scroll-height":"40vh",placeholder:v.value,"input-id":r,"append-to":"self",suggestions:u.value,delay:100,loading:!m(k).isLoaded,"complete-on-focus":"","auto-option-focus":"","force-selection":"",multiple:"","option-label":"display_name",onComplete:M[3]||(M[3]=P=>h(P.query)),onOptionSelect:M[4]||(M[4]=P=>y(P.value)),onFocusedOptionChanged:M[5]||(M[5]=P=>S(P))},{option:A(({option:P})=>[R(Th,{"node-def":P,"current-query":g.value},null,8,["node-def","current-query"])]),chip:A(({value:P})=>[P.filterDef&&P.value?(d(),O(yr,{key:`${P.filterDef.id}-${P.value}`,text:P.value,badge:P.filterDef.invokeSequence.toUpperCase(),"badge-class":P.filterDef.invokeSequence+"-badge",onRemove:n(B=>_(B,P),"onRemove")},null,8,["text","badge","badge-class","onRemove"])):E("",!0)]),_:1},8,["model-value","placeholder","suggestions","loading"])]))}}),Mh=q({__name:"NodeSearchBoxPopover",setup(e,{expose:o}){let t=null,s=null,l=!1;const a=re(),i=ys(),r=To(),{visible:u,newSearchBoxEnabled:p}=qe(i),g=L(!0);function v(){return t?[t.canvasX,t.canvasY]:r.getCanvasCenter()}n(v,"getNewNodeLocation");const f=L([]);function k(W){f.value.push(W)}n(k,"addFilter");function w(W){f.value=f.value.filter(F=>Is(F)!==Is(W))}n(w,"removeFilter");function h(){f.value=[]}n(h,"clearFilters");function C(){u.value=!1}n(C,"closeDialog");const y=he();function N(W){const F=r.addNodeOnGraph(W,{pos:v()});l&&t?y.getCanvas().linkConnector.connectToNode(F,t):t||console.warn("The trigger event was undefined when addNode was called."),l=!1,Oe().activeWorkflow?.changeTracker?.checkState(),window.requestAnimationFrame(C)}n(N,"addNode");function x(W){p.value?W?.pointerType==="touch"?setTimeout(()=>{S(W)},128):S(W):y.getCanvas().showSearchBox(W)}n(x,"showSearchBox");function I(){return y.getCanvas().linkConnector.renderLinks.at(0)}n(I,"getFirstLink");const _=Tt();function S(W){const F=I();if(F){const Q=F.toType==="input"?_.nodeSearchService.inputTypeFilter:_.nodeSearchService.outputTypeFilter,j=F.fromSlot.type?.toString()??"";k({filterDef:Q,value:j})}u.value=!0,t=W,g.value=!1,setTimeout(()=>{g.value=!0},300)}n(S,"showNewSearchBox");function T(W){const F=I();if(!F)return;const{node:Q,fromSlot:j,toType:Y}=F,te={e:W,allow_searchbox:!0,showSearchBox:n(()=>{Ve(),x(W)},"showSearchBox")},X=F.fromReroute?.id,ae=Y==="input"?{nodeFrom:Q,slotFrom:j,afterRerouteId:X}:{nodeTo:Q,slotTo:j,afterRerouteId:X},le=y.getCanvas(),Ne=le.showConnectionMenu({...ae,...te});if(!Ne){console.warn("No menu was returned from showConnectionMenu");return}t=W,s=new AbortController;const{signal:Ue}=s,Qe={once:!0,signal:Ue};Re(le.canvas,"connect-new-default-node",_e=>{if(!(_e instanceof CustomEvent))throw new Error("Invalid event");const Be=_e.detail?.node;if(!(Be instanceof ht))throw new Error("Invalid node");l=!1,_e.preventDefault(),le.linkConnector.connectToNode(Be,W)},Qe);const Ve=Re(Ne.controller.signal,"abort",U,Qe)}n(T,"showContextMenu"),ke(()=>{const{canvas:W}=y;W&&(ge.release_link_on_empty_shows_menu=!1,W.allow_searchbox=!1,Re(W.linkConnector.events,"dropped-on-canvas",G))});function M(W){if(W.detail.subType==="empty-double-click")x(W.detail.originalEvent);else if(W.detail.subType==="group-double-click"){const F=W.detail.group,[Q,j]=F.pos;W.detail.originalEvent.canvasY-j>F.titleHeight&&x(W.detail.originalEvent)}}n(M,"canvasEventHandler");const P=b(()=>a.get("Comfy.LinkRelease.Action")),B=b(()=>a.get("Comfy.LinkRelease.ActionShift"));function H(W){return W.preventDefault()}n(H,"preventDefault");function z(W){W.preventDefault();const F=y.getCanvas();F.linkConnector.state.snapLinksPos=[W.detail.canvasX,W.detail.canvasY],Re(F.linkConnector.events,"reset",H,{once:!0})}n(z,"cancelNextReset");function G(W){switch(l=!0,W.detail.shiftKey?B.value:P.value){case kt.SEARCH_BOX:z(W),x(W.detail);break;case kt.CONTEXT_MENU:z(W),T(W.detail);break;case kt.NO_ACTION:}}n(G,"handleDroppedOnCanvas");function U(){s?.abort(),s=null,t=null;const W=y.getCanvas();W.linkConnector.events.removeEventListener("reset",H),l&&W.linkConnector.disconnectLinks(),W.linkConnector.reset(),W.setDirty(!0,!0)}return n(U,"reset"),se(u,()=>{u.value||U()}),Re(document,"litegraph:canvas",M),o({showSearchBox:x}),(W,F)=>(d(),$("div",null,[R(m(za),{visible:m(u),"onUpdate:visible":F[0]||(F[0]=Q=>it(u)?u.value=Q:null),modal:"","dismissable-mask":g.value,pt:{root:{class:"invisible-dialog-root",role:"search"},mask:{class:"node-search-box-dialog-mask"},transition:{enterFromClass:"opacity-0 scale-75",enterActiveClass:"transition-all duration-100 ease-out",leaveActiveClass:"transition-all duration-100 ease-in",leaveToClass:"opacity-0 scale-75"}},onHide:h},{container:A(()=>[R(Ih,{filters:f.value,onAddFilter:k,onRemoveFilter:w,onAddNode:N},null,8,["filters"])]),_:1},8,["visible","dismissable-mask"])]))}}),Ln=At("helpCenter",()=>{const e=L(!1),o=L("sidebar");return{isVisible:e,triggerLocation:o,toggle:n((a="sidebar")=>{e.value||(o.value=a),e.value=!e.value},"toggle"),show:n((a="sidebar")=>{o.value=a,e.value=!0},"show"),hide:n(()=>{e.value=!1},"hide")}});function bs(e="sidebar"){const o=re(),t=po(),s=Ln(),{isVisible:l,triggerLocation:a}=qe(s),{shouldShowRedDot:i}=qe(t),r=Ya(),{showNodeConflictDialog:u}=bt(),{shouldShowRedDot:p,markConflictsAsSeen:g}=ts(),v=b(()=>i.value||p.value),f=b(()=>o.get("Comfy.Sidebar.Location")),k=n(()=>{s.toggle(e)},"toggleHelpCenter"),w=n(()=>{s.hide()},"closeHelpCenter"),h=n(async()=>{try{await r.shouldShowConflictModalAfterUpdate()&&C()}catch(y){console.error("[HelpCenter] Error checking conflict modal:",y)}},"handleWhatsNewDismissed"),C=n(()=>{u({showAfterWhatsNew:!0,dialogComponentProps:{onClose:n(()=>{g()},"onClose")}})},"showConflictModal");return ze(async()=>{await t.initialize()}),{isHelpCenterVisible:l,triggerLocation:a,shouldShowRedDot:v,sidebarLocation:f,toggleHelpCenter:k,closeHelpCenter:w,handleWhatsNewDismissed:h}}n(bs,"useHelpCenter");const Ph={key:0,class:"release-toast-popup"},Dh={class:"w-96 max-h-96 bg-base-background border border-border-default rounded-lg shadow-[1px_1px_8px_0_rgba(0,0,0,0.4)] flex flex-col"},Ah={class:"p-4 flex flex-col gap-4 flex-1 min-h-0"},Lh={class:"flex items-center gap-4"},Eh={class:"flex flex-col gap-1"},Vh={class:"text-sm font-normal text-base-foreground leading-[1.429]"},Rh={class:"text-sm font-normal text-muted-foreground leading-[1.21]"},Oh=["innerHTML"],Wh={class:"flex justify-between items-center px-4 pb-4"},zh=["href"],Bh={class:"flex items-center gap-4"},Fh=q({__name:"ReleaseNotificationToast",setup(e,{expose:o}){const{buildDocsUrl:t}=uo(),{toastErrorHandler:s}=Ft(),l=po(),{t:a}=pe(),i=L(!1),r=b(()=>l.recentRelease),u=b(()=>l.shouldShowToast&&!i.value),p=b(()=>{const N=t("/changelog",{includeLocale:!0});if(r.value?.version){const x=is(r.value.version);return`${N}#${x}`}return N}),g=b(()=>{if(!r.value?.content)return Ct.sanitize(`<p>${a("releaseToast.description")}</p>`);try{const I=r.value.content.replace(/^# .+$/m,"").replace(/!\[.*?\]\(.*?\)/g,""),_=I.trim();return!_||_.replace(/\s+/g,"")===""?Ct.sanitize(`<p>${a("releaseToast.description")}</p>`):Ja(I)}catch(N){console.error("Error parsing markdown:",N);const x=r.value.content.replace(/\n/g,"<br>");return x.trim()?Ct.sanitize(x):Ct.sanitize(`<p>${a("releaseToast.description")}</p>`)}});let v=null;const f=n(()=>{v&&clearTimeout(v),v=setTimeout(()=>{w()},8e3)},"startAutoHide"),k=n(()=>{v&&(clearTimeout(v),v=null)},"clearAutoHide"),w=n(()=>{i.value=!0,k()},"dismissToast"),h=n(()=>{r.value&&l.handleSkipRelease(r.value.version),w()},"handleSkip"),C=n(()=>{r.value&&l.handleShowChangelog(r.value.version),w()},"handleLearnMore"),y=n(async()=>{if(Ke()){try{await Se().execute("Comfy-Desktop.CheckForUpdates"),w()}catch(N){s(N)}return}window.open(t("/installation/update_comfyui",{includeLocale:!0}),"_blank"),w()},"handleUpdate");return se(u,N=>{N?f():k()}),ze(async()=>{l.releases.length||await l.fetchReleases()}),o({handleSkip:h,handleLearnMore:C,handleUpdate:y}),(N,x)=>u.value?(d(),$("div",Ph,[c("div",Dh,[c("div",Ah,[c("div",Lh,[x[0]||(x[0]=c("div",{class:"p-3 bg-primary-background-hover rounded-lg flex items-center justify-center shrink-0"},[c("i",{class:"icon-[lucide--rocket] w-4 h-4 text-white"})],-1)),c("div",Eh,[c("div",Vh,V(N.$t("releaseToast.newVersionAvailable")),1),c("div",Rh,V(r.value?.version),1)])]),c("div",{class:"pl-14 text-sm font-normal text-muted-foreground leading-[1.21] overflow-y-auto flex-1 min-h-0",innerHTML:g.value},null,8,Oh)]),c("div",Wh,[c("a",{class:"flex items-center gap-2 text-sm font-normal py-1 text-muted-foreground hover:text-base-foreground",href:p.value,target:"_blank",rel:"noopener noreferrer",onClick:C},[x[1]||(x[1]=c("i",{class:"icon-[lucide--external-link] w-4 h-4"},null,-1)),$e(" "+V(N.$t("releaseToast.whatsNew")),1)],8,zh),c("div",Bh,[c("button",{class:"h-6 px-0 bg-transparent border-none text-sm font-normal text-muted-foreground hover:text-base-foreground cursor-pointer",onClick:h},V(N.$t("releaseToast.skip")),1),c("button",{class:"h-10 px-4 bg-secondary-background hover:bg-secondary-background-hover rounded-lg border-none text-sm font-normal text-base-foreground cursor-pointer",onClick:y},V(N.$t("releaseToast.update")),1)])])])])):E("",!0)}}),Uh=Le(Fh,[["__scopeId","data-v-ba02c61a"]]),Gh={key:0,class:"whats-new-popup-container left-4"},Hh={class:"modal-body flex flex-col gap-4 px-0 pt-0 pb-2 flex-1"},jh=["innerHTML"],qh={class:"modal-footer flex justify-between items-center gap-4 px-4 pb-4"},Kh=["href"],Qh={class:"footer-actions flex items-center gap-4"},Yh=q({__name:"WhatsNewPopup",emits:["whats-new-dismissed"],setup(e,{expose:o,emit:t}){const{buildDocsUrl:s}=uo(),l=po(),{t:a}=pe(),i=t,r=L(!1),u=b(()=>l.recentRelease),p=b(()=>l.shouldShowPopup&&!r.value),g=b(()=>{const h=s("/changelog",{includeLocale:!0});if(u.value?.version){const C=is(u.value.version);return`${h}#${C}`}return h}),v=b(()=>{if(!u.value?.content)return Ct.sanitize(`<p>${a("whatsNewPopup.noReleaseNotes")}</p>`);try{const h=u.value.content,C=h.trim();if(!C||C.replace(/\s+/g,"")==="")return Ct.sanitize(`<p>${a("whatsNewPopup.noReleaseNotes")}</p>`);const y=h.match(/!\[.*?\]\(.*?\)/),N=y?y[0]:"",x=h.replace(/!\[.*?\]\(.*?\)/,"").trim(),I=[N,x].filter(Boolean).join(`

`);return Ja(I)}catch(h){console.error("Error parsing markdown:",h);const C=u.value.content.replace(/\n/g,"<br>");return C.trim()?Ct.sanitize(C):Ct.sanitize(`<p>${a("whatsNewPopup.noReleaseNotes")}</p>`)}}),f=n(()=>{r.value=!1},"show"),k=n(()=>{r.value=!0,i("whats-new-dismissed")},"hide"),w=n(async()=>{u.value&&await l.handleWhatsNewSeen(u.value.version),k()},"closePopup");return ze(async()=>{l.releases.length||await l.fetchReleases()}),o({show:f,hide:k,closePopup:w}),(h,C)=>p.value?(d(),$("div",Gh,[c("div",{class:"whats-new-popup",onClick:C[0]||(C[0]=Ce(()=>{},["stop"]))},[R(Z,{class:"close-button absolute top-2 right-2 z-10 w-8 h-8 p-2 rounded-lg opacity-50","aria-label":h.$t("g.close"),size:"icon-sm",variant:"muted-textonly",onClick:w},{default:A(()=>C[1]||(C[1]=[c("i",{class:"icon-[lucide--x]"},null,-1)])),_:1},8,["aria-label"]),c("div",Hh,[c("div",{class:"content-text max-h-96 overflow-y-auto",innerHTML:v.value},null,8,jh)]),c("div",qh,[c("a",{class:"learn-more-link flex items-center gap-2 text-sm font-normal py-1",href:g.value,target:"_blank",rel:"noopener noreferrer",onClick:w},[C[2]||(C[2]=c("i",{class:"icon-[lucide--external-link]"},null,-1)),$e(" "+V(h.$t("whatsNewPopup.learnMore")),1)],8,Kh),c("div",Qh,[R(Z,{class:"h-8",size:"sm",variant:"muted-textonly",onClick:w},{default:A(()=>[$e(V(h.$t("whatsNewPopup.later")),1)]),_:1})])])])])):E("",!0)}}),Jh=Le(Yh,[["__scopeId","data-v-98a9f324"]]),Xh=["width","height"],Zh={"clip-path":"url(#clip0_1099_16244)"},ey=["stroke"],ty=q({__name:"PuzzleIcon",props:{size:{default:16},color:{default:"currentColor"},class:{}},setup(e){const o=b(()=>e.class||"");return(t,s)=>(d(),$("svg",{xmlns:"http://www.w3.org/2000/svg",width:t.size,height:t.size,viewBox:"0 0 16 16",fill:"none",class:K(o.value)},[c("g",Zh,[c("path",{d:"M4.99992 3.00016C4.99992 2.07969 5.74611 1.3335 6.66658 1.3335C7.58706 1.3335 8.33325 2.07969 8.33325 3.00016V4.00016H8.99992C9.9318 4.00016 10.3977 4.00016 10.7653 4.1524C11.2553 4.35539 11.6447 4.74474 11.8477 5.2348C11.9999 5.60234 11.9999 6.06828 11.9999 7.00016H12.9999C13.9204 7.00016 14.6666 7.74635 14.6666 8.66683C14.6666 9.5873 13.9204 10.3335 12.9999 10.3335H11.9999V11.4668C11.9999 12.5869 11.9999 13.147 11.7819 13.5748C11.5902 13.9511 11.2842 14.2571 10.9079 14.4488C10.4801 14.6668 9.92002 14.6668 8.79992 14.6668H8.33325V13.5002C8.33325 12.6717 7.66168 12.0002 6.83325 12.0002C6.00482 12.0002 5.33325 12.6717 5.33325 13.5002V14.6668H4.53325C3.41315 14.6668 2.85309 14.6668 2.42527 14.4488C2.04895 14.2571 1.74299 13.9511 1.55124 13.5748C1.33325 13.147 1.33325 12.5869 1.33325 11.4668V10.3335H2.33325C3.25373 10.3335 3.99992 9.5873 3.99992 8.66683C3.99992 7.74635 3.25373 7.00016 2.33325 7.00016H1.33325C1.33325 6.06828 1.33325 5.60234 1.48549 5.2348C1.68848 4.74474 2.07783 4.35539 2.56789 4.1524C2.93543 4.00016 3.40137 4.00016 4.33325 4.00016H4.99992V3.00016Z",stroke:t.color,"stroke-width":"1.2","stroke-linecap":"round","stroke-linejoin":"round"},null,8,ey)]),s[0]||(s[0]=c("defs",null,[c("clipPath",{id:"clip0_1099_16244"},[c("rect",{width:"16",height:"16",fill:"white"})])],-1))],10,Xh))}}),oy=["aria-label"],ny={class:"w-full"},sy={class:"flex w-full flex-col gap-2",role:"menubar"},ay=["onClick","onMouseenter","onMouseleave"],ly={class:"help-menu-icon-container"},iy={class:"help-menu-icon"},ry={key:0,class:"menu-red-dot"},uy={class:"menu-label"},cy={key:0,class:"icon-[lucide--external-link] text-primary w-4 h-4 ml-auto"},dy={key:1,class:"pi pi-chevron-right ml-auto"},py={key:0,class:"submenu-divider"},fy=["onClick"],my={class:"menu-label"},gy={key:0,class:"w-full","data-testid":"whats-new-section"},vy={class:"section-description flex items-center gap-2.5 self-stretch px-8 pt-2 pb-2"},hy=["aria-label"],yy=["onClick","onKeydown"],by={class:"release-content"},wy={class:"release-title"},ky=["datetime"],Cy={class:"normal-state"},xy={class:"hover-state"},Sy={key:1,class:"help-menu-item",role:"status","aria-live":"polite"},_y={key:2,class:"help-menu-item",role:"status"},Ty=q({__name:"HelpCenterMenuContent",emits:["close"],setup(e,{emit:o}){const t={MINUTE:6e4,HOUR:36e5,DAY:864e5,WEEK:6048e5,MONTH:2592e6,YEAR:31536e6},s={DELAY_MS:100,OFFSET_PX:8,Z_INDEX:10001},{t:l}=pe(),a=zt(),{staticUrls:i,buildDocsUrl:r}=uo(),u=po(),p=Se(),g=re(),v=L(Date.now()),f=o,k=L(!1),w=L(null),h=L({});let C=null;const y=b(()=>u.releases.length>0),N=b(()=>g.get("Comfy.Notification.ShowVersionUpdates")),{shouldShowRedDot:x}=ts(),{isNewManagerUI:I}=vt(),_=b(()=>[{key:"desktop-guide",type:"item",label:l("helpCenter.desktopUserGuide"),visible:Ke(),action:n(()=>{P(r("/installation/desktop",{includeLocale:!0,platform:!0})),f("close")},"action")},{key:"dev-tools",type:"item",label:l("helpCenter.openDevTools"),visible:Ke(),action:n(()=>{Q(),f("close")},"action")},{key:"divider-1",type:"divider",visible:Ke()},{key:"reinstall",type:"item",label:l("helpCenter.reinstall"),visible:Ke(),action:n(()=>{j(),f("close")},"action")}].filter(ae=>ae.visible!==!1)),S=b(()=>!!_.value.length),T=b(()=>M.value.find(X=>X.key==="more")),M=b(()=>{const X=[{key:"feedback",type:"item",icon:"icon-[lucide--clipboard-pen]",label:l("helpCenter.feedback"),action:n(()=>{p.execute("Comfy.ContactSupport"),f("close")},"action")},{key:"help",type:"item",icon:"icon-[lucide--message-circle-question]",label:l("helpCenter.help"),action:n(()=>{p.execute("Comfy.ContactSupport"),f("close")},"action")},{key:"docs",type:"item",icon:"icon-[lucide--book-open]",label:l("helpCenter.docs"),showExternalIcon:!0,action:n(()=>{P(r("/",{includeLocale:!0})),f("close")},"action")},{key:"discord",type:"item",icon:"pi pi-discord",label:"Discord",showExternalIcon:!0,action:n(()=>{P(i.discord),f("close")},"action")},{key:"github",type:"item",icon:"icon-[lucide--github]",label:l("helpCenter.github"),showExternalIcon:!0,action:n(()=>{P(i.github),f("close")},"action")}];return X.push({key:"manager",type:"item",icon:ty,label:l("helpCenter.managerExtension"),showRedDot:x.value,action:n(async()=>{await vt().openManager({initialTab:to.All,showToastOnLegacyError:!1}),f("close")},"action")}),!Ke()&&!xt&&I.value&&X.push({key:"update-comfyui",type:"item",icon:"icon-[lucide--download]",label:l("helpCenter.updateComfyUI"),action:n(()=>{Y(),f("close")},"action")}),X.push({key:"more",type:"item",icon:"",label:l("helpCenter.more"),visible:S.value,action:n(()=>{},"action"),items:_.value}),X}),P=n(X=>{window.open(X,"_blank","noopener,noreferrer")},"openExternalLink"),B=n(()=>{C&&(clearTimeout(C),C=null)},"clearHoverTimeout"),H=n(X=>{const ae=X.getBoundingClientRect(),le=210,Ue=(T.value?.items?.filter(wt=>wt.visible!==!1).length||0)*48+16,Qe=w.value?.offsetHeight||Ue,Ve=window.innerWidth,_e=window.innerHeight;let Be=ae.top,Je=ae.right+s.OFFSET_PX;return Je+le>Ve&&(Je=ae.left-le-s.OFFSET_PX),Be+Qe>_e&&(Be=Math.max(s.OFFSET_PX,ae.bottom-Qe)),Be<s.OFFSET_PX&&(Be=s.OFFSET_PX),Be-=8,{position:"fixed",top:`${Be}px`,left:`${Je}px`,zIndex:s.Z_INDEX}},"calculateSubmenuPosition"),z=n(X=>{if(!X)return"date";const ae=new Date(X),Ne=Math.abs(new Date().getTime()-ae.getTime()),Ue=[{unit:t.YEAR,key:"yearsAgo"},{unit:t.MONTH,key:"monthsAgo"},{unit:t.WEEK,key:"weeksAgo"},{unit:t.DAY,key:"daysAgo"},{unit:t.HOUR,key:"hoursAgo"},{unit:t.MINUTE,key:"minutesAgo"}];for(const{unit:Qe,key:Ve}of Ue){const _e=Math.floor(Ne/Qe);if(_e>0)return l(`g.relativeTime.${Ve}`,{count:_e})}return l("g.relativeTime.now")},"formatReleaseDate"),G=n(async(X,ae)=>{if(X!=="more"||!T.value?.items||!T.value.items.some(Ue=>Ue.visible!==!1))return;B();const Ne=ae.currentTarget;h.value=H(Ne),k.value=!0,await Fe(),w.value&&(h.value=H(Ne))},"onMenuItemHover"),U=n(X=>{X==="more"&&(C=window.setTimeout(()=>{k.value=!1},s.DELAY_MS))},"onMenuItemLeave"),W=n(()=>{B()},"onSubmenuHover"),F=n(()=>{k.value=!1},"onSubmenuLeave"),Q=n(()=>{Ke()&&bo().openDevTools()},"openDevTools"),j=n(()=>{Ke()&&bo().reinstall()},"onReinstall"),Y=n(async()=>{const{updateComfyUI:X,rebootComfyUI:ae,error:le}=Xa();a.add({severity:"info",summary:l("helpCenter.updateComfyUIStarted"),detail:l("helpCenter.updateComfyUIStartedDetail"),life:3e3});try{if(await X({is_stable:!0})===null||le.value){a.add({severity:"error",summary:l("g.error"),detail:le.value||l("helpCenter.updateComfyUIFailed"),life:5e3});return}a.add({severity:"success",summary:l("helpCenter.updateComfyUISuccess"),detail:l("helpCenter.updateComfyUISuccessDetail"),life:3e3}),await ae()}catch(Ne){a.add({severity:"error",summary:l("g.error"),detail:Ne instanceof Error?Ne.message:l("g.unknownError"),life:5e3})}},"onUpdateComfyUI"),te=n(X=>{u.handleShowChangelog(X.version);const ae=is(X.version),le=`${r("/changelog",{includeLocale:!0})}#${ae}`;P(le),f("close")},"onReleaseClick");return ze(async()=>{y.value||await u.fetchReleases()}),ut(()=>{Math.round((Date.now()-v.value)/1e3)}),(X,ae)=>(d(),$("div",{class:"help-center-menu flex flex-col items-start gap-1",role:"menu","aria-label":X.$t("help.helpCenterMenu")},[c("div",ny,[c("nav",sy,[(d(!0),$(oe,null,be(M.value,le=>de((d(),$("button",{key:le.key,type:"button",class:K(["help-menu-item",{"more-item":le.key==="more"}]),role:"menuitem",onClick:le.action,onMouseenter:n(Ne=>G(le.key,Ne),"onMouseenter"),onMouseleave:n(Ne=>U(le.key),"onMouseleave")},[c("div",ly,[c("div",iy,[typeof le.icon=="object"?(d(),O(no(le.icon),{key:0,size:16})):(d(),$("i",{key:1,class:K(le.icon)},null,2))]),le.showRedDot?(d(),$("div",ry)):E("",!0)]),c("span",uy,V(le.label),1),le.showExternalIcon?(d(),$("i",cy)):E("",!0),le.key==="more"?(d(),$("i",dy)):E("",!0)],42,ay)),[[Xe,le.visible!==!1]])),128))]),ae[0]||(ae[0]=c("div",{class:"flex h-4 flex-col items-center justify-between self-stretch p-2"},[c("div",{class:"w-full border-b border-interface-menu-stroke"})],-1))]),(d(),O(Mt,{to:"body"},[k.value?(d(),$("div",{key:0,ref_key:"submenuRef",ref:w,class:"more-submenu",style:ve(h.value),onMouseenter:W,onMouseleave:F},[(d(!0),$(oe,null,be(T.value?.items,le=>(d(),$(oe,{key:le.key},[le.type==="divider"?de((d(),$("div",py,null,512)),[[Xe,le.visible!==!1]]):de((d(),$("button",{key:1,type:"button",class:"help-menu-item submenu-item",role:"menuitem",onClick:le.action},[c("span",my,V(le.label),1)],8,fy)),[[Xe,le.visible!==!1]])],64))),128))],36)):E("",!0)])),N.value?(d(),$("section",gy,[c("h3",vy,V(X.$t("helpCenter.whatsNew")),1),y.value?(d(),$("div",{key:0,role:"group","aria-label":X.$t("help.recentReleases")},[(d(!0),$(oe,null,be(m(u).recentReleases,le=>(d(),$("article",{key:le.id||le.version,class:"release-menu-item flex h-12 min-h-6 cursor-pointer items-center gap-2 self-stretch rounded p-2 transition-colors hover:bg-interface-menu-component-surface-hovered",role:"button",tabindex:"0",onClick:n(Ne=>te(le),"onClick"),onKeydown:[oo(Ne=>te(le),["enter"]),oo(Ce(Ne=>te(le),["prevent"]),["space"])]},[ae[1]||(ae[1]=c("i",{class:"help-menu-icon icon-[lucide--package]","aria-hidden":"true"},null,-1)),c("div",by,[c("span",wy,V(X.$t("g.releaseTitle",{package:"Comfy",version:le.version})),1),c("time",{class:"release-date",datetime:le.published_at},[c("span",Cy,V(z(le.published_at)),1),c("span",xy,V(X.$t("helpCenter.clickToLearnMore")),1)],8,ky)])],40,yy))),128))],8,hy)):m(u).isLoading?(d(),$("div",Sy,[ae[2]||(ae[2]=c("i",{class:"pi pi-spin pi-spinner help-menu-icon","aria-hidden":"true"},null,-1)),c("span",null,V(X.$t("helpCenter.loadingReleases")),1)])):(d(),$("div",_y,[ae[3]||(ae[3]=c("i",{class:"pi pi-info-circle help-menu-icon","aria-hidden":"true"},null,-1)),c("span",null,V(X.$t("helpCenter.noRecentReleases")),1)]))])):E("",!0)],8,oy))}}),$y=Le(Ty,[["__scopeId","data-v-8ecd06e2"]]),Ny=q({__name:"HelpCenterPopups",props:{isSmall:{type:Boolean,default:!1}},setup(e){const{isHelpCenterVisible:o,triggerLocation:t,sidebarLocation:s,closeHelpCenter:l,handleWhatsNewDismissed:a}=bs();return(i,r)=>(d(),$(oe,null,[(d(),O(Mt,{to:"#graph-canvas-container"},[m(o)?(d(),$("div",{key:0,class:K(["help-center-popup",{"sidebar-left":m(t)==="sidebar"&&m(s)==="left","sidebar-right":m(t)==="sidebar"&&m(s)==="right","topbar-right":m(t)==="topbar","small-sidebar":i.isSmall}])},[R($y,{onClose:m(l)},null,8,["onClose"])],2)):E("",!0)])),(d(),O(Mt,{to:"#graph-canvas-container"},[R(Uh,{class:K({"sidebar-left":m(s)==="left","sidebar-right":m(s)==="right","small-sidebar":i.isSmall})},null,8,["class"])])),(d(),O(Mt,{to:"#graph-canvas-container"},[R(Jh,{class:K({"sidebar-left":m(s)==="left","sidebar-right":m(s)==="right","small-sidebar":i.isSmall}),onWhatsNewDismissed:m(a)},null,8,["class","onWhatsNewDismissed"])])),(d(),O(Mt,{to:"body"},[m(o)?(d(),$("div",{key:0,class:"help-center-backdrop",onClick:r[0]||(r[0]=(...u)=>m(l)&&m(l)(...u))})):E("",!0)]))],64))}}),Iy=Le(Ny,[["__scopeId","data-v-2583d84f"]]),My=["width","height"],Py=q({__name:"ComfyLogo",props:{size:{default:16},color:{default:"currentColor"},class:{},mode:{default:"outline"}},setup(e){const o=b(()=>e.class||""),t=b(()=>({stroke:e.mode==="outline"?e.color:void 0,strokeWidth:e.mode==="outline"?1:void 0,fill:e.mode==="fill"?e.color:"none"}));return(s,l)=>(d(),$("svg",{class:K(o.value),width:s.size,height:s.size,viewBox:"0 0 18 18",xmlns:"http://www.w3.org/2000/svg"},[c("path",_t({d:"M14.8193 0.600586C15.1248 0.600586 15.3296 0.70893 15.459 0.881836C15.5914 1.05888 15.6471 1.33774 15.5527 1.66895L14.8037 4.30176C14.7063 4.64386 14.4729 4.97024 14.1641 5.21191C13.8544 5.45415 13.496 5.58984 13.1699 5.58984H13.1689L9.5791 5.59668H7.90625C7.52654 5.59668 7.19496 5.84986 7.09082 6.21289L5.69434 11.0889C5.63007 11.3133 5.66134 11.5534 5.77734 11.7529L5.83203 11.8359C5.99177 12.0491 6.24252 12.1758 6.50977 12.1758H6.51074L8.88281 12.1709H11.4971C11.7643 12.171 11.9541 12.254 12.084 12.3906L12.1357 12.4521C12.2685 12.6295 12.3249 12.9089 12.2305 13.2402L11.4805 15.8721C11.383 16.2144 11.1498 16.5415 10.8408 16.7832C10.5314 17.0252 10.1736 17.161 9.84766 17.1611H9.84668L6.25684 17.168H3.64258C3.33762 17.1679 3.13349 17.0588 3.00391 16.8857C2.87135 16.7087 2.81482 16.43 2.90918 16.0986L3.39551 14.3887C3.46841 14.1327 3.41794 13.8576 3.25879 13.6445V13.6436C3.09901 13.4303 2.84745 13.3037 2.58008 13.3037H1.18066C0.875088 13.3037 0.670398 13.1953 0.541016 13.0225C0.408483 12.8451 0.351891 12.5655 0.446289 12.2344L2.11914 6.38965L2.30371 5.74707V5.74609C2.40139 5.40341 2.63456 5.07671 2.94336 4.83496C3.25302 4.59258 3.61143 4.45705 3.9375 4.45703H5.6123C5.94484 4.45703 6.24083 4.26316 6.37891 3.9707L6.42773 3.83984L6.98145 1.89551C7.07894 1.55317 7.31212 1.22614 7.62109 0.984375C7.93074 0.742127 8.2892 0.606445 8.61523 0.606445H8.61621L12.1982 0.600586H14.8193Z"},t.value),null,16)],10,My))}}),zo=q({__name:"CardBottom",props:{fullHeight:{type:Boolean,default:!0}},setup(e){const o=b(()=>ne("flex-1 w-full",e.fullHeight&&"h-full"));return(t,s)=>(d(),$("div",{class:K(o.value)},[ye(t.$slots,"default")],2))}}),Dy="flex flex-col overflow-hidden",Bo=q({__name:"CardContainer",props:{size:{default:"regular"},variant:{default:"default"},rounded:{default:"md"},customAspectRatio:{},hasBorder:{type:Boolean,default:!0},hasBackground:{type:Boolean,default:!0},hasShadow:{type:Boolean,default:!0},hasCursor:{type:Boolean,default:!0},class:{default:""}},setup(e){const o={none:"rounded-none",md:"rounded",lg:"rounded-lg",xl:"rounded-xl"},t=b(()=>{const s={default:ne(e.hasBackground&&"bg-modal-card-background",e.hasBorder&&"border border-border-default",e.hasShadow&&"shadow-sm",e.hasCursor&&"cursor-pointer"),ghost:ne(e.hasCursor&&"cursor-pointer","p-2 transition-colors duration-200"),outline:ne(e.hasBorder&&"border-2 border-border-subtle",e.hasCursor&&"cursor-pointer","hover:border-border-subtle/50 transition-colors")},l=e.customAspectRatio?`aspect-[${e.customAspectRatio}]`:{mini:"aspect-100/120",compact:"aspect-240/311",regular:"aspect-256/308",portrait:"aspect-256/325",tall:"aspect-256/353"}[e.size];return ne(Dy,o[e.rounded],s[e.variant],l,e.class)});return(s,l)=>(d(),$("div",{class:K(t.value)},[ye(s.$slots,"top"),ye(s.$slots,"bottom")],2))}}),Fo=q({__name:"CardTop",props:{ratio:{default:"square"},topLeftClass:{},topRightClass:{},centerLeftClass:{},centerRightClass:{},bottomLeftClass:{},bottomRightClass:{}},setup(e){const o=ba(),t=b(()=>`relative p-0 overflow-hidden ${{square:"aspect-square",landscape:"aspect-48/27"}[e.ratio]}`),s={"top-left":"absolute top-2 left-2 flex flex-wrap justify-start gap-2","top-right":"absolute top-2 right-2 flex flex-wrap justify-end gap-2","center-left":"absolute top-1/2 left-2 flex -translate-y-1/2 flex-wrap justify-start gap-2","center-right":"absolute top-1/2 right-2 flex -translate-y-1/2 flex-wrap justify-end gap-2","bottom-left":"absolute bottom-2 left-2 flex flex-wrap justify-start gap-2","bottom-right":"absolute right-2 bottom-2 flex flex-wrap justify-end gap-2"},l=b(()=>({"top-left":ne(s["top-left"],e.topLeftClass),"top-right":ne(s["top-right"],e.topRightClass),"center-left":ne(s["center-left"],e.centerLeftClass),"center-right":ne(s["center-right"],e.centerRightClass),"bottom-left":ne(s["bottom-left"],e.bottomLeftClass),"bottom-right":ne(s["bottom-right"],e.bottomRightClass)}));return(a,i)=>(d(),$("div",{class:K(t.value)},[ye(a.$slots,"default",{class:"absolute top-0 left-0 h-full w-full"}),m(o)["top-left"]?(d(),$("div",{key:0,class:K(l.value["top-left"])},[ye(a.$slots,"top-left")],2)):E("",!0),m(o)["top-right"]?(d(),$("div",{key:1,class:K(l.value["top-right"])},[ye(a.$slots,"top-right")],2)):E("",!0),m(o)["center-left"]?(d(),$("div",{key:2,class:K(l.value["center-left"])},[ye(a.$slots,"center-left")],2)):E("",!0),m(o)["center-right"]?(d(),$("div",{key:3,class:K(l.value["center-right"])},[ye(a.$slots,"center-right")],2)):E("",!0),m(o)["bottom-left"]?(d(),$("div",{key:4,class:K(l.value["bottom-left"])},[ye(a.$slots,"bottom-left")],2)):E("",!0),m(o)["bottom-right"]?(d(),$("div",{key:5,class:K(l.value["bottom-right"])},[ye(a.$slots,"bottom-right")],2)):E("",!0)],2))}}),Ay="inline-flex shrink-0 items-center justify-center gap-1 rounded px-2 py-1 text-xs font-bold",Uo=q({__name:"SquareChip",props:{label:{},variant:{default:"dark"}},setup(e){const o={dark:"bg-zinc-500/40 text-white/90",light:ne("backdrop-blur-[2px] bg-base-background/50 text-base-foreground"),gray:ne("backdrop-blur-[2px] bg-modal-card-tag-background text-base-foreground")},t=b(()=>ne(Ay,o[e.variant]));return(s,l)=>(d(),$("div",{class:K(t.value)},[ye(s.$slots,"icon"),c("span",null,V(s.label),1)],2))}}),Ly={class:"relative aspect-square w-full overflow-hidden rounded-t-lg select-none"},Ey={key:1,class:"flex h-full w-full items-center justify-center"},Vy=q({__name:"BaseThumbnail",props:{hoverZoom:{default:4},isHovered:{type:Boolean}},setup(e){const o=L(!1),t=L(null);return ze(()=>{Array.from(t.value?.getElementsByTagName("img")??[]).forEach(l=>{Re(l,"error",()=>{o.value=!0})})}),(s,l)=>(d(),$("div",Ly,[o.value?(d(),$("div",Ey,l[0]||(l[0]=[c("img",{src:hu,draggable:"false",class:"h-full w-full transform-gpu object-cover transition-transform duration-300 ease-out"},null,-1)]))):(d(),$("div",{key:0,ref_key:"contentRef",ref:t,class:"h-full w-full transform-gpu transition-transform duration-1000 ease-out",style:ve(s.isHovered?{transform:`scale(${1+s.hoverZoom/100})`}:void 0)},[ye(s.$slots,"default",{},void 0,!0)],4))]))}}),un=Le(Vy,[["__scopeId","data-v-c216f2c0"]]),Ry={class:"flex h-full w-full items-center justify-center p-4",style:{backgroundImage:"url(/assets/images/default-template.png)",backgroundRepeat:"round"}},Oy=["src"],Wy=q({__name:"AudioThumbnail",props:{src:{}},setup(e){return(o,t)=>(d(),O(un,null,{default:A(()=>[c("div",Ry,[c("audio",{controls:"",class:"relative w-full",src:o.src,onClick:t[0]||(t[0]=Ce(()=>{},["stop"]))},null,8,Oy)])]),_:1}))}}),zy=50,By=q({__name:"CompareSliderThumbnail",props:{baseImageSrc:{},overlayImageSrc:{},alt:{},isHovered:{type:Boolean},isVideo:{type:Boolean}},setup(e){const o=e.isVideo||e.baseImageSrc?.toLowerCase().endsWith(".webp")||e.overlayImageSrc?.toLowerCase().endsWith(".webp")||!1,t=L(zy),s=L(null),{elementX:l,elementWidth:a,isOutside:i}=Ul(s);return se([()=>e.isHovered,l,a,i],([r,u,p,g])=>{r&&(g||(t.value=u/p*100))}),(r,u)=>(d(),O(un,{"is-hovered":r.isHovered},{default:A(()=>[R(xo,{src:r.baseImageSrc,alt:r.alt,"image-class":m(o)?"w-full h-full object-cover":"max-w-full max-h-64 object-contain"},null,8,["src","alt","image-class"]),c("div",{ref_key:"containerRef",ref:s,class:"absolute inset-0"},[R(xo,{src:r.overlayImageSrc,alt:r.alt,"image-class":m(o)?"w-full h-full object-cover":"max-w-full max-h-64 object-contain","image-style":{clipPath:`inset(0 ${100-t.value}% 0 0)`}},null,8,["src","alt","image-class","image-style"]),c("div",{class:"pointer-events-none absolute inset-y-0 z-10 w-0.5 bg-white/30 backdrop-blur-sm",style:ve({left:`${t.value}%`})},null,4)],512)]),_:1},8,["is-hovered"]))}}),Fy=q({__name:"DefaultThumbnail",props:{src:{},alt:{},hoverZoom:{},isHovered:{type:Boolean},isVideo:{type:Boolean}},setup(e){const o=e.isVideo??(e.src?.toLowerCase().endsWith(".webp")||!1);return(t,s)=>(d(),O(un,{"hover-zoom":t.hoverZoom,"is-hovered":t.isHovered},{default:A(()=>[R(xo,{src:t.src,alt:t.alt,"image-class":["transform-gpu transition-transform duration-300 ease-out",m(o)?"w-full h-full object-cover":"max-w-full max-h-64 object-contain"],"image-style":t.isHovered?{transform:`scale(${1+t.hoverZoom/100})`}:void 0},null,8,["src","alt","image-class","image-style"])]),_:1},8,["hover-zoom","is-hovered"]))}}),Uy={class:"relative h-full w-full"},Gy={class:"absolute inset-0"},Hy={class:"absolute inset-0 z-10"},jy=q({__name:"HoverDissolveThumbnail",props:{baseImageSrc:{},overlayImageSrc:{},alt:{},isHovered:{type:Boolean},isVideo:{type:Boolean}},setup(e){const o=e.isVideo||e.baseImageSrc?.toLowerCase().endsWith(".webp")||e.overlayImageSrc?.toLowerCase().endsWith(".webp")||!1,t=b(()=>o?"size-full object-cover":"size-full object-contain"),s=b(()=>{const l="size-full transition-opacity duration-300",a=o?"object-cover":"object-contain",i=e.isHovered?"opacity-100":"opacity-0";return`${l} ${a} ${i}`});return(l,a)=>(d(),O(un,{"is-hovered":l.isHovered},{default:A(()=>[c("div",Uy,[c("div",Gy,[R(xo,{src:l.baseImageSrc,alt:l.alt,"image-class":t.value},null,8,["src","alt","image-class"])]),c("div",Hy,[R(xo,{src:l.overlayImageSrc,alt:l.alt,"image-class":s.value},null,8,["src","alt","image-class"])])])]),_:1},8,["is-hovered"]))}});function qy(e,o={}){const{itemsPerPage:t=12,initialPage:s=1}=o,l=L(s),a=L(!1),i=Ze(new Set([])),r=b(()=>{const k="value"in e?e.value:e;return Array.isArray(k)?k:[]}),u=b(()=>{const k=r.value;if(k.length===0)return[];const w=Array.from(i.value).sort((y,N)=>y-N),C=Math.max(...w,0)*t;return k.slice(0,C)}),p=b(()=>{const k=r.value;if(k.length===0)return!1;const w=Array.from(i.value);return Math.max(...w,0)*t<k.length}),g=b(()=>{const k=r.value;return k.length===0?0:Math.ceil(k.length/t)}),v=n(async()=>{if(a.value||!p.value)return;a.value=!0;const k=Array.from(i.value),w=Math.max(...k,0)+1,h=new Set(i.value);h.add(w),i.value=h,l.value=w,a.value=!1},"loadNextPage");return se(()=>r.value.length,k=>{k>0&&i.value.size===0&&(i.value=new Set([1]))},{immediate:!0}),{paginatedItems:u,isLoading:a,hasMoreItems:p,currentPage:l,totalPages:g,loadNextPage:v,reset:n(()=>{l.value=s,i.value=new Set([]),a.value=!1,r.value.length>0&&(i.value=new Set([1]))},"reset")}}n(qy,"useLazyPagination");const Ky=At("templateRanking",()=>{const e=L(),o=n(a=>a/(e.value??a),"normalizeUsageScore"),t=n(a=>{if(!a)return .5;const i=new Date(a);if(isNaN(i.getTime()))return .5;const r=(Date.now()-i.getTime())/(1e3*60*60*24);return Math.max(.1,1/(1+r/90))},"computeFreshness");return{largestUsageScore:e,computeFreshness:t,computeDefaultScore:n((a,i,r=0)=>{const u=(i??5)/10,p=t(a);return o(r)*.5+u*.3+p*.2},"computeDefaultScore"),computePopularScore:n((a,i=0)=>{const r=t(a);return o(i)*.9+r*.1},"computePopularScore")}}),Qy={keys:[{name:"name",weight:.3},{name:"title",weight:.3},{name:"description",weight:.1},{name:"tags",weight:.2},{name:"models",weight:.3}],threshold:.33,includeScore:!0,includeMatches:!0};function Yy(e){const o=re(),t=Ky(),s=L(""),l=L(o.get("Comfy.Templates.SelectedModels")),a=L(o.get("Comfy.Templates.SelectedUseCases")),i=L(o.get("Comfy.Templates.SelectedRunsOn")),r=L(o.get("Comfy.Templates.SortBy")),u=L(Qy),p=b(()=>{const U="value"in e?e.value:e;return Array.isArray(U)?U:[]}),g=b(()=>new Gl(p.value,u.value)),v=b(()=>{const U=new Set;return p.value.forEach(W=>{Array.isArray(W.models)&&W.models.forEach(F=>U.add(F))}),Array.from(U).sort()}),f=b(()=>{const U=new Set;return p.value.forEach(W=>{W.tags&&Array.isArray(W.tags)&&W.tags.forEach(F=>U.add(F))}),Array.from(U).sort()}),k=b(()=>["ComfyUI","External or Remote API"]),w=$a(s,50),h=b(()=>w.value.trim()?g.value.search(w.value).map(W=>W.item):p.value),C=b(()=>l.value.length===0?h.value:h.value.filter(U=>!U.models||!Array.isArray(U.models)?!1:l.value.some(W=>U.models?.includes(W)))),y=b(()=>a.value.length===0?C.value:C.value.filter(U=>!U.tags||!Array.isArray(U.tags)?!1:a.value.some(W=>U.tags?.includes(W)))),N=b(()=>i.value.length===0?y.value:y.value.filter(U=>{const W=U.openSource===!1,F=U.openSource!==!1;return i.value.some(Q=>Q==="External or Remote API"?W:Q==="ComfyUI"?F:!1)})),x=n(U=>typeof U.vram=="number"&&Number.isFinite(U.vram)&&U.vram>0?U.vram:Number.POSITIVE_INFINITY,"getVramMetric");se(N,U=>{t.largestUsageScore=Math.max(...U.map(W=>W.usage||0))},{immediate:!0});const I=b(()=>{const U=[...N.value];switch(r.value){case"recommended":return U.sort((W,F)=>{const Q=t.computeDefaultScore(W.date,W.searchRank,W.usage);return t.computeDefaultScore(F.date,F.searchRank,F.usage)-Q});case"popular":return U.sort((W,F)=>{const Q=t.computePopularScore(W.date,W.usage);return t.computePopularScore(F.date,F.usage)-Q});case"alphabetical":return U.sort((W,F)=>{const Q=W.title||W.name||"",j=F.title||F.name||"";return Q.localeCompare(j)});case"newest":return U.sort((W,F)=>{const Q=new Date(W.date||"1970-01-01");return new Date(F.date||"1970-01-01").getTime()-Q.getTime()});case"vram-low-to-high":return U.sort((W,F)=>{const Q=x(W),j=x(F);if(Q===j){const Y=W.title||W.name||"",te=F.title||F.name||"";return Y.localeCompare(te)}return Q===Number.POSITIVE_INFINITY?1:j===Number.POSITIVE_INFINITY?-1:Q-j});case"model-size-low-to-high":return U.sort((W,F)=>{const Q=typeof W.size=="number"?W.size:Number.POSITIVE_INFINITY,j=typeof F.size=="number"?F.size:Number.POSITIVE_INFINITY;return Q===j?0:Q-j});case"default":default:return U}}),_=b(()=>I.value),S=n(()=>{s.value="",l.value=[],a.value=[],i.value=[],r.value="default"},"resetFilters"),T=n(U=>{l.value=l.value.filter(W=>W!==U)},"removeModelFilter"),M=n(U=>{a.value=a.value.filter(W=>W!==U)},"removeUseCaseFilter"),P=n(U=>{i.value=i.value.filter(W=>W!==U)},"removeRunsOnFilter"),B=b(()=>_.value.length),H=b(()=>p.value.length),z=on(()=>{},500),G=n(async()=>{const U=await Te.getFuseOptions();U&&(u.value=U)},"loadFuseOptions");return se([s,l,a,i,r],()=>{(s.value.trim()!==""||l.value.length>0||a.value.length>0||i.value.length>0||r.value!=="default")&&z()},{deep:!0}),Zt(l,U=>{o.set("Comfy.Templates.SelectedModels",U)},{debounce:500,deep:!0}),Zt(a,U=>{o.set("Comfy.Templates.SelectedUseCases",U)},{debounce:500,deep:!0}),Zt(i,U=>{o.set("Comfy.Templates.SelectedRunsOn",U)},{debounce:500,deep:!0}),Zt(r,U=>{o.set("Comfy.Templates.SortBy",U)},{debounce:500}),{searchQuery:s,selectedModels:l,selectedUseCases:a,selectedRunsOn:i,sortBy:r,filteredTemplates:_,availableModels:v,availableUseCases:f,availableRunsOn:k,filteredCount:B,totalCount:H,resetFilters:S,removeModelFilter:T,removeUseCaseFilter:M,removeRunsOnFilter:P,loadFuseOptions:G}}n(Yy,"useTemplateFiltering");function kl(){const{t:e}=pe(),o=cl(),t=ct(),s=L(null),l=L(null),a=b(()=>o.isLoaded),i=b(()=>o.groupedTemplates),r=n(async()=>(o.isLoaded||await o.loadWorkflowTemplates(),o.isLoaded),"loadTemplates"),u=n(()=>{if(i.value.length>0){const h=i.value[0].modules[0];p(h)}},"selectFirstTemplateCategory"),p=n(h=>(s.value=h,h!==null),"selectTemplateCategory"),g=n((h,C,y="1")=>{const N=C==="default"?Te.fileURL(`/templates/${h.name}`):Te.apiURL(`/workflow_templates/${C}/${h.name}`),x=C==="default"&&y?`-${y}`:"";return`${N}${x}.${h.mediaSubtype}`},"getTemplateThumbnailUrl"),v=n((h,C)=>{const y=h.title??h.name??`${C} Template`;return C==="default"?h.localizedTitle??y:y},"getTemplateTitle"),f=n(h=>(h.localizedDescription||h.description)?.replace(/[-_]/g," ").trim()??"","getTemplateDescription"),k=n(async(h,C)=>{if(!a.value)return!1;l.value=h;let y;try{if(C==="all"){const _=i.value.find(M=>M.label===e("templateWorkflows.category.ComfyUI Examples","ComfyUI Examples"))?.modules.find(M=>M.moduleName==="all")?.templates.find(M=>M.name===h);if(!_||!_.sourceModule)return!1;const S=_.sourceModule;y=await w(h,S);const T=S==="default"?e(`templateWorkflows.template.${h}`,h):h;return t.closeDialog(),await J.loadGraphData(y,!0,!0,T,{openSource:"template"}),!0}y=await w(h,C);const N=C==="default"?e(`templateWorkflows.template.${h}`,h):h;return t.closeDialog(),await J.loadGraphData(y,!0,!0,N,{openSource:"template"}),!0}catch(N){return console.error("Error loading workflow template:",N),!1}finally{l.value=null}},"loadWorkflowTemplate"),w=n(async(h,C)=>C==="default"?fetch(Te.fileURL(`/templates/${h}.json`)).then(y=>y.json()):fetch(Te.apiURL(`/workflow_templates/${C}/${h}.json`)).then(y=>y.json()),"fetchTemplateJson");return{selectedTemplate:s,loadingTemplateId:l,isTemplatesLoaded:a,allTemplateGroups:i,loadTemplates:r,selectFirstTemplateCategory:u,selectTemplateCategory:p,getTemplateThumbnailUrl:g,getTemplateTitle:v,getTemplateDescription:f,loadWorkflowTemplate:k}}n(kl,"useTemplateWorkflows");function Cl(e={}){const{minWidth:o="15rem",maxWidth:t="1fr",padding:s="0",gap:l="1rem",columns:a}=e;return a!==void 0&&a<1&&console.warn("createGridStyle: columns must be >= 1, defaulting to 1"),{display:"grid",gridTemplateColumns:a?`repeat(${Math.max(1,a??1)}, 1fr)`:`repeat(auto-fill, minmax(${o}, ${t}))`,padding:s,gap:l}}n(Cl,"createGridStyle");const Jy={class:"text-neutral text-base"},Xy={class:"flex gap-2"},Zy={class:"relative flex flex-wrap justify-between gap-2 px-6 pb-4"},eb={class:"flex flex-wrap gap-2"},tb={key:0,class:"text-neutral px-6 pt-4 pb-2 text-2xl font-semibold"},ob={key:0,class:"flex h-64 flex-col items-center justify-center text-neutral-500"},nb={class:"mb-2 text-lg"},sb={class:"text-sm"},ab={key:1},lb={key:0,class:"inline-block h-8 w-48 animate-pulse rounded bg-dialog-surface"},ib={class:"relative h-full w-full overflow-hidden rounded-lg"},rb={class:"flex flex-col gap-2 pt-3"},ub=["title"],cb={class:"flex justify-between gap-2"},db={class:"flex-1"},pb=["title"],fb={key:0,class:"flex flex-col-reverse justify-center"},mb={key:0,class:"text-sm text-muted"},gb={key:3,class:"mt-6 px-6 text-sm text-muted"},vb=q({__name:"WorkflowTemplateSelectorDialog",props:{onClose:{type:Function}},setup(e){const{t:o}=pe(),t=L(0),s=L(!1);ze(()=>{t.value=Date.now()});const l=es(),a=b(()=>[ul.Local]),i=n(()=>{e.onClose()},"onClose");tn(rn,i);const r=cl(),{loadTemplates:u,loadWorkflowTemplate:p,getTemplateThumbnailUrl:g,getTemplateTitle:v,getTemplateDescription:f}=kl(),k=n(ee=>ee.sourceModule||"default","getEffectiveSourceModule"),w=n(ee=>{const ie=k(ee);return g(ee,ie,ie==="default"?"1":"")},"getBaseThumbnailSrc"),h=n(ee=>{const ie=k(ee);return g(ee,ie,ie==="default"?"2":"")},"getOverlayThumbnailSrc"),C=n(ee=>{ee.tutorialUrl&&window.open(ee.tutorialUrl,"_blank")},"openTutorial"),y=b(()=>we.value?[{id:"skeleton-all",label:"All Templates",icon:"icon-[lucide--layout-grid]"},{id:"skeleton-basics",label:"Basics",icon:"icon-[lucide--graduation-cap]"},{title:"Generation Type",items:[{id:"skeleton-1",label:"...",icon:"icon-[lucide--loader-2]"},{id:"skeleton-2",label:"...",icon:"icon-[lucide--loader-2]"}]},{title:"Closed Source Models",items:[{id:"skeleton-3",label:"...",icon:"icon-[lucide--loader-2]"}]}]:r.navGroupedTemplates),N=b(()=>Cl()),x=b(()=>r.enhancedTemplates),I=L("all"),_=b(()=>I.value?r.filterTemplatesByCategory(I.value):x.value),{searchQuery:S,selectedModels:T,selectedUseCases:M,selectedRunsOn:P,sortBy:B,filteredTemplates:H,availableModels:z,availableUseCases:G,availableRunsOn:U,filteredCount:W,totalCount:F,resetFilters:Q,loadFuseOptions:j}=Yy(_),Y=n(ee=>{const ie=I.value==="popular",mt=B.value==="popular";ee==="nav"?ie&&!mt?B.value="popular":!ie&&mt&&(B.value="default"):ee==="sort"&&ie&&!mt&&(I.value="all")},"coordinateNavAndSort");se(I,()=>Y("nav")),se(B,()=>Y("sort"));const te=b({get(){return T.value.map(ee=>({name:ee,value:ee}))},set(ee){T.value=ee.map(ie=>ie.value)}}),X=b({get(){return M.value.map(ee=>({name:ee,value:ee}))},set(ee){M.value=ee.map(ie=>ie.value)}}),ae=b({get(){return P.value.map(ee=>({name:ee,value:ee}))},set(ee){P.value=ee.map(ie=>ie.value)}}),le=L(null),Ne=L(null),Ue=L([]),Qe=L(0),Ve=L(""),_e=b(()=>z.value.map(ee=>({name:ee,value:ee}))),Be=b(()=>G.value.map(ee=>({name:ee,value:ee}))),Je=b(()=>U.value.map(ee=>({name:ee,value:ee}))),wt=b(()=>te.value.length===0?o("templateWorkflows.modelFilter","Model Filter"):te.value.length===1?te.value[0].name:o("templateWorkflows.modelsSelected",{count:te.value.length})),fo=b(()=>X.value.length===0?o("templateWorkflows.useCaseFilter","Use Case"):X.value.length===1?X.value[0].name:o("templateWorkflows.useCasesSelected",{count:X.value.length})),jt=b(()=>ae.value.length===0?o("templateWorkflows.runsOnFilter","Runs On"):ae.value.length===1?ae.value[0].name:o("templateWorkflows.runsOnSelected",{count:ae.value.length})),qt=b(()=>[{name:o("templateWorkflows.sort.default","Default"),value:"default"},{name:o("templateWorkflows.sort.recommended","Recommended"),value:"recommended"},{name:o("templateWorkflows.sort.popular","Popular"),value:"popular"},{name:o("templateWorkflows.sort.newest","Newest"),value:"newest"},{name:o("templateWorkflows.sort.vramLowToHigh","VRAM Usage (Low to High)"),value:"vram-low-to-high"},{name:o("templateWorkflows.sort.modelSizeLowToHigh","Model Size (Low to High)"),value:"model-size-low-to-high"},{name:o("templateWorkflows.sort.alphabetical","Alphabetical (A-Z)"),value:"alphabetical"}]),ft=L(null),$t=b(()=>!S.value.trim()),{paginatedItems:Lt,isLoading:ot,hasMoreItems:Kt,loadNextPage:mo,reset:Qt}=qy(H,{itemsPerPage:24}),fe=b(()=>$t.value?Lt.value:H.value);yu(ft,()=>{$t.value&&Kt.value&&!ot.value&&mo()}),se([S,I,B,T,M,P],()=>{Qt(),le.value=null,Qe.value++});const xe=n(async ee=>{le.value=ee.name;try{await p(ee.name,k(ee)),s.value=!0,i()}finally{le.value=null}},"onLoadWorkflow"),De=b(()=>{const ee=y.value.find(ie=>"id"in ie?ie.id===I.value:ie.items?.some(mt=>mt.id===I.value));return ee?"id"in ee?ee.label:ee.items?.find(ie=>ie.id===I.value)?.label||o("templateWorkflows.allTemplates","All Templates"):o("templateWorkflows.allTemplates","All Templates")}),{isLoading:we}=Hl(async()=>(await Promise.all([u(),r.loadWorkflowTemplates(),j()]),!0),!1,{immediate:!0}),Ee=n(ee=>(ee.includeOnDistributions?.length??0)>0?a.value.some(ie=>ee.includeOnDistributions?.includes(ie)):!0,"isTemplateVisibleOnDistribution");return ut(()=>{Ue.value=[]}),(ee,ie)=>{const mt=Ie("tooltip");return d(),O(us,{"content-title":ee.$t("templateWorkflows.title","Workflow Templates"),class:"workflow-template-selector-dialog"},{leftPanel:A(()=>[R(cs,{modelValue:I.value,"onUpdate:modelValue":ie[0]||(ie[0]=ue=>I.value=ue),"nav-items":y.value},{"header-icon":A(()=>ie[8]||(ie[8]=[c("i",{class:"icon-[comfy--template]"},null,-1)])),"header-title":A(()=>[c("span",Jy,V(ee.$t("sideToolbar.templates","Templates")),1)]),_:1},8,["modelValue","nav-items"])]),header:A(()=>[R(sn,{modelValue:m(S),"onUpdate:modelValue":ie[1]||(ie[1]=ue=>it(S)?S.value=ue:null),size:"lg",class:"max-w-[384px]"},null,8,["modelValue"])]),"header-right-area":A(()=>[c("div",Xy,[m(W)!==m(F)?(d(),O(Z,{key:0,variant:"secondary",size:"lg",onClick:m(Q)},{default:A(()=>[ie[9]||(ie[9]=c("i",{class:"icon-[lucide--filter-x]"},null,-1)),c("span",null,V(ee.$t("templateWorkflows.resetFilters","Clear Filters")),1)]),_:1},8,["onClick"])):E("",!0)])]),contentFilter:A(()=>[c("div",Zy,[c("div",eb,[R(Wt,{modelValue:te.value,"onUpdate:modelValue":ie[2]||(ie[2]=ue=>te.value=ue),"search-query":Ve.value,"onUpdate:searchQuery":ie[3]||(ie[3]=ue=>Ve.value=ue),class:"w-[250px]",label:wt.value,options:_e.value,"show-search-box":!0,"show-selected-count":!0,"show-clear-button":!0},{icon:A(()=>ie[10]||(ie[10]=[c("i",{class:"icon-[lucide--cpu]"},null,-1)])),_:1},8,["modelValue","search-query","label","options"]),R(Wt,{modelValue:X.value,"onUpdate:modelValue":ie[4]||(ie[4]=ue=>X.value=ue),label:fo.value,options:Be.value,"show-search-box":!0,"show-selected-count":!0,"show-clear-button":!0},{icon:A(()=>ie[11]||(ie[11]=[c("i",{class:"icon-[lucide--target]"},null,-1)])),_:1},8,["modelValue","label","options"]),R(Wt,{modelValue:ae.value,"onUpdate:modelValue":ie[5]||(ie[5]=ue=>ae.value=ue),label:jt.value,options:Je.value,"show-search-box":!0,"show-selected-count":!0,"show-clear-button":!0},{icon:A(()=>ie[12]||(ie[12]=[c("i",{class:"icon-[lucide--server]"},null,-1)])),_:1},8,["modelValue","label","options"])]),c("div",null,[R(Ko,{modelValue:m(B),"onUpdate:modelValue":ie[6]||(ie[6]=ue=>it(B)?B.value=ue:null),label:ee.$t("templateWorkflows.sorting","Sort by"),options:qt.value,class:"w-62.5"},{icon:A(()=>ie[13]||(ie[13]=[c("i",{class:"icon-[lucide--arrow-up-down] text-muted-foreground"},null,-1)])),_:1},8,["modelValue","label","options"])])]),m(we)?E("",!0):(d(),$("div",tb,[c("span",null,V(De.value),1)]))]),content:A(()=>[!m(we)&&m(H).length===0?(d(),$("div",ob,[ie[14]||(ie[14]=c("i",{class:"mb-4 icon-[lucide--search] h-12 w-12 opacity-50"},null,-1)),c("p",nb,V(ee.$t("templateWorkflows.noResults","No templates found")),1),c("p",sb,V(ee.$t("templateWorkflows.noResultsHint","Try adjusting your search or filters")),1)])):(d(),$("div",ab,[m(we)?(d(),$("span",lb)):E("",!0),(d(),$("div",{key:Qe.value,style:ve(N.value),"data-testid":"template-workflows-content"},[(d(!0),$(oe,null,be(m(we)?12:0,ue=>(d(),O(Bo,{key:`initial-skeleton-${ue}`,size:"compact",variant:"ghost",rounded:"lg",class:"hover:bg-base-background"},{top:A(()=>[R(Fo,{ratio:"landscape"},{default:A(()=>ie[15]||(ie[15]=[c("div",{class:"h-full w-full animate-pulse bg-dialog-surface"},null,-1)])),_:1})]),bottom:A(()=>[R(zo,null,{default:A(()=>ie[16]||(ie[16]=[c("div",{class:"px-4 py-3"},[c("div",{class:"mb-2 h-6 animate-pulse rounded bg-dialog-surface"}),c("div",{class:"h-4 animate-pulse rounded bg-dialog-surface"})],-1)])),_:1})]),_:2},1024))),128)),(d(!0),$(oe,null,be(m(we)?[]:fe.value,ue=>de((d(),O(Bo,{key:ue.name,ref_for:!0,ref_key:"cardRefs",ref:Ue,size:"compact",variant:"ghost",rounded:"lg","data-testid":`template-workflow-${ue.name}`,class:"hover:bg-base-background",onMouseenter:n(Nt=>Ne.value=ue.name,"onMouseenter"),onMouseleave:ie[7]||(ie[7]=Nt=>Ne.value=null),onClick:n(Nt=>xe(ue),"onClick")},{top:A(()=>[R(Fo,{ratio:"square"},{default:A(()=>[c("div",ib,[ue.mediaType==="audio"?(d(),O(Wy,{key:0,src:w(ue)},null,8,["src"])):ue.thumbnailVariant==="compareSlider"?(d(),O(By,{key:1,"base-image-src":w(ue),"overlay-image-src":h(ue),alt:m(v)(ue,k(ue)),"is-hovered":Ne.value===ue.name,"is-video":ue.mediaType==="video"||ue.mediaSubtype==="webp"},null,8,["base-image-src","overlay-image-src","alt","is-hovered","is-video"])):ue.thumbnailVariant==="hoverDissolve"?(d(),O(jy,{key:2,"base-image-src":w(ue),"overlay-image-src":h(ue),alt:m(v)(ue,k(ue)),"is-hovered":Ne.value===ue.name,"is-video":ue.mediaType==="video"||ue.mediaSubtype==="webp"},null,8,["base-image-src","overlay-image-src","alt","is-hovered","is-video"])):(d(),O(Fy,{key:3,src:w(ue),alt:m(v)(ue,k(ue)),"is-hovered":Ne.value===ue.name,"is-video":ue.mediaType==="video"||ue.mediaSubtype==="webp","hover-zoom":ue.thumbnailVariant==="zoomHover"?16:5},null,8,["src","alt","is-hovered","is-video","hover-zoom"])),le.value===ue.name?(d(),O(m(pi),{key:4,class:"absolute inset-0 z-10 m-auto h-12 w-12"})):E("",!0)])]),"bottom-right":A(()=>[ue.tags&&ue.tags.length>0?(d(!0),$(oe,{key:0},be(ue.tags,Nt=>(d(),O(Uo,{key:Nt,label:Nt},null,8,["label"]))),128)):E("",!0)]),_:2},1024)]),bottom:A(()=>[R(zo,null,{default:A(()=>[c("div",rb,[c("h3",{class:"m-0 line-clamp-1 text-sm",title:m(v)(ue,k(ue))},V(m(v)(ue,k(ue))),9,ub),c("div",cb,[c("div",db,[c("p",{class:"m-0 line-clamp-2 text-sm text-muted",title:m(f)(ue)},V(m(f)(ue)),9,pb)]),ue.tutorialUrl?(d(),$("div",fb,[Ne.value===ue.name?de((d(),O(Z,_t({key:0,ref_for:!0},ee.$attrs,{variant:"inverted",size:"icon",onClick:Ce(Nt=>C(ue),["stop"])}),{default:A(()=>ie[17]||(ie[17]=[c("i",{class:"icon-[lucide--info] size-4"},null,-1)])),_:2},1040,["onClick"])),[[mt,ee.$t("g.seeTutorial"),void 0,{bottom:!0}]]):E("",!0)])):E("",!0)])])]),_:2},1024)]),_:2},1032,["data-testid","onMouseenter","onClick"])),[[Xe,Ee(ue)]])),128)),(d(!0),$(oe,null,be(m(ot)?6:0,ue=>(d(),O(Bo,{key:`skeleton-${ue}`,size:"compact",variant:"ghost",rounded:"lg",class:"hover:bg-base-background"},{top:A(()=>[R(Fo,{ratio:"square"},{default:A(()=>ie[18]||(ie[18]=[c("div",{class:"h-full w-full animate-pulse bg-dialog-surface"},null,-1)])),_:1})]),bottom:A(()=>[R(zo,null,{default:A(()=>ie[19]||(ie[19]=[c("div",{class:"px-4 py-3"},[c("div",{class:"mb-2 h-6 animate-pulse rounded bg-dialog-surface"}),c("div",{class:"h-4 animate-pulse rounded bg-dialog-surface"})],-1)])),_:1})]),_:2},1024))),128))],4))])),!m(we)&&m(Kt)?(d(),$("div",{key:2,ref_key:"loadTrigger",ref:ft,class:"mt-4 flex h-4 w-full items-center justify-center"},[m(ot)?(d(),$("div",mb,V(ee.$t("templateWorkflows.loadingMore","Loading more...")),1)):E("",!0)],512)):E("",!0),m(we)?E("",!0):(d(),$("div",gb,V(ee.$t("templateWorkflows.resultsCount",{count:m(W),total:m(F)})),1))]),_:1},8,["content-title"])}}}),ua="global-workflow-template-selector",ws=n(()=>{const e=bt(),o=ct();function t(){o.closeDialog({key:ua})}n(t,"hide");function s(l="command"){e.showLayoutDialog({key:ua,component:vb,props:{onClose:t},dialogComponentProps:{pt:{content:{class:"!px-0 overflow-hidden h-full !py-0"},root:{style:"width: 90vw; height: 85vh; max-width: 1400px; display: flex;"}}}})}return n(s,"show"),{show:s,hide:t}},"useWorkflowTemplateSelectorDialog"),En=n((e,o,t=30)=>{const s=e instanceof HTMLElement?e:e.target;let l=0;const a=setInterval(()=>{o(l++)},t),i=n(()=>{clearInterval(a),r(),u()},"dispose"),r=Re(document,"mouseup",i),u=Re(s,"mouseup",i);return{dispose:i}},"whileMouseDown"),hb={class:"flex h-8 w-8 items-center justify-center rounded-lg bg-black"},yb=["href","onMousedown","onClick"],bb={class:"p-menubar-item-label text-nowrap"},wb={key:3,class:"keybinding-tag ml-auto rounded border border-surface p-1 text-xs text-nowrap text-muted"},kb={key:4,class:"pi pi-angle-right ml-auto"},Cb={class:"p-menubar-item-label text-nowrap"},xb=q({__name:"ComfyMenuButton",setup(e){const{t:o}=pe(),t=Se(),s=Za(),l=pt(),a=el(),i=ct(),r=vt(),u=re(),p=L(null),g=b({get:n(()=>u.get("Comfy.VueNodes.Enabled")??!1,"get"),set:n(async P=>{await u.set("Comfy.VueNodes.Enabled",P)},"set")});function v(P){p.value?.toggle(P)}n(v,"onLogoMenuClick");const f=n(P=>{const B=typeof P.label=="function"?P.label():P.label,H=B?o(`menuLabels.${He(B)}`,B):void 0;return{...P,label:H,items:P.items?.map(f)}},"translateMenuItem"),k=n(P=>{i.showDialog({key:"global-settings",headerComponent:wr,component:br,props:{defaultPanel:P}})},"showSettings"),w=n(async()=>{await r.openManager({initialTab:to.All,showToastOnLegacyError:!1})},"showManageExtensions"),h=b(()=>l.palettes.map(P=>({key:`theme-${P.id}`,label:P.name,parentPath:"theme",comfyCommand:{active:n(()=>l.activePaletteId===P.id,"active")},command:n(async()=>{await a.loadColorPalette(P.id)},"command")}))),C=b(()=>[{separator:!0},{key:"theme",label:o("menu.theme"),items:h.value},{key:"nodes-2.0-toggle",label:"Nodes 2.0"},{separator:!0},{key:"browse-templates",label:o("menuLabels.Browse Templates"),icon:"icon-[comfy--template]",command:n(()=>ws().show("menu"),"command")},{key:"settings",label:o("g.settings"),icon:"mdi mdi-cog-outline",command:n(()=>{k()},"command")},{key:"manage-extensions",label:o("menu.manageExtensions"),icon:"mdi mdi-puzzle-outline",command:w}]),y=b(()=>{const P=s.menuItems.map(f);let B=P.findIndex(z=>z.key==="Help"),H;if(B!==-1){P[B].icon="mdi mdi-help-circle-outline";const z=B!==P.length-1;H=P.splice(B,1,...z?[{separator:!0}]:[])[0]}return B=P.length,P.splice(B,0,...C.value,...H?[{separator:!0},H]:[]),P}),N=n(()=>{Fe(()=>{p.value&&(p.value.dirty=!0)})},"onMenuShow"),x=n(P=>P.comfyCommand?.id==="Comfy.Canvas.ZoomIn"||P.comfyCommand?.id==="Comfy.Canvas.ZoomOut","isZoomCommand"),I=n((P,B)=>{P.comfyCommand&&En(B,async()=>{await t.execute(P.comfyCommand.id)},50)},"handleZoomMouseDown"),_=n((P,B)=>{if(x(P)||P.comfyCommand?.active)return B.preventDefault(),B.stopPropagation(),P.comfyCommand?.active&&P.command?.({item:P,originalEvent:B}),!1},"handleItemClick"),S=n(P=>P.parentPath&&(P.parentPath==="theme"||s.menuItemHasActiveStateChildren[P.parentPath]),"hasActiveStateSiblings"),T=n(()=>!1,"handleNodes2ToggleClick"),M=n(async P=>{await u.set("Comfy.VueNodes.Enabled",P)},"onNodes2ToggleChange");return(P,B)=>{const H=Ie("tooltip");return d(),$(oe,null,[de((d(),$("div",{class:K(["comfy-menu-button-wrapper flex shrink-0 cursor-pointer flex-col items-center justify-center p-2 transition-colors",{"comfy-menu-button-active":p.value?.visible}]),onClick:B[0]||(B[0]=z=>v(z))},[c("div",hb,[R(Py,{alt:"ComfyUI Logo",class:"comfyui-logo h-[18px] w-[18px] text-white",mode:"fill"})])],2)),[[H,{value:m(o)("sideToolbar.labels.menu"),showDelay:300,hideDelay:300}]]),R(m(fi),{ref_key:"menuRef",ref:p,model:y.value,popup:!0,class:"comfy-command-menu",onShow:N},{item:A(({item:z,props:G})=>[z.key!=="nodes-2.0-toggle"?(d(),$("a",_t({key:0,class:"p-menubar-item-link px-4 py-2"},G.action,{href:z.url,target:"_blank",class:typeof z.class=="function"?z.class():z.class,onMousedown:n(U=>x(z)?I(z,U):void 0,"onMousedown"),onClick:n(U=>_(z,U),"onClick")}),[S(z)?(d(),$("i",{key:0,class:K(["p-menubar-item-icon pi pi-check text-sm",{invisible:!z.comfyCommand?.active?.()}])},null,2)):z.icon&&z.comfyCommand?.id!=="Comfy.NewBlankWorkflow"?(d(),$("span",{key:1,class:K(["p-menubar-item-icon text-sm",z.icon])},null,2)):E("",!0),c("span",bb,V(z.label),1),z.comfyCommand?.id==="Comfy.NewBlankWorkflow"?(d(),$("i",{key:2,class:K(["ml-auto",z.icon])},null,2)):E("",!0),z?.comfyCommand?.keybinding?(d(),$("span",wb,V(z.comfyCommand.keybinding.combo.toString()),1)):E("",!0),z.items?(d(),$("i",kb)):E("",!0)],16,yb)):(d(),$("div",{key:1,class:"flex items-center justify-between px-4 py-2",onClick:Ce(T,["stop"])},[c("span",Cb,V(z.label),1),R(m(eo),{severity:"info",class:"ml-2 text-xs"},{default:A(()=>[$e(V(P.$t("g.beta")),1)]),_:1}),R(m(Wa),{modelValue:g.value,"onUpdate:modelValue":[B[1]||(B[1]=U=>g.value=U),M],class:"ml-4","aria-label":z.label,pt:{root:{style:{width:"38px",height:"20px"}},handle:{style:{width:"16px",height:"16px"}}},onClick:B[2]||(B[2]=Ce(()=>{},["stop"]))},null,8,["modelValue","aria-label"])]))]),_:1},8,["model"])],64)}}}),Sb=Le(xb,[["__scopeId","data-v-7f8c3b49"]]),_b={class:"side-bar-button-content"},Tb={key:0,class:"side-bar-button-label"},$b=q({__name:"SidebarIcon",props:{icon:{default:""},selected:{type:Boolean,default:!1},tooltip:{default:""},tooltipSuffix:{default:""},iconBadge:{type:[String,Function],default:""},label:{default:""},isSmall:{type:Boolean,default:!1}},emits:["click"],setup(e,{emit:o}){const{t}=pe(),s=o,l=b(()=>typeof e.iconBadge=="function"?e.iconBadge()??"":e.iconBadge),a=b(()=>!!l.value),i=b(()=>t(e.tooltip)+e.tooltipSuffix);return(r,u)=>{const p=Ie("tooltip");return de((d(),O(Z,{class:K(m(ne)("side-bar-button cursor-pointer border-none",r.selected&&"side-bar-button-selected")),variant:"muted-textonly","aria-label":i.value,onClick:u[0]||(u[0]=g=>s("click",g))},{default:A(()=>[c("div",_b,[ye(r.$slots,"icon",{},()=>[a.value?(d(),O(m(mi),{key:0,value:l.value},{default:A(()=>[typeof r.icon=="string"?(d(),$("i",{key:0,class:K(r.icon+" side-bar-button-icon")},null,2)):(d(),O(no(r.icon),{key:1,class:"side-bar-button-icon"}))]),_:1},8,["value"])):typeof r.icon=="string"?(d(),$("i",{key:1,class:K(r.icon+" side-bar-button-icon")},null,2)):typeof r.icon=="object"?(d(),O(no(r.icon),{key:2,class:"side-bar-button-icon"})):E("",!0)],!0),r.label&&!r.isSmall?(d(),$("span",Tb,V(m(t)(r.label)),1)):E("",!0)])]),_:3},8,["class","aria-label"])),[[p,{value:i.value,showDelay:300,hideDelay:300}]])}}}),Ht=Le($b,[["__scopeId","data-v-bbb98ec9"]]),Nb=q({__name:"SidebarBottomPanelToggleButton",setup(e){const o=ro(),t=n(()=>{o.toggleBottomPanel()},"toggleConsole");return(s,l)=>(d(),O(Ht,{icon:"icon-[ph--terminal-bold]",label:s.$t("sideToolbar.labels.console"),tooltip:s.$t("menu.toggleBottomPanel"),selected:m(o).activePanel=="terminal",onClick:t},null,8,["label","tooltip","selected"]))}}),Ib=q({__name:"SidebarSettingsButton",setup(e){const{t:o}=pe(),{getCommand:t,formatKeySequence:s}=Se(),l=t("Comfy.ShowSettingsDialog"),a=b(()=>`${o("g.settings")} (${s(l)})`),i=n(()=>{l.function()},"showSettingsDialog");return(r,u)=>(d(),O(Ht,{icon:"icon-[lucide--settings]",label:r.$t("g.settings"),tooltip:a.value,onClick:i},null,8,["label","tooltip"]))}}),Mb=q({__name:"SidebarShortcutsToggleButton",setup(e){const{t:o}=pe(),t=ro(),s=Se(),l=s.getCommand("Workspace.ToggleBottomPanel.Shortcuts"),{formatKeySequence:a}=s,i=b(()=>t.activePanel==="shortcuts"),r=b(()=>`${o("shortcuts.keyboardShortcuts")} (${a(l)})`),u=n(()=>{t.togglePanel("shortcuts")},"toggleShortcutsPanel");return(p,g)=>(d(),O(Ht,{icon:"icon-[lucide--keyboard]",label:p.$t("shortcuts.shortcuts"),tooltip:r.value,selected:i.value,onClick:u},null,8,["label","tooltip","selected"]))}}),Pb=q({__name:"SidebarHelpCenterIcon",props:{isSmall:{type:Boolean}},setup(e){const{shouldShowRedDot:o,toggleHelpCenter:t}=bs();return(s,l)=>(d(),O(Ht,{icon:"pi pi-question-circle",class:"comfy-help-center-btn",label:s.$t("menu.help"),tooltip:s.$t("sideToolbar.helpCenter"),"icon-badge":m(o)?"":"","is-small":s.isSmall,onClick:m(t)},null,8,["label","tooltip","icon-badge","is-small","onClick"]))}}),Db=Le(Pb,[["__scopeId","data-v-4a7593e2"]]),Ab=q({__name:"SidebarLogoutIcon",setup(e){const{t:o}=pe(),t=tl(),s=b(()=>`${o("sideToolbar.logout")} (${t.currentUser?.username})`),l=n(async()=>{await t.logout(),window.location.reload()},"logout");return(a,i)=>(d(),O(Ht,{icon:"pi pi-sign-out",tooltip:s.value,label:a.$t("sideToolbar.logout"),onClick:l},null,8,["tooltip","label"]))}}),Lb=q({__name:"SidebarTemplatesButton",setup(e){const o=re(),t=b(()=>o.get("Comfy.Sidebar.Size")==="small"),s=n(()=>{ws().show("sidebar")},"openTemplates");return(l,a)=>(d(),O(Ht,{icon:"icon-[comfy--template]",tooltip:l.$t("sideToolbar.templates"),label:l.$t("sideToolbar.labels.templates"),"is-small":t.value,class:"templates-tab-button",onClick:s},null,8,["tooltip","label","is-small"]))}}),Eb=20,Vb=50,Rb=q({__name:"SideToolbar",setup(e){const o=rt(),t=re(),s=tl(),l=Se(),a=he(),i=L(),r=L(),u=L(),p=b(()=>t.get("Comfy.Sidebar.Size")==="small"),g=b(()=>t.get("Comfy.Sidebar.Location")),v=b(()=>t.get("Comfy.Sidebar.Style")),f=b(()=>t.get("Comfy.UI.TabBarLayout")==="Integrated"),k=b(()=>h.value||x.value||v.value==="connected"),w=b(()=>o.getSidebarTabs()),h=b(()=>o.sidebarTab.activeSidebarTab),C=n(async S=>{S.id,S.id,S.id,S.id,await l.commands.find(T=>T.id===`Workspace.ToggleSidebarTab.${S.id}`)?.function?.()},"onTabClick"),y=kr(),N=n(S=>{const T=y.getKeybindingByCommandId(`Workspace.ToggleSidebarTab.${S.id}`);return T?` (${T.combo.toString()})`:""},"getTabTooltipSuffix"),x=L(!1),I=b(()=>ne("sidebar-item-group flex flex-col items-center overflow-hidden flex-shrink-0",!k.value&&"rounded-lg shadow-interface pointer-events-auto")),_=on(()=>{if(!i.value||!r.value||!u.value)return;const S=i.value.clientHeight,T=r.value.scrollHeight,M=u.value.scrollHeight,P=T+M;x.value?x.value=S<P+Vb:x.value=S<P+Eb},16);return ze(()=>{if(!i.value)return;const S=Ca(i.value,_);_(),ut(()=>{S.stop()}),se([p,g],async()=>{a.canvas&&(g.value==="left"?(await Fe(),a.canvas.fpsInfoLocation=[i.value?.getBoundingClientRect()?.right,null]):a.canvas.fpsInfoLocation=null,a.canvas.setDirty(!1,!0))},{immediate:!0})}),(S,T)=>(d(),$("nav",{ref_key:"sideToolbarRef",ref:i,class:K(["side-tool-bar-container flex h-full flex-col items-center bg-transparent [.floating-sidebar]:-mr-2",{"small-sidebar":p.value,"connected-sidebar pointer-events-auto":k.value,"floating-sidebar":!k.value,"overflowing-sidebar":x.value,"border-r border-[var(--interface-stroke)] shadow-interface":k.value}])},[c("div",{class:K(x.value?"side-tool-bar-container overflow-y-auto":"flex flex-col h-full")},[c("div",{ref_key:"topToolbarRef",ref:r,class:K(I.value)},[R(Sb),(d(!0),$(oe,null,be(w.value,M=>(d(),O(Ht,{key:M.id,icon:M.icon,"icon-badge":M.iconBadge,tooltip:M.tooltip,"tooltip-suffix":N(M),label:M.label||M.title,"is-small":p.value,selected:M.id===h.value?.id,class:K(M.id+"-tab-button"),onClick:n(P=>C(M),"onClick")},null,8,["icon","icon-badge","tooltip","tooltip-suffix","label","is-small","selected","class","onClick"]))),128)),R(Lb)],2),c("div",{ref_key:"bottomToolbarRef",ref:u,class:K(["mt-auto",I.value])},[m(s).isMultiUserServer?(d(),O(Ab,{key:0,"is-small":p.value},null,8,["is-small"])):E("",!0),f.value?E("",!0):(d(),O(Db,{key:1,"is-small":p.value},null,8,["is-small"])),R(Nb,{"is-small":p.value},null,8,["is-small"]),R(Mb,{"is-small":p.value},null,8,["is-small"]),R(Ib,{"is-small":p.value},null,8,["is-small"])],2)],2),R(Iy,{"is-small":p.value},null,8,["is-small"])],2))}}),Ob=Le(Rb,[["__scopeId","data-v-9d98575c"]]),Wb=At("topbarBadge",()=>{const e=Zn();return{badges:b(()=>e.extensions.flatMap(t=>t.topbarBadges??[]))}}),zb={class:"flex h-full shrink-0 items-center"},xl=q({__name:"TopbarBadges",props:{reverseOrder:{type:Boolean,default:!1},noPadding:{type:Boolean,default:!1}},setup(e){const o=Jo(en),t=o.greaterOrEqual("xl"),s=o.greaterOrEqual("lg"),l=b(()=>t.value?"full":s.value?"compact":"icon-only"),a=Wb();return(i,r)=>(d(),$("div",zb,[(d(!0),$(oe,null,be(m(a).badges,u=>(d(),O(ed,{key:u.text,badge:u,"display-mode":l.value,"reverse-order":i.reverseOrder,"no-padding":i.noPadding},null,8,["badge","display-mode","reverse-order","no-padding"]))),128))]))}}),Bb={class:"relative inline-flex items-center justify-center size-[1em]"},Fb=q({__name:"OverlayIcon",props:{mainIcon:{},subIcon:{},positionX:{default:"right"},positionY:{default:"bottom"},offsetX:{default:0},offsetY:{default:0},subIconScale:{default:.6}},setup(e){const o=["-1px -1px 0 rgba(0, 0, 0, 0.7)","1px -1px 0 rgba(0, 0, 0, 0.7)","-1px 1px 0 rgba(0, 0, 0, 0.7)","1px 1px 0 rgba(0, 0, 0, 0.7)","-1px 0 0 rgba(0, 0, 0, 0.7)","1px 0 0 rgba(0, 0, 0, 0.7)","0 -1px 0 rgba(0, 0, 0, 0.7)","0 1px 0 rgba(0, 0, 0, 0.7)"].join(", "),t=b(()=>({fontSize:`${e.subIconScale}em`,textShadow:o,...e.offsetX!==0&&{[e.positionX==="left"?"left":"right"]:`${e.offsetX}px`},...e.offsetY!==0&&{[e.positionY==="top"?"top":"bottom"]:`${e.offsetY}px`}}));return(s,l)=>(d(),$("span",Bb,[c("i",{class:K([s.mainIcon,"text-[1em]"])},null,2),c("i",{class:K(m(ne)(s.subIcon,"absolute leading-none pointer-events-none",s.positionX==="left"?"left-0":"right-0",s.positionY==="top"?"top-0":"bottom-0")),style:ve(t.value)},null,6)]))}}),Ub={key:0,class:"absolute top-[7px] right-[7px] size-1.5 rounded-full bg-[#ff3b30]"},Gb=q({__name:"TopMenuHelpButton",setup(e){const{shouldShowRedDot:o,toggleHelpCenter:t}=bs("topbar");return(s,l)=>(d(),O(Z,{class:"comfy-help-center-btn relative text-base-foreground",variant:"textonly",onClick:m(t)},{default:A(()=>[$e(V(s.$t("menu.helpAndFeedback"))+" ",1),l[0]||(l[0]=c("i",{class:"icon-[lucide--circle-help] ml-0.5"},null,-1)),m(o)?(d(),$("span",Ub)):E("",!0)]),_:1},8,["onClick"]))}}),Hb={class:"workflow-preview-content"},jb={key:0,class:"workflow-preview-thumbnail relative"},qb=["src"],Kb={class:"workflow-preview-footer"},Qb={class:"workflow-preview-name"},Yb=250,Jb=q({__name:"WorkflowTabPopover",props:{workflowFilename:{},thumbnailUrl:{},isActiveTab:{type:Boolean}},setup(e,{expose:o}){const t=e,{thumbnailUrl:s,isActiveTab:l}=jl(t),a=L(null),i=L(null);let r=null,u=null;const p=Tn(),g=n(w=>{r&&(clearTimeout(r),r=null),u&&(clearTimeout(u),u=null),u=setTimeout(async()=>{if(a.value&&i.value){a.value.show(w,i.value),await Fe();const h=document.querySelector(`.workflow-popover-fade[data-popover-id="${p}"]`);if(h){const C=i.value.getBoundingClientRect().left,y=h.getBoundingClientRect().width,N=y/2;let x=C-N,I=0;if(x<0)I=x-8,x=8;else if(x+y>window.innerWidth){const _=window.innerWidth-y-16;I=x-_,x=_}I+N<0&&(I=-N+24),h.style.left=`${x}px`,h.style.setProperty("--shift",`${I}px`)}}},200)},"showPopover"),v=n(()=>{},"cancelHidePopover"),f=n(()=>{u&&(clearTimeout(u),u=null),r=setTimeout(()=>{a.value&&a.value.hide()},100)},"hidePopover");return o({showPopover:g,hidePopover:f,togglePopover:n(w=>{a.value&&a.value.toggle(w)},"togglePopover")}),(w,h)=>(d(),$(oe,null,[c("div",{ref_key:"positionRef",ref:i,class:"absolute bottom-0 left-1/2 -translate-x-1/2"},null,512),R(m(et),{ref_key:"popoverRef",ref:a,"append-to":"body",pt:{root:{class:"workflow-popover-fade fit-content","data-popover-id":m(p)}},onMouseenter:v,onMouseleave:f},{default:A(()=>[c("div",Hb,[m(s)&&!m(l)?(d(),$("div",jb,[c("img",{src:m(s),class:"block h-[200px] rounded-lg object-cover p-2",style:ve({width:`${Yb}px`})},null,12,qb)])):E("",!0),c("div",Kb,[c("span",Qb,V(w.workflowFilename),1)])])]),_:1},8,["pt"])],64))}}),Xb=Le(Jb,[["__scopeId","data-v-4c13cb50"]]),Zb={class:"workflow-label inline-block max-w-[150px] truncate text-sm"},ew={class:"relative"},tw={key:0,class:"absolute top-1/2 left-1/2 z-10 w-4 -translate-1/2 bg-(--comfy-menu-bg) text-2xl font-bold group-hover:hidden"},ow=q({__name:"WorkflowTab",props:{workflowOption:{}},setup(e){const o=e,{t}=pe(),s=rt(),l=Oe(),a=re(),i=L(null),r=L(null),u=Cr(),p=b(()=>a.get("Comfy.Workflow.AutoSave")),g=b(()=>a.get("Comfy.Workflow.AutoSaveDelay")),v=b(()=>s.shiftDown?!1:o.workflowOption.workflow.isPersisted?o.workflowOption.workflow.isModified?p.value==="off"||p.value==="after delay"&&g.value>3e3:!1:!0),f=b(()=>l.activeWorkflow?.key===o.workflowOption.workflow.key),k=b(()=>u.getThumbnail(o.workflowOption.workflow.key)),w=L(),{menuItems:h}=ds(()=>Se().execute("Comfy.RenameWorkflow")),C=n(T=>{r.value?.showPopover(T)},"handleMouseEnter"),y=n(()=>{r.value?.hidePopover()},"handleMouseLeave"),N=n(T=>{r.value?.togglePopover(T)},"handleClick"),x=n(T=>{w.value?.toggle(T)},"handleMenuClick"),I=n(async T=>{for(const M of T)if(!await tt().closeWorkflow(M.workflow,{warnIfUnsaved:!s.shiftDown,hint:t("sideToolbar.workflowTab.dirtyCloseHint")}))break},"closeWorkflows"),_=n(async T=>{await I([T])},"onCloseWorkflow"),S=n(()=>i.value,"tabGetter");return xr(S,{getInitialData:n(()=>({workflowKey:o.workflowOption.workflow.key}),"getInitialData")}),ol(S,{getData:n(()=>({workflowKey:o.workflowOption.workflow.key}),"getData"),onDrop:n(T=>{const M=l.openWorkflows.findIndex(B=>B.key===T.source.data.workflowKey),P=l.openWorkflows.findIndex(B=>B.key===T.location.current.dropTargets[0]?.data.workflowKey);M!==P&&l.reorderWorkflows(M,P)},"onDrop")}),yt(()=>{r.value?.hidePopover()}),(T,M)=>(d(),$(oe,null,[c("div",_t({ref_key:"workflowTabRef",ref:i,class:"workflow-tab group flex gap-2 p-2"},T.$attrs,{onMouseenter:C,onMouseleave:y,onClick:N}),[f.value?(d(),O(Z,{key:0,class:"context-menu-button -mx-1 w-auto px-1 py-0",variant:"muted-textonly",size:"icon-sm",onClick:Ce(x,["stop"])},{default:A(()=>M[1]||(M[1]=[c("i",{class:"pi pi-bars"},null,-1)])),_:1})):E("",!0),c("span",Zb,V(T.workflowOption.workflow.filename),1),c("div",ew,[v.value?(d(),$("span",tw,"")):E("",!0),R(Z,{class:"close-button invisible w-auto p-0",variant:"muted-textonly",size:"icon-sm","aria-label":m(t)("g.close"),onClick:M[0]||(M[0]=Ce(P=>_(T.workflowOption),["stop"]))},{default:A(()=>M[2]||(M[2]=[c("i",{class:"pi pi-times"},null,-1)])),_:1},8,["aria-label"])])],16),R(Xb,{ref_key:"popoverRef",ref:r,"workflow-filename":T.workflowOption.workflow.filename,"thumbnail-url":k.value,"is-active-tab":f.value},null,8,["workflow-filename","thumbnail-url","is-active-tab"]),f.value?(d(),O(m(Hn),{key:0,ref_key:"menu",ref:w,model:m(h),popup:!0,pt:{root:{style:"background-color: var(--comfy-menu-bg)"},itemLink:{class:"py-2"}}},null,8,["model"])):E("",!0)],64))}}),nw=q({__name:"WorkflowOverflowMenu",props:{workflows:{},activeWorkflow:{}},setup(e){const o=e,t=L(null),s=tt(),l=b(()=>o.workflows.map(a=>({label:a.filename,icon:o.activeWorkflow?.key===a.key?"pi pi-check":void 0,command:n(()=>{s.openWorkflow(a)},"command")})));return(a,i)=>{const r=Ie("tooltip");return d(),$("div",null,[de((d(),O(Z,{class:"rounded-none h-full w-auto aspect-square",variant:"muted-textonly",size:"icon","aria-label":a.$t("g.moreWorkflows"),onClick:i[0]||(i[0]=u=>t.value?.toggle(u))},{default:A(()=>i[1]||(i[1]=[c("i",{class:"pi pi-ellipsis-h"},null,-1)])),_:1},8,["aria-label"])),[[r,{value:a.$t("g.moreWorkflows"),showDelay:300}]]),R(m(Hn),{ref_key:"menu",ref:t,model:l.value,popup:!0,class:"max-h-[40vh] overflow-auto"},null,8,["model"])])}}}),sw={key:3,class:"ml-auto flex shrink-0 items-center gap-2 px-2"},aw={key:4,class:"window-actions-spacer app-drag shrink-0"},lw=q({__name:"WorkflowTabs",props:{class:{}},setup(e){const o=e,{t}=pe(),s=re(),l=rt(),a=Oe(),i=tt(),r=Se(),{isLoggedIn:u}=Ut(),p=b(()=>s.get("Comfy.UI.TabBarLayout")==="Integrated"),g=L(),v=L(),f=L(null),k=L(!1),w=L(!1),h=L(!1),C=Ke(),y=n(j=>({value:j.path,workflow:j}),"workflowToOption"),N=b(()=>a.openWorkflows.map(y)),x=b(()=>a.activeWorkflow?y(a.activeWorkflow):null),I=n(async j=>{j&&x.value?.value!==j.value&&await i.openWorkflow(j.workflow)},"onWorkflowChange"),_=n(async j=>{for(const Y of j)if(!await i.closeWorkflow(Y.workflow,{warnIfUnsaved:!l.shiftDown}))break},"closeWorkflows"),S=n(async j=>{await _([j])},"onCloseWorkflow"),T=n((j,Y)=>{g.value=Y,v.value.show(j)},"showContextMenu"),M=b(()=>g.value?.workflow??null),{menuItems:P}=ds(()=>r.execute("Comfy.RenameWorkflow"),{includeDelete:!1,workflow:M}),B=b(()=>{const j=g.value;if(!j)return[];const Y=N.value.findIndex(te=>te.workflow===j.workflow);return[...P.value,{label:t("tabMenu.closeTab"),icon:"pi pi-times",command:n(()=>S(j),"command")},{label:t("tabMenu.closeTabsToLeft"),overlayIcon:{mainIcon:"pi pi-times",subIcon:"pi pi-arrow-left",positionX:"right",positionY:"bottom",subIconScale:.5},command:n(()=>_(N.value.slice(0,Y)),"command"),disabled:Y<=0},{label:t("tabMenu.closeTabsToRight"),overlayIcon:{mainIcon:"pi pi-times",subIcon:"pi pi-arrow-right",positionX:"right",positionY:"bottom",subIconScale:.5},command:n(()=>_(N.value.slice(Y+1)),"command"),disabled:Y===N.value.length-1},{label:t("tabMenu.closeOtherTabs"),overlayIcon:{mainIcon:"pi pi-times",subIcon:"pi pi-arrows-h",positionX:"right",positionY:"bottom",subIconScale:.5},command:n(()=>_([...N.value.slice(Y+1),...N.value.slice(0,Y)]),"command"),disabled:N.value.length<=1}]}),H=n(j=>{const Y=j.currentTarget,te=j.deltaX||j.deltaY;Y.scroll({left:Y.scrollLeft+te})},"handleWheel"),z=b(()=>f.value?.querySelector(".p-scrollpanel-content")??null),G=n(j=>{const Y=z.value;Y&&Y.scrollBy({left:j*20})},"scroll"),U=n(async(j={})=>{if(!x.value)return;j.waitForDom!==!1&&await Fe();const Y=f.value;if(!Y)return;const te=Y.querySelector(".p-togglebutton-checked");te&&te.scrollIntoView({block:"nearest",inline:"nearest"})},"ensureActiveTabVisible");se(()=>a.activeWorkflow,()=>{U()},{immediate:!0});let W=null,F=null,Q=null;return se(z,(j,Y,te)=>{if(F?.(),Q?.(),W?.dispose(),!j)return;const X=Ma(j);F=se([()=>X.arrivedState.left,()=>X.arrivedState.right],([ae,le])=>{w.value=!ae,h.value=!le},{immediate:!0}),W=ml(j),Q=se(W.isOverflowing,ae=>{k.value=ae,ae&&Fe(()=>{X.measure(),U({waitForDom:!1})})},{immediate:!0}),te(()=>{F?.(),Q?.(),W?.dispose()})},{immediate:!0}),xa(()=>{W?.disposed.value||W?.checkOverflow()}),(j,Y)=>{const te=Ie("tooltip");return d(),$("div",{ref_key:"containerRef",ref:f,class:K(["workflow-tabs-container flex h-full max-w-full flex-auto flex-row overflow-hidden",{"workflow-tabs-container-desktop":m(C)}])},[k.value?(d(),O(Z,{key:0,variant:"muted-textonly",size:"icon",class:"overflow-arrow overflow-arrow-left h-full w-auto aspect-square","aria-label":j.$t("g.scrollLeft"),disabled:!w.value,onMousedown:Y[0]||(Y[0]=X=>m(En)(X,()=>G(-1)))},{default:A(()=>Y[3]||(Y[3]=[c("i",{class:"icon-[lucide--chevron-left] size-full"},null,-1)])),_:1},8,["aria-label","disabled"])):E("",!0),R(m(gi),{class:"no-drag overflow-hidden","pt:content":{class:"p-0 w-full flex",onwheel:H},"pt:bar-x":"h-1"},{default:A(()=>[R(m(Ra),{class:K(["workflow-tabs bg-transparent",o.class]),"model-value":x.value,options:N.value,"option-label":"label","data-key":"value","onUpdate:modelValue":I},{option:A(({option:X})=>[R(ow,{"workflow-option":X,onContextmenu:n(ae=>T(ae,X),"onContextmenu"),onMouseup:Ce(ae=>S(X),["middle"])},null,8,["workflow-option","onContextmenu","onMouseup"])]),_:1},8,["class","model-value","options"])]),_:1},8,["pt:content"]),k.value?(d(),O(Z,{key:1,variant:"muted-textonly",size:"icon",class:"overflow-arrow overflow-arrow-right h-full w-auto aspect-square","aria-label":j.$t("g.scrollRight"),disabled:!h.value,onMousedown:Y[1]||(Y[1]=X=>m(En)(X,()=>G(1)))},{default:A(()=>Y[4]||(Y[4]=[c("i",{class:"icon-[lucide--chevron-right] size-full"},null,-1)])),_:1},8,["aria-label","disabled"])):E("",!0),k.value?(d(),O(nw,{key:2,workflows:m(a).openWorkflows,"active-workflow":m(a).activeWorkflow},null,8,["workflows","active-workflow"])):E("",!0),de((d(),O(Z,{class:"new-blank-workflow-button no-drag shrink-0 rounded-none h-full w-auto aspect-square",variant:"muted-textonly",size:"icon","aria-label":j.$t("sideToolbar.newBlankWorkflow"),onClick:Y[2]||(Y[2]=()=>m(r).execute("Comfy.NewBlankWorkflow"))},{default:A(()=>Y[5]||(Y[5]=[c("i",{class:"pi pi-plus"},null,-1)])),_:1},8,["aria-label"])),[[te,{value:j.$t("sideToolbar.newBlankWorkflow"),showDelay:300}]]),p.value?(d(),$("div",sw,[R(Gb),m(u)?(d(),O(ps,{key:0,"show-arrow":!1,compact:"",class:"shrink-0 p-1"})):m(C)?(d(),O(fs,{key:1,class:"p-1"})):E("",!0)])):E("",!0),R(m(Oa),{ref_key:"menu",ref:v,model:B.value},{itemicon:A(({item:X})=>[X.overlayIcon?(d(),O(Fb,ql(_t({key:0},X.overlayIcon)),null,16)):X.icon?(d(),$("i",{key:1,class:K(X.icon)},null,2)):E("",!0)]),_:1},8,["model"]),m(C)?(d(),$("div",aw)):E("",!0)],2)}}}),Sl=Le(lw,[["__scopeId","data-v-09158161"]]);function iw(){const e=L();function o(s){s?.graph&&(t(),e.value=Pe.onChange(l=>{for(const a of l.nodeIds){const i=Pe.getNodeLayoutRef(a).value;if(!i)continue;const r=s.graph?.getNodeById(parseInt(a));r&&((r.pos[0]!==i.position.x||r.pos[1]!==i.position.y)&&(r.pos[0]=i.position.x,r.pos[1]=i.position.y),(r.size[0]!==i.size.width||r.size[1]!==i.size.height)&&r.setSize([i.size.width,i.size.height]))}s.setDirty(!0,!0)}))}n(o,"startSync");function t(){e.value?.(),e.value=void 0}return n(t,"stopSync"),yt(t),{startSync:o,stopSync:t}}n(iw,"useLayoutSync");function rw(){const e=he(),o=ln(),{shouldRenderVueNodes:t}=qo(),s=Ze(null),{startSync:l}=iw(),a=n(()=>{const p=J.canvas?.graph;if(!p||s.value)return;const g=xv(p);s.value=g;const v=p._nodes.map(f=>({id:f.id.toString(),pos:[f.pos[0],f.pos[1]],size:[f.size[0],Sr(f.size[1])]}));Pe.initializeFromLiteGraph(v);for(const f of p.reroutes.values()){const[k,w]=f.pos,h=f.parentId??void 0,C=Array.from(f.linkIds);o.createReroute(f.id,{x:k,y:w},h,C)}for(const f of p._links.values())o.createLink(f.id,f.origin_id,f.origin_slot,f.target_id,f.target_slot);l(e.canvas)},"initializeNodeManager"),i=n(()=>{if(s.value){try{s.value.cleanup()}catch{}s.value=null}},"disposeNodeManagerAndSyncs");return se(()=>t.value&&!!J.canvas?.graph,p=>{p&&(a(),Ws(J.canvas?.graph?.extra.workflowRendererVersion))},{immediate:!0}),St(()=>!t.value,()=>{Ws(J.canvas?.graph?.extra.workflowRendererVersion),i(),J.canvas?.setDirty(!0,!0)}),se(()=>t.value,(p,g)=>{p!==g&&Pe.clearAllSlotLayouts()},{immediate:!0,flush:"sync"}),{nodeManager:s,initializeNodeManager:a,disposeNodeManagerAndSyncs:i,setupEmptyGraphListener:n(()=>{const p=J.canvas?.graph;if(!t.value||s.value||p?._nodes.length!==0)return;const g=p.onNodeAdded;p.onNodeAdded=function(v){p.onNodeAdded=g,t.value&&!s.value&&a(),g&&g.call(this,v)}},"setupEmptyGraphListener"),cleanup:n(()=>{s.value&&(s.value.cleanup(),s.value=null)},"cleanup")}}n(rw,"useVueNodeLifecycleIndividual");const ks=nn(rw),uw=.04,lt=n(e=>e*uw,"meshyCreditsToUsd"),cw={minimumFractionDigits:0,maximumFractionDigits:0},Qo=n(e=>_r({usd:e,numberOptions:cw}),"formatCreditsValue"),Cs=n(e=>e?"~":"","makePrefix"),xs=n(e=>e??"/Run","makeSuffix"),Ss=n(e=>e?` ${e}`:"","appendNote"),D=n((e,{suffix:o,note:t,approximate:s}={})=>`${Cs(s)}${Qo(e)} credits${xs(o)}${Ss(t)}`,"formatCreditsLabel"),me=n((e,o,{suffix:t,note:s,approximate:l}={})=>{const a=Qo(e),i=Qo(o),r=a===i?a:`${a}-${i}`;return`${Cs(l)}${r} credits${xs(t)}${Ss(s)}`},"formatCreditsRangeLabel"),Ge=n((e,{suffix:o,note:t,approximate:s,separator:l}={})=>{const i=e.map(r=>Qo(r)).join(l??"/");return`${Cs(s)}${i} credits${xs(o)}${Ss(t)}`},"formatCreditsListLabel");function dw(e,o,t=""){try{return e(o)}catch{return t}}n(dw,"safePricingExecution");const bn=n(e=>{const o=e.widgets?.find(a=>a.name==="duration");if(!o)return D(.0715,{suffix:"/second"});const t=Number(o.value),l=.0715*(isNaN(t)?5:t);return D(l)},"calculateRunwayDurationPrice"),Po=n(e=>o=>{const t=o.widgets?.find(a=>a.name==="duration");if(!t)return D(e,{suffix:"/second"});const s=parseFloat(String(t.value));if(!Number.isFinite(s))return D(e,{suffix:"/second"});const l=e*s;return D(l)},"makeOmniProDurationCalculator"),pw=n(e=>{const o=e.widgets?.find(s=>s.name==="mode");if(!o)return Ge([.07,.112],{suffix:"/second",note:"(std/pro)"});const t=String(o.value).toLowerCase();return t==="pro"?D(.112,{suffix:"/second"}):t==="std"?D(.07,{suffix:"/second"}):Ge([.07,.112],{suffix:"/second",note:"(std/pro)"})},"klingMotionControlPricingCalculator"),wn=n(e=>{const o=e.widgets?.find(r=>r.name==="duration_seconds"),t=e.widgets?.find(r=>r.name==="quality"),s=e.widgets?.find(r=>r.name==="motion_mode");if(!o||!t)return me(.45,1.2,{note:"(varies with duration, quality & motion mode)"});const l=String(o.value),a=String(t.value),i=String(s?.value);if(l.includes("5")){if(a.includes("1080p")||a.includes("720p")&&i?.includes("fast"))return D(1.2);if(a.includes("720p")&&i?.includes("normal"))return D(.6);if(a.includes("540p")&&i?.includes("fast"))return D(.9);if(a.includes("540p")&&i?.includes("normal"))return D(.45);if(a.includes("360p")&&i?.includes("fast"))return D(.9);if(a.includes("360p")&&i?.includes("normal"))return D(.45)}else if(l.includes("8")){if(a.includes("540p")&&i?.includes("normal"))return D(.9);if(a.includes("540p")&&i?.includes("fast"))return D(1.2);if(a.includes("360p")&&i?.includes("normal"))return D(.9);if(a.includes("360p")&&i?.includes("fast")||a.includes("1080p")&&i?.includes("normal")||a.includes("1080p")&&i?.includes("fast")||a.includes("720p")&&i?.includes("normal")||a.includes("720p")&&i?.includes("fast"))return D(1.2)}return D(.9)},"pixversePricingCalculator"),Do=n(e=>{const o=e.widgets?.find(x=>x.name==="model"),t=e.widgets?.find(x=>x.name==="duration"),s=e.widgets?.find(x=>x.name==="resolution"),l=e.widgets?.find(x=>x.name==="generate_audio");if(!o||!t||!s)return"Token-based";const a=String(o.value).toLowerCase(),i=String(s.value).toLowerCase(),r=parseFloat(String(t.value)),u=l&&String(l.value).toLowerCase()==="true",p={"seedance-1-5-pro":{"480p":[.12,.12],"720p":[.26,.26],"1080p":[.58,.59]},"seedance-1-0-pro":{"480p":[.23,.24],"720p":[.51,.56],"1080p":[1.18,1.22]},"seedance-1-0-pro-fast":{"480p":[.09,.1],"720p":[.21,.23],"1080p":[.47,.49]},"seedance-1-0-lite":{"480p":[.17,.18],"720p":[.37,.41],"1080p":[.85,.88]}},g=a.includes("seedance-1-5-pro")?"seedance-1-5-pro":a.includes("seedance-1-0-pro-fast")?"seedance-1-0-pro-fast":a.includes("seedance-1-0-pro")?"seedance-1-0-pro":a.includes("seedance-1-0-lite")?"seedance-1-0-lite":"",v=i.includes("1080")?"1080p":i.includes("720")?"720p":i.includes("480")?"480p":"",f=g&&v?p[g]?.[v]:void 0;if(!f)return"Token-based";const[k,w]=f,h=r/10,C=g==="seedance-1-5-pro"&&u?2:1,y=k*h*C,N=w*h*C;return y===N?D(y):me(y,N)},"byteDanceVideoPricingCalculator"),ca=n(e=>{const o=e.widgets?.find(f=>f.name==="model"),t=e.widgets?.find(f=>f.name==="duration"),s=e.widgets?.find(f=>f.name==="resolution"),l=me(.04,.24,{suffix:"/second"});if(!o||!t||!s)return l;const a=String(o.value).toLowerCase(),i=String(s.value).toLowerCase(),r=parseFloat(String(t.value)),p={"ltx-2 (pro)":{"1920x1080":.06,"2560x1440":.12,"3840x2160":.24},"ltx-2 (fast)":{"1920x1080":.04,"2560x1440":.08,"3840x2160":.16}}[a];if(!p)return l;const g=p[i];if(!g)return l;const v=g*r;return D(v)},"ltxvPricingCalculator"),da=n(e=>{const o=e.widgets?.find(a=>a.name==="duration"),t=e.widgets?.find(a=>a.name==="generate_audio");if(!o||!t)return me(.35,1.4,{note:"(varies with duration & audio)"});const s=String(o.value),l=String(t.value).toLowerCase()==="true";return s==="5"?D(l?.7:.35):s==="10"?D(l?1.4:.7):me(.35,1.4,{note:"(varies with duration & audio)"})},"klingVideoWithAudioPricingCalculator"),_o={BASIC:new Set(["720x1280","1280x720"]),PRO:new Set(["1024x1792","1792x1024"])},fw=new Set([..._o.BASIC,..._o.PRO]);function mw(e,o,t){const s=e?.toLowerCase()??"",l=t?.toLowerCase()??"";if(!o||Number.isNaN(o))return"Set duration (4s / 8s / 12s)";if(!l)return"Set size (720x1280, 1280x720, 1024x1792, 1792x1024)";if(!fw.has(l))return"Invalid size. Must be 720x1280, 1280x720, 1024x1792, or 1792x1024.";if(!s.includes("sora-2-pro")){if(s.includes("sora-2")&&!_o.BASIC.has(l))return"sora-2 supports only 720x1280 or 1280x720";if(!s.includes("sora-2"))return"Unsupported model"}}n(mw,"validateSora2Selection");function gw(e,o){const t=e?.toLowerCase()??"",s=o?.toLowerCase()??"";return t.includes("sora-2-pro")?_o.PRO.has(s)?.5:.3:t.includes("sora-2")?.1:_o.PRO.has(s)?.5:.1}n(gw,"perSecForSora2");function vw(e,o){return D(Number((e*o).toFixed(2)))}n(vw,"formatRunPrice");const hw=n(e=>{const o=n(r=>String(e.widgets?.find(u=>u.name===r)?.value??""),"getWidgetValue"),t=o("model"),s=o("size"),l=Number(e.widgets?.find(r=>["duration","duration_s"].includes(r.name))?.value);if(!t||!s||!l)return"Set model, duration & size";const a=mw(t,l,s);if(a)return a;const i=gw(t,s);return vw(i,l)},"sora2PricingCalculator"),kn=n((e,o)=>{const t=n(x=>e.widgets?.find(I=>I.name===x),"getWidget"),s=n((x,I)=>{const _=t(x);return!_||_.value===void 0||_.value===null?I:String(_.value)},"getString"),l=n((x,I)=>{const _=t(x);if(!_||_.value===void 0||_.value===null)return I;const S=_.value;if(typeof S=="number")return S!==0;const T=String(S).toLowerCase();return T==="true"?!0:T==="false"?!1:I},"getBool"),a=s("model_version","").toLowerCase();if(a==="")return me(.1,.65,{note:"(varies with quad, style, texture & quality)"});const r=s("style","None").toLowerCase()!=="none",u=l("texture",!1),p=l("pbr",!1),g=l("quad",!1),v=s("texture_quality","standard").toLowerCase(),f=s("geometry_quality","standard").toLowerCase(),k=v==="detailed",w=f==="detailed",h=u||p;let C;a.includes("v1.4")||h?o==="text"?C=20:C=30:o==="text"?C=10:C=20;let y=C;r&&(y+=5),g&&(y+=5),k&&(y+=10),w&&(y+=20);const N=y*.01;return D(N)},"calculateTripo3DGenerationPrice"),yw=n(e=>{const o=e.widgets?.find(l=>l.name==="should_texture");if(!o)return me(lt(20),lt(30),{note:"(varies with texture)"});const s=String(o.value).toLowerCase()==="true"?30:20;return D(lt(s))},"calculateMeshyImageToModelPrice"),bw=n(e=>{const o=e.widgets?.find(l=>l.name==="should_texture");if(!o)return me(lt(5),lt(15),{note:"(varies with texture)"});const s=String(o.value).toLowerCase()==="true"?15:5;return D(lt(s))},"calculateMeshyMultiImageToModelPrice"),pa={FluxProCannyNode:{displayPrice:D(.05)},FluxProDepthNode:{displayPrice:D(.05)},FluxProExpandNode:{displayPrice:D(.05)},FluxProFillNode:{displayPrice:D(.05)},FluxProUltraImageNode:{displayPrice:D(.06)},FluxProKontextProNode:{displayPrice:D(.04)},FluxProKontextMaxNode:{displayPrice:D(.08)},Flux2ProImageNode:{displayPrice:n(e=>{const o=e.widgets?.find(g=>g.name==="width"),t=e.widgets?.find(g=>g.name==="height"),s=Number(o?.value),l=Number(t?.value);if(!Number.isFinite(s)||!Number.isFinite(l)||s<=0||l<=0)return me(.03,.15);const a=e.inputs?.find(g=>g.name==="images"),i=typeof a?.link<"u"&&a.link!=null,r=1024*1024,u=Math.max(1,Math.floor((s*l+r-1)/r)),p=.03+.015*Math.max(u-1,0);if(i){const g=p+.015,v=p+.12;return me(g,v,{approximate:!0})}return D(p)},"displayPrice")},Flux2MaxImageNode:{displayPrice:n(e=>{const o=e.widgets?.find(g=>g.name==="width"),t=e.widgets?.find(g=>g.name==="height"),s=Number(o?.value),l=Number(t?.value);if(!Number.isFinite(s)||!Number.isFinite(l)||s<=0||l<=0)return me(.07,.35);const a=e.inputs?.find(g=>g.name==="images"),i=typeof a?.link<"u"&&a.link!=null,r=1024*1024,u=Math.max(1,Math.floor((s*l+r-1)/r)),p=.07+.03*Math.max(u-1,0);if(i){const g=p+.03,v=p+.24;return me(g,v)}return D(p)},"displayPrice")},OpenAIVideoSora2:{displayPrice:hw},IdeogramV1:{displayPrice:n(e=>{const o=e.widgets?.find(r=>r.name==="num_images"),t=e.widgets?.find(r=>r.name==="turbo");if(!o)return me(.03,.09,{suffix:" x num_images/Run"});const s=Number(o.value)||1,a=String(t?.value).toLowerCase()==="true"?.0286:.0858,i=Number((a*s).toFixed(2));return D(i)},"displayPrice")},IdeogramV2:{displayPrice:n(e=>{const o=e.widgets?.find(r=>r.name==="num_images"),t=e.widgets?.find(r=>r.name==="turbo");if(!o)return me(.07,.11,{suffix:" x num_images/Run"});const s=Number(o.value)||1,a=String(t?.value).toLowerCase()==="true"?.0715:.1144,i=Number((a*s).toFixed(2));return D(i)},"displayPrice")},IdeogramV3:{displayPrice:n(e=>{const o=e.widgets?.find(p=>p.name==="rendering_speed"),t=e.widgets?.find(p=>p.name==="num_images"),s=e.inputs?.find(p=>p.name==="character_image"),l=typeof s?.link<"u"&&s.link!=null;if(!o)return me(.04,.11,{suffix:" x num_images/Run",note:"(varies with rendering speed & num_images)"});const a=Number(t?.value)||1;let i=.0858;const r=String(o.value);r.toLowerCase().includes("quality")?l?i=.286:i=.1287:r.toLowerCase().includes("default")?l?i=.2145:i=.0858:r.toLowerCase().includes("turbo")&&(l?i=.143:i=.0429);const u=Number((i*a).toFixed(2));return D(u)},"displayPrice")},KlingCameraControlI2VNode:{displayPrice:D(.49)},KlingCameraControlT2VNode:{displayPrice:D(.14)},KlingDualCharacterVideoEffectNode:{displayPrice:n(e=>{const o=e.widgets?.find(r=>r.name==="mode"),t=e.widgets?.find(r=>r.name==="model_name"),s=e.widgets?.find(r=>r.name==="duration");if(!o||!t||!s)return me(.14,2.8,{note:"(varies with model, mode & duration)"});const l=String(o.value),a=String(s.value),i=String(t.value);return i.includes("v1-6")||i.includes("v1-5")?l.includes("pro")?a.includes("10")?D(.98):D(.49):a.includes("10")?D(.56):D(.28):i.includes("v1")?l.includes("pro")?a.includes("10")?D(.98):D(.49):a.includes("10")?D(.28):D(.14):D(.14)},"displayPrice")},KlingImage2VideoNode:{displayPrice:n(e=>{const o=e.widgets?.find(r=>r.name==="mode"),t=e.widgets?.find(r=>r.name==="model_name"),s=e.widgets?.find(r=>r.name==="duration");if(!o){if(!t)return me(.14,2.8,{note:"(varies with model, mode & duration)"});const r=String(t.value);return r.includes("v2-1-master")||r.includes("v2-master")?D(1.4):r.includes("v1-6")||r.includes("v1-5")?D(.28):D(.14)}const l=String(o.value),a=String(s.value),i=String(t.value);return i.includes("v2-5-turbo")?a.includes("10")?D(.7):D(.35):i.includes("v2-1-master")||i.includes("v2-master")?a.includes("10")?D(2.8):D(1.4):i.includes("v2-1")||i.includes("v1-6")||i.includes("v1-5")?l.includes("pro")?a.includes("10")?D(.98):D(.49):a.includes("10")?D(.56):D(.28):i.includes("v1")?l.includes("pro")?a.includes("10")?D(.98):D(.49):a.includes("10")?D(.28):D(.14):D(.14)},"displayPrice")},KlingImageGenerationNode:{displayPrice:n(e=>{const t=e.inputs?.find(p=>p.name==="image")?.link?"image to image":"text to image",s=e.widgets?.find(p=>p.name==="model_name"),l=e.widgets?.find(p=>p.name==="n");if(!s)return me(.0035,.028,{suffix:" x n/Run",note:"(varies with modality & model)"});const a=String(s.value),i=Number(l?.value)||1;let r=.014;t.includes("text to image")?a.includes("kling-v1-5")||a.includes("kling-v2")?r=.014:a.includes("kling-v1")&&(r=.0035):t.includes("image to image")&&(a.includes("kling-v1-5")?r=.028:a.includes("kling-v1")&&(r=.0035));const u=r*i;return D(u)},"displayPrice")},KlingLipSyncAudioToVideoNode:{displayPrice:D(.1,{approximate:!0})},KlingLipSyncTextToVideoNode:{displayPrice:D(.1,{approximate:!0})},KlingSingleImageVideoEffectNode:{displayPrice:n(e=>{const o=e.widgets?.find(s=>s.name==="effect_scene");if(!o)return me(.28,.49,{note:"(varies with effect scene)"});const t=String(o.value);return t.includes("fuzzyfuzzy")||t.includes("squish")?D(.28):t.includes("dizzydizzy")||t.includes("bloombloom")?D(.49):(t.includes("expansion"),D(.28))},"displayPrice")},KlingStartEndFrameNode:{displayPrice:n(e=>{const o=e.widgets?.find(s=>s.name==="mode");if(!o)return me(.14,2.8,{note:"(varies with model, mode & duration)"});const t=String(o.value);return t.includes("v2-5-turbo")?t.includes("10")?D(.7):D(.35):t.includes("v2-1")?t.includes("10s")?D(.98):D(.49):t.includes("v2-master")?t.includes("10s")?D(2.8):D(1.4):t.includes("v1-6")?t.includes("pro")?t.includes("10s")?D(.98):D(.49):t.includes("10s")?D(.56):D(.28):t.includes("v1")?t.includes("pro")?t.includes("10s")?D(.98):D(.49):t.includes("10s")?D(.28):D(.14):D(.14)},"displayPrice")},KlingTextToVideoNode:{displayPrice:n(e=>{const o=e.widgets?.find(s=>s.name==="mode");if(!o)return me(.14,2.8,{note:"(varies with model, mode & duration)"});const t=String(o.value);return t.includes("v2-5-turbo")?t.includes("10")?D(.7):D(.35):t.includes("v2-1-master")||t.includes("v2-master")?t.includes("10s")?D(2.8):D(1.4):t.includes("v1-6")?t.includes("pro")?t.includes("10s")?D(.98):D(.49):t.includes("10s")?D(.56):D(.28):t.includes("v1")?t.includes("pro")?t.includes("10s")?D(.98):D(.49):t.includes("10s")?D(.28):D(.14):D(.14)},"displayPrice")},KlingVideoExtendNode:{displayPrice:D(.28)},KlingVirtualTryOnNode:{displayPrice:D(.07)},KlingOmniProTextToVideoNode:{displayPrice:Po(.112)},KlingOmniProFirstLastFrameNode:{displayPrice:Po(.112)},KlingOmniProImageToVideoNode:{displayPrice:Po(.112)},KlingOmniProVideoToVideoNode:{displayPrice:Po(.168)},KlingMotionControl:{displayPrice:pw},KlingOmniProEditVideoNode:{displayPrice:D(.168,{suffix:"/second"})},KlingOmniProImageNode:{displayPrice:D(.028)},KlingTextToVideoWithAudio:{displayPrice:da},KlingImageToVideoWithAudio:{displayPrice:da},LumaImageToVideoNode:{displayPrice:n(e=>{const o=e.widgets?.find(r=>r.name==="model"),t=e.widgets?.find(r=>r.name==="resolution"),s=e.widgets?.find(r=>r.name==="duration");if(!o||!t||!s)return me(.2,16.4,{note:"(varies with model, resolution & duration)"});const l=String(o.value),a=String(t.value).toLowerCase(),i=String(s.value);if(l.includes("ray-flash-2")){if(i.includes("5s")){if(a.includes("4k"))return D(3.13);if(a.includes("1080p"))return D(.79);if(a.includes("720p"))return D(.34);if(a.includes("540p"))return D(.2)}else if(i.includes("9s")){if(a.includes("4k"))return D(5.65);if(a.includes("1080p"))return D(1.42);if(a.includes("720p"))return D(.61);if(a.includes("540p"))return D(.36)}}else if(l.includes("ray-2")){if(i.includes("5s")){if(a.includes("4k"))return D(9.11);if(a.includes("1080p"))return D(2.27);if(a.includes("720p"))return D(1.02);if(a.includes("540p"))return D(.57)}else if(i.includes("9s")){if(a.includes("4k"))return D(16.4);if(a.includes("1080p"))return D(4.1);if(a.includes("720p"))return D(1.83);if(a.includes("540p"))return D(1.03)}}else if(l.includes("ray-1-6"))return D(.5);return D(.79)},"displayPrice")},LumaVideoNode:{displayPrice:n(e=>{const o=e.widgets?.find(r=>r.name==="model"),t=e.widgets?.find(r=>r.name==="resolution"),s=e.widgets?.find(r=>r.name==="duration");if(!o||!t||!s)return me(.2,16.4,{note:"(varies with model, resolution & duration)"});const l=String(o.value),a=String(t.value).toLowerCase(),i=String(s.value);if(l.includes("ray-flash-2")){if(i.includes("5s")){if(a.includes("4k"))return D(3.13);if(a.includes("1080p"))return D(.79);if(a.includes("720p"))return D(.34);if(a.includes("540p"))return D(.2)}else if(i.includes("9s")){if(a.includes("4k"))return D(5.65);if(a.includes("1080p"))return D(1.42);if(a.includes("720p"))return D(.61);if(a.includes("540p"))return D(.36)}}else if(l.includes("ray-2")){if(i.includes("5s")){if(a.includes("4k"))return D(9.11);if(a.includes("1080p"))return D(2.27);if(a.includes("720p"))return D(1.02);if(a.includes("540p"))return D(.57)}else if(i.includes("9s")){if(a.includes("4k"))return D(16.4);if(a.includes("1080p"))return D(4.1);if(a.includes("720p"))return D(1.83);if(a.includes("540p"))return D(1.03)}}else if(l.includes("ray-1-6"))return D(.5);return D(.79)},"displayPrice")},MinimaxImageToVideoNode:{displayPrice:D(.43)},MinimaxTextToVideoNode:{displayPrice:D(.43)},MinimaxHailuoVideoNode:{displayPrice:n(e=>{const o=e.widgets?.find(a=>a.name==="resolution"),t=e.widgets?.find(a=>a.name==="duration");if(!o||!t)return me(.28,.56,{note:"(varies with resolution & duration)"});const s=String(o.value),l=String(t.value);if(s.includes("768P")){if(l.includes("6"))return D(.28);if(l.includes("10"))return D(.56)}else if(s.includes("1080P")&&l.includes("6"))return D(.49);return D(.43)},"displayPrice")},OpenAIDalle2:{displayPrice:n(e=>{const o=e.widgets?.find(r=>r.name==="size"),t=e.widgets?.find(r=>r.name==="n");if(!o)return me(.016,.02,{suffix:" x n/Run",note:"(varies with size & n)"});const s=String(o.value),l=Number(t?.value)||1;let a=.02;s.includes("1024x1024")?a=.02:s.includes("512x512")?a=.018:s.includes("256x256")&&(a=.016);const i=Number((a*l).toFixed(3));return D(i)},"displayPrice")},OpenAIDalle3:{displayPrice:n(e=>{const o=e.widgets?.find(a=>a.name==="size"),t=e.widgets?.find(a=>a.name==="quality");if(!o||!t)return me(.04,.12,{note:"(varies with size & quality)"});const s=String(o.value),l=String(t.value);return s.includes("1024x1024")?l.includes("hd")?D(.08):D(.04):s.includes("1792x1024")||s.includes("1024x1792")?l.includes("hd")?D(.12):D(.08):D(.04)},"displayPrice")},OpenAIGPTImage1:{displayPrice:n(e=>{const o=e.widgets?.find(i=>i.name==="quality"),t=e.widgets?.find(i=>i.name==="n");if(!o)return me(.011,.3,{suffix:" x n/Run",note:"(varies with quality & n)"});const s=String(o.value),l=Number(t?.value)||1;let a=[.046,.07];return s.includes("high")?a=[.167,.3]:s.includes("medium")?a=[.046,.07]:s.includes("low")&&(a=[.011,.02]),l===1?me(a[0],a[1]):me(a[0],a[1],{suffix:` x ${l}/Run`})},"displayPrice")},PixverseImageToVideoNode:{displayPrice:wn},PixverseTextToVideoNode:{displayPrice:wn},PixverseTransitionVideoNode:{displayPrice:wn},RecraftCreativeUpscaleNode:{displayPrice:D(.25)},RecraftCrispUpscaleNode:{displayPrice:D(.004)},RecraftGenerateColorFromImageNode:{displayPrice:n(e=>{const o=e.widgets?.find(l=>l.name==="n");if(!o)return D(.04,{suffix:" x n/Run"});const t=Number(o.value)||1,s=Number((.04*t).toFixed(2));return D(s)},"displayPrice")},RecraftGenerateImageNode:{displayPrice:n(e=>{const o=e.widgets?.find(l=>l.name==="n");if(!o)return D(.04,{suffix:" x n/Run"});const t=Number(o.value)||1,s=Number((.04*t).toFixed(2));return D(s)},"displayPrice")},RecraftGenerateVectorImageNode:{displayPrice:n(e=>{const o=e.widgets?.find(l=>l.name==="n");if(!o)return D(.08,{suffix:" x n/Run"});const t=Number(o.value)||1,s=Number((.08*t).toFixed(2));return D(s)},"displayPrice")},RecraftImageInpaintingNode:{displayPrice:n(e=>{const o=e.widgets?.find(l=>l.name==="n");if(!o)return D(.04,{suffix:" x n/Run"});const t=Number(o.value)||1,s=Number((.04*t).toFixed(2));return D(s)},"displayPrice")},RecraftImageToImageNode:{displayPrice:n(e=>{const o=e.widgets?.find(l=>l.name==="n");if(!o)return D(.04,{suffix:" x n/Run"});const t=Number(o.value)||1,s=Number((.04*t).toFixed(2));return D(s)},"displayPrice")},RecraftRemoveBackgroundNode:{displayPrice:D(.01)},RecraftReplaceBackgroundNode:{displayPrice:D(.04)},RecraftTextToImageNode:{displayPrice:n(e=>{const o=e.widgets?.find(l=>l.name==="n");if(!o)return D(.04,{suffix:" x n/Run"});const t=Number(o.value)||1,s=Number((.04*t).toFixed(2));return D(s)},"displayPrice")},RecraftTextToVectorNode:{displayPrice:n(e=>{const o=e.widgets?.find(l=>l.name==="n");if(!o)return D(.08,{suffix:" x n/Run"});const t=Number(o.value)||1,s=Number((.08*t).toFixed(2));return D(s)},"displayPrice")},RecraftVectorizeImageNode:{displayPrice:n(e=>{const o=e.widgets?.find(l=>l.name==="n");if(!o)return D(.01,{suffix:" x n/Run"});const t=Number(o.value)||1,s=Number((.01*t).toFixed(2));return D(s)},"displayPrice")},StabilityStableImageSD_3_5Node:{displayPrice:n(e=>{const o=e.widgets?.find(s=>s.name==="model");if(!o)return me(.035,.065,{note:"(varies with model)"});const t=String(o.value).toLowerCase();return t.includes("large")?D(.065):(t.includes("medium"),D(.035))},"displayPrice")},StabilityStableImageUltraNode:{displayPrice:D(.08)},StabilityUpscaleConservativeNode:{displayPrice:D(.25)},StabilityUpscaleCreativeNode:{displayPrice:D(.25)},StabilityUpscaleFastNode:{displayPrice:D(.01)},StabilityTextToAudio:{displayPrice:D(.2)},StabilityAudioToAudio:{displayPrice:D(.2)},StabilityAudioInpaint:{displayPrice:D(.2)},VeoVideoGenerationNode:{displayPrice:n(e=>{const o=e.widgets?.find(s=>s.name==="duration_seconds");if(!o)return me(2.5,5,{note:"(varies with duration)"});const t=.5*Number(o.value);return D(t)},"displayPrice")},Veo3VideoGenerationNode:{displayPrice:n(e=>{const o=e.widgets?.find(a=>a.name==="model"),t=e.widgets?.find(a=>a.name==="generate_audio");if(!o||!t)return me(.8,3.2,{note:"(varies with model & audio generation)"});const s=String(o.value),l=String(t.value).toLowerCase()==="true";return s.includes("veo-3.0-fast-generate-001")||s.includes("veo-3.1-fast-generate")?D(l?1.2:.8):s.includes("veo-3.0-generate-001")||s.includes("veo-3.1-generate")?D(l?3.2:1.6):me(.8,3.2)},"displayPrice")},Veo3FirstLastFrameNode:{displayPrice:n(e=>{const o=e.widgets?.find(p=>p.name==="model"),t=e.widgets?.find(p=>p.name==="generate_audio"),s=e.widgets?.find(p=>p.name==="duration");if(!o||!t||!s)return me(.4,3.2,{note:"(varies with model & audio generation)"});const l=String(o.value),a=String(t.value).toLowerCase()==="true",i=parseFloat(String(s.value));let r=null;if(l.includes("veo-3.1-fast-generate")?r=a?.15:.1:l.includes("veo-3.1-generate")&&(r=a?.4:.2),r===null)return me(.4,3.2);const u=r*i;return D(u)},"displayPrice")},LumaImageNode:{displayPrice:n(e=>{const o=e.widgets?.find(l=>l.name==="model"),t=e.widgets?.find(l=>l.name==="aspect_ratio");if(!o||!t)return me(.0064,.026,{note:"(varies with model & aspect ratio)"});const s=String(o.value);return s.includes("photon-flash-1")?D(.0027):s.includes("photon-1")?D(.0104):D(.0246)},"displayPrice")},LumaImageModifyNode:{displayPrice:n(e=>{const o=e.widgets?.find(s=>s.name==="model");if(!o)return me(.0027,.0104,{note:"(varies with model)"});const t=String(o.value);return t.includes("photon-flash-1")?D(.0027):t.includes("photon-1")?D(.0104):D(.0246)},"displayPrice")},MoonvalleyTxt2VideoNode:{displayPrice:n(e=>{const o=e.widgets?.find(s=>s.name==="length");if(!o)return D(1.5);const t=String(o.value);return D(t==="5s"?1.5:t==="10s"?3:1.5)},"displayPrice")},MoonvalleyImg2VideoNode:{displayPrice:n(e=>{const o=e.widgets?.find(s=>s.name==="length");if(!o)return D(1.5);const t=String(o.value);return D(t==="5s"?1.5:t==="10s"?3:1.5)},"displayPrice")},MoonvalleyVideo2VideoNode:{displayPrice:n(e=>{const o=e.widgets?.find(s=>s.name==="length");if(!o)return D(2.25);const t=String(o.value);return D(t==="5s"?2.25:t==="10s"?4:2.25)},"displayPrice")},RunwayTextToImageNode:{displayPrice:D(.11)},RunwayImageToVideoNodeGen3a:{displayPrice:bn},RunwayImageToVideoNodeGen4:{displayPrice:bn},RunwayFirstLastFrameNode:{displayPrice:bn},Rodin3D_Regular:{displayPrice:D(.4)},Rodin3D_Detail:{displayPrice:D(.4)},Rodin3D_Smooth:{displayPrice:D(.4)},Rodin3D_Sketch:{displayPrice:D(.4)},TripoTextToModelNode:{displayPrice:n(e=>kn(e,"text"),"displayPrice")},TripoImageToModelNode:{displayPrice:n(e=>kn(e,"image"),"displayPrice")},TripoMultiviewToModelNode:{displayPrice:n(e=>kn(e,"multiview"),"displayPrice")},TripoTextureNode:{displayPrice:n(e=>{const o=e.widgets?.find(s=>s.name==="texture_quality");return o?String(o.value).includes("detailed")?D(.2):D(.1):me(.1,.2,{note:"(varies with quality)"})},"displayPrice")},TripoRigNode:{displayPrice:"$0.25/Run"},TripoConversionNode:{displayPrice:n(e=>{const o=n(w=>e.widgets?.find(h=>h.name===w)?.value,"getWidgetValue"),t=n((w,h)=>{const C=o(w);if(C==null||C==="")return h;if(typeof C=="number")return Number.isFinite(C)?C:h;const y=Number(C);return Number.isFinite(y)?y:h},"getNumber"),s=n((w,h)=>{const C=o(w);if(C==null)return h;if(typeof C=="number")return C!==0;const y=String(C).toLowerCase();return y==="true"?!0:y==="false"?!1:h},"getBool");let l=!1;return s("quad",!1)&&(l=!0),s("force_symmetry",!1)&&(l=!0),s("flatten_bottom",!1)&&(l=!0),s("pivot_to_center_bottom",!1)&&(l=!0),s("with_animation",!1)&&(l=!0),s("pack_uv",!1)&&(l=!0),s("bake",!1)&&(l=!0),s("export_vertex_colors",!1)&&(l=!0),s("animate_in_place",!1)&&(l=!0),t("face_limit",-1)!==-1&&(l=!0),t("texture_size",4096)!==4096&&(l=!0),t("flatten_bottom_threshold",0)!==0&&(l=!0),t("scale_factor",1)!==1&&(l=!0),String(o("texture_format")??"JPEG").toUpperCase()!=="JPEG"&&(l=!0),String(o("part_names")??"").trim().length>0&&(l=!0),String(o("fbx_preset")??"blender").toLowerCase()!=="blender"&&(l=!0),String(o("export_orientation")??"default").toLowerCase()!=="default"&&(l=!0),D((l?10:5)*.01)},"displayPrice")},TripoRetargetNode:{displayPrice:D(.1)},TripoRefineNode:{displayPrice:D(.3)},MeshyTextToModelNode:{displayPrice:D(lt(20))},MeshyRefineNode:{displayPrice:D(lt(10))},MeshyImageToModelNode:{displayPrice:yw},MeshyMultiImageToModelNode:{displayPrice:bw},MeshyRigModelNode:{displayPrice:D(lt(5))},MeshyAnimateModelNode:{displayPrice:D(lt(3))},MeshyTextureNode:{displayPrice:D(lt(10))},GeminiNode:{displayPrice:n(e=>{const o=e.widgets?.find(s=>s.name==="model");if(!o)return"Token-based";const t=String(o.value);return t.includes("gemini-2.5-flash-preview-04-17")?Ge([3e-4,.0025],{suffix:" per 1K tokens",approximate:!0,separator:"-"}):t.includes("gemini-2.5-flash")?Ge([3e-4,.0025],{suffix:" per 1K tokens",approximate:!0,separator:"-"}):t.includes("gemini-2.5-pro-preview-05-06")?Ge([.00125,.01],{suffix:" per 1K tokens",approximate:!0,separator:"-"}):t.includes("gemini-2.5-pro")?Ge([.00125,.01],{suffix:" per 1K tokens",approximate:!0,separator:"-"}):t.includes("gemini-3-pro-preview")?Ge([.002,.012],{suffix:" per 1K tokens",approximate:!0,separator:"-"}):"Token-based"},"displayPrice")},GeminiImageNode:{displayPrice:D(.039,{suffix:"/Image (1K)",approximate:!0})},GeminiImage2Node:{displayPrice:n(e=>{const o=e.widgets?.find(s=>s.name==="resolution");if(!o)return"Token-based";const t=String(o.value);return t.includes("1K")?D(.134,{suffix:"/Image",approximate:!0}):t.includes("2K")?D(.134,{suffix:"/Image",approximate:!0}):t.includes("4K")?D(.24,{suffix:"/Image",approximate:!0}):"Token-based"},"displayPrice")},OpenAIChatNode:{displayPrice:n(e=>{const o=e.widgets?.find(s=>s.name==="model");if(!o)return"Token-based";const t=String(o.value);return t.includes("o4-mini")?Ge([.0011,.0044],{suffix:" per 1K tokens",approximate:!0,separator:"-"}):t.includes("o1-pro")?Ge([.15,.6],{suffix:" per 1K tokens",approximate:!0,separator:"-"}):t.includes("o1")?Ge([.015,.06],{suffix:" per 1K tokens",approximate:!0,separator:"-"}):t.includes("o3-mini")?Ge([.0011,.0044],{suffix:" per 1K tokens",approximate:!0,separator:"-"}):t.includes("o3")?Ge([.01,.04],{suffix:" per 1K tokens",approximate:!0,separator:"-"}):t.includes("gpt-4o")?Ge([.0025,.01],{suffix:" per 1K tokens",approximate:!0,separator:"-"}):t.includes("gpt-4.1-nano")?Ge([1e-4,4e-4],{suffix:" per 1K tokens",approximate:!0,separator:"-"}):t.includes("gpt-4.1-mini")?Ge([4e-4,.0016],{suffix:" per 1K tokens",approximate:!0,separator:"-"}):t.includes("gpt-4.1")?Ge([.002,.008],{suffix:" per 1K tokens",approximate:!0,separator:"-"}):t.includes("gpt-5-nano")?Ge([5e-5,4e-4],{suffix:" per 1K tokens",approximate:!0,separator:"-"}):t.includes("gpt-5-mini")?Ge([25e-5,.002],{suffix:" per 1K tokens",approximate:!0,separator:"-"}):t.includes("gpt-5")?Ge([.00125,.01],{suffix:" per 1K tokens",approximate:!0,separator:"-"}):"Token-based"},"displayPrice")},ViduTextToVideoNode:{displayPrice:D(.4)},ViduImageToVideoNode:{displayPrice:D(.4)},ViduReferenceVideoNode:{displayPrice:D(.4)},ViduStartEndToVideoNode:{displayPrice:D(.4)},ByteDanceImageNode:{displayPrice:n(e=>{const o=e.widgets?.find(s=>s.name==="model");return o&&String(o.value).includes("seedream-3-0-t2i")?D(.03):"Token-based"},"displayPrice")},ByteDanceImageEditNode:{displayPrice:n(e=>{const o=e.widgets?.find(s=>s.name==="model");return o&&String(o.value).includes("seededit-3-0-i2i")?D(.03):"Token-based"},"displayPrice")},ByteDanceSeedreamNode:{displayPrice:n(e=>{const o=e.widgets?.find(l=>l.name==="model"),t=String(o?.value??"").toLowerCase();let s=.03;return t.includes("seedream-4-5-251128")?s=.04:t.includes("seedream-4-0-250828")&&(s=.03),D(s,{suffix:" x images/Run",approximate:!0})},"displayPrice")},ByteDanceTextToVideoNode:{displayPrice:Do},ByteDanceImageToVideoNode:{displayPrice:Do},ByteDanceFirstLastFrameNode:{displayPrice:Do},ByteDanceImageReferenceNode:{displayPrice:Do},WanTextToVideoApi:{displayPrice:n(e=>{const o=e.widgets?.find(p=>p.name==="duration"),t=e.widgets?.find(p=>p.name==="size");if(!o||!t)return me(.05,.15,{suffix:"/second"});const s=parseFloat(String(o.value)),l=String(t.value).toLowerCase(),a=l.includes("1080")?"1080p":l.includes("720")?"720p":l.includes("480")?"480p":l.match(/^\s*(\d{3,4}p)/)?.[1]??"",r={"480p":.05,"720p":.1,"1080p":.15}[a];if(isNaN(s)||!r)return me(.05,.15,{suffix:"/second"});const u=Number((r*s).toFixed(2));return D(u)},"displayPrice")},WanImageToVideoApi:{displayPrice:n(e=>{const o=e.widgets?.find(u=>u.name==="duration"),t=e.widgets?.find(u=>u.name==="resolution");if(!o||!t)return me(.05,.15,{suffix:"/second"});const s=parseFloat(String(o.value)),l=String(t.value).trim().toLowerCase(),i={"480p":.05,"720p":.1,"1080p":.15}[l];if(isNaN(s)||!i)return me(.05,.15,{suffix:"/second"});const r=Number((i*s).toFixed(2));return D(r)},"displayPrice")},WanTextToImageApi:{displayPrice:D(.03)},WanImageToImageApi:{displayPrice:D(.03)},LtxvApiTextToVideo:{displayPrice:ca},LtxvApiImageToVideo:{displayPrice:ca},WanReferenceVideoApi:{displayPrice:n(e=>{const o=e.widgets?.find(v=>v.name==="duration"),t=e.widgets?.find(v=>v.name==="size");if(!o||!t)return me(.7,1.5,{note:"(varies with size & duration)"});const s=parseFloat(String(o.value)),a=String(t.value).toLowerCase().includes("1080p")?.15:.1,i=2*a,r=5*a,u=s*a,p=i+u,g=r+u;return me(p,g)},"displayPrice")},Vidu2TextToVideoNode:{displayPrice:n(e=>{const o=e.widgets?.find(u=>u.name==="duration"),t=e.widgets?.find(u=>u.name==="resolution");if(!o||!t)return me(.075,.6,{note:"(varies with duration & resolution)"});const s=parseFloat(String(o.value)),l=String(t.value).toLowerCase();let a,i;if(l.includes("1080")?(a=.1,i=.05):(a=.075,i=.025),!Number.isFinite(s)||s<=0)return me(.075,.6,{note:"(varies with duration & resolution)"});const r=a+i*(s-1);return D(r)},"displayPrice")},Vidu2ImageToVideoNode:{displayPrice:n(e=>{const o=e.widgets?.find(v=>v.name==="model"),t=e.widgets?.find(v=>v.name==="duration"),s=e.widgets?.find(v=>v.name==="resolution");if(!o||!t||!s)return me(.04,1,{note:"(varies with model, duration & resolution)"});const l=String(o.value).toLowerCase(),a=parseFloat(String(t.value)),r=String(s.value).toLowerCase().includes("1080");let u,p;if(l.includes("q2-pro-fast"))u=r?.08:.04,p=r?.02:.01;else if(l.includes("q2-pro"))u=r?.275:.075,p=r?.075:.05;else if(l.includes("q2-turbo"))if(r)u=.175,p=.05;else{if(a<=1)return D(.04);if(a<=2)return D(.05);const v=.05+.05*(a-2);return D(v)}else return me(.04,1,{note:"(varies with model, duration & resolution)"});if(!Number.isFinite(a)||a<=0)return me(.04,1,{note:"(varies with model, duration & resolution)"});const g=u+p*(a-1);return D(g)},"displayPrice")},Vidu2ReferenceVideoNode:{displayPrice:n(e=>{const o=e.widgets?.find(f=>f.name==="duration"),t=e.widgets?.find(f=>f.name==="resolution"),s=e.widgets?.find(f=>f.name==="audio");if(!o)return me(.125,1.5,{note:"(varies with duration, resolution & audio)"});const l=parseFloat(String(o.value)),i=String(t?.value??"").toLowerCase().includes("1080"),r=s?.value,u=r!=null&&String(r).toLowerCase()!=="false"&&String(r).toLowerCase()!=="none"&&r!=="";let p,g;i?(p=.375,g=.05):(p=.125,g=.025);let v=p;return Number.isFinite(l)&&l>0&&(v=p+g*(l-1)),u&&(v+=.075),D(v)},"displayPrice")},Vidu2StartEndToVideoNode:{displayPrice:n(e=>{const o=e.widgets?.find(v=>v.name==="model"),t=e.widgets?.find(v=>v.name==="duration"),s=e.widgets?.find(v=>v.name==="resolution");if(!o||!t||!s)return me(.04,1,{note:"(varies with model, duration & resolution)"});const l=String(o.value).toLowerCase(),a=parseFloat(String(t.value)),r=String(s.value).toLowerCase().includes("1080");let u,p;if(l.includes("q2-pro-fast"))u=r?.08:.04,p=r?.02:.01;else if(l.includes("q2-pro"))u=r?.275:.075,p=r?.075:.05;else if(l.includes("q2-turbo"))if(r)u=.175,p=.05;else{if(!Number.isFinite(a)||a<=1)return D(.04);if(a<=2)return D(.05);const v=.05+.05*(a-2);return D(v)}else return me(.04,1,{note:"(varies with model, duration & resolution)"});if(!Number.isFinite(a)||a<=0)return D(u);const g=u+p*(a-1);return D(g)},"displayPrice")}},ww=n(()=>({getNodeDisplayPrice:n(s=>{if(!s.constructor?.nodeData?.api_node)return"";const l=s.constructor.nodeData.name,a=pa[l];return a?typeof a.displayPrice=="function"?dw(a.displayPrice,s,""):a.displayPrice:""},"getNodeDisplayPrice"),getNodePricingConfig:n(s=>pa[s.constructor.nodeData?.name??""],"getNodePricingConfig"),getRelevantWidgetNames:n(s=>({KlingTextToVideoNode:["mode","model_name","duration"],KlingImage2VideoNode:["mode","model_name","duration"],KlingImageGenerationNode:["modality","model_name","n"],KlingDualCharacterVideoEffectNode:["mode","model_name","duration"],KlingSingleImageVideoEffectNode:["effect_scene"],KlingStartEndFrameNode:["mode","model_name","duration"],KlingTextToVideoWithAudio:["duration","generate_audio"],KlingImageToVideoWithAudio:["duration","generate_audio"],KlingOmniProTextToVideoNode:["duration"],KlingOmniProFirstLastFrameNode:["duration"],KlingOmniProImageToVideoNode:["duration"],KlingOmniProVideoToVideoNode:["duration"],KlingMotionControl:["mode"],MinimaxHailuoVideoNode:["resolution","duration"],OpenAIDalle3:["size","quality"],OpenAIDalle2:["size","n"],OpenAIVideoSora2:["model","size","duration"],OpenAIGPTImage1:["quality","n"],IdeogramV1:["num_images","turbo"],IdeogramV2:["num_images","turbo"],IdeogramV3:["rendering_speed","num_images","character_image"],FluxProKontextProNode:[],FluxProKontextMaxNode:[],Flux2ProImageNode:["width","height","images"],Flux2MaxImageNode:["width","height","images"],VeoVideoGenerationNode:["duration_seconds"],Veo3VideoGenerationNode:["model","generate_audio"],Veo3FirstLastFrameNode:["model","generate_audio","duration"],LumaVideoNode:["model","resolution","duration"],LumaImageToVideoNode:["model","resolution","duration"],LumaImageNode:["model","aspect_ratio"],LumaImageModifyNode:["model","aspect_ratio"],PixverseTextToVideoNode:["duration_seconds","quality","motion_mode"],PixverseTransitionVideoNode:["duration_seconds","motion_mode","quality"],PixverseImageToVideoNode:["duration_seconds","quality","motion_mode"],StabilityStableImageSD_3_5Node:["model"],RecraftTextToImageNode:["n"],RecraftImageToImageNode:["n"],RecraftImageInpaintingNode:["n"],RecraftTextToVectorNode:["n"],RecraftVectorizeImageNode:["n"],RecraftGenerateColorFromImageNode:["n"],RecraftGenerateImageNode:["n"],RecraftGenerateVectorImageNode:["n"],MoonvalleyTxt2VideoNode:["length"],MoonvalleyImg2VideoNode:["length"],MoonvalleyVideo2VideoNode:["length"],RunwayImageToVideoNodeGen3a:["duration"],RunwayImageToVideoNodeGen4:["duration"],RunwayFirstLastFrameNode:["duration"],TripoTextToModelNode:["model_version","quad","style","texture","pbr","texture_quality","geometry_quality"],TripoImageToModelNode:["model_version","quad","style","texture","pbr","texture_quality","geometry_quality"],TripoMultiviewToModelNode:["model_version","quad","texture","pbr","texture_quality","geometry_quality"],TripoConversionNode:["quad","face_limit","texture_size","texture_format","force_symmetry","flatten_bottom","flatten_bottom_threshold","pivot_to_center_bottom","scale_factor","with_animation","pack_uv","bake","part_names","fbx_preset","export_vertex_colors","export_orientation","animate_in_place"],TripoTextureNode:["texture_quality"],MeshyImageToModelNode:["should_texture"],MeshyMultiImageToModelNode:["should_texture"],GeminiNode:["model"],GeminiImage2Node:["resolution"],OpenAIChatNode:["model"],ByteDanceImageNode:["model"],ByteDanceImageEditNode:["model"],ByteDanceSeedreamNode:["model","sequential_image_generation","max_images"],ByteDanceTextToVideoNode:["model","duration","resolution","generate_audio"],ByteDanceImageToVideoNode:["model","duration","resolution","generate_audio"],ByteDanceFirstLastFrameNode:["model","duration","resolution","generate_audio"],ByteDanceImageReferenceNode:["model","duration","resolution"],WanTextToVideoApi:["duration","size"],WanImageToVideoApi:["duration","resolution"],WanReferenceVideoApi:["duration","size"],LtxvApiTextToVideo:["model","duration","resolution"],LtxvApiImageToVideo:["model","duration","resolution"],Vidu2TextToVideoNode:["model","duration","resolution"],Vidu2ImageToVideoNode:["model","duration","resolution"],Vidu2ReferenceVideoNode:["audio","duration","resolution"],Vidu2StartEndToVideoNode:["model","duration","resolution"]})[s]||[],"getRelevantWidgetNames")}),"useNodePricing"),Vn=new Image;Vn.src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'%3E%3Cpath fill='none' stroke='oklch(83.01%25 0.163 83.16)' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M15.536 11.293a1 1 0 0 0 0 1.414l2.376 2.377a1 1 0 0 0 1.414 0l2.377-2.377a1 1 0 0 0 0-1.414l-2.377-2.377a1 1 0 0 0-1.414 0zm-13.239 0a1 1 0 0 0 0 1.414l2.377 2.377a1 1 0 0 0 1.414 0l2.377-2.377a1 1 0 0 0 0-1.414L6.088 8.916a1 1 0 0 0-1.414 0zm6.619 6.619a1 1 0 0 0 0 1.415l2.377 2.376a1 1 0 0 0 1.414 0l2.377-2.376a1 1 0 0 0 0-1.415l-2.377-2.376a1 1 0 0 0-1.414 0zm0-13.238a1 1 0 0 0 0 1.414l2.377 2.376a1 1 0 0 0 1.414 0l2.377-2.376a1 1 0 0 0 0-1.414l-2.377-2.377a1 1 0 0 0-1.414 0z'/%3E%3C/svg%3E";const kw=n(()=>{function e(a){if(!a.isSubgraphNode())return;a.badges=a.badges.filter(r=>!t(r));const i=o(a.subgraph);i.length>1?a.badges.push(l("Partner Nodes x "+i.length)):a.badges.push(...i)}n(e,"updateSubgraphCredits");function o(a,i=new Set){if(i.has(a.id))return[];i.add(a.id);const r=[];for(const u of a.nodes)r.push(...u.isSubgraphNode()?o(u.subgraph,i):u.badges.filter(p=>t(p)));return r}n(o,"collectCreditsBadges");function t(a){return(typeof a=="function"?a():a).icon?.image===Vn}n(t,"isCreditsBadge");const s=pt();function l(a){const i=s.completedActivePalette.light_theme;return new rs({text:a,iconOptions:{image:Vn,size:8},fgColor:s.completedActivePalette.colors.litegraph_base.BADGE_FG_COLOR,bgColor:i?Rt("#8D6932",{lightness:.5}):"#8D6932"})}return n(l,"getCreditsBadge"),{getCreditsBadge:l,updateSubgraphCredits:e}},"usePriceBadge"),Cw=n((e,o={})=>{const{widgetNames:t,triggerCanvasRedraw:s=!1}=o,l=L({});if(e.widgets){const a=t?e.widgets.filter(r=>t.includes(r.name)):e.widgets,i={};if(a.forEach(r=>{i[r.name]=r.value}),l.value=i,a.forEach(r=>{r.callback=so(r.callback,()=>{l.value={...l.value,[r.name]:r.value},s&&e.graph?.setDirtyCanvas(!0,!0)})}),t&&t.length>a.length){const r=t.map(u=>a.some(p=>p.name==u)?-1:e.inputs.findIndex(p=>p.name==u)).filter(u=>u>=0);e.onConnectionsChange=so(e.onConnectionsChange,(u,p,g)=>{r.includes(p)&&(l.value={...l.value,[r[p]]:g},s&&e.graph?.setDirtyCanvas(!0,!0))})}}return a=>Kl(l,a)},"useComputedWithWidgetWatch"),xw=n(()=>{const e=re(),o=Zn(),t=pt(),s=kw(),l=b(()=>e.get("Comfy.NodeBadge.NodeSourceBadgeMode")),a=b(()=>e.get("Comfy.NodeBadge.NodeIdBadgeMode")),i=b(()=>e.get("Comfy.NodeBadge.NodeLifeCycleBadgeMode")),r=b(()=>e.get("Comfy.NodeBadge.ShowApiPricing"));se([l,a,i,r],()=>{J.canvas?.setDirty(!0,!0)});const u=Tt();function p(g,v){return!(v===gt.None||g?.isCoreNode&&v===gt.HideBuiltIn)}n(p,"badgeTextVisible"),ze(()=>{const g=ww();o.registerExtension({name:"Comfy.NodeBadge",nodeCreated(v){v.badgePosition=Tr.TopRight;const f=b(()=>{const k=u.fromLGraphNode(v);return new rs({text:Ql.truncate([p(k,a.value)?`#${v.id}`:"",p(k,i.value)?k?.nodeLifeCycleBadgeText??"":"",p(k,l.value)?k?.nodeSource?.badgeText??"":""].filter(w=>w.length>0).join(" "),{length:31}),fgColor:t.completedActivePalette.colors.litegraph_base.BADGE_FG_COLOR,bgColor:t.completedActivePalette.colors.litegraph_base.BADGE_BG_COLOR})});if(v.badges.push(()=>f.value),v.constructor.nodeData?.api_node&&r.value){const w=typeof g.getNodePricingConfig(v)?.displayPrice=="function";let h;const C=n(()=>{const y=g.getNodeDisplayPrice(v);return s.getCreditsBadge(y)},"createBadge");if(w){const y=g.getRelevantWidgetNames(v.constructor.nodeData?.name);h=Cw(v,{widgetNames:y,triggerCanvasRedraw:!0})(C)}else h=b(C);v.badges.push(()=>h.value)}},init(){J.canvas.canvas.addEventListener("litegraph:set-graph",()=>{for(const v of J.canvas.graph?.nodes??[])s.updateSubgraphCredits(v)}),J.canvas.canvas.addEventListener("subgraph-converted",v=>s.updateSubgraphCredits(v.detail.subgraphNode))},afterConfigureGraph(){for(const v of J.canvas.graph?.nodes??[])s.updateSubgraphCredits(v)}})})},"useNodeBadge"),Sw=n(e=>{const o=Qn(),t=To(),s=tt();ol(()=>e.value,{getDropEffect:n(l=>l.source.data.type==="tree-explorer-node"?"copy":"move","getDropEffect"),onDrop:n(async l=>{const a=l.location.current.input,i=l.source.data;if(i.type==="tree-explorer-node"){const r=i.data,p=nl().clientPosToCanvasPos([a.clientX,a.clientY]);if(r.data instanceof $r){const g=r.data,v=[...p];v[1]+=ge.NODE_TITLE_HEIGHT,t.addNodeOnGraph(g,{pos:v})}else if(r.data instanceof Nr){const g=r.data,v=p,f=J.canvas.graph?.getNodeOnPos(v[0],v[1]);let k=null,w=null;if(f){const h=o.getAllNodeProviders(g.directory);for(const C of h)C.nodeDef.name===f.comfyClass&&(w=f,k=C)}if(!w){const h=o.getNodeProvider(g.directory);h&&(w=t.addNodeOnGraph(h.nodeDef,{pos:v}),k=h)}if(w){const h=w.widgets?.find(C=>C.name===k?.key);h&&(h.value=g.file_name)}}else if(r.data instanceof Fa){const g=r.data;await s.insertWorkflow(g,{position:p})}}},"onDrop")})},"useCanvasDrop"),_w=n(()=>{Jt.install(Ye.prototype,"getCanvasMenuOptions");const{getCanvasMenuOptions:e}=Ye.prototype,o=n(function(...r){const u=e.apply(this,r),p=J.collectCanvasMenuItems(this);for(const v of p)u.push(v);const g=Jt.extractLegacyItems("getCanvasMenuOptions",this,...r);for(const v of g)u.push(v);for(const v of u)v?.content&&(v.content=Ae(`contextMenu.${v.content}`,v.content));return u},"getCanvasCenterMenuOptions");Ye.prototype.getCanvasMenuOptions=o,Jt.registerWrapper("getCanvasMenuOptions",o,e,Ye.prototype),Jt.install(Ye.prototype,"getNodeMenuOptions");const t=Ye.prototype.getNodeMenuOptions,s=n(function(...r){const u=t.apply(this,r),p=r[0],g=J.collectNodeMenuItems(p);for(const f of g)u.push(f);const v=Jt.extractLegacyItems("getNodeMenuOptions",this,...r);for(const f of v)u.push(f);return u},"getNodeMenuOptionsWithExtensions");Ye.prototype.getNodeMenuOptions=s,Jt.registerWrapper("getNodeMenuOptions",s,t,Ye.prototype);function l(r,u){if(!r)return;const p=/Convert (.*) to input/,g=/Convert (.*) to widget/,v=Ae("contextMenu.Convert ","Convert "),f=Ae("contextMenu. to input"," to input"),k=Ae("contextMenu. to widget"," to widget");for(const w of r){if(typeof w=="string"||(l(w?.submenu?.options,u),!w?.content))continue;Ir(`contextMenu.${w.content}`)&&(w.content=Ae(`contextMenu.${w.content}`,w.content));const h=u.extra||u.parentMenu?.options?.extra,C=w.content?.match(p);if(C){let N=C[1];h?.inputs?.find(x=>{if(x.name!=N)return!1;N=x.label?x.label:x.name}),h?.widgets?.find(x=>{if(x.name!=N)return!1;N=x.label?x.label:x.name}),w.content=v+N+f;continue}const y=w.content?.match(g);if(y){let N=y[1];h?.inputs?.find(x=>{if(x.name!=N)return!1;N=x.label?x.label:x.name}),h?.widgets?.find(x=>{if(x.name!=N)return!1;N=x.label?x.label:x.name}),w.content=v+N+k;continue}}}n(l,"translateMenus");const a=ge.ContextMenu;function i(r,u){return u.title&&(u.title=Ae(`nodeDefs.${He(u.title)}.display_name`,u.title)),l(r,u),new a(r,u)}n(i,"ContextMenu"),ge.ContextMenu=i,ge.ContextMenu.prototype=a.prototype},"useContextMenuTranslation"),Tw=['<meta charset="utf-8"><div><span data-metadata="','"></span></div><span style="white-space:pre-wrap;">Text</span>'],$w=n(()=>{const e=he();Re(document,"copy",o=>{if(Mr(o.target))return;const t=e.canvas;if(t?.selectedItems){const s=t.copyToClipboard(),l=btoa(String.fromCharCode(...Array.from(new TextEncoder().encode(s))));return o.clipboardData?.setData("text/html",Tw.join(l)),o.preventDefault(),o.stopImmediatePropagation(),!1}})},"useCopy"),Nw=n(()=>{window.LiteGraph=ge,window.LGraph=Pr,window.LLink=Dr,window.LGraphNode=ht,window.LGraphGroup=Ot,window.DragAndScale=Ar,window.LGraphCanvas=Ye,window.ContextMenu=Lr,window.LGraphBadge=rs},"useGlobalLitegraph"),Iw=n(()=>{const e=re(),o=he();ke(()=>{const t=e.get("Comfy.Graph.CanvasInfo");o.canvas&&(o.canvas.show_info=t,o.canvas.draw(!1,!0))}),ke(()=>{const t=e.get("Comfy.Graph.ZoomSpeed");o.canvas&&(o.canvas.zoom_speed=t)}),ke(()=>{ge.snaps_for_comfy=e.get("Comfy.Node.AutoSnapLinkToSlot")}),ke(()=>{ge.snap_highlights_node=e.get("Comfy.Node.SnapHighlightsNode")}),ke(()=>{ht.keepAllLinksOnBypass=e.get("Comfy.Node.BypassAllLinksOnDelete")}),ke(()=>{ge.middle_click_slot_add_default_node=e.get("Comfy.Node.MiddleClickRerouteNode")}),ke(()=>{const t=e.get("Comfy.LinkRenderMode");o.canvas&&(o.canvas.links_render_mode=t,o.canvas.setDirty(!1,!0))}),ke(()=>{const t=e.get("LiteGraph.Canvas.MinFontSizeForLOD");o.canvas&&(o.canvas.min_font_size_for_lod=t,o.canvas.setDirty(!0,!0))}),ke(()=>{const t=e.get("Comfy.Graph.LinkMarkers"),{canvas:s}=o;s&&(s.linkMarkerShape=t,s.setDirty(!1,!0))}),ke(()=>{const t=e.get("LiteGraph.Canvas.MaximumFps"),{canvas:s}=o;s&&(s.maximumFps=t)}),ke(()=>{const t=e.get("Comfy.Graph.CtrlShiftZoom"),{canvas:s}=o;s&&(s.dragZoomEnabled=t)}),ke(()=>{const t=e.get("Comfy.Graph.LiveSelection"),{canvas:s}=o;s&&(s.liveSelection=t)}),ke(()=>{dn.doubleClickTime=e.get("Comfy.Pointer.DoubleClickTime")}),ke(()=>{dn.bufferTime=e.get("Comfy.Pointer.ClickBufferTime")}),ke(()=>{dn.maxClickDrift=e.get("Comfy.Pointer.ClickDrift")}),ke(()=>{ge.CANVAS_GRID_SIZE=e.get("Comfy.SnapToGrid.GridSize")}),ke(()=>{ge.alwaysSnapToGrid=e.get("pysssss.SnapToGrid")}),ke(()=>{ge.context_menu_scaling=e.get("LiteGraph.ContextMenu.Scaling")}),ke(()=>{ge.Reroute.maxSplineOffset=e.get("LiteGraph.Reroute.SplineOffset")}),ke(()=>{const t=e.get("Comfy.Canvas.NavigationMode");ge.canvasNavigationMode=t,ge.macTrackpadGestures=t==="standard"}),ke(()=>{const t=e.get("Comfy.Canvas.LeftMouseClickBehavior");ge.leftMouseClickBehavior=t}),ke(()=>{const t=e.get("Comfy.Canvas.MouseWheelScroll");ge.mouseWheelScroll=t}),ke(()=>{ge.saveViewportWithGraph=e.get("Comfy.EnableWorkflowViewRestore")})},"useLitegraphSettings"),Mw=[{id:"Comfy.Memory.AllowManualUnload",name:"Allow manual unload of models and execution cache via user command",type:"hidden",defaultValue:!0,versionAdded:"1.18.0"},{id:"Comfy.Validation.Workflows",name:"Validate workflows",type:"boolean",defaultValue:!1},{id:"Comfy.NodeSearchBoxImpl",category:["Comfy","Node Search Box","Implementation"],experimental:!0,name:"Node search box implementation",type:"combo",options:["default","litegraph (legacy)"],defaultValue:"default"},{id:"Comfy.LinkRelease.Action",category:["LiteGraph","LinkRelease","Action"],name:"Action on link release (No modifier)",type:"combo",options:Object.values(kt),defaultValue:kt.CONTEXT_MENU,defaultsByInstallVersion:{"1.24.1":kt.SEARCH_BOX}},{id:"Comfy.LinkRelease.ActionShift",category:["LiteGraph","LinkRelease","ActionShift"],name:"Action on link release (Shift)",type:"combo",options:Object.values(kt),defaultValue:kt.SEARCH_BOX,defaultsByInstallVersion:{"1.24.1":kt.CONTEXT_MENU}},{id:"Comfy.NodeSearchBoxImpl.NodePreview",category:["Comfy","Node Search Box","NodePreview"],name:"Node preview",tooltip:"Only applies to the default implementation",type:"boolean",defaultValue:!0},{id:"Comfy.NodeSearchBoxImpl.ShowCategory",category:["Comfy","Node Search Box","ShowCategory"],name:"Show node category in search results",tooltip:"Only applies to the default implementation",type:"boolean",defaultValue:!0},{id:"Comfy.NodeSearchBoxImpl.ShowIdName",category:["Comfy","Node Search Box","ShowIdName"],name:"Show node id name in search results",tooltip:"Only applies to the default implementation",type:"boolean",defaultValue:!1},{id:"Comfy.NodeSearchBoxImpl.ShowNodeFrequency",category:["Comfy","Node Search Box","ShowNodeFrequency"],name:"Show node frequency in search results",tooltip:"Only applies to the default implementation",type:"boolean",defaultValue:!1},{id:"Comfy.Sidebar.Location",category:["Appearance","Sidebar","Location"],name:"Sidebar location",type:"combo",options:["left","right"],defaultValue:"left"},{id:"Comfy.Sidebar.Size",category:["Appearance","Sidebar","Size"],name:"Sidebar size",type:"combo",options:["normal","small"],defaultValue:n(()=>window.innerWidth<1536?"small":"normal","defaultValue")},{id:"Comfy.Sidebar.UnifiedWidth",category:["Appearance","Sidebar","UnifiedWidth"],name:"Unified sidebar width",type:"boolean",defaultValue:!0,versionAdded:"1.18.1"},{id:"Comfy.Sidebar.Style",category:["Appearance","Sidebar","Style"],name:"Sidebar style",type:"combo",options:["floating","connected"],defaultValue:"connected"},{id:"Comfy.TextareaWidget.FontSize",category:["Appearance","Node Widget","TextareaWidget","FontSize"],name:"Textarea widget font size",type:"slider",defaultValue:10,attrs:{min:8,max:24}},{id:"Comfy.TextareaWidget.Spellcheck",category:["Comfy","Node Widget","TextareaWidget","Spellcheck"],name:"Textarea widget spellcheck",type:"boolean",defaultValue:!1},{id:"Comfy.Workflow.SortNodeIdOnSave",name:"Sort node IDs when saving workflow",type:"boolean",defaultValue:!1},{id:"Comfy.Canvas.NavigationMode",category:["LiteGraph","Canvas Navigation","NavigationMode"],name:"Navigation Mode",defaultValue:"legacy",type:"combo",sortOrder:100,options:[{value:"standard",text:"Standard (New)"},{value:"legacy",text:"Drag Navigation"},{value:"custom",text:"Custom"}],versionAdded:"1.25.0",defaultsByInstallVersion:{"1.25.0":"legacy"},onChange:n(async(e,o)=>{if(!o)return;const t=re();e==="standard"?(await t.set("Comfy.Canvas.LeftMouseClickBehavior","select"),await t.set("Comfy.Canvas.MouseWheelScroll","panning")):e==="legacy"&&(await t.set("Comfy.Canvas.LeftMouseClickBehavior","panning"),await t.set("Comfy.Canvas.MouseWheelScroll","zoom"))},"onChange")},{id:"Comfy.Canvas.LeftMouseClickBehavior",category:["LiteGraph","Canvas Navigation","LeftMouseClickBehavior"],name:"Left Mouse Click Behavior",defaultValue:"panning",type:"radio",sortOrder:50,options:[{value:"panning",text:"Panning"},{value:"select",text:"Select"}],versionAdded:"1.27.4",onChange:n(async e=>{const o=re(),t=o.get("Comfy.Canvas.NavigationMode");if(t!=="custom"){if(e==="select"&&t==="standard"||e==="panning"&&t==="legacy")return;await o.set("Comfy.Canvas.NavigationMode","custom")}},"onChange")},{id:"Comfy.Canvas.MouseWheelScroll",category:["LiteGraph","Canvas Navigation","MouseWheelScroll"],name:"Mouse Wheel Scroll",defaultValue:"zoom",type:"radio",options:[{value:"panning",text:"Panning"},{value:"zoom",text:"Zoom in/out"}],versionAdded:"1.27.4",onChange:n(async e=>{const o=re(),t=o.get("Comfy.Canvas.NavigationMode");if(t!=="custom"){if(e==="panning"&&t==="standard"||e==="zoom"&&t==="legacy")return;await o.set("Comfy.Canvas.NavigationMode","custom")}},"onChange")},{id:"Comfy.Graph.CanvasInfo",category:["LiteGraph","Canvas","CanvasInfo"],name:"Show canvas info on bottom left corner (fps, etc.)",type:"boolean",defaultValue:!0},{id:"Comfy.Node.ShowDeprecated",name:"Show deprecated nodes in search",tooltip:"Deprecated nodes are hidden by default in the UI, but remain functional in existing workflows that use them.",type:"boolean",defaultValue:!1},{id:"Comfy.Node.ShowExperimental",name:"Show experimental nodes in search",tooltip:"Experimental nodes are marked as such in the UI and may be subject to significant changes or removal in future versions. Use with caution in production workflows",type:"boolean",defaultValue:!0},{id:"Comfy.Node.Opacity",category:["Appearance","Node","Opacity"],name:"Node opacity",type:"slider",defaultValue:1,attrs:{min:.01,max:1,step:.01}},{id:"Comfy.Workflow.ShowMissingNodesWarning",name:"Show missing nodes warning",type:"boolean",defaultValue:!0},{id:"Comfy.Workflow.ShowMissingModelsWarning",name:"Show missing models warning",type:"boolean",defaultValue:!0,experimental:!0},{id:"Comfy.Workflow.WarnBlueprintOverwrite",name:"Require confirmation to overwrite an existing subgraph blueprint",type:"boolean",defaultValue:!0},{id:"Comfy.Graph.ZoomSpeed",category:["LiteGraph","Canvas","ZoomSpeed"],name:"Canvas zoom speed",type:"slider",defaultValue:1.1,attrs:{min:1.01,max:2.5,step:.01}},{id:"Comfy.NodeLibrary.Bookmarks",name:"Node library bookmarks with display name (deprecated)",type:"hidden",defaultValue:[],deprecated:!0},{id:"Comfy.NodeLibrary.Bookmarks.V2",name:"Node library bookmarks v2 with unique name",type:"hidden",defaultValue:[]},{id:"Comfy.NodeLibrary.BookmarksCustomization",name:"Node library bookmarks customization",type:"hidden",defaultValue:{}},{id:"Comfy.GroupSelectedNodes.Padding",category:["LiteGraph","Group","Padding"],name:"Group selected nodes padding",type:"slider",defaultValue:10,attrs:{min:0,max:100}},{id:"Comfy.Node.DoubleClickTitleToEdit",category:["LiteGraph","Node","DoubleClickTitleToEdit"],name:"Double click node title to edit",type:"boolean",defaultValue:!0},{id:"Comfy.Node.AllowImageSizeDraw",category:["LiteGraph","Node Widget","AllowImageSizeDraw"],name:"Show width  height below the image preview",type:"boolean",defaultValue:!0},{id:"Comfy.Group.DoubleClickTitleToEdit",category:["LiteGraph","Group","DoubleClickTitleToEdit"],name:"Double click group title to edit",type:"boolean",defaultValue:!0},{id:"Comfy.Window.UnloadConfirmation",name:"Show confirmation when closing window",type:"boolean",defaultValue:!0,versionModified:"1.7.12"},{id:"Comfy.TreeExplorer.ItemPadding",category:["Appearance","Tree Explorer","ItemPadding"],name:"Tree explorer item padding",type:"slider",defaultValue:2,attrs:{min:0,max:8,step:1}},{id:"Comfy.ModelLibrary.AutoLoadAll",name:"Automatically load all model folders",tooltip:"If true, all folders will load as soon as you open the model library (this may cause delays while it loads). If false, root level model folders will only load once you click on them.",type:"boolean",defaultValue:!1},{id:"Comfy.ModelLibrary.NameFormat",name:"What name to display in the model library tree view",tooltip:'Select "filename" to render a simplified view of the raw filename (without directory or ".safetensors" extension) in the model list. Select "title" to display the configurable model metadata title.',type:"combo",options:["filename","title"],defaultValue:"title"},{id:"Comfy.Locale",name:"Language",type:"combo",options:[{value:"en",text:"English"},{value:"zh",text:""},{value:"zh-TW",text:""},{value:"ru",text:""},{value:"ja",text:""},{value:"ko",text:""},{value:"fr",text:"Franais"},{value:"es",text:"Espaol"},{value:"ar",text:""},{value:"tr",text:"Trke"},{value:"pt-BR",text:"Portugus (BR)"},{value:"fa",text:""}],defaultValue:n(()=>navigator.language.split("-")[0]||"en","defaultValue")},{id:"Comfy.NodeBadge.NodeSourceBadgeMode",category:["LiteGraph","Node","NodeSourceBadgeMode"],name:"Node source badge mode",type:"combo",options:Object.values(gt),defaultValue:gt.HideBuiltIn},{id:"Comfy.NodeBadge.NodeIdBadgeMode",category:["LiteGraph","Node","NodeIdBadgeMode"],name:"Node ID badge mode",type:"combo",options:[gt.None,gt.ShowAll],defaultValue:gt.None},{id:"Comfy.NodeBadge.NodeLifeCycleBadgeMode",category:["LiteGraph","Node","NodeLifeCycleBadgeMode"],name:"Node life cycle badge mode",type:"combo",options:[gt.None,gt.ShowAll],defaultValue:gt.ShowAll},{id:"Comfy.NodeBadge.ShowApiPricing",category:["Comfy","API Nodes"],name:"Show API node pricing badge",type:"boolean",defaultValue:!0,versionAdded:"1.20.3"},{id:"Comfy.Notification.ShowVersionUpdates",category:["Comfy","Notification Preferences"],name:"Show version updates",tooltip:"Show updates for new models, and major new features.",type:"boolean",defaultValue:!0},{id:"Comfy.ConfirmClear",category:["Comfy","Workflow","ConfirmClear"],name:"Require confirmation when clearing workflow",type:"boolean",defaultValue:!0},{id:"Comfy.PromptFilename",category:["Comfy","Workflow","PromptFilename"],name:"Prompt for filename when saving workflow",type:"boolean",defaultValue:!0},{id:"Comfy.PreviewFormat",category:["LiteGraph","Node Widget","PreviewFormat"],name:"Preview image format",tooltip:"When displaying a preview in the image widget, convert it to a lightweight image, e.g. webp, jpeg, webp;50, etc.",type:"text",defaultValue:""},{id:"Comfy.DisableSliders",category:["LiteGraph","Node Widget","DisableSliders"],name:"Disable node widget sliders",type:"boolean",defaultValue:!1},{id:"Comfy.DisableFloatRounding",category:["LiteGraph","Node Widget","DisableFloatRounding"],name:"Disable default float widget rounding.",tooltip:"(requires page reload) Cannot disable round when round is set by the node in the backend.",type:"boolean",defaultValue:!1},{id:"Comfy.FloatRoundingPrecision",category:["LiteGraph","Node Widget","FloatRoundingPrecision"],name:"Float widget rounding decimal places [0 = auto].",tooltip:"(requires page reload)",type:"slider",attrs:{min:0,max:6,step:1},defaultValue:0},{id:"LiteGraph.Node.TooltipDelay",name:"Tooltip Delay",type:"number",attrs:{min:100,max:3e3,step:50},defaultValue:500,versionAdded:"1.9.0"},{id:"Comfy.EnableTooltips",category:["LiteGraph","Node","EnableTooltips"],name:"Enable Tooltips",type:"boolean",defaultValue:!0},{id:"Comfy.DevMode",name:"Enable dev mode options (API save, etc.)",type:"boolean",defaultValue:!1,onChange:n(e=>{const o=document.getElementById("comfy-dev-save-api-button");o&&(o.style.display=e?"flex":"none")},"onChange")},{id:"Comfy.UI.TabBarLayout",category:["Appearance","General"],name:"Tab Bar Layout",type:"combo",options:["Default","Integrated"],tooltip:'Controls the layout of the tab bar. "Integrated" moves Help and User controls into the tab bar area.',defaultValue:"Default"},{id:"Comfy.UseNewMenu",category:["Comfy","Menu","UseNewMenu"],defaultValue:"Top",name:"Use new menu",type:"combo",options:["Disabled","Top"],tooltip:"Enable the redesigned top menu bar.",migrateDeprecatedValue:n(e=>e==="Floating"||e==="Bottom"?"Top":e,"migrateDeprecatedValue")},{id:"Comfy.Workflow.WorkflowTabsPosition",name:"Opened workflows position",type:"combo",options:["Sidebar","Topbar"],defaultValue:"Topbar",migrateDeprecatedValue:n(e=>e==="Topbar (2nd-row)"?"Topbar":e,"migrateDeprecatedValue")},{id:"Comfy.Graph.CanvasMenu",category:["LiteGraph","Canvas","CanvasMenu"],name:"Show graph canvas menu",type:"boolean",defaultValue:!0},{id:"Comfy.QueueButton.BatchCountLimit",name:"Batch count limit",tooltip:"The maximum number of tasks added to the queue at one button click",type:"number",defaultValue:100,versionAdded:"1.3.5"},{id:"Comfy.Keybinding.UnsetBindings",name:"Keybindings unset by the user",type:"hidden",defaultValue:[],versionAdded:"1.3.7",versionModified:"1.7.3",migrateDeprecatedValue:n(e=>e.map(o=>(o.targetSelector==="#graph-canvas"&&(o.targetElementId="graph-canvas-container"),o)),"migrateDeprecatedValue")},{id:"Comfy.Keybinding.NewBindings",name:"Keybindings set by the user",type:"hidden",defaultValue:[],versionAdded:"1.3.7"},{id:"Comfy.Extension.Disabled",name:"Disabled extension names",type:"hidden",defaultValue:[],versionAdded:"1.3.11"},{id:"Comfy.LinkRenderMode",category:["LiteGraph","Graph","LinkRenderMode"],name:"Link Render Mode",defaultValue:2,type:"combo",options:[{value:ge.STRAIGHT_LINK,text:"Straight"},{value:ge.LINEAR_LINK,text:"Linear"},{value:ge.SPLINE_LINK,text:"Spline"},{value:ge.HIDDEN_LINK,text:"Hidden"}]},{id:"Comfy.Node.AutoSnapLinkToSlot",category:["LiteGraph","Node","AutoSnapLinkToSlot"],name:"Auto snap link to node slot",tooltip:"When dragging a link over a node, the link automatically snap to a viable input slot on the node",type:"boolean",defaultValue:!0,versionAdded:"1.3.29"},{id:"Comfy.Node.SnapHighlightsNode",category:["LiteGraph","Node","SnapHighlightsNode"],name:"Snap highlights node",tooltip:"When dragging a link over a node with viable input slot, highlight the node",type:"boolean",defaultValue:!0,versionAdded:"1.3.29"},{id:"Comfy.Node.BypassAllLinksOnDelete",category:["LiteGraph","Node","BypassAllLinksOnDelete"],name:"Keep all links when deleting nodes",tooltip:"When deleting a node, attempt to reconnect all of its input and output links (bypassing the deleted node)",type:"boolean",defaultValue:!0,versionAdded:"1.3.40"},{id:"Comfy.Node.MiddleClickRerouteNode",category:["LiteGraph","Node","MiddleClickRerouteNode"],name:"Middle-click creates a new Reroute node",type:"boolean",defaultValue:!0,versionAdded:"1.3.42"},{id:"Comfy.Graph.LinkMarkers",category:["LiteGraph","Link","LinkMarkers"],name:"Link midpoint markers",defaultValue:Io.Circle,type:"combo",options:[{value:Io.None,text:"None"},{value:Io.Circle,text:"Circle"},{value:Io.Arrow,text:"Arrow"}],versionAdded:"1.3.42"},{id:"Comfy.DOMClippingEnabled",category:["LiteGraph","Node","DOMClippingEnabled"],name:"Enable DOM element clipping (enabling may reduce performance)",type:"boolean",defaultValue:!0},{id:"Comfy.Graph.CtrlShiftZoom",category:["LiteGraph","Canvas","CtrlShiftZoom"],name:"Enable fast-zoom shortcut (Ctrl + Shift + Drag)",type:"boolean",defaultValue:!0,versionAdded:"1.4.0"},{id:"Comfy.Graph.LiveSelection",category:["LiteGraph","Canvas","LiveSelection"],name:"Live selection",tooltip:"When enabled, nodes are selected/deselected in real-time as you drag the selection rectangle, similar to other design tools.",type:"boolean",defaultValue:!1,versionAdded:"1.36.1"},{id:"Comfy.Pointer.ClickDrift",category:["LiteGraph","Pointer","ClickDrift"],name:"Pointer click drift (maximum distance)",tooltip:`If the pointer moves more than this distance while holding a button down, it is considered dragging (rather than clicking).

Helps prevent objects from being unintentionally nudged if the pointer is moved whilst clicking.`,experimental:!0,type:"slider",attrs:{min:0,max:20,step:1},defaultValue:6,versionAdded:"1.4.3"},{id:"Comfy.Pointer.ClickBufferTime",category:["LiteGraph","Pointer","ClickBufferTime"],name:"Pointer click drift delay",tooltip:`After pressing a pointer button down, this is the maximum time (in milliseconds) that pointer movement can be ignored for.

Helps prevent objects from being unintentionally nudged if the pointer is moved whilst clicking.`,experimental:!0,type:"slider",attrs:{min:0,max:1e3,step:25},defaultValue:150,versionAdded:"1.4.3"},{id:"Comfy.Pointer.DoubleClickTime",category:["LiteGraph","Pointer","DoubleClickTime"],name:"Double click interval (maximum)",tooltip:"The maximum time in milliseconds between the two clicks of a double-click.  Increasing this value may assist if double-clicks are sometimes not registered.",type:"slider",attrs:{min:100,max:1e3,step:50},defaultValue:300,versionAdded:"1.4.3"},{id:"Comfy.SnapToGrid.GridSize",category:["LiteGraph","Canvas","GridSize"],name:"Snap to grid size",type:"slider",attrs:{min:1,max:500},tooltip:"When dragging and resizing nodes while holding shift they will be aligned to the grid, this controls the size of that grid.",defaultValue:ge.CANVAS_GRID_SIZE},{id:"pysssss.SnapToGrid",category:["LiteGraph","Canvas","AlwaysSnapToGrid"],name:"Always snap to grid",type:"boolean",defaultValue:!1,versionAdded:"1.3.13"},{id:"Comfy.Server.ServerConfigValues",name:"Server config values for frontend display",tooltip:"Server config values used for frontend display only",type:"hidden",defaultValue:{},versionAdded:"1.4.8"},{id:"Comfy.Server.LaunchArgs",name:"Server launch arguments",tooltip:"These are the actual arguments that are passed to the server when it is launched.",type:"hidden",defaultValue:{},versionAdded:"1.4.8"},{id:"Comfy.Queue.MaxHistoryItems",name:"Queue history size",tooltip:"The maximum number of tasks that show in the queue history.",type:"slider",attrs:{min:2,max:256,step:2},defaultValue:64,versionAdded:"1.4.12"},{id:"Comfy.Queue.History.Expanded",name:"Queue history expanded",type:"hidden",defaultValue:!1,versionAdded:"1.37.0"},{id:"Comfy.Execution.PreviewMethod",category:["Comfy","Execution","PreviewMethod"],name:"Live preview method",tooltip:'Live preview method during image generation. "default" uses the server CLI setting.',type:"combo",options:["default","none","auto","latent2rgb","taesd"],defaultValue:"default",versionAdded:"1.36.0"},{id:"LiteGraph.Canvas.MaximumFps",name:"Maximum FPS",tooltip:"The maximum frames per second that the canvas is allowed to render. Caps GPU usage at the cost of smoothness. If 0, the screen refresh rate is used. Default: 0",type:"slider",attrs:{min:0,max:120},defaultValue:0,versionAdded:"1.5.1"},{id:"Comfy.EnableWorkflowViewRestore",category:["Comfy","Workflow","EnableWorkflowViewRestore"],name:"Save and restore canvas position and zoom level in workflows",type:"boolean",defaultValue:!0,versionModified:"1.5.4"},{id:"Comfy.Workflow.ConfirmDelete",name:"Show confirmation when deleting workflows",type:"boolean",defaultValue:!0,versionAdded:"1.5.6"},{id:"Comfy.ColorPalette",name:"The active color palette id",type:"hidden",defaultValue:"dark",versionModified:"1.6.7",migrateDeprecatedValue(e){return e.startsWith("custom_")?e.replace("custom_",""):e}},{id:"Comfy.CustomColorPalettes",name:"Custom color palettes",type:"hidden",defaultValue:{},versionModified:"1.6.7"},{id:"Comfy.WidgetControlMode",category:["Comfy","Node Widget","WidgetControlMode"],name:"Widget control mode",tooltip:"Controls when widget values are updated (randomize/increment/decrement), either before the prompt is queued or after.",type:"combo",defaultValue:"after",options:["before","after"],versionModified:"1.6.10"},{id:"Comfy.TutorialCompleted",name:"Tutorial completed",type:"hidden",defaultValue:!1,versionAdded:"1.8.7"},{id:"Comfy.InstalledVersion",name:"The frontend version that was running when the user first installed ComfyUI",type:"hidden",defaultValue:null,versionAdded:"1.24.0"},{id:"LiteGraph.ContextMenu.Scaling",name:"Scale node combo widget menus (lists) when zoomed in",defaultValue:!1,type:"boolean",versionAdded:"1.8.8"},{id:"LiteGraph.Canvas.LowQualityRenderingZoomThreshold",type:"hidden",deprecated:!0,name:"Low quality rendering zoom threshold (deprecated)",tooltip:"Zoom level threshold for performance mode. Lower values (0.1) = quality at all zoom levels. Higher values (1.0) = performance mode even when zoomed in. Performance mode simplifies rendering by hiding text labels, shadows, and details.",attrs:{min:.1,max:1,step:.01},defaultValue:.6,versionAdded:"1.9.1",versionModified:"1.26.7"},{id:"LiteGraph.Canvas.MinFontSizeForLOD",name:"Zoom Node Level of Detail - font size threshold",tooltip:"Controls when the nodes switch to low quality LOD rendering. Uses font size in pixels to determine when to switch. Set to 0 to disable. Values 1-24 set the minimum font size threshold for LOD - higher values (24px) = switch nodes to simplified rendering sooner when zooming out, lower values (1px) = maintain full node quality longer.",type:"slider",attrs:{min:0,max:24,step:1},defaultValue:8,versionAdded:"1.26.7",hideInVueNodes:!0},{id:"Comfy.Canvas.SelectionToolbox",category:["LiteGraph","Canvas","SelectionToolbox"],name:"Show selection toolbox",type:"boolean",defaultValue:!0,versionAdded:"1.10.5"},{id:"LiteGraph.Reroute.SplineOffset",name:"Reroute spline offset",tooltip:"The bezier control point offset from the reroute centre point",type:"slider",defaultValue:20,attrs:{min:0,max:400},versionAdded:"1.15.7"},{id:"Comfy.Toast.DisableReconnectingToast",name:"Disable toasts when reconnecting or reconnected",type:"hidden",defaultValue:!1,versionAdded:"1.15.12"},{id:"Comfy.Minimap.Visible",name:"Display minimap on canvas",type:"hidden",defaultValue:window.innerWidth>=en.lg,versionAdded:"1.25.0"},{id:"Comfy.Minimap.NodeColors",name:"Display node with its original color on minimap",type:"hidden",defaultValue:!1,versionAdded:"1.26.0"},{id:"Comfy.Minimap.ShowLinks",name:"Display links on minimap",type:"hidden",defaultValue:!0,versionAdded:"1.26.0"},{id:"Comfy.Minimap.ShowGroups",name:"Display node groups on minimap",type:"hidden",defaultValue:!0,versionAdded:"1.26.0"},{id:"Comfy.Minimap.RenderBypassState",name:"Render bypass state on minimap",type:"hidden",defaultValue:!0,versionAdded:"1.26.0"},{id:"Comfy.Minimap.RenderErrorState",name:"Render error state on minimap",type:"hidden",defaultValue:!0,versionAdded:"1.26.0"},{id:"Comfy.Workflow.AutoSaveDelay",name:"Auto Save Delay (ms)",defaultValue:1e3,type:"number",tooltip:'Only applies if Auto Save is set to "after delay".',versionAdded:"1.16.0"},{id:"Comfy.Workflow.AutoSave",name:"Auto Save",type:"combo",options:["off","after delay"],defaultValue:"off",versionAdded:"1.16.0"},{id:"Comfy.Workflow.Persist",name:"Persist workflow state and restore on page (re)load",type:"boolean",defaultValue:!0,versionAdded:"1.16.1"},{id:"LiteGraph.Node.DefaultPadding",name:"Always shrink new nodes",tooltip:"Resize nodes to the smallest possible size when created. When disabled, a newly added node will be widened slightly to show widget values.",type:"boolean",defaultValue:!1,versionAdded:"1.18.0"},{id:"Comfy.Canvas.BackgroundImage",category:["Appearance","Canvas","Background"],name:"Canvas background image",type:"backgroundImage",tooltip:'Image URL for the canvas background. You can right-click an image in the outputs panel and select "Set as Background" to use it, or upload your own image using the upload button.',defaultValue:"",versionAdded:"1.20.4",versionModified:"1.20.5"},{id:"Comfy.Release.Version",name:"Last seen release version",type:"hidden",defaultValue:""},{id:"Comfy.Release.Status",name:"Release status",type:"hidden",defaultValue:"skipped"},{id:"Comfy.Release.Timestamp",name:"Release seen timestamp",type:"hidden",defaultValue:0},{id:"Comfy.Templates.SelectedModels",name:"Template library - Selected model filters",type:"hidden",defaultValue:[]},{id:"Comfy.Templates.SelectedUseCases",name:"Template library - Selected use case filters",type:"hidden",defaultValue:[]},{id:"Comfy.Templates.SelectedRunsOn",name:"Template library - Selected runs on filters",type:"hidden",defaultValue:[]},{id:"Comfy.Templates.SortBy",name:"Template library - Sort preference",type:"hidden",defaultValue:"default"},{id:"Comfy.VueNodes.Enabled",category:["Comfy","Nodes 2.0","VueNodesEnabled"],name:"Modern Node Design (Nodes 2.0)",type:"boolean",tooltip:"Modern: DOM-based rendering with enhanced interactivity, native browser features, and updated visual design. Classic: Traditional canvas rendering.",defaultValue:!1,sortOrder:100,experimental:!0,versionAdded:"1.27.1"},{id:"Comfy.VueNodes.AutoScaleLayout",category:["Comfy","Nodes 2.0","AutoScaleLayout"],name:"Auto-scale layout (Nodes 2.0)",tooltip:"Automatically scale node positions when switching to Nodes 2.0 rendering to prevent overlap",type:"boolean",sortOrder:50,experimental:!0,defaultValue:!0,versionAdded:"1.30.3"},{id:"Comfy.Assets.UseAssetAPI",name:"Use Asset API for model library",type:"hidden",tooltip:"Use new Asset API for model browsing",defaultValue:!1,experimental:!0},{id:"Comfy.VersionCompatibility.DisableWarnings",name:"Disable version compatibility warnings",type:"hidden",defaultValue:!1,versionAdded:"1.34.1"},{id:"Comfy.Queue.QPOV2",name:"Queue Panel V2",type:"hidden",tooltip:"Enable the new Assets Panel design with list/grid view toggle",defaultValue:!1,experimental:!0}];function Pw(){const e=Oe(),o=re(),t=tt(),s=b(()=>o.get("Comfy.Workflow.AutoSave")),l=b(()=>o.get("Comfy.Workflow.AutoSaveDelay"));let a=null,i=!1,r=!1;const u=n(()=>{if(a&&(clearTimeout(a),a=null),s.value==="after delay"){if(i){r=!0;return}const g=l.value;a=setTimeout(async()=>{const v=e.activeWorkflow;if(v?.isModified&&v.isPersisted)try{i=!0,await t.saveWorkflow(v)}catch(f){console.error("Auto save failed:",f)}finally{i=!1,r&&(r=!1,u())}},g)}},"scheduleAutoSave");se(s,g=>{a&&(clearTimeout(a),a=null),g==="after delay"&&e.activeWorkflow?.isModified&&u()},{immediate:!0});const p=n(()=>{u()},"onGraphChanged");Te.addEventListener("graphChanged",p),yt(()=>{a&&(clearTimeout(a),a=null),Te.removeEventListener("graphChanged",p)})}n(Pw,"useWorkflowAutoSave");function Dw(){const e=La(),o=Ea(),{t}=pe(),s=zt(),l=kl(),a=he(),i=sl.TEMPLATE,r=["linear"],u=n(f=>/^[a-zA-Z0-9_.-]+$/.test(f),"isValidParameter"),p=n(f=>r.includes(f),"isSupportedMode"),g=n(()=>{const f={...e.query};delete f.template,delete f.source,delete f.mode,o.replace({query:f})},"cleanupUrlParams");return{loadTemplateFromUrl:n(async()=>{const f=e.query.template;if(!f||typeof f!="string")return;if(!u(f)){console.warn(`[useTemplateUrlLoader] Invalid template parameter format: ${f}`);return}const k=e.query.source||"default";if(!u(k)){console.warn(`[useTemplateUrlLoader] Invalid source parameter format: ${k}`);return}const w=e.query.mode;if(w&&(typeof w!="string"||!u(w))){console.warn(`[useTemplateUrlLoader] Invalid mode parameter format: ${w}`);return}w&&!p(w)&&console.warn(`[useTemplateUrlLoader] Unsupported mode parameter: ${w}. Supported modes: ${r.join(", ")}`);try{await l.loadTemplates(),await l.loadWorkflowTemplate(f,k)?w==="linear"&&(a.linearMode=!0):s.add({severity:"error",summary:t("g.error"),detail:t("templateWorkflows.error.templateNotFound",{templateName:f}),life:3e3})}catch(h){console.error("[useTemplateUrlLoader] Failed to load template from URL:",h),s.add({severity:"error",summary:t("g.error"),detail:t("g.errorLoadingTemplate"),life:3e3})}finally{g(),Er(i)}},"loadTemplateFromUrl")}}n(Dw,"useTemplateUrlLoader");function Aw(){const e=Oe(),o=re(),t=La(),s=Ea(),l=Dw(),a=sl.TEMPLATE,i=n(async()=>{Vr(a);const I=Rr(a,t.query);return I&&await s.replace({query:I}),I??t.query},"ensureTemplateQueryFromIntent"),r=b(()=>o.get("Comfy.Workflow.Persist")),u=n(()=>{if(!r.value)return;const I=JSON.stringify(J.rootGraph.serialize());try{localStorage.setItem("workflow",I),Te.clientId&&sessionStorage.setItem(`workflow:${Te.clientId}`,I)}catch(_){const S=Object.keys(sessionStorage).filter(T=>T.startsWith("workflow:")||T==="workflow");throw console.error("QuotaExceededError details:",{workflowSizeKB:Math.round(I.length/1024),totalStorageItems:Object.keys(sessionStorage).length,ourWorkflowKeys:S.length,ourWorkflowSizes:S.map(T=>({key:T,sizeKB:Math.round(sessionStorage[T].length/1024)})),error:_ instanceof Error?_.message:String(_)}),_}},"persistCurrentWorkflow"),p=n(async(I,_)=>{if(!I)return!1;const S=JSON.parse(I);return await J.loadGraphData(S,!0,!0,_),!0},"loadWorkflowFromStorage"),g=n(async()=>{const I=pn("Comfy.PreviousWorkflow"),_=Te.initialClientId??Te.clientId;if(_){const T=sessionStorage.getItem(`workflow:${_}`);if(await p(T,I))return!0}const S=localStorage.getItem("workflow");return await p(S,I)},"loadPreviousWorkflowFromStorage"),v=n(async()=>{o.get("Comfy.TutorialCompleted")?await J.loadGraphData():(await o.set("Comfy.TutorialCompleted",!0),await tt().loadBlankWorkflow(),await Se().execute("Comfy.BrowseTemplates"))},"loadDefaultWorkflow"),f=n(async()=>{if(r.value)try{await g()||await v()}catch(I){console.error("Error loading previous workflow",I),await v()}},"initializeWorkflow"),k=n(async()=>{const I=await i();I.template&&typeof I.template=="string"&&await l.loadTemplateFromUrl()},"loadTemplateFromUrlIfPresent");se(()=>e.activeWorkflow?.key,I=>{I&&(fn("Comfy.PreviousWorkflow",I),u())}),Te.addEventListener("graphChanged",u),Pa(()=>{Te.removeEventListener("graphChanged",u)});const w=b(()=>e.openWorkflows),h=b(()=>e.activeWorkflow),C=b(()=>{if(!w.value||!h.value)return{paths:[],activeIndex:-1};const I=w.value.filter(S=>S?.isPersisted).map(S=>S.path),_=w.value.findIndex(S=>S.path===h.value?.path);return{paths:I,activeIndex:_}}),y=JSON.parse(pn("Comfy.OpenWorkflowsPaths")||"[]"),N=JSON.parse(pn("Comfy.ActiveWorkflowIndex")||"-1");return se(C,({paths:I,activeIndex:_})=>{r.value&&(fn("Comfy.OpenWorkflowsPaths",JSON.stringify(I)),fn("Comfy.ActiveWorkflowIndex",JSON.stringify(_)))}),{initializeWorkflow:f,loadTemplateFromUrlIfPresent:k,restoreWorkflowTabsState:n(()=>{if(!r.value)return;y?.length>0&&N>=0&&e.openWorkflowsInBackground({left:y.slice(0,N),right:y.slice(N)})},"restoreWorkflowTabsState")}}n(Aw,"useWorkflowPersistence");function Lw(e,o={}){const{settleDelay:t=256,passive:s=!0}=o,l=L(!1),a=n(()=>{l.value=!0},"markTransformActive"),i=Yl(()=>{l.value=!1},t);return Re(e,"wheel",n(()=>{a(),i()},"handleWheel"),{capture:!0,passive:s}),{isTransforming:l}}n(Lw,"useTransformSettling");function Ew(){const e=Ia({x:0,y:0,z:1}),o=b(()=>({transform:`scale(${e.z}) translate(${e.x}px, ${e.y}px)`,transformOrigin:"0 0"}));function t(f){!f||!f.ds||(e.x=f.ds.offset[0],e.y=f.ds.offset[1],e.z=f.ds.scale||1)}n(t,"syncWithCanvas");function s(f){return{x:(f.x+e.x)*e.z,y:(f.y+e.y)*e.z}}n(s,"canvasToScreen");const l=n(f=>({x:f.x/e.z-e.x,y:f.y/e.z-e.y}),"screenToCanvas");function a(f,k){const w=s({x:f[0],y:f[1]}),h=k[0]*e.z,C=k[1]*e.z;return new DOMRect(w.x,w.y,h,C)}n(a,"getNodeScreenBounds");function i(f){return e.z<.1?Math.min(f*5,2):e.z>3?Math.max(f*.5,.05):f}n(i,"calculateAdjustedMargin");function r(f){return Math.max(f[0],f[1])*e.z<4}n(r,"isNodeTooSmall");function u(f,k){const w=f.width*k,h=f.height*k;return{left:-w,right:f.width+w,top:-h,bottom:f.height+h}}n(u,"getExpandedViewportBounds");function p(f,k,w){const h=f.x+k[0]*e.z,C=f.y+k[1]*e.z;return!(h<w.left||f.x>w.right||C<w.top||f.y>w.bottom)}n(p,"testViewportIntersection");function g(f,k,w,h=.2){if(r(k))return!1;const C=s({x:f[0],y:f[1]}),y=i(h),N=u(w,y);return p(C,k,N)}n(g,"isNodeInViewport");function v(f,k=.2){const w=f.width*k,h=f.height*k,C=l({x:-w,y:-h}),y=l({x:f.width+w,y:f.height+h});return{x:C.x,y:C.y,width:y.x-C.x,height:y.y-C.y}}return n(v,"getViewportBounds"),{camera:$n(e),transformStyle:o,syncWithCanvas:t,canvasToScreen:s,screenToCanvas:l,getNodeScreenBounds:a,isNodeInViewport:g,getViewportBounds:v}}n(Ew,"useTransformStateIndividual");const _s=nn(Ew),Vw=q({__name:"TransformPane",props:{canvas:{}},setup(e){const o=e,{transformStyle:t,syncWithCanvas:s}=_s(),l=b(()=>o.canvas?.canvas),{isTransforming:a}=Lw(l,{settleDelay:16});return lo(()=>{o.canvas&&s(o.canvas)},{immediate:!0}),(i,r)=>(d(),$("div",{"data-testid":"transform-pane",class:K(m(ne)("absolute inset-0 w-full h-full pointer-events-none",m(a)?"transform-pane--interacting":"will-change-auto")),style:ve(m(t))},[ye(i.$slots,"default",{},void 0,!0)],6))}}),Rw=Le(Vw,[["__scopeId","data-v-4d46eee6"]]),Ow={class:"flex items-center gap-2"},Ww={for:"node-colors"},zw={class:"flex items-center gap-2"},Bw={for:"show-links"},Fw={class:"flex items-center gap-2"},Uw={for:"show-groups"},Gw={class:"flex items-center gap-2"},Hw={for:"render-bypass"},jw={class:"flex items-center gap-2"},qw={for:"render-error"},Kw=q({__name:"MiniMapPanel",props:{panelStyles:{},nodeColors:{type:Boolean},showLinks:{type:Boolean},showGroups:{type:Boolean},renderBypass:{type:Boolean},renderError:{type:Boolean}},emits:["updateOption"],setup(e){return(o,t)=>(d(),$("div",{class:"minimap-panel mr-2 flex flex-col gap-2 bg-comfy-menu-bg p-3 text-sm shadow-interface",style:ve(o.panelStyles)},[c("div",Ow,[R(m(go),{"input-id":"node-colors",name:"node-colors","model-value":o.nodeColors,binary:"","onUpdate:modelValue":t[0]||(t[0]=s=>o.$emit("updateOption","Comfy.Minimap.NodeColors",s))},null,8,["model-value"]),t[5]||(t[5]=c("i",{class:"icon-[lucide--palette]"},null,-1)),c("label",Ww,V(o.$t("minimap.nodeColors")),1)]),c("div",zw,[R(m(go),{"input-id":"show-links",name:"show-links","model-value":o.showLinks,binary:"","onUpdate:modelValue":t[1]||(t[1]=s=>o.$emit("updateOption","Comfy.Minimap.ShowLinks",s))},null,8,["model-value"]),t[6]||(t[6]=c("i",{class:"icon-[lucide--route]"},null,-1)),c("label",Bw,V(o.$t("minimap.showLinks")),1)]),c("div",Fw,[R(m(go),{"input-id":"show-groups",name:"show-groups","model-value":o.showGroups,binary:"","onUpdate:modelValue":t[2]||(t[2]=s=>o.$emit("updateOption","Comfy.Minimap.ShowGroups",s))},null,8,["model-value"]),t[7]||(t[7]=c("i",{class:"icon-[lucide--frame]"},null,-1)),c("label",Uw,V(o.$t("minimap.showGroups")),1)]),c("div",Gw,[R(m(go),{"input-id":"render-bypass",name:"render-bypass","model-value":o.renderBypass,binary:"","onUpdate:modelValue":t[3]||(t[3]=s=>o.$emit("updateOption","Comfy.Minimap.RenderBypassState",s))},null,8,["model-value"]),t[8]||(t[8]=c("i",{class:"icon-[lucide--circle-slash-2]"},null,-1)),c("label",Hw,V(o.$t("minimap.renderBypassState")),1)]),c("div",jw,[R(m(go),{"input-id":"render-error",name:"render-error","model-value":o.renderError,binary:"","onUpdate:modelValue":t[4]||(t[4]=s=>o.$emit("updateOption","Comfy.Minimap.RenderErrorState",s))},null,8,["model-value"]),t[9]||(t[9]=c("i",{class:"icon-[lucide--message-circle-warning]"},null,-1)),c("label",qw,V(o.$t("minimap.renderErrorState")),1)])],4))}}),Qw=["width","height"],Yw=q({__name:"MiniMap",setup(e){const o=Se(),t=L(),s=_n("containerRef"),l=_n("canvasRef"),{initialized:a,visible:i,containerStyles:r,viewportStyles:u,width:p,height:g,panelStyles:v,nodeColors:f,showLinks:k,showGroups:w,renderBypass:h,renderError:C,updateOption:y,destroy:N,handlePointerDown:x,handlePointerMove:I,handlePointerUp:_,handlePointerCancel:S,handleWheel:T,setMinimapRef:M}=gs({containerRefMaybe:s,canvasRefMaybe:l}),P=L(!1),B=n(()=>{P.value=!P.value},"toggleOptionsPanel");return ze(()=>{t.value&&M(t.value)}),yt(()=>{N()}),(H,z)=>m(i)&&m(a)?(d(),$("div",{key:0,ref_key:"minimapRef",ref:t,class:"minimap-main-container absolute right-0 bottom-[54px] z-1000 flex"},[P.value?(d(),O(Kw,{key:0,"panel-styles":m(v),"node-colors":m(f),"show-links":m(k),"show-groups":m(w),"render-bypass":m(h),"render-error":m(C),onUpdateOption:m(y)},null,8,["panel-styles","node-colors","show-links","show-groups","render-bypass","render-error","onUpdateOption"])):E("",!0),c("div",{ref_key:"containerRef",ref:s,class:"litegraph-minimap relative border border-interface-stroke bg-comfy-menu-bg shadow-interface",style:ve(m(r))},[R(Z,{class:"absolute top-0 left-0 z-10",size:"icon",variant:"muted-textonly","aria-label":H.$t("g.settings"),onClick:Ce(B,["stop"])},{default:A(()=>z[7]||(z[7]=[c("i",{class:"icon-[lucide--settings-2]"},null,-1)])),_:1},8,["aria-label"]),R(Z,{class:"absolute top-0 right-0 z-10",size:"icon",variant:"muted-textonly","aria-label":H.$t("g.close"),"data-testid":"close-minmap-button",onClick:z[0]||(z[0]=Ce(()=>m(o).execute("Comfy.Canvas.ToggleMinimap"),["stop"]))},{default:A(()=>z[8]||(z[8]=[c("i",{class:"icon-[lucide--x]"},null,-1)])),_:1},8,["aria-label"]),c("hr",{class:"absolute top-6 h-px border-0 bg-node-component-border",style:ve({width:m(r).width})},null,4),c("canvas",{ref_key:"canvasRef",ref:l,width:m(p),height:m(g),class:"minimap-canvas"},null,8,Qw),c("div",{class:"minimap-viewport",style:ve(m(u))},null,4),c("div",{class:"absolute inset-0 touch-none",onPointerdown:z[1]||(z[1]=(...G)=>m(x)&&m(x)(...G)),onPointermove:z[2]||(z[2]=(...G)=>m(I)&&m(I)(...G)),onPointerup:z[3]||(z[3]=(...G)=>m(_)&&m(_)(...G)),onPointerleave:z[4]||(z[4]=(...G)=>m(_)&&m(_)(...G)),onPointercancel:z[5]||(z[5]=(...G)=>m(S)&&m(S)(...G)),onWheel:z[6]||(z[6]=(...G)=>m(T)&&m(T)(...G))},null,32)],4)],512)):E("",!0)}}),Jw=Le(Yw,[["__scopeId","data-v-66f11255"]]);function Rn(e){return e.ctrlKey||e.metaKey||e.shiftKey}n(Rn,"isMultiSelectKey");function Xw(){const e=he(),{nodeManager:o}=ks(),{bringNodeToFront:t}=al(),{shouldHandleNodePointerEvents:s}=co();function l(p,g){if(!s.value||!e.canvas||!o.value)return;const v=o.value.getNode(g);if(!v)return;const f=Rn(p),k=e.selectedItems.length,w=!f&&v.selected&&k>1;f?v.selected||e.canvas.select(v):w||(e.canvas.deselectAll(),e.canvas.select(v)),v.flags?.pinned||t(g),e.updateSelectedItems()}n(l,"handleNodeSelect");function a(p,g){if(!s.value||!o.value)return;const v=o.value.getNode(p);if(!v)return;(v.flags?.collapsed??!1)!==g&&v.collapse()}n(a,"handleNodeCollapse");function i(p,g){if(!s.value||!o.value)return;const v=o.value.getNode(p);v&&(v.title=g)}n(i,"handleNodeTitleUpdate");function r(p,g){if(!s.value||!e.canvas||!o.value)return;const v=o.value.getNode(g);v&&(p.preventDefault(),v.selected||l(p,g))}n(r,"handleNodeRightClick");function u(p,g){if(!s.value||!e.canvas||!o.value)return;const v=o.value.getNode(p);if(v){if(!g){e.canvas.deselectAll(),e.canvas.select(v),e.updateSelectedItems(),v.flags?.pinned||t(p);return}v.selected?e.canvas.deselect(v):(e.canvas.select(v),v.flags?.pinned||t(p)),e.updateSelectedItems()}}return n(u,"toggleNodeSelectionAfterPointerUp"),{handleNodeSelect:l,handleNodeCollapse:a,handleNodeTitleUpdate:i,handleNodeRightClick:r,toggleNodeSelectionAfterPointerUp:u}}n(Xw,"useNodeEventHandlersIndividual");const _l=nn(Xw);function Tl(){const e=re(),o=b(()=>e.get("Comfy.SnapToGrid.GridSize")),t=b(()=>e.get("pysssss.SnapToGrid"));function s(i){return i.shiftKey||t.value}n(s,"shouldSnap");function l(i){const r=o.value;if(!r)return{...i};const u=[i.x,i.y];return zs(u,r)?{x:u[0],y:u[1]}:{...i}}n(l,"applySnapToPosition");function a(i){const r=o.value;if(!r)return{...i};const u=[i.width,i.height];return zs(u,r)?{width:u[0],height:u[1]}:{...i}}return n(a,"applySnapToSize"),{gridSize:o,alwaysSnap:t,shouldSnap:s,applySnapToPosition:l,applySnapToSize:a}}n(Tl,"useNodeSnap");function $l(){const e=Ze(!1);let o=null;function t(l){l!==e.value&&(!o&&(o=J.canvas?.canvas??null,!o)||(e.value=l,o.dispatchEvent(new KeyboardEvent(l?"keydown":"keyup",{key:"Shift",shiftKey:l,bubbles:!0}))))}n(t,"syncShiftState");function s(l){t(l.shiftKey);const a=n(u=>{u.key==="Shift"&&t(u.shiftKey)},"handleKeyEvent"),i=Re(window,"keydown",a,{passive:!0}),r=Re(window,"keyup",a,{passive:!0});return()=>{i(),r()}}return n(s,"trackShiftKey"),Pa(()=>{e.value=!1,o=null}),{trackShiftKey:s}}n($l,"useShiftKeySync");const Nl=nn(Zw);function Zw(){const e=ln(),{selectedNodeIds:o,selectedItems:t}=qe(he()),s=_s(),{shouldSnap:l,applySnapToPosition:a}=Tl(),{trackShiftKey:i}=$l();let r=null,u=null,p=null,g=null,v=null,f=null,k=null;function w(y,N){const x=je(Pe.getNodeLayoutRef(N));if(!x)return;const I=x.position??{x:0,y:0};v=i(y),r={...I},u={x:y.clientX,y:y.clientY};const _=je(o),S=_?.has(N);if(S&&_.size>1){p=new Map;for(const T of _){if(T===N)continue;const M=Pe.getNodeLayoutRef(T).value;M&&p.set(T,{...M.position})}}else p=null;S?(k=je(t).filter(ss),f={x:0,y:0}):(k=null,f=null),e.setSource(Co.Vue)}n(w,"startDrag");function h(y,N){if(!r||!u||g!==null)return;const{target:x,pointerId:I}=y;x instanceof HTMLElement&&!x.hasPointerCapture(I)&&x.setPointerCapture(I),g=requestAnimationFrame(()=>{if(g=null,!r||!u)return;const _={x:y.clientX-u.x,y:y.clientY-u.y},S=s.screenToCanvas({x:0,y:0}),T=s.screenToCanvas(_),M={x:T.x-S.x,y:T.y-S.y},P={x:r.x+M.x,y:r.y+M.y};if(e.moveNode(N,P),p&&p.size>0)for(const[B,H]of p){const z={x:H.x+M.x,y:H.y+M.y};e.moveNode(B,z)}if(k&&k.length>0&&f){const B={x:M.x-f.x,y:M.y-f.y};for(const H of k)H.move(B.x,B.y,!0)}f=M})}n(h,"handleDrag");function C(y,N){if(l(y)&&N){const x=[],I=je(Pe.getNodeLayoutRef(N));if(I){const _=I.position,S=a({..._});(S.x!==_.x||S.y!==_.y)&&x.push({nodeId:N,bounds:{x:S.x,y:S.y,width:I.size.width,height:I.size.height}})}if(p&&p.size>0)for(const _ of p.keys()){const S=Pe.getNodeLayoutRef(_).value;if(S){const T={...S.position},M=a(T);(M.x!==T.x||M.y!==T.y)&&x.push({nodeId:_,bounds:{x:M.x,y:M.y,width:S.size.width,height:S.size.height}})}}x.length>0&&Pe.batchUpdateNodeBounds(x)}r=null,u=null,p=null,k=null,f=null,v?.(),v=null,g!==null&&(cancelAnimationFrame(g),g=null)}return n(C,"endDrag"),{startDrag:w,handleDrag:h,endDrag:C}}n(Zw,"useNodeDragIndividual");function e0(e){const{startDrag:o,endDrag:t,handleDrag:s}=Nl(),{forwardEventToCanvas:l,shouldHandleNodePointerEvents:a}=co(),{handleNodeSelect:i,toggleNodeSelectionAfterPointerUp:r}=_l(),{nodeManager:u}=ks(),p=n(S=>Or(S)?(l(S),!0):!1,"forwardMiddlePointerIfNeeded");let g=!1;const v=L({x:0,y:0}),f=3;function k(S){if(p(S)||S.button!==0)return;if(!a.value){l(S);return}const T=je(e);if(!T){console.warn("LGraphNode: nodeData is null/undefined in handlePointerDown");return}u.value?.getNode(T)?.flags?.pinned||(v.value={x:S.clientX,y:S.clientY},C(S,T))}n(k,"onPointerdown");function w(S){if(p(S)||Pe.isResizingVueNodes.value)return;const T=je(e);if(u.value?.getNode(T)?.flags?.pinned)return;const M=Rn(S),P=S.buttons&1;if(P&&M&&!Pe.isDraggingVueNodes.value){Pe.isDraggingVueNodes.value=!0,i(S,T),C(S,T);return}if(P&&!Pe.isDraggingVueNodes.value){const B=S.clientX-v.value.x,H=S.clientY-v.value.y;Math.sqrt(B*B+H*H)>f&&(Pe.isDraggingVueNodes.value=!0,i(S,T))}Pe.isDraggingVueNodes.value&&s(S,T)}n(w,"onPointermove");function h(){Pe.isDraggingVueNodes.value=!1}n(h,"cleanupDragState");function C(S,T){try{o(S,T)}finally{g=!0}}n(C,"safeDragStart");function y(S){try{const T=je(e);t(S,T)}catch(T){console.error("Error during endDrag:",T)}finally{g=!1,h()}}n(y,"safeDragEnd");function N(S){if(p(S))return;if(!a.value){l(S);return}const M=Pe.isDraggingVueNodes.value;if((g||M)&&(y(S),M)||S.button===2)return;const P=Rn(S),B=je(e);B&&r(B,P)}n(N,"onPointerup");function x(S){Pe.isDraggingVueNodes.value&&y(S)}n(x,"onPointercancel");function I(S){Pe.isDraggingVueNodes.value&&(S.preventDefault(),h())}return n(I,"onContextmenu"),Jl(()=>{h()}),{pointerHandlers:{onPointerdown:k,onPointermove:w,onPointerup:N,onPointercancel:x,onContextmenu:I}}}n(e0,"useNodePointerInteractions");const Yo=new Map([["node",{dataAttribute:"nodeId",updateHandler:n(e=>{const o=e.map(({id:t,bounds:s})=>({nodeId:t,bounds:s}));Pe.batchUpdateNodeBounds(o)},"updateHandler")}]]),fa=new ResizeObserver(e=>{if(he().linearMode)return;const o=nl(),t=new Map,s=new Set;for(const l of e){if(!(l.target instanceof HTMLElement))continue;const a=l.target;let i,r;for(const[y,N]of Yo){const x=a.dataset[N.dataAttribute];if(x){i=y,r=x;break}}if(!i||!r)continue;const u=Array.isArray(l.borderBoxSize)?l.borderBoxSize[0]:{inlineSize:l.contentRect.width,blockSize:l.contentRect.height},p=u.inlineSize,g=u.blockSize,v=a.getBoundingClientRect(),[f,k]=o.clientPosToCanvasPos([v.left,v.top]),w={x:f,y:k},h={x:w.x,y:w.y+ge.NODE_TITLE_HEIGHT,width:Math.max(0,p),height:Math.max(0,g)};let C=t.get(i);C||(C=[],t.set(i,C)),C.push({id:r,bounds:h}),i==="node"&&r&&s.add(r)}Pe.setSource(Co.DOM);for(const[l,a]of t){const i=Yo.get(l);i&&a.length&&i.updateHandler(a)}if(s.size>0)for(const l of s)Wr(l)});function t0(e,o){const t=je(e);ze(()=>{const s=Ms()?.proxy?.$el;if(!(s instanceof HTMLElement)||!t)return;const l=Yo.get(o);l&&(s.dataset[l.dataAttribute]=t,fa.observe(s))}),yt(()=>{const s=Ms()?.proxy?.$el;if(!(s instanceof HTMLElement))return;const l=Yo.get(o);l&&(delete s.dataset[l.dataAttribute],fa.unobserve(s))})}n(t0,"useVueElementTracking");const o0=n(e=>{const o=b(()=>je(e)??""),{nodeLocationProgressStates:t,isIdle:s}=qe(dt()),l=b(()=>{const p=o.value;return p?t.value[p]:void 0}),a=b(()=>!s.value&&l.value?.state==="running"),i=b(()=>{const p=l.value;return p&&p.max>0?p.value/p.max:void 0}),r=b(()=>{const p=i.value;return p!==void 0?Math.round(p*100):void 0}),u=b(()=>{const p=l.value;return p?p.state:"idle"});return{executing:a,progress:i,progressPercentage:r,progressState:l,executionState:u}},"useNodeExecutionState");function n0(e){const o=je(e),t=ln(),s=Pe.getNodeLayoutRef(o);yt(()=>{Pe.cleanupNodeRef(o)});const l=b(()=>s.value?.position??{x:0,y:0}),a=b(()=>s.value?.size??{width:200,height:100}),i=b(()=>s.value?.zIndex??0);function r(u){t.setSource(Co.Vue),t.moveNode(o,u)}return n(r,"moveNodeTo"),{position:l,size:a,zIndex:i,moveNodeTo:r}}n(n0,"useNodeLayout");const s0=n((e,o)=>{const t=je(e),s=Oe(),{nodePreviewImages:l}=qe($o()),a=b(()=>s.nodeIdToNodeLocatorId(t)),i=b(()=>{const g=a.value;if(!g)return;const v=l.value[g];return v?.length?v:void 0}),r=b(()=>!!i.value?.length),u=b(()=>{const g=i.value;return g?.length?g.at(-1):""}),p=b(()=>o?.isCollapsed?!o.isCollapsed.value&&r.value:r.value);return{locatorId:a,previewUrls:i,hasPreview:r,latestPreviewUrl:u,shouldShowPreviewImg:p}},"useNodePreviewState");function a0(e){const o=_s(),t=L(!1),s=L(null),l=L(null),{shouldSnap:a,applySnapToSize:i}=Tl(),{trackShiftKey:r}=$l();return{startResize:n(p=>{p.preventDefault(),p.stopPropagation();const g=p.currentTarget;if(!(g instanceof HTMLElement))return;const v=g.closest("[data-node-id]");if(!(v instanceof HTMLElement))return;const f=v.getBoundingClientRect(),k=o.camera.z,w={width:f.width/k,height:f.height/k},h=r(p);g.setPointerCapture(p.pointerId),Pe.isResizingVueNodes.value=!0,t.value=!0,s.value={x:p.clientX,y:p.clientY},l.value=w;const C=n(I=>{if(!t.value||!s.value||!l.value)return;const _=o.camera.z,S=(I.clientX-s.value.x)/(_||1),T=(I.clientY-s.value.y)/(_||1);let M={width:l.value.width+S,height:l.value.height+T};a(I)&&(M=i(M));const P=g.closest("[data-node-id]");P instanceof HTMLElement&&e({size:M},P)},"handlePointerMove"),y=n(I=>{t.value&&(t.value=!1,Pe.isResizingVueNodes.value=!1,s.value=null,l.value=null,h(),g.releasePointerCapture(I.pointerId),N(),x())},"handlePointerUp"),N=Re("pointermove",C),x=Re("pointerup",y)},"startResize"),isResizing:t}}n(a0,"useNodeResize");const l0={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function i0(e,o){return d(),$("svg",l0,[...o[0]||(o[0]=[c("g",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"},[c("path",{d:"m2 2l20 20M10.41 10.41a2 2 0 1 1-2.83-2.83m5.92 5.92L6 21m12-9l3 3"}),c("path",{d:"M3.59 3.59A2 2 0 0 0 3 5v14a2 2 0 0 0 2 2h14c.55 0 1.052-.22 1.41-.59M21 15V5a2 2 0 0 0-2-2H9"})],-1)])])}n(i0,"render$1");const r0=Da({name:"lucide-image-off",render:i0}),u0={key:0,class:"flex h-full min-h-16 w-full min-w-16 flex-col"},c0={class:"relative h-88 w-full grow overflow-hidden rounded-[5px] bg-node-component-surface"},d0={key:0,class:"text-pure-white flex h-full w-full flex-col items-center justify-center text-center"},p0={class:"text-xs text-smoke-400"},f0=["src","alt"],m0={class:"text-node-component-header-text mt-1 text-center text-xs"},g0=q({__name:"LivePreview",props:{imageUrl:{}},setup(e){const o=e,t=L(null),s=L(!1);se(()=>o.imageUrl,()=>{t.value=null,s.value=!1});const l=n(i=>{if(!i.target||!(i.target instanceof HTMLImageElement))return;const r=i.target;s.value=!1,r.naturalWidth&&r.naturalHeight&&(t.value=`${r.naturalWidth} x ${r.naturalHeight}`)},"handleImageLoad"),a=n(()=>{s.value=!0,t.value=null},"handleImageError");return(i,r)=>{const u=r0;return i.imageUrl?(d(),$("div",u0,[c("div",c0,[s.value?(d(),$("div",d0,[R(u,{class:"mb-1 size-8 text-smoke-500"}),c("p",p0,V(i.$t("g.imageFailedToLoad")),1)])):(d(),$("img",{key:1,src:i.imageUrl,alt:i.$t("g.liveSamplingPreview"),class:"pointer-events-none h-full w-full object-contain object-center",onLoad:l,onError:a},null,40,f0))]),c("div",m0,V(s.value?i.$t("g.errorLoadingImage"):t.value||i.$t("g.calculatingDimensions")),1)])):E("",!0)}}}),v0=["aria-label","aria-busy"],h0={key:0,role:"alert",class:"flex size-full flex-col items-center justify-center bg-muted-background text-center text-base-foreground py-8"},y0={class:"text-sm text-base-foreground"},b0={class:"mt-1 text-xs text-base-foreground"},w0=["src"],k0={key:3,class:"actions absolute top-2 right-2 flex gap-2.5"},C0=["title","aria-label"],x0=["title","aria-label"],S0={key:4,class:"absolute right-2 bottom-2 left-2 flex justify-center gap-1"},_0=["aria-label","onClick"],T0={class:"mt-2 text-center text-xs text-muted-foreground"},$0={key:0,class:"text-red-400"},N0={key:1,class:"text-smoke-400"},I0={key:2},ma="flex h-8 min-h-8 items-center justify-center gap-2.5 rounded-lg border-0 bg-button-surface px-2 py-2 text-button-surface-contrast shadow-sm transition-colors duration-200 hover:bg-button-hover-surface focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-button-surface-contrast focus-visible:ring-offset-2 focus-visible:ring-offset-transparent cursor-pointer",M0=q({__name:"VideoPreview",props:{imageUrls:{},nodeId:{}},setup(e){const o=e,{t}=pe(),s=$o(),l=L(0),a=L(!1),i=L(!1),r=L(null),u=L(!1),p=L(!1),g=L(),v=b(()=>o.imageUrls[l.value]),f=b(()=>o.imageUrls.length>1);se(()=>o.imageUrls,P=>{l.value>=P.length&&(l.value=0),r.value=null,u.value=!1,p.value=P.length>0},{deep:!0,immediate:!0});const k=n(P=>{if(!P.target||!(P.target instanceof HTMLVideoElement))return;const B=P.target;p.value=!1,u.value=!1,B.videoWidth&&B.videoHeight&&(r.value=`${B.videoWidth} x ${B.videoHeight}`)},"handleVideoLoad"),w=n(()=>{p.value=!1,u.value=!0,r.value=null},"handleVideoError"),h=n(()=>{try{as(v.value)}catch{zt().add({severity:"error",summary:"Error",detail:t("g.failedToDownloadVideo"),life:3e3,group:"video-preview"})}},"handleDownload"),C=n(()=>{o.nodeId&&s.removeNodeOutputs(o.nodeId)},"handleRemove"),y=n(P=>{P>=0&&P<o.imageUrls.length&&(l.value=P,r.value=null,p.value=!0,u.value=!1)},"setCurrentIndex"),N=n(()=>{a.value=!0},"handleMouseEnter"),x=n(()=>{a.value=!1},"handleMouseLeave"),I=n(()=>{i.value=!0},"handleFocusIn"),_=n(P=>{g.value?.contains(P.relatedTarget)||(i.value=!1)},"handleFocusOut"),S=n(P=>["w-2 h-2 rounded-full transition-all duration-200 border-0 cursor-pointer",P===l.value?"bg-white":"bg-white/50 hover:bg-white/80"],"getNavigationDotClass"),T=n(P=>{if(!(o.imageUrls.length<=1))switch(P.key){case"ArrowLeft":P.preventDefault(),y(l.value>0?l.value-1:o.imageUrls.length-1);break;case"ArrowRight":P.preventDefault(),y(l.value<o.imageUrls.length-1?l.value+1:0);break;case"Home":P.preventDefault(),y(0);break;case"End":P.preventDefault(),y(o.imageUrls.length-1);break}},"handleKeyDown"),M=n(P=>{try{return new URL(P).searchParams.get("filename")||"Unknown file"}catch{return"Invalid URL"}},"getVideoFilename");return(P,B)=>P.imageUrls.length>0?(d(),$("div",{key:0,class:"video-preview group relative flex size-full min-h-16 min-w-16 flex-col px-2",onKeydown:T},[c("div",{ref_key:"videoWrapperEl",ref:g,class:"relative h-full w-full grow overflow-hidden rounded-[5px] bg-node-component-surface",tabindex:"0",role:"region","aria-label":P.$t("g.videoPreview"),"aria-busy":p.value,onMouseenter:N,onMouseleave:x,onFocusin:I,onFocusout:_},[u.value?(d(),$("div",h0,[B[0]||(B[0]=c("i",{class:"mb-2 icon-[lucide--video-off] h-12 w-12 text-base-foreground"},null,-1)),c("p",y0,V(P.$t("g.videoFailedToLoad")),1),c("p",b0,V(M(v.value)),1)])):E("",!0),p.value&&!u.value?(d(),O(m(jn),{key:1,class:"absolute inset-0 size-full","border-radius":"5px",width:"100%",height:"100%"})):E("",!0),u.value?E("",!0):(d(),$("video",{key:2,src:v.value,class:K(m(ne)("block size-full object-contain",p.value&&"invisible")),controls:"",loop:"",playsinline:"",onLoadeddata:k,onError:w},null,42,w0)),a.value||i.value?(d(),$("div",k0,[c("button",{class:K(ma),title:P.$t("g.downloadVideo"),"aria-label":P.$t("g.downloadVideo"),onClick:h},B[1]||(B[1]=[c("i",{class:"icon-[lucide--download] h-4 w-4"},null,-1)]),8,C0),c("button",{class:K(ma),title:P.$t("g.removeVideo"),"aria-label":P.$t("g.removeVideo"),onClick:C},B[2]||(B[2]=[c("i",{class:"icon-[lucide--x] h-4 w-4"},null,-1)]),8,x0)])):E("",!0),f.value?(d(),$("div",S0,[(d(!0),$(oe,null,be(P.imageUrls,(H,z)=>(d(),$("button",{key:z,class:K(S(z)),"aria-label":P.$t("g.viewVideoOfTotal",{index:z+1,total:P.imageUrls.length}),onClick:n(G=>y(z),"onClick")},null,10,_0))),128))])):E("",!0)],40,v0),c("div",T0,[u.value?(d(),$("span",$0,V(P.$t("g.errorLoadingVideo")),1)):p.value?(d(),$("span",N0,V(P.$t("g.loading"))+"... ",1)):(d(),$("span",I0,V(r.value||P.$t("g.calculatingDimensions")),1))])],32)):E("",!0)}}),P0={width:"1.2em",height:"1.2em",xmlns:"http://www.w3.org/2000/svg",class:"",viewBox:"0 0 16 16",fill:"none"},D0=["clip-path"],A0=["id"];function L0(e,o){return d(),$("svg",P0,[c("g",{"clip-path":"url(#"+e.idMap.clip0_704_2695+")"},[...o[0]||(o[0]=[Xl('<path d="M6.05048 2C5.52055 7.29512 9.23033 10.4722 14 9.94267" stroke="currentColor" stroke-width="1.3"></path><path d="M6.5 5.5L10 2" stroke="currentColor" stroke-width="1.3" stroke-linecap="round"></path><path d="M8 8L12.5 3.5" stroke="currentColor" stroke-width="1.3" stroke-linecap="square"></path><path d="M10.5 9.5L14 6" stroke="currentColor" stroke-width="1.3" stroke-linecap="round"></path><path d="M7.99992 14.6667C11.6818 14.6667 14.6666 11.6819 14.6666 8.00004C14.6666 4.31814 11.6818 1.33337 7.99992 1.33337C4.31802 1.33337 1.33325 4.31814 1.33325 8.00004C1.33325 11.6819 4.31802 14.6667 7.99992 14.6667Z" stroke="currentColor" stroke-width="1.3" stroke-linecap="round" stroke-linejoin="round"></path>',5)])],8,D0),c("defs",null,[c("clipPath",{id:e.idMap.clip0_704_2695},[...o[1]||(o[1]=[c("rect",{width:"16",height:"16",fill:"white"},null,-1)])],8,A0)])])}n(L0,"render");const E0=Da({name:"comfy-mask",render:L0,setup(){return{idMap:{clip0_704_2695:"uicons-"+n(()=>Math.random().toString(36).substr(2,10),"__randId")()}}}}),V0=["aria-label","aria-busy"],R0={key:0,role:"alert",class:"flex size-full flex-col items-center justify-center bg-muted-background text-center text-base-foreground py-8"},O0={class:"text-sm text-base-foreground"},W0={class:"mt-1 text-xs text-base-foreground"},z0={key:1,class:"size-full"},B0=["src","alt"],F0={key:3,class:"actions absolute top-2 right-2 flex gap-2.5"},U0=["title","aria-label"],G0=["title","aria-label"],H0=["title","aria-label"],j0={class:"pt-2 text-center text-xs text-base-foreground"},q0={key:0,class:"text-red-400"},K0={key:1,class:"text-base-foreground"},Q0={key:2},Y0={key:0,class:"flex flex-wrap justify-center gap-1 pt-4"},J0=["aria-current","aria-label","onClick"],Cn="flex h-8 min-h-8 items-center justify-center gap-2.5 rounded-lg border-0 bg-button-surface px-2 py-2 text-button-surface-contrast shadow-sm transition-colors duration-200 hover:bg-button-hover-surface focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-button-surface-contrast focus-visible:ring-offset-2 focus-visible:ring-offset-transparent cursor-pointer",X0=q({__name:"ImagePreview",props:{imageUrls:{},nodeId:{}},setup(e){const o=e,{t}=pe(),s=Se(),l=$o(),a=L(0),i=L(!1),r=L(!1),u=L(null),p=L(!1),g=L(!1),v=L(),f=L(),{start:k,stop:w}=Zl(()=>{g.value=!0},250,{immediate:!1}),h=b(()=>o.imageUrls[a.value]),C=b(()=>o.imageUrls.length>1),y=b(()=>`Node output ${a.value+1}`);se(()=>o.imageUrls,F=>{a.value>=F.length&&(a.value=0),u.value=null,p.value=!1,F.length>0&&k()},{deep:!0,immediate:!0});const N=n(F=>{if(!F.target||!(F.target instanceof HTMLImageElement))return;const Q=F.target;w(),g.value=!1,p.value=!1,Q.naturalWidth&&Q.naturalHeight&&(u.value=`${Q.naturalWidth} x ${Q.naturalHeight}`)},"handleImageLoad"),x=n(()=>{w(),g.value=!1,p.value=!0,u.value=null},"handleImageError"),I=n(()=>{if(!o.nodeId||!v.value)return;const F=J.rootGraph?.getNodeById(o.nodeId);F&&(F.imageIndex=a.value,F.imgs=[v.value],J.canvas?.select(F))},"setupNodeForMaskEditor"),_=n(()=>{I(),s.execute("Comfy.MaskEditor.OpenMaskEditor")},"handleEditMask"),S=n(()=>{try{as(h.value)}catch{zt().add({severity:"error",summary:"Error",detail:t("g.failedToDownloadImage"),life:3e3,group:"image-preview"})}},"handleDownload"),T=n(()=>{o.nodeId&&l.removeNodeOutputs(o.nodeId)},"handleRemove"),M=n(F=>{a.value!==F&&F>=0&&F<o.imageUrls.length&&(a.value=F,k(),p.value=!1)},"setCurrentIndex"),P=n(()=>{i.value=!0},"handleMouseEnter"),B=n(()=>{i.value=!1},"handleMouseLeave"),H=n(()=>{r.value=!0},"handleFocusIn"),z=n(F=>{f.value?.contains(F.relatedTarget)||(r.value=!1)},"handleFocusOut"),G=n(F=>["w-2 h-2 rounded-full transition-all duration-200 border-0 cursor-pointer p-0",F===a.value?"bg-base-foreground":"bg-base-foreground/50 hover:bg-base-foreground/80"],"getNavigationDotClass"),U=n(F=>{if(!(o.imageUrls.length<=1))switch(F.key){case"ArrowLeft":F.preventDefault(),M(a.value>0?a.value-1:o.imageUrls.length-1);break;case"ArrowRight":F.preventDefault(),M(a.value<o.imageUrls.length-1?a.value+1:0);break;case"Home":F.preventDefault(),M(0);break;case"End":F.preventDefault(),M(o.imageUrls.length-1);break}},"handleKeyDown"),W=n(F=>{try{return new URL(F).searchParams.get("filename")||"Unknown file"}catch{return"Invalid URL"}},"getImageFilename");return(F,Q)=>{const j=E0;return F.imageUrls.length>0?(d(),$("div",{key:0,class:"image-preview group relative flex size-full min-h-16 min-w-16 flex-col px-2 justify-center",onKeydown:U},[c("div",{ref_key:"imageWrapperEl",ref:f,class:"h-full w-full overflow-hidden rounded-[5px] bg-muted-background relative",tabindex:"0",role:"img","aria-label":F.$t("g.imagePreview"),"aria-busy":g.value,onMouseenter:P,onMouseleave:B,onFocusin:H,onFocusout:z},[p.value?(d(),$("div",R0,[Q[0]||(Q[0]=c("i",{class:"mb-2 icon-[lucide--image-off] h-12 w-12 text-base-foreground"},null,-1)),c("p",O0,V(F.$t("g.imageFailedToLoad")),1),c("p",W0,V(W(h.value)),1)])):E("",!0),g.value&&!p.value?(d(),$("div",z0,[R(m(jn),{"border-radius":"5px",width:"100%",height:"100%"})])):E("",!0),p.value?E("",!0):(d(),$("img",{key:2,ref_key:"currentImageEl",ref:v,src:h.value,alt:y.value,class:"block size-full object-contain pointer-events-none",onLoad:N,onError:x},null,40,B0)),i.value||r.value?(d(),$("div",F0,[C.value?E("",!0):(d(),$("button",{key:0,class:K(Cn),title:F.$t("g.editOrMaskImage"),"aria-label":F.$t("g.editOrMaskImage"),onClick:_},[R(j,{class:"h-4 w-4"})],8,U0)),c("button",{class:K(Cn),title:F.$t("g.downloadImage"),"aria-label":F.$t("g.downloadImage"),onClick:S},Q[1]||(Q[1]=[c("i",{class:"icon-[lucide--download] h-4 w-4"},null,-1)]),8,G0),c("button",{class:K(Cn),title:F.$t("g.removeImage"),"aria-label":F.$t("g.removeImage"),onClick:T},Q[2]||(Q[2]=[c("i",{class:"icon-[lucide--x] h-4 w-4"},null,-1)]),8,H0)])):E("",!0)],40,V0),c("div",j0,[p.value?(d(),$("span",q0,V(F.$t("g.errorLoadingImage")),1)):g.value?(d(),$("span",K0,V(F.$t("g.loading"))+"... ",1)):(d(),$("span",Q0,V(u.value||F.$t("g.calculatingDimensions")),1))]),C.value?(d(),$("div",Y0,[(d(!0),$(oe,null,be(F.imageUrls,(Y,te)=>(d(),$("button",{key:te,class:K(G(te)),"aria-current":te===a.value?"true":void 0,"aria-label":F.$t("g.viewImageOfTotal",{index:te+1,total:F.imageUrls.length}),onClick:n(X=>M(te),"onClick")},null,10,J0))),128))])):E("",!0)],32)):E("",!0)}}}),Z0={key:0,class:"node-error p-2 text-sm text-red-500"},e1={key:1,class:"lg-node-content flex grow flex-col"},t1=q({__name:"NodeContent",props:{nodeData:{},media:{}},setup(e){const o=e,t=b(()=>o.media&&o.media.urls.length>0),s=b(()=>o.nodeData?.id?.toString()),l=L(null),{toastErrorHandler:a}=Ft();return Aa(i=>(l.value=i.message,a(i),!1)),(i,r)=>l.value?(d(),$("div",Z0,V(m(Ae)("nodeErrors.content","Node Content Error")),1)):(d(),$("div",e1,[ye(i.$slots,"default",{},()=>[t.value&&i.media?.type==="video"?(d(),O(M0,{key:0,"image-urls":i.media.urls,"node-id":s.value,class:"mt-2"},null,8,["image-urls","node-id"])):t.value&&i.media?.type==="image"?(d(),O(X0,{key:1,"image-urls":i.media.urls,"node-id":s.value,class:"mt-2"},null,8,["image-urls","node-id"])):E("",!0)])]))}}),o1={key:0,class:"node-error p-2 text-sm text-red-500"},n1=["data-node-id"],s1={key:0,class:"flex flex-col justify-center items-center relative"},a1={class:"relative mb-1"},l1=["data-testid"],i1={key:1,class:"min-h-0 flex-1 flex"},r1={key:2,class:"min-h-0 flex-1 px-4"},u1=["aria-label"],c1="absolute h-3 w-3 opacity-0 pointer-events-auto focus-visible:outline focus-visible:outline-2 focus-visible:outline-white/40",d1=225,ga="h-2 bg-primary-500 transition-all duration-300",p1=q({__name:"LGraphNode",props:{nodeData:{},error:{default:null}},setup(e){const{t:o}=pe(),{handleNodeCollapse:t,handleNodeTitleUpdate:s,handleNodeRightClick:l}=_l(),{bringNodeToFront:a}=al();t0(()=>e.nodeData.id,"node");const{selectedNodeIds:i}=qe(he()),r=b(()=>i.value.has(e.nodeData.id)),u=b(()=>mn(e.nodeData)),{executing:p,progress:g}=o0(u),v=dt(),f=b(()=>v.lastExecutionErrorNodeId===e.nodeData.id),k=b(()=>!!(f.value||e.nodeData.hasErrors||e.error||(v.lastNodeErrors?.[e.nodeData.id]?.errors.length??0)>0)),w=b(()=>e.nodeData.titleMode!==zr.NO_TITLE),h=b(()=>e.nodeData.flags?.collapsed??!1),C=b(()=>e.nodeData.mode===We.BYPASS),y=b(()=>e.nodeData.mode===We.NEVER),N=b(()=>{const fe=pt();return e.nodeData.bgcolor?Br(e.nodeData.bgcolor,!!fe.completedActivePalette.light_theme):""}),x=b(()=>{const fe=re().get("Comfy.Node.Opacity")??1;return C.value||y.value?fe*.5:fe}),I=b(()=>Fr(e.nodeData).length>0),_=b(()=>!!e.nodeData.outputs?.length),{handleWheel:S,shouldHandleNodePointerEvents:T}=co(),M=L(null),{toastErrorHandler:P}=Ft();Aa(fe=>(M.value=fe.message,P(fe),!1));const{position:B,size:H,zIndex:z}=n0(()=>e.nodeData.id),{pointerHandlers:G}=e0(()=>e.nodeData.id),{onPointerdown:U,...W}=G,{startDrag:F}=Nl();async function Q(fe){if(fe.altKey&&ft.value){const xe=Ye.cloneNodes([ft.value]);if(xe?.created?.length){const[De]=xe.created;F(fe,`${De.id}`),Pe.isDraggingVueNodes.value=!0,await Fe(),a(`${De.id}`);return}}U(fe)}n(Q,"nodeOnPointerdown");const j=n(fe=>{fe.preventDefault(),fe.stopPropagation(),l(fe,e.nodeData.id),jg(fe)},"handleContextMenu");ze(()=>{Y()});function Y(){const fe=Lt.value,{width:xe,height:De}=H.value;if(!fe)return;const we=h.value?"-x":"";fe.style.setProperty(`--node-width${we}`,`${xe}px`),fe.style.setProperty(`--node-height${we}`,`${De}px`)}n(Y,"initSizeStyles");const{startResize:te}=a0((fe,xe)=>{if(h.value)return;const De=Math.max(fe.size.width,d1);xe.style.setProperty("--node-width",`${De}px`),xe.style.setProperty("--node-height",`${fe.size.height}px`)}),X=n(fe=>{fe.button===0&&T.value&&(e.nodeData.flags?.pinned||e.nodeData.resizable!==!1&&te(fe))},"handleResizePointerDown");se(h,fe=>{const xe=Lt.value;if(!xe)return;const[De,we]=fe?["","-x"]:["-x",""],Ee=xe.style.getPropertyValue(`--node-width${De}`);xe.style.setProperty(`--node-width${we}`,Ee),xe.style.setProperty(`--node-width${De}`,"");const ee=xe.style.getPropertyValue(`--node-height${De}`);xe.style.setProperty(`--node-height${we}`,ee),xe.style.setProperty(`--node-height${De}`,"")});const ae=b(()=>!!$t.value&&$t.value.urls.length>0),{latestPreviewUrl:le,shouldShowPreviewImg:Ne}=s0(()=>e.nodeData.id,{isCollapsed:h}),Ue=b(()=>k.value?"border-node-stroke-error":!w.value&&e.nodeData.bgcolor&&Ur(e.nodeData.bgcolor)?"border-0":""),Qe=b(()=>ne(r.value&&"outline-node-component-outline",k.value&&"outline-node-stroke-error",p.value&&"outline-node-stroke-executing")),Ve=b(()=>ne(e.nodeData.flags?.pinned?"cursor-default":Pe.isDraggingVueNodes.value?"cursor-grabbing":"cursor-grab")),_e=b(()=>{switch(e.nodeData.shape){case Pt.BOX:return"rounded-none";case Pt.CARD:return"rounded-tl-2xl rounded-br-2xl rounded-tr-none rounded-bl-none";default:return"rounded-2xl"}}),Be=b(()=>{switch(e.nodeData.shape){case Pt.BOX:return"before:rounded-none";case Pt.CARD:return"before:rounded-tl-2xl before:rounded-br-2xl before:rounded-tr-none before:rounded-bl-none";default:return"before:rounded-2xl"}}),Je=n(()=>{t(e.nodeData.id,!h.value)},"handleCollapse"),wt=n(fe=>{s(e.nodeData.id,fe)},"handleHeaderTitleUpdate"),fo=n(()=>{const fe=J.rootGraph;if(!fe){console.warn("LGraphNode: No graph available for subgraph navigation");return}const xe=mn(e.nodeData),De=Bs(fe,xe);if(!De?.isSubgraphNode()||!("subgraph"in De)){console.warn("LGraphNode: Node is not a valid subgraph node",De);return}const we=J.canvas;if(!we||typeof we.openSubgraph!="function"){console.warn("LGraphNode: Canvas or openSubgraph method not available");return}we.openSubgraph(De.subgraph,De)},"handleEnterSubgraph"),jt=$o(),qt=b(()=>e.nodeData.subgraphId?`${e.nodeData.subgraphId}:${e.nodeData.id}`:e.nodeData.id),ft=b(()=>{const fe=mn(e.nodeData);return Bs(J.rootGraph,fe)}),$t=b(()=>{const fe=jt.nodeOutputs[qt.value],xe=ft.value;if(!xe||!fe?.images?.length)return;const De=jt.getNodeImageUrls(xe);if(!De?.length)return;const we=xe.inputs?.some(ee=>ee.type==="VIDEO");return{type:xe.previewMediaType==="video"||!xe.previewMediaType&&we?"video":"image",urls:De}}),Lt=L(),ot=L(!1);function Kt(fe){const xe=ft.value;if(!xe||!xe.onDragOver){ot.value=!1;return}const De=xe.onDragOver(fe);ot.value=De}n(Kt,"handleDragOver");function mo(){ot.value=!1}n(mo,"handleDragLeave");async function Qt(fe){ot.value=!1;const xe=ft.value;!xe||!xe.onDragDrop||await xe.onDragDrop(fe)}return n(Qt,"handleDrop"),(fe,xe)=>M.value?(d(),$("div",o1,V(m(Ae)("nodeErrors.render","Node Render Error")),1)):(d(),$("div",_t({key:1,ref_key:"nodeContainerRef",ref:Lt,tabindex:"0","data-node-id":fe.nodeData.id,class:m(ne)("bg-component-node-background lg-node absolute text-sm","contain-style contain-layout min-w-[225px] min-h-(--node-height) w-(--node-width)",_e.value,"touch-none flex flex-col","border-1 border-solid border-component-node-border",m(T)&&"hover:ring-7 ring-node-component-ring","outline-transparent outline-2 focus-visible:outline-node-component-outline",Ue.value,Qe.value,Ve.value,{[`${Be.value} before:pointer-events-none before:absolute before:bg-bypass/60 before:inset-0`]:C.value,[`${Be.value} before:pointer-events-none before:absolute before:inset-0`]:y.value,"ring-4 ring-primary-500 bg-primary-500/10":ot.value},m(T)?"pointer-events-auto":"pointer-events-none",!h.value&&" pb-1"),style:[{transform:`translate(${m(B).x??0}px, ${(m(B).y??0)-m(ge).NODE_TITLE_HEIGHT}px)`,zIndex:m(z),opacity:x.value,"--component-node-background":N.value}]},W,{onPointerdown:Q,onWheel:xe[0]||(xe[0]=(...De)=>m(S)&&m(S)(...De)),onContextmenu:j,onDragover:Ce(Kt,["prevent"]),onDragleave:mo,onDrop:Ce(Qt,["stop","prevent"])}),[w.value?(d(),$("div",s1,[h.value?(d(),$(oe,{key:0},[I.value?(d(),O(Fs,{key:0,multi:"",class:"absolute left-0 -translate-x-1/2"})):E("",!0),_.value?(d(),O(Fs,{key:1,multi:"",class:"absolute right-0 translate-x-1/2"})):E("",!0),R(Us,{"node-data":fe.nodeData,unified:""},null,8,["node-data"])],64)):E("",!0),R(Gr,{"node-data":fe.nodeData,collapsed:h.value,onCollapse:Je,"onUpdate:title":wt,onEnterSubgraph:fo},null,8,["node-data","collapsed"])])):E("",!0),h.value&&m(p)&&m(g)!==void 0?(d(),$("div",{key:1,class:K(m(ne)("absolute inset-x-4 -bottom-[1px] translate-y-1/2 rounded-full",ga)),style:ve({width:`${Math.min(m(g)*100,100)}%`})},null,6)):E("",!0),h.value?E("",!0):(d(),$(oe,{key:2},[c("div",a1,[m(p)&&m(g)!==void 0?(d(),$("div",{key:0,class:K(m(ne)("absolute inset-x-0 top-1/2 -translate-y-1/2",m(g)<1&&"rounded-r-full",ga)),style:ve({width:`${Math.min(m(g)*100,100)}%`})},null,6)):E("",!0)]),c("div",{class:"flex flex-1 flex-col gap-1 pb-2","data-testid":`node-body-${fe.nodeData.id}`},[R(Us,{"node-data":fe.nodeData},null,8,["node-data"]),fe.nodeData.widgets?.length?(d(),O(ll,{key:0,"node-data":fe.nodeData},null,8,["node-data"])):E("",!0),ae.value?(d(),$("div",i1,[R(t1,{"node-data":fe.nodeData,media:$t.value},null,8,["node-data","media"])])):E("",!0),m(Ne)?(d(),$("div",r1,[R(g0,{"image-url":m(le)||null},null,8,["image-url"])])):E("",!0)],8,l1)],64)),!h.value&&fe.nodeData.resizable!==!1?(d(),$("div",{key:3,role:"button","aria-label":m(o)("g.resizeFromBottomRight"),class:K(m(ne)(c1,"right-0 bottom-0 cursor-se-resize")),onPointerdown:Ce(X,["stop"])},null,42,u1)):E("",!0)],16,n1))}});let Ao=[],Lo=!1,Eo=null;const f1=n(()=>{function e(l){const a=Object.keys(l.settingValues).length===0||!l.get("Comfy.TutorialCompleted"),i=!localStorage.getItem("workflow"),r=!localStorage.getItem("Comfy.PreviousWorkflow");return a&&i&&r}n(e,"checkIsNewUser");async function o(l){if(Lo){if(Eo)try{await l()}catch(a){console.error("New user initialization callback failed:",a)}}else Ao.push(l)}n(o,"registerInitCallback");async function t(l){if(!Lo){if(Eo=e(l),Lo=!0,!Eo){Ao=[];return}await l.set("Comfy.InstalledVersion","1.37.11");for(const a of Ao)try{await a()}catch(i){console.error("New user initialization callback failed:",i)}Ao=[]}}n(t,"initializeIfNewUser");function s(){return Lo?Eo:null}return n(s,"isNewUser"),{registerInitCallback:o,initializeIfNewUser:t,isNewUser:s}},"newUserService"),m1=q({__name:"SelectionRectangle",setup(e){const o=he(),t=L(null);lo(()=>{const a=o.canvas;if(!a){t.value=null;return}const{pointer:i,dragging_rectangle:r}=a;if(r&&i.eDown&&i.eMove){const u=i.eDown.safeOffsetX,p=i.eDown.safeOffsetY,g=i.eMove.safeOffsetX-u,v=i.eMove.safeOffsetY-p;t.value={x:u,y:p,w:g,h:v}}else t.value=null});const s=b(()=>t.value!==null),l=b(()=>{const a=t.value;if(!a)return{};const i=a.w>=0?a.x:a.x+a.w,r=a.h>=0?a.y:a.y+a.h,u=Math.abs(a.w),p=Math.abs(a.h);return{left:`${i}px`,top:`${r}px`,width:`${u}px`,height:`${p}px`}});return(a,i)=>s.value?(d(),$("div",{key:0,class:"pointer-events-none absolute z-9999 border border-blue-400 bg-blue-500/20",style:ve(l.value)},null,4)):E("",!0)}}),g1={key:0,class:"workflow-tabs-container pointer-events-auto relative h-9.5 w-full"},v1={key:0,class:"app-drag fixed top-0 left-0 z-10 h-[var(--comfy-topbar-height)] w-full"},h1={class:"flex h-full items-center border-b border-interface-stroke bg-comfy-menu-bg shadow-interface"},y1={class:"sidebar-content-container h-full w-full overflow-x-hidden overflow-y-auto"},b1=q({__name:"GraphCanvas",emits:["ready"],setup(e,{emit:o}){const t=o,s=L(null),l=Ze(null),a=re(),i=Tt(),r=rt(),u=he(),p=dt(),g=Dt(),v=pt(),f=el(),k=co(),w=b(()=>a.get("Comfy.UseNewMenu")!=="Disabled"),h=b(()=>a.get("Comfy.Workflow.WorkflowTabsPosition")),C=b(()=>a.get("Comfy.Graph.CanvasMenu")),y=b(()=>a.get("Comfy.EnableTooltips")),N=b(()=>a.get("Comfy.Canvas.SelectionToolbox")),x=b(()=>r.sidebarTab.activeSidebarTab),I=b(()=>!r.focusMode&&w.value),_=b(()=>a.get("Comfy.Minimap.Visible")),{shouldRenderVueNodes:S}=qo(),T=ks(),M=n(async()=>{S.value&&(T.disposeNodeManagerAndSyncs(),await Fe(),T.initializeNodeManager())},"handleVueNodeLifecycleReset");se(()=>u.currentGraph,M),se(()=>u.isInSubgraph,async(G,U)=>{U&&!G&&Oe().updateActiveGraph(),await M()});const P=b(()=>Array.from(T.nodeManager.value?.vueNodeData?.values()??[]));ke(()=>{ge.nodeOpacity=a.get("Comfy.Node.Opacity")}),ke(()=>{ge.nodeLightness=v.completedActivePalette.light_theme?.5:void 0}),ke(()=>{i.showDeprecated=a.get("Comfy.Node.ShowDeprecated")}),ke(()=>{i.showExperimental=a.get("Comfy.Node.ShowExperimental")}),ke(()=>{const G=a.get("Comfy.TextareaWidget.Spellcheck");document.querySelectorAll("textarea.comfy-multiline-input").forEach(W=>{W.spellcheck=G,W.focus(),W.blur()})}),se(()=>a.get("Comfy.WidgetControlMode"),()=>{u.canvas&&(Gs(J.rootGraph,G=>{if(G.widgets){for(const U of G.widgets)if(U[Yr]&&(Hs(U),!!U.linkedWidgets))for(const W of U.linkedWidgets)Hs(W)}}),u.canvas.setDirty(!0))}),se([()=>u.canvas,()=>a.get("Comfy.ColorPalette")],async([G,U])=>{G&&await f.loadColorPalette(U)}),se(()=>a.get("Comfy.Canvas.BackgroundImage"),async()=>{if(!u.canvas)return;const G=v.activePaletteId;G&&(await f.loadColorPalette(G),u.canvas.setDirty(!1,!0))}),se(()=>v.activePaletteId,async G=>{await a.set("Comfy.ColorPalette",G)}),se(()=>[p.nodeLocationProgressStates,u.canvas],([G,U])=>{if(U?.graph){for(const W of U.graph.nodes){const F=Oe().nodeIdToNodeLocatorId(W.id),Q=G[F];Q&&Q.state==="running"?W.progress=Q.value/Q.max:W.progress=void 0}U.setDirty(!0,!1)}},{deep:!0}),se(()=>p.lastNodeErrors,G=>{J.graph&&(Gs(J.rootGraph,U=>{for(const Q of U.inputs)delete Q.hasErrors;for(const Q of U.outputs)delete Q.hasErrors;const W=G?.[U.id];if(!W)return;W.errors.filter(Q=>Q.extra_info?.input_name!==void 0).forEach(Q=>{const j=Q.extra_info.input_name,Y=U.findInputSlot(j);Y!==-1&&(U.inputs[Y].hasErrors=!0)})}),J.canvas.setDirty(!0,!0))}),Re(s,"litegraph:no-items-selected",()=>{g.add({severity:"warn",summary:ce("toastMessages.nothingSelected"),life:2e3})},{passive:!0});const B=n(async()=>{try{const G=await Te.getCustomNodesI18n();Qr(G)}catch(G){console.error("Failed to load custom nodes i18n",G)}},"loadCustomNodesI18n"),H=L(!1),z=Aw();return Sw(s),Iw(),xw(),ze(async()=>{Nw(),_w(),$w(),Hr(),Pw(),qo(),J.vueAppReady=!0,r.spinner=!0,jr.init(),await B();try{await a.loadSettingValues()}catch(W){if(W instanceof qr)localStorage.removeItem("Comfy.userId"),localStorage.removeItem("Comfy.userName"),window.location.reload();else throw W}Mw.forEach(a.addSetting),await f1().initializeIfNewUser(a),await J.setup(s.value),u.canvas=J.canvas,u.canvas.render_canvas_border=!1,r.spinner=!1,ys().setPopoverRef(l.value),window.app=J,window.graph=J.graph,H.value=!0,T.setupEmptyGraphListener(),J.canvas.onSelectionChange=so(J.canvas.onSelectionChange,()=>u.updateSelectedItems()),v.customPalettes=a.get("Comfy.CustomColorPalettes"),await z.initializeWorkflow(),z.restoreWorkflowTabsState(),await z.loadTemplateFromUrlIfPresent();const{useReleaseStore:G}=await Un(async()=>{const{useReleaseStore:W}=await Promise.resolve().then(()=>rm);return{useReleaseStore:W}},void 0,import.meta.url);G().initialize(),se(()=>a.get("Comfy.Locale"),async()=>{await Se().execute("Comfy.RefreshNodeDefinitions"),await tt().reloadCurrentWorkflow()}),St(()=>he().canvas,W=>{Re(W.canvas,"litegraph:set-graph",()=>{Oe().updateActiveGraph()})},{immediate:!0}),t("ready")}),yt(()=>{T.cleanup()}),(G,U)=>(d(),$(oe,null,[H.value?(d(),O(pd,{key:0},Bn({"graph-canvas-panel":A(()=>[C.value?(d(),O(og,{key:0,class:"pointer-events-auto"})):E("",!0),H.value&&_.value&&w.value?(d(),O(Jw,{key:1,class:"pointer-events-auto"})):E("",!0)]),_:2},[I.value?{name:"workflow-tabs",fn:A(()=>[h.value==="Topbar"?(d(),$("div",g1,[m(Kr)()&&h.value!=="Topbar"?(d(),$("div",v1)):E("",!0),c("div",h1,[R(Sl),R(xl)])])):E("",!0)]),key:"0"}:void 0,I.value?{name:"side-toolbar",fn:A(()=>[R(Ob)]),key:"1"}:void 0,I.value?{name:"side-bar-panel",fn:A(()=>[c("div",y1,[x.value?(d(),O(ms,{key:0,extension:x.value},null,8,["extension"])):E("",!0)])]),key:"2"}:void 0,I.value?{name:"topmenu",fn:A(()=>[R(vm)]),key:"3"}:void 0,I.value?{name:"bottom-panel",fn:A(()=>[R(Sm)]),key:"4"}:void 0,I.value?{name:"right-side-panel",fn:A(()=>[R(vh)]),key:"5"}:void 0]),1024)):E("",!0),c("canvas",{id:"graph-canvas",ref_key:"canvasRef",ref:s,tabindex:"1",class:"absolute inset-0 size-full touch-none"},null,512),m(S)&&m(J).canvas&&H.value?(d(),O(Rw,{key:1,canvas:m(J).canvas,onWheelCapture:m(k).forwardEventToCanvas},{default:A(()=>[(d(!0),$(oe,null,be(P.value,W=>(d(),O(p1,{key:W.id,"node-data":W,error:m(p).lastExecutionError?.node_id===W.id?"Execution error":null,"zoom-level":m(u).canvas?.ds?.scale||1,"data-node-id":W.id},null,8,["node-data","error","zoom-level","data-node-id"]))),128))]),_:1},8,["canvas","onWheelCapture"])):E("",!0),H.value?(d(),O(m1,{key:2})):E("",!0),y.value?(d(),O(sg,{key:3})):E("",!0),R(Mh,{ref_key:"nodeSearchboxPopoverRef",ref:l},null,512),H.value?(d(),$(oe,{key:4},[R(pv),N.value?(d(),O(cv,{key:0})):E("",!0),m(S)?E("",!0):(d(),O(Pm,{key:1}))],64)):E("",!0)],64))}}),w1={class:"flex flex-auto flex-col items-start"},k1={class:"my-4 text-lg font-medium"},C1=q({__name:"RerouteMigrationToast",setup(e){const{t:o}=pe(),t=zt(),s=Oe(),l=n(async()=>{const a=J.rootGraph.serialize(),i=Jr(a);await J.loadGraphData(i,!1,!1,s.activeWorkflow),t.removeGroup("reroute-migration")},"migrateToLitegraphReroute");return(a,i)=>(d(),O(m(Va),{group:"reroute-migration"},{message:A(()=>[c("div",w1,[c("div",k1,V(m(o)("toastMessages.migrateToLitegraphReroute")),1),R(Z,{class:"self-end",size:"sm",onClick:l},{default:A(()=>[$e(V(m(o)("g.migrate")),1)]),_:1})])]),_:1}))}}),va="ComfyUI",x1=" - ComfyUI",S1=n(()=>{const e=dt(),o=re(),t=Oe(),s=rt(),l=b(()=>e.isIdle?"":`[${Math.round(e.executionProgress*100)}%]`),a=b(()=>o.get("Comfy.UseNewMenu")!=="Disabled"),i=b(()=>o.get("Comfy.Workflow.AutoSave")==="after delay"),r=b(()=>!!t.activeWorkflow?.isModified),u=b(()=>!!t.activeWorkflow?.isPersisted),p=b(()=>s.shiftDown||i.value?!1:!!(!u.value||r.value)),g=b(()=>p.value?" *":""),v=b(()=>{const h=t.activeWorkflow?.filename;return h?g.value+h+x1:va}),f=b(()=>{const C=Object.entries(e.nodeProgressStates).filter(([_,S])=>S.state==="running");if(C.length===0)return"";if(C.length>1)return`${l.value}[${C.length} ${ce("g.nodesRunning","nodes running")}]`;const[y,N]=C[0],x=Math.round(N.value/N.max*100),I=e.activePrompt?.workflow?.changeTracker?.activeState.nodes.find(_=>String(_.id)===y)?.type||"Node";return`${l.value}[${x}%] ${I}`}),k=b(()=>l.value+(a.value?v.value:va)),w=b(()=>f.value||k.value);ei(w)},"useBrowserTabTitle"),_1={},T1={class:"size-full bg-modal-panel-background pr-6 pb-8 pl-4"};function $1(e,o){return d(),$("div",T1,[ye(e.$slots,"default")])}n($1,"_sfc_render");const N1=Le(_1,[["render",$1]]),I1={class:"text-neutral text-base"},M1={class:"flex gap-2"},P1={class:"relative flex gap-2 px-6 pb-4"},D1=q({__name:"SampleModelSelector",props:{onClose:{type:Function}},setup(e){const o=L([{name:"Vue",value:"vue"},{name:"React",value:"react"},{name:"Angular",value:"angular"},{name:"Svelte",value:"svelte"}]),t=L([{name:"Project A",value:"proj-a"},{name:"Project B",value:"proj-b"},{name:"Project C",value:"proj-c"}]),s=L([{name:"Popular",value:"popular"},{name:"Latest",value:"latest"},{name:"A  Z",value:"az"}]),l=L([{id:"installed",label:"Installed",icon:"icon-[lucide--download]"},{title:"TAGS",items:[{id:"tag-sd15",label:"SD 1.5",icon:"icon-[lucide--tag]"},{id:"tag-sdxl",label:"SDXL",icon:"icon-[lucide--tag]"},{id:"tag-utility",label:"Utility",icon:"icon-[lucide--tag]"}]},{title:"CATEGORIES",items:[{id:"cat-models",label:"Models",icon:"icon-[lucide--layers]"},{id:"cat-nodes",label:"Nodes",icon:"icon-[lucide--grid-3x3]"}]}]);tn(rn,e.onClose);const a=L(""),i=L(""),r=L([]),u=L([]),p=L("popular"),g=L("installed"),v=b(()=>Cl());return(f,k)=>(d(),O(us,{"content-title":f.$t("assetBrowser.checkpoints")},{leftPanel:A(()=>[R(cs,{modelValue:g.value,"onUpdate:modelValue":k[0]||(k[0]=w=>g.value=w),"nav-items":l.value},{"header-icon":A(()=>k[6]||(k[6]=[c("i",{class:"text-neutral icon-[lucide--puzzle]"},null,-1)])),"header-title":A(()=>[c("span",I1,V(f.$t("g.title")),1)]),_:1},8,["modelValue","nav-items"])]),header:A(()=>[R(sn,{modelValue:a.value,"onUpdate:modelValue":k[1]||(k[1]=w=>a.value=w),size:"lg",class:"max-w-[384px]"},null,8,["modelValue"])]),"header-right-area":A(()=>[c("div",M1,[R(Z,{variant:"primary",onClick:n(()=>{},"onClick")},{default:A(()=>[k[7]||(k[7]=c("i",{class:"icon-[lucide--upload]"},null,-1)),c("span",null,V(f.$t("g.upload")),1)]),_:1}),R(dl,null,{default:A(({close:w})=>[R(Z,{variant:"secondary",onClick:n(()=>{w()},"onClick")},{default:A(()=>[k[8]||(k[8]=c("i",{class:"icon-[lucide--download]"},null,-1)),c("span",null,V(f.$t("g.settings")),1)]),_:2},1032,["onClick"]),R(Z,{variant:"primary",onClick:n(()=>{w()},"onClick")},{default:A(()=>[k[9]||(k[9]=c("i",{class:"icon-[lucide--scroll]"},null,-1)),c("span",null,V(f.$t("g.profile")),1)]),_:2},1032,["onClick"])]),_:1})])]),contentFilter:A(()=>[c("div",P1,[R(Wt,{modelValue:r.value,"onUpdate:modelValue":k[2]||(k[2]=w=>r.value=w),"search-query":i.value,"onUpdate:searchQuery":k[3]||(k[3]=w=>i.value=w),class:"w-[250px]",label:f.$t("assetBrowser.selectFrameworks"),options:o.value,"show-search-box":!0,"show-selected-count":!0,"show-clear-button":!0},null,8,["modelValue","search-query","label","options"]),R(Wt,{modelValue:u.value,"onUpdate:modelValue":k[4]||(k[4]=w=>u.value=w),label:f.$t("assetBrowser.selectProjects"),options:t.value},null,8,["modelValue","label","options"]),R(Ko,{modelValue:p.value,"onUpdate:modelValue":k[5]||(k[5]=w=>p.value=w),label:f.$t("assetBrowser.sortingType"),options:s.value,class:"w-[135px]"},{icon:A(()=>k[10]||(k[10]=[c("i",{class:"icon-[lucide--filter]"},null,-1)])),_:1},8,["modelValue","label","options"])])]),content:A(()=>[c("div",{style:ve(v.value)},[(d(),$(oe,null,be(100,w=>R(Bo,{key:w,size:"regular"},{top:A(()=>[R(Fo,{ratio:"landscape"},{default:A(()=>k[11]||(k[11]=[c("div",{class:"h-full w-full bg-blue-500"},null,-1)])),"top-right":A(()=>[R(Z,{size:"icon",class:"!bg-white !text-neutral-900",onClick:n(()=>{},"onClick")},{default:A(()=>k[12]||(k[12]=[c("i",{class:"icon-[lucide--info]"},null,-1)])),_:1})]),"bottom-right":A(()=>[R(Uo,{label:"png"}),R(Uo,{label:"1.2 MB"}),R(Uo,{label:"LoRA"},{icon:A(()=>k[13]||(k[13]=[c("i",{class:"icon-[lucide--folder]"},null,-1)])),_:1})]),_:1})]),bottom:A(()=>[R(zo)]),_:2},1024)),64))],4)]),rightPanel:A(()=>[R(N1)]),_:1},8,["content-title"]))}}),ha="global-model-selector",A1=n(()=>{const e=bt(),o=ct();function t(){o.closeDialog({key:ha})}n(t,"hide");function s(){e.showLayoutDialog({key:ha,component:D1,props:{onClose:t}})}return n(s,"show"),{show:s,hide:t}},"useModelSelectorDialog");function L1(e,o){const t=Xr.safeParse(e);if(!t.success){const h=t.error.errors.map(C=>`${C.path.join(".")}: ${C.message}`).join(", ");return console.error("Invalid asset item:",h),{success:!1,error:{code:"INVALID_ASSET",message:"Asset schema validation failed",assetId:e.id,details:{validationErrors:h}}}}const s=t.data,l=s.user_metadata;if(!l)return console.error(`Asset ${s.id} missing required user_metadata`),{success:!1,error:{code:"INVALID_ASSET",message:"Asset missing required user_metadata",assetId:s.id}};const a=l.filename;if(typeof a!="string"||a.length===0)return console.error(`Asset ${s.id} has invalid user_metadata.filename (expected non-empty string, got ${typeof a})`),{success:!1,error:{code:"INVALID_ASSET",message:`Invalid filename (expected non-empty string, got ${typeof a})`,assetId:s.id}};if(s.tags.length===0)return console.error(`Asset ${s.id} has no tags defined (expected at least one category tag)`),{success:!1,error:{code:"INVALID_ASSET",message:"Asset has no tags defined",assetId:s.id}};const i=s.tags.find(h=>h!==js&&h!==qs);if(!i)return console.error(`Asset ${s.id} has no valid category tag. Available tags: ${s.tags.join(", ")} (expected tag other than '${js}' or '${qs}')`),{success:!1,error:{code:"INVALID_ASSET",message:"Asset has no valid category tag",assetId:s.id,details:{availableTags:s.tags}}};const u=Qn().getNodeProvider(i);if(!u)return console.error(`No node provider registered for category: ${i}`),{success:!1,error:{code:"NO_PROVIDER",message:`No node provider registered for category: ${i}`,assetId:s.id,details:{category:i}}};const g=To().getCanvasCenter(),v=ge.createNode(u.nodeDef.name,u.nodeDef.display_name,{pos:g});if(!v)return console.error(`Failed to create node for type: ${u.nodeDef.name}`),{success:!1,error:{code:"NODE_CREATION_FAILED",message:`Failed to create node for type: ${u.nodeDef.name}`,assetId:s.id,details:{nodeType:u.nodeDef.name}}};const f=Oe(),k=f.isSubgraphActive?f.activeSubgraph:J.canvas.graph;if(!k)return console.error("No active graph available"),{success:!1,error:{code:"NO_GRAPH",message:"No active graph available",assetId:s.id}};const w=v.widgets?.find(h=>h.name===u.key);return w?(w.value=a,k.add(v),{success:!0,value:v}):(console.error(`Widget ${u.key} not found on node ${u.nodeDef.name}`),{success:!1,error:{code:"MISSING_WIDGET",message:`Widget ${u.key} not found on node ${u.nodeDef.name}`,assetId:s.id,details:{widgetName:u.key,nodeType:u.nodeDef.name}}})}n(L1,"createModelNodeFromAsset");const Vo={DISTRIBUTION:"tf_42243568391700",ANONYMOUS_EMAIL:"tf_anonymous_requester_email",EMAIL:"tf_40029135130388",USER_ID:"tf_42515251051412"},E1="https://support.comfy.org/hc/en-us/requests/new";function V1(e){const o=new URLSearchParams({[Vo.DISTRIBUTION]:"oss"});return e?.userEmail&&(o.append(Vo.ANONYMOUS_EMAIL,e.userEmail),o.append(Vo.EMAIL,e.userEmail)),e?.userId&&o.append(Vo.USER_ID,e.userId),`${E1}?${o.toString()}`}n(V1,"buildSupportUrl");const{isActiveSubscription:xn,showSubscriptionDialog:Sn}=Yn(),Ro="1.22.2";function R1(){const e=tt(),o=Oe(),t=bt(),s=pt(),l=Ga(),a=Dt(),i=he(),r=dt(),{staticUrls:u,buildDocsUrl:p}=uo(),g=re(),v=ro(),f=ct(),k=Zr(),{getSelectedNodes:w,toggleSelectedNodesMode:h}=ns(),C=n(()=>o.activeWorkflow?.changeTracker,"getTracker");function y(){return g.get("Comfy.Queue.QPOV2")}n(y,"isQueuePanelV2Enabled");async function N(){await g.set("Comfy.Queue.QPOV2",!y())}n(N,"toggleQueuePanelV2");const x=n(_=>{const S=w();if(S.length===0)return;const T=re().get("Comfy.SnapToGrid.GridSize");S.forEach(M=>{M.pos=_(M.pos,T)}),J.canvas.state.selectionChanged=!0,J.canvas.setDirty(!0,!0)},"moveSelectedNodes");return[{id:"Comfy.NewBlankWorkflow",icon:"pi pi-plus",label:"New Blank Workflow",menubarLabel:"New",category:"essentials",function:n(async()=>{J.rootGraph._nodes.length>0,await e.loadBlankWorkflow()},"function")},{id:"Comfy.OpenWorkflow",icon:"pi pi-folder-open",label:"Open Workflow",menubarLabel:"Open",category:"essentials",function:n(()=>{J.ui.loadFile()},"function")},{id:"Comfy.LoadDefaultWorkflow",icon:"pi pi-code",label:"Load Default Workflow",function:n(async()=>{J.rootGraph._nodes.length>0,await e.loadDefaultWorkflow()},"function")},{id:"Comfy.SaveWorkflow",icon:"pi pi-save",label:"Save Workflow",menubarLabel:"Save",category:"essentials",function:n(async()=>{const _=Oe().activeWorkflow;_&&await e.saveWorkflow(_)},"function")},{id:"Comfy.PublishSubgraph",icon:"pi pi-save",label:"Publish Subgraph",menubarLabel:"Publish",function:n(async()=>{await Jn().publishSubgraph()},"function")},{id:"Comfy.SaveWorkflowAs",icon:"pi pi-save",label:"Save Workflow As",menubarLabel:"Save As",category:"essentials",function:n(async()=>{const _=Oe().activeWorkflow;_&&await e.saveWorkflowAs(_)},"function")},{id:"Comfy.RenameWorkflow",icon:"pi pi-pencil",label:"Rename Workflow",menubarLabel:"Rename",function:n(async()=>{const _=o.activeWorkflow;if(!_||!_.isPersisted)return;const S=await t.prompt({title:ce("g.rename"),message:ce("workflowService.enterFilename")+":",defaultValue:_.filename});if(!S||S===_.filename)return;const T=_.directory+"/"+S+".json";await e.renameWorkflow(_,T)},"function")},{id:"Comfy.ExportWorkflow",icon:"pi pi-download",label:"Export Workflow",menubarLabel:"Export",category:"essentials",function:n(async()=>{await e.exportWorkflow("workflow","workflow")},"function")},{id:"Comfy.ExportWorkflowAPI",icon:"pi pi-download",label:"Export Workflow (API Format)",menubarLabel:"Export (API)",function:n(async()=>{await e.exportWorkflow("workflow_api","output")},"function")},{id:"Comfy.Undo",icon:"pi pi-undo",label:"Undo",category:"essentials",function:n(async()=>{f.isDialogOpen("global-mask-editor")?k.canvasHistory.undo():await C()?.undo?.()},"function")},{id:"Comfy.Redo",icon:"pi pi-refresh",label:"Redo",category:"essentials",function:n(async()=>{f.isDialogOpen("global-mask-editor")?k.canvasHistory.redo():await C()?.redo?.()},"function")},{id:"Comfy.ClearWorkflow",icon:"pi pi-trash",label:"Clear Workflow",category:"essentials",function:n(()=>{if(!re().get("Comfy.ConfirmClear")||confirm("Clear workflow?")){if(J.clean(),J.canvas.subgraph){const S=J.canvas.subgraph;tu(S).forEach(M=>S.remove(M))}Te.dispatchCustomEvent("graphCleared")}},"function")},{id:"Comfy.Canvas.ResetView",icon:"pi pi-expand",label:"Reset View",function:n(()=>{To().resetView()},"function")},{id:"Comfy.OpenClipspace",icon:"pi pi-clipboard",label:"Clipspace",function:n(()=>{J.openClipspace()},"function")},{id:"Comfy.RefreshNodeDefinitions",icon:"pi pi-refresh",label:"Refresh Node Definitions",category:"essentials",function:n(async()=>{await J.refreshComboInNodes()},"function")},{id:"Comfy.Interrupt",icon:"pi pi-stop",label:"Interrupt",category:"essentials",function:n(async()=>{await Te.interrupt(r.activePromptId),a.add({severity:"info",summary:ce("g.interrupted"),detail:ce("toastMessages.interrupted"),life:1e3})},"function")},{id:"Comfy.ClearPendingTasks",icon:"pi pi-stop",label:"Clear Pending Tasks",category:"essentials",function:n(async()=>{await Bt().clear(["queue"]),a.add({severity:"info",summary:ce("g.confirmed"),detail:ce("toastMessages.pendingTasksDeleted"),life:3e3})},"function")},{id:"Comfy.BrowseTemplates",icon:"pi pi-folder-open",label:"Browse Templates",function:n(()=>{ws().show()},"function")},{id:"Comfy.Canvas.ZoomIn",icon:"pi pi-plus",label:"Zoom In",category:"view-controls",function:n(()=>{const _=J.canvas.ds;_.changeScale(_.scale*1.1,_.element?[_.element.width/2,_.element.height/2]:void 0),J.canvas.setDirty(!0,!0)},"function")},{id:"Comfy.Canvas.ZoomOut",icon:"pi pi-minus",label:"Zoom Out",category:"view-controls",function:n(()=>{const _=J.canvas.ds;_.changeScale(_.scale/1.1,_.element?[_.element.width/2,_.element.height/2]:void 0),J.canvas.setDirty(!0,!0)},"function")},{id:"Experimental.ToggleVueNodes",label:n(()=>`Experimental: ${re().get("Comfy.VueNodes.Enabled")?"Disable":"Enable"} Nodes 2.0`,"label"),function:n(async()=>{const _=re(),S=_.get("Comfy.VueNodes.Enabled")??!1;await _.set("Comfy.VueNodes.Enabled",!S)},"function")},{id:"Comfy.Canvas.FitView",icon:"pi pi-expand",label:"Fit view to selected nodes",menubarLabel:"Zoom to fit",category:"view-controls",function:n(()=>{if(J.canvas.empty){a.add({severity:"error",summary:ce("toastMessages.emptyCanvas"),life:3e3});return}J.canvas.fitViewToSelectionAnimated()},"function")},{id:"Comfy.Canvas.ToggleLock",icon:"pi pi-lock",label:"Canvas Toggle Lock",category:"view-controls",function:n(()=>{J.canvas.state.readOnly=!J.canvas.state.readOnly},"function")},{id:"Comfy.Canvas.Lock",icon:"pi pi-lock",label:"Lock Canvas",category:"view-controls",function:n(()=>{J.canvas.state.readOnly=!0},"function")},{id:"Comfy.Canvas.Unlock",icon:"pi pi-lock-open",label:"Unlock Canvas",function:n(()=>{J.canvas.state.readOnly=!1},"function")},{id:"Comfy.Canvas.ToggleLinkVisibility",icon:"pi pi-eye",label:"Canvas Toggle Link Visibility",menubarLabel:"Node Links",versionAdded:"1.3.6",function:(()=>{const _=re();let S=ge.SPLINE_LINK;return async()=>{const T=_.get("Comfy.LinkRenderMode");T===ge.HIDDEN_LINK?await _.set("Comfy.LinkRenderMode",S):(S=T,await _.set("Comfy.LinkRenderMode",ge.HIDDEN_LINK))}})(),active:n(()=>re().get("Comfy.LinkRenderMode")!==ge.HIDDEN_LINK,"active")},{id:"Comfy.Canvas.ToggleMinimap",icon:"pi pi-map",label:"Canvas Toggle Minimap",menubarLabel:"Minimap",versionAdded:"1.24.1",function:n(async()=>{const _=re();await _.set("Comfy.Minimap.Visible",!_.get("Comfy.Minimap.Visible"))},"function"),active:n(()=>re().get("Comfy.Minimap.Visible"),"active")},{id:"Comfy.Queue.ToggleOverlay",icon:"pi pi-history",label:n(()=>ce("queue.toggleJobHistory"),"label"),menubarLabel:n(()=>ce("queue.jobHistory"),"menubarLabel"),versionAdded:"1.37.0",category:"view-controls",function:n(()=>{In().toggleOverlay()},"function"),active:n(()=>In().isOverlayExpanded,"active")},{id:"Comfy.QueuePrompt",icon:"pi pi-play",label:"Queue Prompt",versionAdded:"1.3.7",category:"essentials",function:n(async _=>{if(!xn.value){Sn();return}const S=wo().batchCount;await J.queuePrompt(0,S)},"function")},{id:"Comfy.QueuePromptFront",icon:"pi pi-play",label:"Queue Prompt (Front)",versionAdded:"1.3.7",category:"essentials",function:n(async _=>{if(!xn.value){Sn();return}const S=wo().batchCount;await J.queuePrompt(-1,S)},"function")},{id:"Comfy.QueueSelectedOutputNodes",icon:"pi pi-play",label:"Queue Selected Output Nodes",versionAdded:"1.19.6",function:n(async _=>{if(!xn.value){Sn();return}const S=wo().batchCount,T=w(),M=Ka(T);if(M.length===0){a.add({severity:"error",summary:ce("toastMessages.nothingToQueue"),detail:ce("toastMessages.pleaseSelectOutputNodes"),life:3e3});return}const P=ou(M);if(P.length===0){a.add({severity:"error",summary:ce("toastMessages.failedToQueue"),detail:ce("toastMessages.failedExecutionPathResolution"),life:3e3});return}await J.queuePrompt(0,S,P)},"function")},{id:"Comfy.ShowSettingsDialog",icon:"pi pi-cog",label:"Show Settings Dialog",versionAdded:"1.3.7",category:"view-controls",function:n(()=>{t.showSettingsDialog()},"function")},{id:"Comfy.Graph.GroupSelectedNodes",icon:"pi pi-sitemap",label:"Group Selected Nodes",versionAdded:"1.3.7",category:"essentials",function:n(()=>{const{canvas:_}=J;if(!_.selectedItems?.size){a.add({severity:"error",summary:ce("toastMessages.nothingToGroup"),detail:ce("toastMessages.pleaseSelectNodesToGroup"),life:3e3});return}const S=new Ot,T=re().get("Comfy.GroupSelectedNodes.Padding");S.resizeTo(_.selectedItems,T),_.graph?.add(S),S.recomputeInsideNodes(),an().titleEditorTarget=S},"function")},{id:"Workspace.NextOpenedWorkflow",icon:"pi pi-step-forward",label:"Next Opened Workflow",versionAdded:"1.3.9",function:n(async()=>{await e.loadNextOpenedWorkflow()},"function")},{id:"Workspace.PreviousOpenedWorkflow",icon:"pi pi-step-backward",label:"Previous Opened Workflow",versionAdded:"1.3.9",function:n(async()=>{await e.loadPreviousOpenedWorkflow()},"function")},{id:"Comfy.Canvas.ToggleSelectedNodes.Mute",icon:"pi pi-volume-off",label:"Mute/Unmute Selected Nodes",versionAdded:"1.3.11",category:"essentials",function:n(()=>{h(We.NEVER),J.canvas.setDirty(!0,!0)},"function")},{id:"Comfy.Canvas.ToggleSelectedNodes.Bypass",icon:"pi pi-shield",label:"Bypass/Unbypass Selected Nodes",versionAdded:"1.3.11",category:"essentials",function:n(()=>{h(We.BYPASS),J.canvas.setDirty(!0,!0)},"function")},{id:"Comfy.Canvas.ToggleSelectedNodes.Pin",icon:"pi pi-pin",label:"Pin/Unpin Selected Nodes",versionAdded:"1.3.11",category:"essentials",function:n(()=>{w().forEach(_=>{_.pin(!_.pinned)}),J.canvas.setDirty(!0,!0)},"function")},{id:"Comfy.Canvas.ToggleSelected.Pin",icon:"pi pi-pin",label:"Pin/Unpin Selected Items",versionAdded:"1.3.33",function:n(()=>{for(const _ of J.canvas.selectedItems)(_ instanceof ht||_ instanceof Ot)&&_.pin(!_.pinned);J.canvas.setDirty(!0,!0)},"function")},{id:"Comfy.Canvas.Resize",icon:"pi pi-minus",label:"Resize Selected Nodes",versionAdded:"",function:n(()=>{w().forEach(_=>{const S=_.computeSize();_.setSize([S[0],S[1]])}),J.canvas.setDirty(!0,!0)},"function")},{id:"Comfy.Canvas.ToggleSelectedNodes.Collapse",icon:"pi pi-minus",label:"Collapse/Expand Selected Nodes",versionAdded:"1.3.11",function:n(()=>{w().forEach(_=>{_.collapse()}),J.canvas.setDirty(!0,!0)},"function")},{id:"Comfy.ToggleTheme",icon:"pi pi-moon",label:"Toggle Theme (Dark/Light)",versionAdded:"1.3.12",function:(()=>{let _=nu.id,S=su.id;return async()=>{const T=re(),M=s.completedActivePalette;M.light_theme?(S=M.id,await T.set("Comfy.ColorPalette",_)):(_=M.id,await T.set("Comfy.ColorPalette",S))}})()},{id:"Workspace.ToggleBottomPanel",icon:"pi pi-list",label:"Toggle Bottom Panel",menubarLabel:"Bottom Panel",versionAdded:"1.3.22",category:"view-controls",function:n(()=>{v.toggleBottomPanel()},"function"),active:n(()=>v.bottomPanelVisible,"active")},{id:"Workspace.ToggleFocusMode",icon:"pi pi-eye",label:"Toggle Focus Mode",menubarLabel:"Focus Mode",versionAdded:"1.3.27",category:"view-controls",function:n(()=>{rt().toggleFocusMode()},"function"),active:n(()=>rt().focusMode,"active")},{id:"Comfy.Graph.FitGroupToContents",icon:"pi pi-expand",label:"Fit Group To Contents",versionAdded:"1.4.9",function:n(()=>{for(const _ of J.canvas.selectedItems)if(_ instanceof Ot){_.recomputeInsideNodes();const S=re().get("Comfy.GroupSelectedNodes.Padding");_.resizeTo(_.children,S),J.canvas.setDirty(!1,!0)}},"function")},{id:"Comfy.Help.OpenComfyUIIssues",icon:"pi pi-github",label:"Open ComfyUI Issues",menubarLabel:"ComfyUI Issues",versionAdded:"1.5.5",function:n(()=>{window.open(u.githubIssues,"_blank")},"function")},{id:"Comfy.Help.OpenComfyUIDocs",icon:"pi pi-info-circle",label:"Open ComfyUI Docs",menubarLabel:"ComfyUI Docs",versionAdded:"1.5.5",function:n(()=>{window.open(p("/",{includeLocale:!0}),"_blank")},"function")},{id:"Comfy.Help.OpenComfyOrgDiscord",icon:"pi pi-discord",label:"Open Comfy-Org Discord",menubarLabel:"Comfy-Org Discord",versionAdded:"1.5.5",function:n(()=>{window.open(u.discord,"_blank")},"function")},{id:"Workspace.SearchBox.Toggle",icon:"pi pi-search",label:"Toggle Search Box",versionAdded:"1.5.7",function:n(()=>{ys().toggleVisible()},"function")},{id:"Comfy.Help.AboutComfyUI",icon:"pi pi-info-circle",label:"Open About ComfyUI",menubarLabel:"About ComfyUI",versionAdded:"1.6.4",function:n(()=>{t.showSettingsDialog("about")},"function")},{id:"Comfy.DuplicateWorkflow",icon:"pi pi-clone",label:"Duplicate Current Workflow",versionAdded:"1.6.15",function:n(async()=>{await e.duplicateWorkflow(o.activeWorkflow)},"function")},{id:"Workspace.CloseWorkflow",icon:"pi pi-times",label:"Close Current Workflow",versionAdded:"1.7.3",function:n(async()=>{o.activeWorkflow&&await e.closeWorkflow(o.activeWorkflow)},"function")},{id:"Comfy.ContactSupport",icon:"pi pi-question",label:"Contact Support",versionAdded:"1.17.8",function:n(()=>{const{userEmail:_,resolvedUserInfo:S}=Ut(),T=V1({userEmail:_.value,userId:S.value?.id});window.open(T,"_blank")},"function")},{id:"Comfy.Help.OpenComfyUIForum",icon:"pi pi-comments",label:"Open ComfyUI Forum",menubarLabel:"ComfyUI Forum",versionAdded:"1.8.2",function:n(()=>{window.open(u.forum,"_blank")},"function")},{id:"Comfy.Canvas.DeleteSelectedItems",icon:"pi pi-trash",label:"Delete Selected Items",versionAdded:"1.10.5",function:n(()=>{J.canvas.deleteSelected(),J.canvas.setDirty(!0,!0)},"function")},{id:"Comfy.Manager.CustomNodesManager.ShowCustomNodesMenu",icon:"pi pi-puzzle",label:"Custom Nodes Manager",versionAdded:"1.12.10",function:n(async()=>{await vt().openManager({showToastOnLegacyError:!0})},"function")},{id:"Comfy.Manager.ShowUpdateAvailablePacks",icon:"pi pi-sync",label:"Check for Custom Node Updates",versionAdded:"1.17.0",function:n(async()=>{const _=vt();if(_.managerUIState.value===au.DISABLED){a.add({severity:"error",summary:ce("g.error"),detail:ce("manager.notAvailable"),life:3e3});return}await _.openManager({initialTab:to.UpdateAvailable,showToastOnLegacyError:!1})},"function")},{id:"Comfy.Manager.ShowMissingPacks",icon:"pi pi-exclamation-circle",label:"Install Missing Custom Nodes",versionAdded:"1.17.0",function:n(async()=>{await vt().openManager({initialTab:to.Missing,showToastOnLegacyError:!1})},"function")},{id:"Comfy.User.OpenSignInDialog",icon:"pi pi-user",label:"Open Sign In Dialog",versionAdded:"1.17.6",function:n(async()=>{await t.showSignInDialog()},"function")},{id:"Comfy.User.SignOut",icon:"pi pi-sign-out",label:"Sign Out",versionAdded:"1.18.1",function:n(async()=>{await l.logout()},"function")},{id:"Comfy.Canvas.MoveSelectedNodes.Up",icon:"pi pi-arrow-up",label:"Move Selected Nodes Up",versionAdded:Ro,function:n(()=>x(([_,S],T)=>[_,S-T]),"function")},{id:"Comfy.Canvas.MoveSelectedNodes.Down",icon:"pi pi-arrow-down",label:"Move Selected Nodes Down",versionAdded:Ro,function:n(()=>x(([_,S],T)=>[_,S+T]),"function")},{id:"Comfy.Canvas.MoveSelectedNodes.Left",icon:"pi pi-arrow-left",label:"Move Selected Nodes Left",versionAdded:Ro,function:n(()=>x(([_,S],T)=>[_-T,S]),"function")},{id:"Comfy.Canvas.MoveSelectedNodes.Right",icon:"pi pi-arrow-right",label:"Move Selected Nodes Right",versionAdded:Ro,function:n(()=>x(([_,S],T)=>[_+T,S]),"function")},{id:"Comfy.Graph.ConvertToSubgraph",icon:"icon-[lucide--shrink]",label:"Convert Selection to Subgraph",versionAdded:"1.20.1",category:"essentials",function:n(()=>{const _=i.getCanvas(),S=_.subgraph??_.graph;if(!S)throw new TypeError("Canvas has no graph or subgraph set.");const T=S.convertToSubgraph(_.selectedItems);if(!T){a.add({severity:"error",summary:ce("toastMessages.cannotCreateSubgraph"),detail:ce("toastMessages.failedToConvertToSubgraph"),life:3e3});return}const{node:M}=T;_.select(M),i.updateSelectedItems()},"function")},{id:"Comfy.Graph.UnpackSubgraph",icon:"icon-[lucide--expand]",label:"Unpack the selected Subgraph",versionAdded:"1.26.3",function:n(()=>{const{unpackSubgraph:_}=Qa();_()},"function")},{id:"Comfy.Graph.EditSubgraphWidgets",label:"Edit Subgraph Widgets",icon:"icon-[lucide--settings-2]",versionAdded:"1.28.5",function:n(()=>{io().openPanel("subgraph")},"function")},{id:"Comfy.Graph.ToggleWidgetPromotion",icon:"icon-[lucide--arrow-left-right]",label:"Toggle promotion of hovered widget",versionAdded:"1.30.1",function:eu},{id:"Comfy.OpenManagerDialog",icon:"mdi mdi-puzzle-outline",label:"Manager",function:n(async()=>{await vt().openManager({initialTab:to.All,showToastOnLegacyError:!1})},"function")},{id:"Comfy.ToggleHelpCenter",icon:"pi pi-question-circle",label:"Help Center",function:n(()=>{Ln().toggle()},"function"),active:n(()=>Ln().isVisible,"active")},{id:"Comfy.ToggleCanvasInfo",icon:"pi pi-info-circle",label:"Canvas Performance",function:n(async()=>{const _=re(),S=_.get("Comfy.Graph.CanvasInfo");await _.set("Comfy.Graph.CanvasInfo",!S)},"function"),active:n(()=>re().get("Comfy.Graph.CanvasInfo"),"active")},{id:"Workspace.ToggleBottomPanel.Shortcuts",icon:"pi pi-key",label:"Show Keybindings Dialog",versionAdded:"1.24.1",category:"view-controls",function:n(()=>{v.togglePanel("shortcuts")},"function")},{id:"Comfy.Graph.ExitSubgraph",icon:"pi pi-arrow-up",label:"Exit Subgraph",versionAdded:"1.20.1",function:n(()=>{const _=he().getCanvas(),S=Xn();_.graph&&_.setGraph(S.navigationStack.at(-2)??_.graph.rootGraph)},"function")},{id:"Comfy.Dev.ShowModelSelector",icon:"pi pi-box",label:"Show Model Selector (Dev)",versionAdded:"1.26.2",category:"view-controls",function:n(()=>{A1().show()},"function")},{id:"Comfy.Manager.CustomNodesManager.ShowLegacyCustomNodesMenu",icon:"pi pi-bars",label:"Custom Nodes (Legacy)",versionAdded:"1.16.4",function:n(async()=>{await vt().openManager({legacyCommand:"Comfy.Manager.CustomNodesManager.ToggleVisibility",showToastOnLegacyError:!0,isLegacyOnly:!0})},"function")},{id:"Comfy.Manager.ShowLegacyManagerMenu",icon:"mdi mdi-puzzle",label:"Manager Menu (Legacy)",versionAdded:"1.16.4",function:n(async()=>{await vt().openManager({showToastOnLegacyError:!0,isLegacyOnly:!0})},"function")},{id:"Comfy.Memory.UnloadModels",icon:"mdi mdi-vacuum-outline",label:"Unload Models",versionAdded:"1.16.4",function:n(async()=>{if(!re().get("Comfy.Memory.AllowManualUnload")){Dt().add({severity:"error",summary:ce("g.error"),detail:ce("g.commandProhibited",{command:"Comfy.Memory.UnloadModels"}),life:3e3});return}await Te.freeMemory({freeExecutionCache:!1})},"function")},{id:"Comfy.Memory.UnloadModelsAndExecutionCache",icon:"mdi mdi-vacuum-outline",label:"Unload Models and Execution Cache",versionAdded:"1.16.4",function:n(async()=>{if(!re().get("Comfy.Memory.AllowManualUnload")){Dt().add({severity:"error",summary:ce("g.error"),detail:ce("g.commandProhibited",{command:"Comfy.Memory.UnloadModelsAndExecutionCache"}),life:3e3});return}await Te.freeMemory({freeExecutionCache:!0})},"function")},{id:"Comfy.BrowseModelAssets",icon:"pi pi-folder-open",label:"Experimental: Browse Model Assets",versionAdded:"1.28.3",function:n(async()=>{if(!re().get("Comfy.Assets.UseAssetAPI")){if(!await t.confirm({title:"Enable Asset API",message:"The Asset API is currently disabled. Would you like to enable it?",type:"default"}))return;await re().set("Comfy.Assets.UseAssetAPI",!0),await e.reloadCurrentWorkflow()}await qc().browse({assetType:"models",title:ce("sideToolbar.modelLibrary"),onAssetSelected:n(S=>{const T=L1(S);T.success||(a.add({severity:"error",summary:ce("g.error"),detail:ce("assetBrowser.failedToCreateNode")}),console.error("Node creation failed:",T.error))},"onAssetSelected")})},"function")},{id:"Comfy.ToggleAssetAPI",icon:"pi pi-database",label:n(()=>`Experimental: ${re().get("Comfy.Assets.UseAssetAPI")?"Disable":"Enable"} AssetAPI`,"label"),function:n(async()=>{const _=re(),S=_.get("Comfy.Assets.UseAssetAPI")??!1;await _.set("Comfy.Assets.UseAssetAPI",!S),await tt().reloadCurrentWorkflow()},"function")},{id:"Comfy.ToggleQPOV2",icon:"pi pi-list",label:"Toggle Queue Panel V2",function:N},{id:"Comfy.ToggleLinear",icon:"pi pi-database",label:"toggle linear mode",function:n(()=>i.linearMode=!i.linearMode,"function")}].map(_=>({..._,source:"System"}))}n(R1,"useCoreCommands");const O1=n(()=>{const e="/assets/images/favicon_progress_16x16/frame_9.png",o=ti(e),t=dt(),s=10;se([()=>t.executionProgress,()=>t.isIdle],([l,a])=>{if(a)o.value=e;else{const i=Math.min(Math.max(0,Math.floor(l*s)),s-1);o.value=`/assets/images/favicon_progress_16x16/frame_${i}.png`}})},"useProgressFavicon");var On=(e=>(e.NoPreviews="none",e.Auto="auto",e.Latent2RGB="latent2rgb",e.TAESD="taesd",e))(On||{}),Wn=(e=>(e.DEBUG="DEBUG",e.INFO="INFO",e.WARNING="WARNING",e.ERROR="ERROR",e.CRITICAL="CRITICAL",e))(Wn||{}),zn=(e=>(e.MD5="md5",e.SHA1="sha1",e.SHA256="sha256",e.SHA512="sha512",e))(zn||{}),Xt=(e=>(e.Auto="auto",e.Disable="disable",e.Enable="enable",e))(Xt||{}),Me=(e=>(e.AUTO="auto",e.FP64="fp64",e.FP32="fp32",e.FP16="fp16",e.BF16="bf16",e.FP8E4M3FN="fp8_e4m3fn",e.FP8E5M2="fp8_e5m2",e))(Me||{}),Go=(e=>(e.Auto="auto",e.Split="split",e.Quad="quad",e.Pytorch="pytorch",e))(Go||{}),Ho=(e=>(e.Auto="auto",e.GPUOnly="gpu-only",e.HighVram="highvram",e.NormalVram="normalvram",e.LowVram="lowvram",e.NoVram="novram",e.CPU="cpu",e))(Ho||{});const W1=[{id:"listen",name:"Host: The IP address to listen on",category:["Network"],type:"text",defaultValue:"127.0.0.1"},{id:"port",name:"Port: The port to listen on",category:["Network"],type:"number",defaultValue:8e3},{id:"tls-keyfile",name:"TLS Key File: Path to TLS key file for HTTPS",category:["Network"],type:"text",defaultValue:""},{id:"tls-certfile",name:"TLS Certificate File: Path to TLS certificate file for HTTPS",category:["Network"],type:"text",defaultValue:""},{id:"enable-cors-header",name:'Enable CORS header: Use "*" for all origins or specify domain',category:["Network"],type:"text",defaultValue:""},{id:"max-upload-size",name:"Maximum upload size (MB)",category:["Network"],type:"number",defaultValue:100},{id:"cuda-device",name:"CUDA device index to use",category:["CUDA"],type:"number",defaultValue:null},{id:"cuda-malloc",name:"Use CUDA malloc for memory allocation",category:["CUDA"],type:"combo",options:Object.values(Xt),defaultValue:Xt.Auto,getValue:n(e=>{switch(e){case Xt.Auto:return{};case Xt.Enable:return{"cuda-malloc":!0};case Xt.Disable:return{"disable-cuda-malloc":!0}}},"getValue")},{id:"global-precision",name:"Global floating point precision",category:["Inference"],type:"combo",options:[Me.AUTO,Me.FP32,Me.FP16],defaultValue:Me.AUTO,tooltip:"Global floating point precision",getValue:n(e=>{switch(e){case Me.AUTO:return{};case Me.FP32:return{"force-fp32":!0};case Me.FP16:return{"force-fp16":!0};default:return{}}},"getValue")},{id:"unet-precision",name:"UNET precision",category:["Inference"],type:"combo",options:[Me.AUTO,Me.FP64,Me.FP32,Me.FP16,Me.BF16,Me.FP8E4M3FN,Me.FP8E5M2],defaultValue:Me.AUTO,tooltip:"UNET precision",getValue:n(e=>{switch(e){case Me.AUTO:return{};default:return{[`${e.toLowerCase()}-unet`]:!0}}},"getValue")},{id:"vae-precision",name:"VAE precision",category:["Inference"],type:"combo",options:[Me.AUTO,Me.FP16,Me.FP32,Me.BF16],defaultValue:Me.AUTO,tooltip:"VAE precision",getValue:n(e=>{switch(e){case Me.AUTO:return{};default:return{[`${e.toLowerCase()}-vae`]:!0}}},"getValue")},{id:"cpu-vae",name:"Run VAE on CPU",category:["Inference"],type:"boolean",defaultValue:!1},{id:"text-encoder-precision",name:"Text Encoder precision",category:["Inference"],type:"combo",options:[Me.AUTO,Me.FP8E4M3FN,Me.FP8E5M2,Me.FP16,Me.FP32],defaultValue:Me.AUTO,tooltip:"Text Encoder precision",getValue:n(e=>{switch(e){case Me.AUTO:return{};default:return{[`${e.toLowerCase()}-text-enc`]:!0}}},"getValue")},{id:"force-channels-last",name:"Force channels-last memory format",category:["Memory"],type:"boolean",defaultValue:!1},{id:"directml",name:"DirectML device index",category:["Memory"],type:"number",defaultValue:null},{id:"disable-ipex-optimize",name:"Disable IPEX optimization",category:["Memory"],type:"boolean",defaultValue:!1},{id:"preview-method",name:"Method used for latent previews",category:["Preview"],type:"combo",options:Object.values(On),defaultValue:On.NoPreviews},{id:"preview-size",name:"Size of preview images",category:["Preview"],type:"slider",defaultValue:512,attrs:{min:128,max:2048,step:128}},{id:"cache-classic",name:"Use classic cache system",category:["Cache"],type:"boolean",defaultValue:!1},{id:"cache-lru",name:"Use LRU caching with a maximum of N node results cached.",category:["Cache"],type:"number",defaultValue:null,tooltip:"May use more RAM/VRAM."},{id:"cross-attention-method",name:"Cross attention method",category:["Attention"],type:"combo",options:Object.values(Go),defaultValue:Go.Auto,getValue:n(e=>{switch(e){case Go.Auto:return{};default:return{[`use-${e.toLowerCase()}-cross-attention`]:!0}}},"getValue")},{id:"disable-xformers",name:"Disable xFormers optimization",type:"boolean",defaultValue:!1},{id:"force-upcast-attention",name:"Force attention upcast",category:["Attention"],type:"boolean",defaultValue:!1},{id:"dont-upcast-attention",name:"Prevent attention upcast",category:["Attention"],type:"boolean",defaultValue:!1},{id:"vram-management",name:"VRAM management mode",category:["Memory"],type:"combo",options:Object.values(Ho),defaultValue:Ho.Auto,getValue:n(e=>{switch(e){case Ho.Auto:return{};default:return{[e]:!0}}},"getValue")},{id:"reserve-vram",name:"Reserved VRAM (GB)",category:["Memory"],type:"number",defaultValue:null,tooltip:"Set the amount of vram in GB you want to reserve for use by your OS/other software. By default some amount is reserved depending on your OS."},{id:"default-hashing-function",name:"Default hashing function for model files",type:"combo",options:Object.values(zn),defaultValue:zn.SHA256},{id:"disable-smart-memory",name:"Disable smart memory management",tooltip:"Force ComfyUI to aggressively offload to regular ram instead of keeping models in vram when it can.",category:["Memory"],type:"boolean",defaultValue:!1},{id:"deterministic",name:"Make pytorch use slower deterministic algorithms when it can.",type:"boolean",defaultValue:!1,tooltip:"Note that this might not make images deterministic in all cases."},{id:"fast",name:"Enable some untested and potentially quality deteriorating optimizations.",type:"boolean",defaultValue:!1},{id:"dont-print-server",name:"Don't print server output to console.",type:"boolean",defaultValue:!1},{id:"disable-metadata",name:"Disable saving prompt metadata in files.",type:"boolean",defaultValue:!1},{id:"enable-manager-legacy-ui",name:"Use legacy Manager UI",tooltip:"Uses the legacy ComfyUI-Manager UI instead of the new UI.",type:"boolean",defaultValue:!1},{id:"disable-all-custom-nodes",name:"Disable loading all custom nodes.",type:"boolean",defaultValue:!1},{id:"log-level",name:"Logging verbosity level",type:"combo",options:Object.values(Wn),defaultValue:Wn.INFO,getValue:n(e=>({verbose:e}),"getValue")},{id:"input-directory",name:"Input directory",category:["Directories"],type:"text",defaultValue:""},{id:"output-directory",name:"Output directory",category:["Directories"],type:"text",defaultValue:""}],z1={key:0,role:"status","aria-live":"polite",class:"fixed inset-x-0 bottom-6 z-9999 mx-auto w-4/5 max-w-3xl overflow-hidden rounded-lg border border-border-default bg-base-background shadow-lg"},Il=q({__name:"HoneyToast",props:Zo({visible:{type:Boolean}},{expanded:{type:Boolean,default:!1},expandedModifiers:{}}),emits:["update:expanded"],setup(e){const o=ko(e,"expanded");function t(){o.value=!o.value}return n(t,"toggle"),(s,l)=>(d(),O(Mt,{to:"body"},[R(Xo,{"enter-active-class":"transition-all duration-300 ease-out","enter-from-class":"translate-y-full opacity-0","enter-to-class":"translate-y-0 opacity-100","leave-active-class":"transition-all duration-200 ease-in","leave-from-class":"translate-y-0 opacity-100","leave-to-class":"translate-y-full opacity-0"},{default:A(()=>[s.visible?(d(),$("div",z1,[c("div",{class:K(m(ne)("overflow-hidden transition-all duration-300",o.value?"max-h-[400px]":"max-h-0"))},[ye(s.$slots,"default",{isExpanded:o.value})],2),ye(s.$slots,"footer",{isExpanded:o.value,toggle:t})])):E("",!0)]),_:3})]))}}),ya=q({__name:"StatusBadge",props:{label:{},severity:{default:"default"}},setup(e){function o(t){const s="inline-flex h-3.5 items-center justify-center rounded-full px-1 text-xxxs font-semibold uppercase";switch(t){case"danger":return`${s} bg-destructive-background text-white`;case"contrast":return`${s} bg-base-foreground text-base-background`;case"warn":return`${s} bg-warning-background text-base-background`;case"secondary":return`${s} bg-secondary-background text-base-foreground`;default:return`${s} bg-primary-background text-base-foreground`}}return n(o,"badgeClasses"),(t,s)=>(d(),$("span",{class:K(o(t.severity))},V(t.label),3))}}),B1={class:"min-w-0 flex-1"},F1={class:"block truncate text-sm text-base-foreground"},U1={class:"flex flex-shrink-0 items-center gap-2"},G1={class:"text-xs text-base-foreground"},H1={key:3,class:"text-xs text-muted-foreground"},j1=q({__name:"ProgressToastItem",props:{job:{}},setup(e){const{t:o}=pe(),t=b(()=>Math.round(e.job.progress*100)),s=b(()=>e.job.status==="completed"),l=b(()=>e.job.status==="failed"),a=b(()=>e.job.status==="running"),i=b(()=>e.job.status==="created");return(r,u)=>(d(),$("div",{class:K(m(ne)("flex items-center justify-between rounded-lg bg-modal-card-background px-4 py-3",s.value&&"opacity-50"))},[c("div",B1,[c("span",F1,V(r.job.assetName),1)]),c("div",U1,[l.value?(d(),$(oe,{key:0},[u[0]||(u[0]=c("i",{class:"icon-[lucide--circle-alert] size-4 text-destructive-background"},null,-1)),R(ya,{label:m(o)("progressToast.failed"),severity:"danger"},null,8,["label"])],64)):s.value?(d(),O(ya,{key:1,label:m(o)("progressToast.finished"),severity:"contrast"},null,8,["label"])):a.value?(d(),$(oe,{key:2},[u[1]||(u[1]=c("i",{class:"icon-[lucide--loader-circle] size-4 animate-spin text-base-foreground"},null,-1)),c("span",G1,V(t.value)+"% ",1)],64)):i.value?(d(),$("span",H1,V(m(o)("progressToast.pending")),1)):E("",!0)])],2))}}),q1={class:"flex h-12 items-center justify-between border-b border-border-default px-4"},K1={class:"text-sm font-bold text-base-foreground"},Q1={class:"flex items-center gap-2"},Y1={class:"flex min-w-30 flex-col items-stretch rounded-lg border border-interface-stroke bg-interface-panel-surface px-2 py-3"},J1={class:"relative max-h-75 overflow-y-auto px-4 py-4"},X1={key:0,class:"absolute right-1 top-4 h-12 w-1 rounded-full bg-muted-foreground"},Z1={class:"flex flex-col gap-2"},ek={key:1,class:"flex flex-col items-center justify-center py-6 text-center"},tk={class:"text-sm text-muted-foreground"},ok={class:"flex h-12 items-center justify-between gap-2 border-t border-border-default px-4"},nk={class:"flex min-w-0 flex-1 items-center gap-2 text-sm"},sk={class:"min-w-0 flex-1 truncate font-bold text-base-foreground"},ak={class:"min-w-0 truncate font-bold text-base-foreground"},lk={class:"min-w-0 truncate font-bold text-base-foreground"},ik={class:"flex flex-shrink-0 items-center gap-2"},rk={key:0,class:"whitespace-nowrap text-sm text-muted-foreground"},uk={class:"flex items-center"},ck=q({__name:"ModelImportProgressDialog",setup(e){const{t:o}=pe(),t=lu(),s=b(()=>t.hasDownloads),l=L(!1),a=L("all"),i=L(null);St(()=>!l.value,()=>i.value?.hide());const r=[{value:"all",label:"all"},{value:"completed",label:"completed"},{value:"failed",label:"failed"}];function u(I){i.value?.toggle(I)}n(u,"onFilterClick");function p(I){a.value=I,i.value?.hide()}n(p,"setFilter");const g=b(()=>t.downloadList),v=b(()=>t.finishedDownloads.filter(I=>I.status==="completed")),f=b(()=>t.finishedDownloads.filter(I=>I.status==="failed")),k=b(()=>t.hasActiveDownloads),w=b(()=>g.value.find(_=>_.status==="running")?.assetName||o("progressToast.downloadingModel")),h=b(()=>v.value.length+f.value.length),C=b(()=>g.value.length),y=b(()=>{switch(a.value){case"completed":return v.value;case"failed":return f.value;default:return g.value}}),N=b(()=>{const I=r.find(_=>_.value===a.value);return o(I?`progressToast.filter.${I.label}`:"progressToast.filter.all")});function x(){t.clearFinishedDownloads(),l.value=!1}return n(x,"closeDialog"),(I,_)=>(d(),O(Il,{expanded:l.value,"onUpdate:expanded":_[0]||(_[0]=S=>l.value=S),visible:s.value},{default:A(()=>[c("div",q1,[c("h3",K1,V(m(o)("progressToast.importingModels")),1),c("div",Q1,[R(Z,{variant:"secondary",size:"md",class:"gap-1.5 px-2",onClick:u},{default:A(()=>[_[1]||(_[1]=c("i",{class:"icon-[lucide--list-filter] size-4"},null,-1)),c("span",null,V(N.value),1),_[2]||(_[2]=c("i",{class:"icon-[lucide--chevron-down] size-3"},null,-1))]),_:1}),R(m(et),{ref_key:"filterPopoverRef",ref:i,dismissable:!0,"close-on-escape":!0,unstyled:"","base-z-index":9999,pt:{root:{class:"absolute z-50"},content:{class:"bg-transparent border-none p-0 pt-2 rounded-lg shadow-lg"}}},{default:A(()=>[c("div",Y1,[(d(),$(oe,null,be(r,S=>R(Z,{key:S.value,variant:"textonly",size:"sm",class:K(m(ne)("w-full justify-start bg-transparent",a.value===S.value&&"bg-secondary-background-selected")),onClick:n(T=>p(S.value),"onClick")},{default:A(()=>[$e(V(m(o)(`progressToast.filter.${S.label}`)),1)]),_:2},1032,["class","onClick"])),64))])]),_:1},512)])]),c("div",J1,[y.value.length>3?(d(),$("div",X1)):E("",!0),c("div",Z1,[(d(!0),$(oe,null,be(y.value,S=>(d(),O(j1,{key:S.taskId,job:S},null,8,["job"]))),128))]),y.value.length===0?(d(),$("div",ek,[c("span",tk,V(m(o)("progressToast.noImportsInQueue",{filter:N.value})),1)])):E("",!0)])]),footer:A(({toggle:S})=>[c("div",ok,[c("div",nk,[k.value?(d(),$(oe,{key:0},[_[3]||(_[3]=c("i",{class:"icon-[lucide--loader-circle] size-4 flex-shrink-0 animate-spin text-muted-foreground"},null,-1)),c("span",sk,V(w.value),1)],64)):f.value.length>0?(d(),$(oe,{key:1},[_[4]||(_[4]=c("i",{class:"icon-[lucide--circle-alert] size-4 flex-shrink-0 text-destructive-background"},null,-1)),c("span",ak,V(m(o)("progressToast.downloadsFailed",{count:f.value.length})),1)],64)):(d(),$(oe,{key:2},[_[5]||(_[5]=c("i",{class:"icon-[lucide--check-circle] size-4 flex-shrink-0 text-jade-600"},null,-1)),c("span",lk,V(m(o)("progressToast.allDownloadsCompleted")),1)],64))]),c("div",ik,[k.value?(d(),$("span",rk,V(m(o)("progressToast.progressCount",{completed:h.value,total:C.value})),1)):E("",!0),c("div",uk,[R(Z,{variant:"muted-textonly",size:"icon","aria-label":l.value?m(o)("contextMenu.Collapse"):m(o)("contextMenu.Expand"),onClick:Ce(S,["stop"])},{default:A(()=>[c("i",{class:K(m(ne)("size-4",l.value?"icon-[lucide--chevron-down]":"icon-[lucide--chevron-up]"))},null,2)]),_:2},1032,["aria-label","onClick"]),k.value?E("",!0):(d(),O(Z,{key:0,variant:"muted-textonly",size:"icon","aria-label":m(o)("g.close"),onClick:Ce(x,["stop"])},{default:A(()=>_[6]||(_[6]=[c("i",{class:"icon-[lucide--x] size-4"},null,-1)])),_:1},8,["aria-label"]))])])])]),_:1},8,["expanded","visible"]))}}),dk=10080*60*1e3,Ml=At("versionCompatibility",()=>{const e=es(),o=re(),t=b(()=>iu.app_version),s=b(()=>e.systemStats?.system?.comfyui_version??""),l=b(()=>e.systemStats?.system?.required_frontend_version??""),a=b(()=>!t.value||!l.value||!Vt.valid(t.value)||!Vt.valid(l.value)?!1:Vt.gt(l.value,t.value)),i=b(()=>!1),r=b(()=>a.value),u=b(()=>!t.value||!s.value||!l.value?null:`${t.value}-${s.value}-${l.value}`),p=oi("comfy.versionMismatch.dismissals",{},localStorage,{serializer:{read:n(y=>{try{return JSON.parse(y)}catch{return{}}},"read"),write:n(y=>JSON.stringify(y),"write")}}),g=b(()=>{if(!u.value)return!1;const y=p.value[u.value];return y?Date.now()<y:!1}),v=b(()=>o.get("Comfy.VersionCompatibility.DisableWarnings")),f=b(()=>r.value&&!g.value&&!v.value),k=b(()=>a.value?{type:"outdated",frontendVersion:t.value,requiredVersion:l.value}:null);async function w(){e.systemStats||await Ta(e.isInitialized)}n(w,"checkVersionCompatibility");function h(){if(!u.value)return;const y=Date.now()+dk;p.value={...p.value,[u.value]:y}}n(h,"dismissWarning");async function C(){await w()}return n(C,"initialize"),{frontendVersion:t,backendVersion:s,requiredFrontendVersion:l,hasVersionMismatch:r,shouldShowWarning:f,warningMessage:k,isFrontendOutdated:a,isFrontendNewer:i,checkVersionCompatibility:w,dismissWarning:h,initialize:C}});function pk(e={}){const{immediate:o=!1}=e,{t}=pe(),s=Dt(),l=Ml();let a=!1;const i=n(()=>{if(a)return;const r=l.warningMessage;if(!r)return;const u=t("g.frontendOutdated",{frontendVersion:r.frontendVersion,requiredVersion:r.requiredVersion}),p=t("g.versionMismatchWarningMessage",{warning:t("g.versionMismatchWarning"),detail:u});s.addAlert(p),a=!0,l.dismissWarning()},"showWarning");return ze(async()=>{o&&(await Fe(),St(()=>l.shouldShowWarning,()=>{i()},{immediate:!0,once:!0}))}),{showWarning:i,shouldShowWarning:b(()=>l.shouldShowWarning),dismissWarning:l.dismissWarning,hasVersionMismatch:b(()=>l.hasVersionMismatch)}}n(pk,"useFrontendVersionMismatchWarning");function fk(){const e=il(),o=wo();let t=!1,s=0;Te.addEventListener("graphChanged",()=>{o.mode==="change"&&(s?t=!0:(t=!1,J.queuePrompt(0,o.batchCount),s++))}),e.$subscribe(async()=>{s=e.count,!s&&!J.lastExecutionError&&(o.mode==="instant"||o.mode==="change"&&t)&&(t=!1,await J.queuePrompt(0,o.batchCount))},{detached:!0})}n(fk,"setupAutoQueueHandler");const mk={class:"absolute w-full h-full"},gk={class:"workflow-tabs-container pointer-events-auto h-9.5 w-full"},vk={class:"flex h-full items-center"},hk={class:"sidebar-content-container h-full w-full overflow-x-hidden overflow-y-auto border-r-1 border-node-component-border"},yk=["src"],bk={key:0,class:"pointer-events-none object-contain flex-1 max-h-full brightness-50 opacity-10",src:uu},wk={class:"actionbar-container flex h-12 items-center rounded-lg border border-[var(--interface-stroke)] p-2 gap-2 bg-comfy-menu-bg justify-end"},kk={class:"rounded-lg border p-2 gap-2 h-full border-[var(--interface-stroke)] bg-comfy-menu-bg flex flex-col"},Ck={class:"grow-1 flex justify-start flex-col overflow-y-auto contain-size *:max-h-100"},xk={class:"p-4 pb-0 border-t border-node-component-border"},Sk=q({__name:"LinearView",setup(e){const o=$o(),t=Se(),s=b(()=>{function g(v){const f=wl(v,new Map),k=v.widgets?.map(w=>{const h=f(w);return h.callback=function(C){if(Cv(C))return w.value=C??void 0,w.callback?.(w.value)},h})??[];return{id:`${v.id}`,title:v.title,type:v.type,mode:0,selected:!1,executing:!1,widgets:k}}return n(g,"nodeToNodeData"),J.rootGraph.nodes.filter(v=>v.mode===0&&v.widgets?.length).map(g)}),{isLoggedIn:l}=Ut(),a=Ke(),i={options:{step2:1,precision:1,min:1,max:100},value:1,name:ce("Number of generations"),type:"number"},{batchCount:r}=qe(wo());async function u(g){const f="shiftKey"in g&&g.shiftKey?"Comfy.QueuePromptFront":"Comfy.QueuePrompt";r.value>1,await t.execute(f,{metadata:{subscribe_to_run:!1,trigger_source:"button"}})}n(u,"runButtonClick");function p(){window.open("https://support.comfy.org/hc/en-us/requests/new?ticket_form_id=40026345549204","_blank","noopener,noreferrer")}return n(p,"openFeedback"),(g,v)=>(d(),$("div",mk,[c("div",gk,[c("div",vk,[R(Sl),R(xl)])]),R(m(Nn),{class:"h-[calc(100%-38px)] w-full bg-comfy-menu-secondary-bg",pt:{gutter:{class:"bg-transparent w-4 -mx-3"}}},{default:A(()=>[R(m(It),{size:1,class:"min-w-min bg-comfy-menu-bg"},{default:A(()=>[c("div",hk,[R(ms,{extension:m(ru)()},null,8,["extension"])])]),_:1}),R(m(It),{size:98,class:"flex flex-row overflow-y-auto flex-wrap min-w-min gap-4 m-4"},{default:A(()=>[(d(!0),$(oe,null,be(m(o).latestOutput,f=>(d(),$("img",{key:f,class:"pointer-events-none object-contain flex-1 max-h-full",src:f},null,8,yk))),128)),m(o).latestOutput.length===0?(d(),$("img",bk)):E("",!0)]),_:1}),R(m(It),{size:1,class:"flex flex-col gap-1 p-1 min-w-min"},{default:A(()=>[c("div",wk,[R(Z,{variant:"secondary",onClick:p},{default:A(()=>[$e(V(m(ce)("g.feedback")),1)]),_:1}),R(Z,{variant:"secondary",class:"min-w-max",onClick:v[0]||(v[0]=f=>m(he)().linearMode=!1)},{default:A(()=>[$e(V(m(ce)("linearMode.openWorkflow"))+" ",1),v[3]||(v[3]=c("i",{class:"icon-[comfy--workflow]"},null,-1))]),_:1}),R(Z,{variant:"inverted",onClick:v[1]||(v[1]=f=>m(tt)().exportWorkflow("workflow","workflow"))},{default:A(()=>[$e(V(m(ce)("linearMode.share")),1)]),_:1}),m(l)?(d(),O(ps,{key:0})):m(a)?(d(),O(fs,{key:1})):E("",!0)]),c("div",kk,[c("div",Ck,[(d(!0),$(oe,null,be(s.value,f=>(d(),O(ll,{key:f.id,"node-data":f,class:"border-b-1 border-node-component-border pt-1 pb-2 last:border-none"},null,8,["node-data"]))),128))]),c("div",xk,[R(wu,{modelValue:m(r),"onUpdate:modelValue":v[2]||(v[2]=f=>it(r)?r.value=f:null),widget:i,class:"*:[.min-w-56]:basis-0"},null,8,["modelValue"]),R(Z,{class:"w-full mt-4",onClick:u},{default:A(()=>[v[4]||(v[4]=c("i",{class:"icon-[lucide--play]"},null,-1)),$e(" "+V(m(ce)("menu.run")),1)]),_:1})])])]),_:1})]),_:1})]))}}),_k={key:0,class:"flex items-center px-4 py-2"},Tk={class:"flex w-full items-center justify-between py-2"},$k={class:"flex flex-col text-sm leading-normal font-medium"},Nk={class:"text-muted"},Ik={class:"h-full"},Mk={class:"break-words whitespace-pre-wrap"},Pk={class:"flex w-full items-center justify-between px-6 py-2 shadow-lg"},Dk={class:"flex items-center text-base leading-none"},Ak={class:"flex items-center"},Lk={class:"flex items-center gap-4"},Ek={key:0,class:"text-sm text-muted-foreground"},Vk={class:"flex items-center"},Rk=q({__name:"ManagerProgressToast",setup(e){const{t:o}=pe(),t=cu(),s=re(),{runFullConflictAnalysis:l}=Ya(),a=L(!1),i=L(0),r=b(()=>[{label:o("manager.installationQueue")},{label:o("manager.failed",{count:t.failedTasksIds.length})}]),u=b(()=>i.value===0?t.succeededTasksLogs:t.failedTasksLogs),p=b(()=>t.taskLogs.length>0),g=L(!1),v=L(!1),f=b(()=>t.isProcessingTasks||g.value),k=n(F=>{const Q=u.value[F];if(!Q)return!1;const j=t.taskQueue;return j?[...j.running_queue||[],...j.pending_queue||[]].some(te=>te.ui_id===Q.taskId):!1},"isTaskInProgress"),w=b(()=>t.succeededTasksIds.length+t.failedTasksIds.length),h=b(()=>{const F=Object.keys(t.taskHistory).length,Q=t.taskQueue,j=Q?(Q.running_queue?.length||0)+(Q.pending_queue?.length||0):0;return F+j}),C=b(()=>g.value?o("manager.restartingBackend"):v.value?o("manager.extensionsSuccessfullyInstalled"):t.taskLogs.length?t.taskLogs.at(-1)?.taskName??o("manager.installingDependencies"):o("manager.installingDependencies")),y=L({});function N(F){y.value[F]=!y.value[F]}n(N,"togglePanel");const x=L(null),{y:I}=Ma(x,{eventListenerOptions:{passive:!0}}),_=L(null),S=L(!1),T=b(()=>u.value?.at(-1)?.logs);function M(F){return F?Math.abs(F.scrollHeight-F.scrollTop-F.clientHeight)<20:!1}n(M,"isAtBottom");function P(){!_.value||S.value||(_.value.scrollTop=_.value.scrollHeight)}n(P,"scrollLastPanelToBottom");function B(){I.value=x.value?.scrollHeight??0}n(B,"scrollContentToBottom");function H(){S.value=!1}n(H,"resetUserScrolling");function z(F){const Q=F.target;Q===_.value&&(S.value=!M(Q))}n(z,"handleScroll");function G(){S.value||P()}n(G,"onLogsAdded"),St(T,G,{flush:"post",deep:!0}),St(()=>a.value,B),St(()=>!a.value,H);function U(){t.resetTaskState(),a.value=!1}n(U,"closeToast");async function W(){const F=s.get("Comfy.Toast.DisableReconnectingToast");try{await s.set("Comfy.Toast.DisableReconnectingToast",!0),g.value=!0,Re(Te,"reconnected",n(async()=>{try{t.setStale(),await Se().execute("Comfy.RefreshNodeDefinitions"),await tt().reloadCurrentWorkflow(),l()}finally{await s.set("Comfy.Toast.DisableReconnectingToast",F),g.value=!1,v.value=!0,setTimeout(()=>{U()},3e3)}},"onReconnect"),{once:!0}),await Xa().rebootComfyUI()}catch(Q){throw await s.set("Comfy.Toast.DisableReconnectingToast",F),g.value=!1,v.value=!1,U(),Q}}return n(W,"handleRestart"),ze(()=>{B()}),ut(()=>{a.value=!1}),(F,Q)=>(d(),O(Il,{expanded:a.value,"onUpdate:expanded":Q[1]||(Q[1]=j=>a.value=j),visible:p.value},{default:A(()=>[a.value?(d(),$("div",_k,[R(m(vi),{"active-index":i.value,"onUpdate:activeIndex":Q[0]||(Q[0]=j=>i.value=j),model:r.value,class:"w-full border-none",pt:{menu:{class:"border-none"},menuitem:{class:"font-medium"},action:{class:"px-4 py-2"}}},null,8,["active-index","model"])])):E("",!0),c("div",{ref_key:"sectionsContainerRef",ref:x,class:"scroll-container max-h-[450px] overflow-y-auto px-6 py-4",style:{scrollbarWidth:"thin",scrollbarColor:"rgba(156, 163, 175, 0.5) transparent"}},[(d(!0),$(oe,null,be(u.value,(j,Y)=>(d(),$("div",{key:Y},[R(m(Gn),{expanded:y.value[Y]===!0,toggleable:"",class:"shadow-elevation-1 mt-2 rounded-lg"},{header:A(()=>[c("div",Tk,[c("div",$k,[c("span",null,V(j.taskName),1),c("span",Nk,V(k(Y)?m(o)("g.inProgress"):m(o)("g.completed")+" "),1)])])]),toggleicon:A(()=>[R(Z,{variant:"textonly",class:"text-neutral-300",onClick:n(te=>N(Y),"onClick")},{default:A(()=>[c("i",{class:K(y.value[Y]?"pi pi-chevron-right":"pi pi-chevron-down")},null,2)]),_:2},1032,["onClick"])]),default:A(()=>[c("div",{ref_for:!0,ref:Y===u.value.length-1?te=>_.value=te:void 0,class:K(["h-64 overflow-y-auto rounded-lg bg-black",{"h-64":Y!==u.value.length-1,grow:Y===u.value.length-1}]),onScroll:z},[c("div",Ik,[(d(!0),$(oe,null,be(j.logs,(te,X)=>(d(),$("div",{key:X,class:"text-muted"},[c("pre",Mk,V(te),1)]))),128))])],34)]),_:2},1032,["expanded"])]))),128))],512)]),footer:A(({toggle:j})=>[c("div",Pk,[c("div",Dk,[c("div",Ak,[f.value?(d(),$(oe,{key:0},[R(du,{duration:"1s",class:"mr-2"}),c("span",null,V(C.value),1)],64)):v.value?(d(),$(oe,{key:1},[Q[2]||(Q[2]=c("span",{class:"mr-2"},"",-1)),c("span",null,V(C.value),1)],64)):(d(),$(oe,{key:2},[Q[3]||(Q[3]=c("span",{class:"mr-2"},"",-1)),c("span",null,V(m(o)("manager.restartToApplyChanges")),1)],64))])]),c("div",Lk,[f.value?(d(),$("span",Ek,V(w.value)+" "+V(m(o)("g.progressCountOf"))+" "+V(h.value),1)):E("",!0),c("div",Vk,[!f.value&&!v.value?(d(),O(Z,{key:0,variant:"secondary",class:"mr-4 rounded-full border-2 border-base-foreground px-3 text-base-foreground hover:bg-secondary-background-hover",onClick:W},{default:A(()=>[$e(V(m(o)("manager.applyChanges")),1)]),_:1})):v.value?E("",!0):(d(),O(Z,{key:1,variant:"muted-textonly",size:"sm",class:"rounded-full font-bold","aria-label":m(o)(a.value?"contextMenu.Collapse":"contextMenu.Expand"),onClick:Ce(j,["stop"])},{default:A(()=>[c("i",{class:K(a.value?"pi pi-chevron-up":"pi pi-chevron-down")},null,2)]),_:2},1032,["aria-label","onClick"])),R(Z,{variant:"muted-textonly",size:"sm",class:"rounded-full font-bold","aria-label":m(o)("g.close"),onClick:Ce(U,["stop"])},{default:A(()=>Q[4]||(Q[4]=[c("i",{class:"pi pi-times"},null,-1)])),_:1},8,["aria-label"])])])])]),_:1},8,["expanded","visible"]))}}),Ok={class:"comfyui-body grid h-full w-full overflow-hidden"},Wk=q({__name:"GraphView",setup(e){fk(),O1(),S1();const{t:o}=pe(),t=zt(),s=re(),l=dt(),a=pt(),i=Bt(),r=Kn(),u=Ml(),p=L(null),{linearMode:g}=qe(he());Ha(),se(()=>a.completedActivePalette,T=>{const M="dark-theme";T.light_theme?document.body.classList.remove(M):document.body.classList.add(M),Ke()&&bo().changeTheme({color:"rgba(0, 0, 0, 0)",symbolColor:T.colors.comfy_base["input-text"]})},{immediate:!0}),Ke()&&se(()=>i.tasks,(T,M)=>{const P=new Set(M.filter(B=>B.isRunning).map(B=>B.promptId));T.filter(B=>P.has(B.promptId)&&B.isHistory).forEach(B=>{bo().Events.incrementUserProperty(`execution:${B.displayStatus.toLowerCase()}`,1),bo().Events.trackEvent("execution",{status:B.displayStatus.toLowerCase()})})},{deep:!0}),ke(()=>{const T=s.get("Comfy.TextareaWidget.FontSize");document.documentElement.style.setProperty("--comfy-textarea-font-size",`${T}px`)}),ke(()=>{const T=s.get("Comfy.TreeExplorer.ItemPadding");document.documentElement.style.setProperty("--comfy-tree-explorer-item-padding",`${T}px`)}),ke(async()=>{const T=s.get("Comfy.Locale");if(T)try{await pu(T),Ba.global.locale.value=T}catch(M){console.error(`Failed to switch to locale "${T}":`,M)}});const v=b(()=>s.get("Comfy.UseNewMenu"));ke(()=>{v.value==="Disabled"?(J.ui.menuContainer.style.setProperty("display","block"),J.ui.restoreMenuPosition()):J.ui.menuContainer.style.setProperty("display","none")}),ke(()=>{i.maxHistoryItems=s.get("Comfy.Queue.MaxHistoryItems")});const f=n(()=>{const T=R1();Se().registerCommands(T),Za().registerCoreMenuCommands(),gn().registerCoreKeybindings(),jo().registerCoreSidebarTabs(),ro().registerCoreBottomPanelTabs(),J.extensionManager=rt()},"init"),k=il(),w=jo(),h=n(async T=>{k.update(T),await i.update(),w.activeSidebarTabId==="assets"&&await r.updateHistory()},"onStatus"),C=n(async()=>{await i.update(),w.activeSidebarTabId==="assets"&&await r.updateHistory()},"onExecutionSuccess"),y={severity:"error",summary:o("g.reconnecting")},N=n(()=>{s.get("Comfy.Toast.DisableReconnectingToast")||(t.remove(y),t.add(y))},"onReconnecting"),x=n(()=>{s.get("Comfy.Toast.DisableReconnectingToast")||(t.remove(y),t.add({severity:"success",summary:o("g.reconnected"),life:2e3}))},"onReconnected");ze(()=>{Te.addEventListener("status",h),Te.addEventListener("execution_success",C),Te.addEventListener("reconnecting",N),Te.addEventListener("reconnected",x),l.bindExecutionEvents();try{f(),p.value?.prepend(J.ui.menuContainer)}catch(T){console.error("Failed to init ComfyUI frontend",T)}}),ut(()=>{Te.removeEventListener("status",h),Te.removeEventListener("execution_success",C),Te.removeEventListener("reconnecting",N),Te.removeEventListener("reconnected",x),l.unbindExecutionEvents()}),Re(window,"keydown",gn().keybindHandler);const{wrapWithErrorHandling:I,wrapWithErrorHandlingAsync:_}=Ft();pk({immediate:!0}),Fe(()=>{u.initialize().catch(T=>{console.warn("Version compatibility check failed:",T)})});const S=n(()=>{fl(()=>{I(gn().registerUserKeybindings)(),I(bu().loadServerConfig)(W1,s.get("Comfy.Server.ServerConfigValues")),_(fu().loadModelFolders)(),_(ls().loadNodeFrequencies)(),Tt().nodeSearchService.searchNode("")},1e3)},"onGraphReady");return(T,M)=>(d(),$(oe,null,[c("div",Ok,[M[0]||(M[0]=c("div",{id:"comfyui-body-top",class:"comfyui-body-top"},null,-1)),M[1]||(M[1]=c("div",{id:"comfyui-body-bottom",class:"comfyui-body-bottom"},null,-1)),M[2]||(M[2]=c("div",{id:"comfyui-body-left",class:"comfyui-body-left"},null,-1)),M[3]||(M[3]=c("div",{id:"comfyui-body-right",class:"comfyui-body-right"},null,-1)),de(c("div",{id:"graph-canvas-container",ref_key:"graphCanvasContainerRef",ref:p,class:"graph-canvas-container"},[R(b1,{onReady:S})],512),[[Xe,!m(g)]]),m(g)?(d(),O(Sk,{key:0})):E("",!0)]),R(ad),R(C1),R(ck),R(Rk),m(Ke)()?E("",!0):(d(),O(rd,{key:0})),R(id)],64))}}),zk=Le(Wk,[["__scopeId","data-v-5229bbd8"]]),Xk=Object.freeze(Object.defineProperty({__proto__:null,default:zk},Symbol.toStringTag,{value:"Module"}));export{Xk as G,ed as _,nd as a,yd as g};
//# sourceMappingURL=GraphView-0U0T8pwU.js.map
